(function(){var b,rt,et,ui;try{(function(){var n={L_Directions_Arrive_By:"Arrive by",L_Directions_Arrive_Time:"Arrive by {0}\r\n",L_Directions_Last_Train:"Last train",L_Directions_Depart_At:"Leave at",L_Directions_Depart_Time:"Leave at {0}\r\n",L_Directions_Highways:"Avoid dual carriageways",L_Directions_Save_History:"Save destination history",L_Directions_Delete_History:"delete destination history",L_Directions_History_Deleted:"Previous history deleted.\r\n",L_Directions_Options:"Options",L_Directions_Option_Miles:"Miles",L_Directions_Option_Km:"Kilometres",L_Option_Sort_By:"Sort by:",L_Option_Sort_By_Time:"Time",L_Option_Sort_By_Cost:"Price",L_Option_Sort_By_Transfers:"Number of transfers",L_Option_Transit_Mode:"Public Transport Mode:",L_Transit_Mode_Bus:"Bus",L_Transit_Mode_Subway:"Underground",L_Transit_Mode_Train:"Train",L_Transit_Mode_CityRail:"Tram/Light rail\r\n",L_Transit_Mode_Ferry:"Ferry",L_Directions_Round_Trip:"Return trip",L_Directions_Title_Drive:"Driving",L_Directions_Title_Transit:"Public Transport",L_Directions_Title_Walk:"Walking",L_Directions_Tolls:"Avoid tolls",L_DirectionsTaskTitle_Text:"Directions",L_Directions_Today:"Today",L_Directions_MyLocation:"My location",L_Directions_Home:"Home",L_Directions_Work:"Work",L_Directions_Error_Waypoints:"Tell us where you are starting from and where you are going to.\r\n",L_Directions_Error_No_Results:"We could not find any routes between these places.",L_Directions_Error_Equal_Waypoints:"Destinations are the same.",L_Directions_Error_User_Location_Not_Found:"Your location is not available. This may occur if your browser or computer settings prevent websites or applications from using your location.",L_Directions_Time_Control_Tip:"Select when to leave or arrive.",L_Directions_Leave_Now:"Leave now",L_Directions_Title_Add:"Add destination",L_Directions_Title_Delete:"Remove",L_Directions_Duration:"{0} hr {1} min",L_Directions_Results_Title:"Via {0}\r\n",L_Directions_Results_Description_Time:"{0} without traffic\r\n",L_Directions_Results_Title_Time_With_Traffic:"{0} with traffic\r\n",L_Directions_Title_Reverse:"Reverse",L_Directions_Title_Start:"From",L_Directions_Title_Destination:"To",L_Directions_Leg_To:"to",L_Directions_Loading:"Directions loading...",L_Data_Special_Attribution:"Buy Tickets From:",L_Data_Attribution:"Data From:",L_Report_Problem_Link:"Report a problem",L_TransitDisclaimer_Text:"These directions are subject to the Microsoft® Service Agreement and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Contains public sector information licensed under the Open Government Licence v.1.0.",L_DirectionsDisclaimer_Text:" \t\r\nThese directions are subject to the {0} and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Construction projects, traffic or other events may cause actual conditions to differ from these results. Map and traffic data © {year} HERE™.\r\n",L_TermsOfUse_Text:"Microsoft® Service Agreement\r\n",L_Directions_Duration_Min:"{0} min\r\n",L_Directions_Go:"Go",L_Directions_NoTolls:"Your route will avoid tolls.",L_Directions_NoHighways:"Your route will avoid dual carriageways.",L_Directions_NoTollsOrHighways:"Your route will avoid tolls and dual carriageways.",L_Directions_Process_Title_Text_Line:"{0} to {1}",L_Directions_Title_Reorder:"Drag to reorder",L_Directions_Waypoint_Text_From_Name_Address:"{0}, {1}\r\n",L_Directions_WalkDistance:"{0}, about {1}\r\n",L_Directions_Print:"Print",L_Directions_PrintNotesWatermark:"Type your route notes here\r\n",L_Directions_Error_Search_Fail:"One or more locations were not found.",L_Directions_Via_Text:"via {0}\r\n",L_Directions_Via_Remove_Link:"Remove",L_Directions_Drag_Pin_Tip:"Drag to modify your route\r\n",L_Directions_Turn_Preview_Tip:"Click to preview your turn",L_Directions_Airline:"Airline",L_Directions_Bus:"Bus",L_Directions_Ferry:"Ferry",L_Directions_Train:"Train",L_Directions_Transit_Via1:"Via {0}: {1}",L_Directions_Transit_Via2:", {0}: {1}\r\n",L_Directions_Tube:"Tube",L_Directions_Categories_Bar_Entity_Coffee:"Coffee",L_Directions_Categories_Bar_Entity_GasStations:"Petrol stations",L_Directions_Categories_Bar_Entity_GroceryStores:"Grocery stores",L_Directions_Categories_Bar_Entity_Hotels:"Hotels",L_Directions_Categories_Bar_Entity_Restaurants:"Restaurants",L_Directions_Categories_Bar_Entity_FastFood:"Fast food",L_Directions_Categories_Bar_Entity_Attractions:"Attractions",L_Directions_Hour_Min_Separator:":",L_Directions_Hour:"hr",L_Directions_Minute:"min",L_Directions_Light_Traffic:"Light traffic",L_Directions_Moderate_Traffic:"Moderate traffic",L_Directions_Heavy_Traffic:"Heavy traffic",L_Directions_Leg_Title:"from {from} to {to}\r\n",L_Directions_Leg_TimeDist_Text:"{time} ({distance})",L_Nearby_Parking:"See nearby parking",L_Print_InstructionIndexSeparator:".",L_Directions_See_All_Routes:"see all routes",L_Directions_Back_Button:"return to route",L_Directions_Edit_Directions:"edit directions",L_Directions_See_All_Routes_Comment:"Choose the route you would like to reach your destination.",L_Directions_See_All_Routes_Title:"Routes -",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_Directions_TimeDistance_Separator:",",L_Directions_Add_From:"From {0}",L_Directions_Add_To:"To {0}",L_InexactMatch:"An exact match was not found. Use {0} or change the search term.",L_Close:"Close",L_Option_Avoid_Flights:"Avoid flights",L_Option_Avoid_Express_Trains:"Avoid express trains",L_Option_Use_Bullet_Trains:"Use bullet trains",L_Option_Avoid_Bullet_Trains:"Avoid bullet trains",L_TransitDisclaimer_Text_Japan:"免責事項: Bing では、各パートナーより情報の提供を受けてサービスを提供しています。Bing 及び各パートナーは正確な情報の提供に努めていますが、本情報を利用してご利用者に生じた問題や損害に関しては責任を負いかねます。(ご注意) JR 線の時刻は Bing が自らの責任により加工していますが、変更となる場合があります。各路線の最新情報に関しては、ご利用者ご自身で再確認いただくことをおすすめします。弘承 平成２５年１２４号 JR データの内容は、株式会社交通新聞社発行の「ＪＲ時刻表」に基づいています。この時刻データを無断転載・複写や電磁媒体等に加工することを禁じます。路線検索 © 株式会社ヴァル研究所",L_DirectionsDisclaimer_Text_Japan:"提示される経路は Microsoft® サービス規約 に準拠しており、情報提供のみを目的としています。経路の完全性または正確性は一切保証されていません。工事、交通状況、その他の要因により、実際の状況は検索結果と異なる場合があります。地図データ © 2015 ZENRIN™。",L_Directions_Cost:"¥{0}‎"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("DirectionsTask",n):window.$MicrosoftMaps8.ResourcesObject=n})();var r=window.$MicrosoftMaps8,f=r.Internal,hr=r.Calendar=r.Calendar||{},ff=r.Tasks=r.Tasks||{},w=r.Directions=r.Directions||{},ot=f.TaskData=f.TaskData||{},cr=r.Transit=r.Transit||{},lr=f.AdsScenario,ar=r.Anchor,vr=f.BaseTask,hi=f._BaseMapTemplateSelector,tt=f.BaseTaskViewModel,ef=r.BasicTemplate,yr=r.BitmapImageTemplate,of=r.VectorImageTemplate,sf=f._BoundsAccumulator,pr=r.CategoriesBar,k=r.CategoriesBarItemData,hf=ot.CollectionActions,gt=f.ControlTemplate,l=r.DataHandlerKeys,wr=f._Debug,cf=f.DefaultPrimitiveCriteria,n=r.GlobalConfig.features.directions,wt=f._EntryPoints,lf=r.GlobalConfig.features.feedback,o=f._Gimme,af=f.GeolocationProvider,d=r.GlobalConfig,a=r.GlobalDataEventHandler,vf=r.ImageFromCssHelper,u=f._Helper,e=f._JSEvent,yf=f._LatLonCrs,ci=r.LocationRect,pf=f._LruCache,h=r.Location,wf=r.MapLayer,ni=f.MapInteractionBehavior,ut=f.MapHelper,bf=r.MapView,li=r.MapMath,br=r.MapTypeId,ai=f._Network,vi=f._ObservableObject,ti=f._ObservableCollection,kf=f._ObservableObjectChangedArgs,yi=f._Overlay,df=f._OverlayEntity,pi=d.features.parking,wi=r.Point,ft=r.GlobalConfig.features.print,kr=f.PrintContent,s=f.PushpinIconType,bi=f._PerfV2Logger,gf=f.ReverseGeocoder,t=r.ResourceManager.DirectionsTask,ki=f.RoutePolyline,ii=f.RoutePushpin,ne=f.StaticPromise,dr=f._StreetsidePerfConstants,te=hr.SingleCalendar,gr=r.SimplePointPrimitive,nu=r.CommonControls.SyndicatedAds,v=r.TaskTypes,ie=f.Template,di=r.VectorMapLayer,g=ot.Waypoint,st=ot.DistanceUnit,nt=ot.Optimize,y=ot.TimeTypes,i=ot.DirectionsMode,gi=r.ZoomLevel,re=f.TipComponents,tu=r.CommonControls.AutosuggestV2,iu=r.CommonControls.MobileAutosuggestV2,it=r.CommonControls.DirectionsAutosuggestDataModel,ru=r.CommonControls.AutosuggestViewModel,bt=r.CommonControls.SearchHistoryLocalStorageHelper,ue=r.GlobalConfig.features.autosuggest,ht=d.features.streetside,uu=r.TaskPrimitivesZOrderManager,fu=cr.TransitRequester,ri=r.PrimitiveOverlayHelper,nr=f._MapAuthentication,eu='<div class="{Binding panelClass}" data-tag="directionsPanel">    <div class="directionsInput" data-tag="directionsInput" style:display="{Binding showWaypoints Converter=boolToDisplay}">\t\t<div class="{Binding optionsClass}">\t\t\t<div class="dirTopRow">\t\t\t\t<div>\t\t\t\t\t<div class="dirModes" data-tag="dirModes">\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding modes}">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t\t<a title="{Binding tooltip}" role="button" class="{Binding btnClass}" event:click="onModeClick" href="#" mode="{Binding mode}" aria-checked="{Binding mode Converter=isSelectedMode}"><\/a>\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnOptions dropdownBtn" href="#" event:click="onOptionsClick" data-tag="dirBtnOptions" role="combobox" aria-expanded="false">\t\t\t\t\t\t\t<TextBlock Text="{Binding resources.L_Directions_Options}" />\t\t\t\t\t\t<\/a>\t\t\t\t\t\t<div class="dirOptsSummary" data-tag="dirOptsSummary">\t\t\t\t\t\t\t<a event:click="onOptionsClick"><TextBlock Text="{Binding optionsText}"/><\/a>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirOptsPopup dropdownPopup" data-tag="dirOptsPopup">\t\t\t\t<div class="dirOptsUnits" data-tag="dirOptsUnits">                    <p>                        <label>                            <input type="radio" class="radio" checked="{Binding unitsMiles Mode=TwoWay}" data-tag="dirOptsUnitsMiles" />                            <TextBlock Text="{Binding resources.L_Directions_Option_Miles}" />                        <\/label>                        <label>                            <input type="radio" class="radio" checked="{Binding unitsKm Mode=TwoWay}" data-tag="dirOptsUnitsKm" />                            <TextBlock Text="{Binding resources.L_Directions_Option_Km}" />                        <\/label>                    <\/p>\t\t\t\t<\/div>                <div class="dirOptsSortBy" style:display="{Binding mode Converter=displaySortByOptions}" data-tag="dirOptsSortBy">                    <p>                        <TextBlock Text="{Binding resources.L_Option_Sort_By}" />                    <\/p>                    <p>                        <label style:display="{Binding showOptimizeTime Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTime Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTime" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Time}" />                        <\/label>                        <label style:display="{Binding showOptimizeCost Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeCost Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByCost" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Cost}" />                        <\/label>                        <label style:display="{Binding showOptimizeTransfers Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTransfers Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTransfers" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Transfers}" />                        <\/label>                    <\/p>                <\/div>\t\t\t\t<div class="dirOptsDriving" style:display="{Binding mode Converter=displayIfDriving}" data-tag="dirOptsDriving">\t\t\t\t\t<p>\t\t\t\t\t\t<CheckBox Content="{Binding resources.L_Directions_Highways}" Checked="{Binding avoidHighways Mode=TwoWay}" Value="" data-tag="dirOptsDrivingHighways" />\t\t\t\t\t<\/p>\t\t\t\t\t<p>\t\t\t\t\t\t<CheckBox Content="{Binding resources.L_Directions_Tolls}" Checked="{Binding avoidTolls Mode=TwoWay}" Value="" data-tag="dirOptsDrivingTolls" />\t\t\t\t\t<\/p>\t\t\t\t<\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displaySpecialTransitModeFilter}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Flights}" Checked="{Binding avoidFlights Mode=TwoWay}" Value="" data-tag="dirOptsAvoidFlights" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Express_Trains}" Checked="{Binding avoidExpressTrains Mode=TwoWay}" Value="" data-tag="dirOptsAvoidExpressTrains" />                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding useBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsUseBulletTrains" />                            <TextBlock Text="{Binding resources.L_Option_Use_Bullet_Trains}" />                        <\/label>                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding avoidBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsAvoidBulletTrains" />                            <TextBlock Text="{Binding resources.L_Option_Avoid_Bullet_Trains}" />                        <\/label>                    <\/p>                <\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displayTransitModeFilterROW}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <table>                        <tbody>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Bus}" Checked="{Binding allowBuses Mode=TwoWay}" Value="" data-tag="dirOptsAllowBuses" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_CityRail}" Checked="{Binding allowCityRails Mode=TwoWay}" Value="" data-tag="dirOptsAllowCityRails" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Subway}" Checked="{Binding allowSubways Mode=TwoWay}" Value="" data-tag="dirOptsAllowSubways" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Ferry}" Checked="{Binding allowFerries Mode=TwoWay}" Value="" data-tag="dirOptsAllowFerries" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Train}" Checked="{Binding allowTrains Mode=TwoWay}" Value="" data-tag="dirOptsAllowTrains" />                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>                <div class="dirOptsSaveHistory" style:display="{Binding enableHistory Converter=boolToDisplay}" data-tag="dirOptsSaveHistory">                    <p>                        <CheckBox Content="{Binding resources.L_Directions_Save_History}" Checked="{Binding saveHistory Mode=TwoWay}" Value="" data-tag="dirOptsSaveHistory" />                    <\/p>                    <p class="dirHistory">                        <a href="#" event:click="onDeleteHistory" class="dirDeleteHistory" style:display="{Binding historyDeleted Converter=boolToNotDisplay}">                            <TextBlock Text="{Binding resources.L_Directions_Delete_History}" />                        <\/a>                    <\/p>                    <p class="dirHistory dirHistoryDeleted" style:display="{Binding historyDeleted Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Directions_History_Deleted}" />                    <\/p>                <\/div>\t\t\t<\/div>\t\t<\/div>\t\t<div class="dirWaypoints">            <a href="#" class="backArrowButton" data-tag="dirReturnBtn" />\t\t\t<DraggableList ItemsSource="{Binding waypoints}" gripClass="defaultGrip dirWpGrip" tooltip="{Binding resources.L_Directions_Title_Reorder}" scrollContainer="{Binding scrollContainer}" event:onDragComplete="onDragComplete" event:onDragBegin="onDragBegin">\t\t\t\t<DraggableList.ItemTemplate>\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t<div>\t\t\t\t\t\t\t<div class="dirWp" data-tag="dirWp">\t\t\t\t\t\t\t\t<div class="{Binding index Converter=indexToIconClass}" aria-label="{Binding index Converter=indexToWaypointTitle}"><TextBlock Text="{Binding index Converter=indexToIconText}" /><\/div>\t\t\t\t\t\t\t\t<WatermarkedTextInput Watermark="{Binding index Converter=indexToWaypointTitle}" Value="{Binding inputText Mode=TwoWay}" MaxLength="1000" Aria-Label="{Binding inputText}" data-tag="input" />\t\t\t\t\t\t\t\t<a href="#" style:display="{Binding showDelete Converter=boolToDisplay}" event:click="onDelete" class="dirBtnDelete commonButton deleteButton" title="{Binding resources.L_Directions_Title_Delete}" data-tag="dirBtnDelete"><\/a>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<div class="dirResolve" style:display="{Binding upHierarchy Converter=nullToDisplayNone}">\t\t\t\t\t\t\t\t<a href="#" event:click="onCloseResolve" class="commonButton deleteButton" title="{Binding resources.L_Close}" data-tag="dirCloseResolve"><\/a>\t\t\t\t\t\t\t\t<TextBlock Text="{Binding resolveText1}" /><a href="#" event:click="onResolve"><TextBlock Text="{Binding upHierarchy}" /><\/a><TextBlock Text="{Binding resolveText2}" />\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/DataTemplate>\t\t\t\t<\/DraggableList.ItemTemplate>\t\t\t<\/DraggableList>\t\t<\/div>                 <a class="dirBtnRev" href="#" style:display="{Binding showReverse Converter=boolToDisplay}" event:click="onReverseClick" title="{Binding resources.L_Directions_Title_Reverse}" data-tag="dirBtnRev"><\/a>\t\t<a title="{Binding resources.L_Directions_Title_Add}" class="dirBtnAdd" href="#" event:click="onAddClick" style:display="{Binding allowAddWp Converter=boolToDisplay}" data-tag="dirBtnAdd"><\/a>\t\t<div class="{Binding showTimeControls Converter=showTimeControlsToClass}">\t\t\t<div class="drTimeGo">\t\t\t\t<div>\t\t\t\t\t<div class="dirBtnTime" style:display="{Binding mode Converter=displayTimeControls}">\t\t\t\t\t\t<a href="#" event:click="onTimeClick" data-tag="dirBtnTime" role="combobox" aria-expanded="false" title="{Binding resources.L_Directions_Time_Control_Tip}">\t\t\t\t\t\t\t<div data-tag="dateTimeSummary1"><TextBlock Text="{Binding dateTimeSummary1}"/><\/div>                            <div class="dropdownIcon" data-tag="dateTimeSummary2"><TextBlock Text="{Binding dateTimeSummary2}" /><\/div>\t\t\t\t\t\t<\/a>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnGo commonButton forwardArrowButton" href="#" event:click="onGetDirectionsClick" data-tag="dirBtnGo"><TextBlock Text="{Binding resources.L_Directions_Go}" /><\/a>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirProgress MicrosoftMap_progress" style:visibility="{Binding showProgress Converter=boolToVisibility}" aria-label="{Binding resources.L_Directions_Loading}" data-tag="dirProgress"><\/div>\t\t\t<div class="dirTimePopup dropdownPopup" data-tag="dirTimePopup">\t\t\t\t<RadioGroup ItemsSource="{Binding timeTypes}" SelectedItem="{Binding transitTimeType Mode=TwoWay}" />                <!--show TimeControlTemplate and calendar on Desktop-->                <TimeControl Time="{Binding time Mode=TwoWay}" Editing="{Binding EditingTime Mode=TwoWay}" Disabled="{Binding timeCtrlDisabled}"/>                <div class="calContainer" data-tag="datePicker"><\/div>                <!--show MobileTimeControlTemplate on Mobile-->                <MobileTimeControl Time="{Binding time Mode=TwoWay}" Date="{Binding Date Mode=TwoWay}" />            <\/div>        <\/div>\t<\/div>    <div class="editDirectionsButton backEdit separator" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onEditDirectionsClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_Edit_Directions}" /><\/div>    <\/div>    <div class="seeAllRoutesButton backEdit" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onSeeAllRoutesClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_See_All_Routes}" /><\/div>    <\/div>\t<div class="dirMessage" style:display="{Binding messageText Converter=nullToDisplayNone}" data-tag="dirMessage" tabindex="0">\t\t<TextBlock Text="{Binding messageText}" />\t<\/div>    <div class="searchboxWithAS" style:display="{Binding showSuggestionsPanel Converter=boolToDisplay}">    <\/div>    <div class="routecategoriesbar" style:display="{Binding showRouteCategoriesPanel Converter=boolToDisplay}"><\/div><\/div>',ou='<div class="dirModes" data-tag="dirModes">    <ItemsControl ItemsSource="{Binding modes}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <a title="{Binding tooltip}" event:click="onModeClick" href="#" mode="{Binding mode}" aria-checked="{Binding mode Converter=isSelectedMode}">                    <TextBlock Text="{Binding title}" />                <\/a>                <div style:display="{Binding mode Converter=selectedModeToDisplay}">                                        <TextBlock Text="{Binding title}" />                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/div>',su='<div>    <li style:display="{Binding isSelected Converter=boolToDisplay}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">        <a href="#" data-tag="directionsRouteLink">            <table class="routeSummary">                <tr>                    <td class="routeSummaryTitle">                        <div class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                            <div class="drDurationRoot">                                <div class="drDurationTable">                                    <div class="drHrDisplay" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <span class="drHours" data-tag="drHours">                                            <TextBlock Text="{Binding hours}" />                                        <\/span>                                        <span class="drHoursLabel" data-tag="drHoursLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                        <\/span>                                    <\/div>                                    <div class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                    <\/div>                                    <div class="drMinDisplay">                                        <span class="drMins" data-tag="drMins">                                            <TextBlock Text="{Binding minutes}" />                                        <\/span>                                        <span class="drMinsLabel" data-tag="drMinsLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                        <div class="drTitleRight" data-tag="descriptionDistance">                            <div class="timeDistanceSeparator" style:display="{Binding routeMode Converter=modeToDisplay}">                                <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                            <\/div>                            <TextBlock Text="{Binding subtitle}" />                        <\/div>                    <\/td>                <\/tr>                <tr>                    <td class="routeDetails">                        <div class="drTitleRoot">                            <table class="drTitleTable">                                <tr>                                <td>                                    <span class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                        <TextBlock Text="{Binding trafficCondition}" />                                    <\/span>                                    <span class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding mainTitle}" />                                    <\/span>                                              <span class="drTitleText" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                        <TextBlock Text=" (" />                                        <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                        <TextBlock Text=")" />                                    <\/span>                                            <p class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}" data-tag="descriptionVia">                                        <TextBlock Text="{Binding descriptionVia}" />                                    <\/p>                                                           <\/td>                                <\/tr>                            <\/table>                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                                <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                    <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                        <div><\/div>                                        <span class="svg"><\/span>                                    <\/td>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                                <\/ItemsControl>                            <\/table>                        <\/div>                    <\/td>                <\/tr>            <\/table>        <\/a>    <\/li><\/div>',hu='<div>  <div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave">    <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">      <ItemsControl.ItemTemplate>        <DataTemplate>          <div class="{Binding legClassName}" data-tag="dirLegContainer">            <div data-index="{Binding index}" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                <div class="dirLegIcons" data-tag="dirLegIconContainer">                    <div>                        <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                            <span>                                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextStart}" />                                <\/span>                            <\/span>                        <\/span>                        <span class="legFromTo">                            <TextBlock Text="{Binding resources.L_Directions_Leg_To}" />                        <\/span>                        <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                            <span>                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextEnd}" />                                <\/span class="dirLegIconText">                            <\/span>                        <\/span>                                                    <\/div>                <\/div>                <div>                    <div class="dirLegRouteInfoContainer" data-tag="dirLegRouteInfoContainer">                        <p class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                            <TextBlock Text="{Binding timeDistanceText}" />                        <\/p>                    <\/div>                <\/div>            <\/div>            <div class="startWaypointTitle" data-tag="startWaypointTitle" >                <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                    <span>                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding startWaypointAddress}" />                <\/span>            <\/div>              <div class="dirInstructionContainer">                  <div class="{Binding legInstructionsClassName}" style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                      <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="ul">                          <ItemsControl.ItemTemplate>                              <DataTemplate>                                  <li class="instructionContainer" style:display="{Binding show Converter=boolToDisplay}">                                      <div class="directionsStepOuterBox">                                          <div class="wrapper">                                              <div class="{Binding parentStepIndex Converter=indexToOddEvenBackgroundClass}">                                              <\/div>                                          <\/div>                                          <div class="instructionStep">                                              <table>                                                  <tbody style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" event:click="onInstructionClick" event:mouseenter="onMouseEnter" data-tag="dirInstruction">                                                      <tr><th colspan="5"><\/th><\/tr>                                                      <tr>                                                          <td class="printDirIcon">                                                              <table>                                                                  <tr>                                                                      <td class="transitTimeText">                                                                          <div>                                                                              <TextBlock Text="{Binding timeText}" />                                                                          <\/div>                                                                      <\/td>                                                                      <td>                                                                          <div class="dirIcon">                                                                              <div class="dirSvg svg"><\/div>                                                                              <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                          <\/div>                                                                      <\/td>                                                                  <\/tr>                                                              <\/table>                                                          <\/td>                                                          <td class="instructionStepIndex">                                                              <div style:display="{Binding stepIndex Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepIndex}" />                                                                  <TextBlock Text="{Binding resources.L_Print_InstructionIndexSeparator}" />                                                              <\/div>                                                          <\/td>                                                          <td class="dirInstruction">                                                              <p>                                                                  <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                              <\/p>                                                              <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepAddress}" />                                                              <\/p>                                                              <ItemsControl ItemsSource="{Binding viaPoints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirVia">                                                                              <span>                                                                                  <TextBlock Text="{Binding text}" />                                                                              <\/span>                                                                              <a href="#" event:click="onRemoveViaClick" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}">                                                                                  <TextBlock Text="{Binding removeLinkText}" />                                                                              <\/a>                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding childSteps}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p>                                                                              <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding hints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirHint" data-tag="dirHint">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding warnings}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                  <a href="{Binding specialAttributionUri}" target="_blank">                                                                      <TextBlock Text="{Binding specialAttributionLink}" />                                                                  <\/a>                                                              <\/p>                                                              <a href="#" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                  <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                              <\/a>                                                          <\/td>                                                          <td class="dirTravelDistance" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                              <span>                                                                  <TextBlock Text="{Binding travelDistanceText}" />                                                              <\/span>                                                              <span class="dirTravelTime" style:display="{Binding travelDurationText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelTime">                                                                  <span>                                                                      <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                                                                      <TextBlock Text="{Binding travelDurationText}" />                                                                  <\/span>                                                              <\/span>                                                          <\/td>                                                      <\/tr>                                                      <tr><th colspan="5"><\/th><\/tr>                                                  <\/tbody>                                              <\/table>                                          <\/div>                                      <\/div>                                  <\/li>                              <\/DataTemplate>                          <\/ItemsControl.ItemTemplate>                      <\/ItemsControl>                  <\/div>              <\/div>            <div class="endWaypointTitle" data-tag="endWaypointTitle">                <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                    <span>                                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding endWaypointAddress}" />                <\/span>            <\/div>          <\/div>        <\/DataTemplate>      <\/ItemsControl.ItemTemplate>    <\/ItemsControl>  <\/div><\/div>',cu='<div class="{Binding printMode}" data-tag="directionsPanel">  <table>      <tr>          <td class="waypointSummary" data-tag="waypointSummary">              <ItemsControl ItemsSource="{Binding waypoints}" panelTagName="ul">                <ItemsControl.ItemTemplate>                  <DataTemplate>                      <div>                          <table>                              <tr>                                  <td class="waypointTypeLabel">                                      <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                              <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                  <TextBlock Text="{Binding index Converter=indexToWaypointTypeLabel}" />                                              <\/span>                                      <\/span>                                                                        <\/td>                                  <td class="waypointAddress">                                      <TextBlock Text="{Binding inputText}" />                                  <\/td>                              <\/tr>                          <\/table>                      <\/div>                  <\/DataTemplate>                <\/ItemsControl.ItemTemplate>              <\/ItemsControl>          <\/td>          <td class="routeDetails">              <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true">  <\/Tab>          <\/td>      <\/tr>  <\/table>    <div class="printNotes">        <table>            <tbody>                <tr>                    <td class="waypointAddress">                        <div class="screenNotes">                            <textarea class="waypointNotes" placeholder="{Binding resources.L_Directions_PrintNotesWatermark}" data-tag="printNotes" maxlength="{Binding notesMaxCharSize}"><\/textarea>                        <\/div>                        <div class="printedNotes">                        <\/div>                    <\/td>                <\/tr>            <\/tbody>        <\/table>    <\/div>      <div class="dirInstructions" data-tag="dirInstructions">        <div class="isText showText" data-tag="dirPrintInstructionText">            <Tab TabContent="{Binding printInstructionsViewModel}" TabTemplate="{Binding instructionsPrintTemplate}" IsDisplayed="true">  <\/Tab>        <\/div>        <div class="taskMapPrint isMap showMap directionsMapPrintPageBreak taskMapPrintPageBreak" data-tag="directionsMapPrint">            <div class="printArea" data-tag="printArea">                <div class="printMap" data-tag="printMap">                <\/div>            <\/div>        <\/div>        <div class="dirSourceDestMiniMaps isMap showMap" data-tag="dirSourceDestMiniMaps">            <ItemsControl ItemsSource="{Binding waypoints}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div class="{Binding index Converter=indexToOddEvenClass}" data-tag="waypointPrintMaps">                            <p class="waypointHeading" data-tag="waypointHeading">                                <span class="miniMapIndexLetter">                                    <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                        <span>                                                                                        <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                            <\/span>                                        <\/span>                                    <\/span>                                <\/span>                                <span class="miniMapText">                                    <TextBlock Text="{Binding inputText}" />                                <\/span>                            <\/p>                            <img src="{Binding printImagePath}" />                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>  <\/div>  <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">    <span class="dirDataFrom">      <TextBlock Text="{Binding resources.L_Data_Attribution}" />    <\/span>    <span class="dirTransitAttribution" data-tag="dirTransitAttribution">      <TextBlock Text="{Binding attributionText}" />    <\/span>  <\/div>  <div class="dirDisclaimer" data-tag="dirDisclaimer">    <TextBlock Text="{Binding disclaimerText}" />  <\/div><\/div>',tr='<div class="directionsPanel" data-tag="directionsPanel" class="{Binding showSeeAllRoutes Converter=boolToSeeAllRoutesClassName}">    <div class="seeAllRoutesPanel" data-tag="seeAllRoutesPanel" style:display="{Binding showSeeAllRoutes Converter=boolToDisplay}">      <div class="backArrowDiv directionsBack">        <a class="commonButton backArrowButton directionsBackButton" event:click="onSeeAllRoutesReturnClick" href="#" role="button" data-tag="backToDirectionsCardButton">          <div class="directionsBackButtonText">            <TextBlock text="{Binding resources.L_Directions_Back_Button}" />          <\/div>        <\/a>      <\/div>      <div class="editDir dirSeeAllComment"><TextBlock text="{Binding resources.L_Directions_See_All_Routes_Comment}" /><\/div>    <\/div>  <ItemsControl ItemsSource="{Binding directionsResultsTitleSet}" panelTagName="ul">    <ItemsControl.ItemTemplate>      <DataTemplate>        <li class="{Binding isSelected Converter=boolToSelectedTitleClassName}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">          <a href="#" event:click="onResultsTitleClick" data-tag="directionsRouteLink">              <table>                  <tr class="drTitleRow">                      <td class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                          <div class="drDurationRoot">                              <table  class="drDurationTable">                                  <tr>                                      <td style:display="{Binding hours Converter=nullToDisplayNone}">                                          <p class="drHours" data-tag="drHours">                                               <TextBlock Text="{Binding hours}" />                                          <\/p>                                          <p class="drHoursLabel" data-tag="drHoursLabel">                                              <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                          <\/p>                                      <\/td>                                      <td class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                         <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                      <\/td>                                      <td>                                          <p class="drMins" data-tag="drMins">                                               <TextBlock Text="{Binding minutes}" />                                          <\/p>                                          <p class="drMinsLabel" data-tag="drMinsLabel">                                              <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                          <\/p>                                      <\/td>                                  <\/tr>                              <\/table>                          <\/div>                      <\/td>                      <td>                          <div class="drTitleRoot">                            <table class="drTitleTable">                              <tr>                                <td>                                    <p class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                        <TextBlock Text="{Binding trafficCondition}" />                                    <\/p>                                     <p class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding mainTitle}" />                                     <\/p>                                              <p class="drTitleText" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                        <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                    <\/p>                                            <p class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                        <span data-tag="descriptionVia">                                            <TextBlock Text="{Binding descriptionVia}" />                                        <\/span>                                        <span class="drCost" style:display="{Binding cost Converter=nullToDisplayNone}" data-tag="descriptionCost">                                            <TextBlock Text="{Binding cost}" />                                        <\/span>                                    <\/p>                                                         <\/td>                                <td class="drTitleRight" data-tag="descriptionDistance">                                  <TextBlock Text="{Binding subtitle}" />                                <\/td>                              <\/tr>                            <\/table>                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                              <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                <ItemsControl.ItemTemplate>                                  <DataTemplate>                                    <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                      <div style:background-color="{Binding lineColor}"><\/div>                                      <span class="dirSvg svg"><\/span>                                    <\/td>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                              <\/ItemsControl>                            <\/table>                        <\/div>                     <\/td>                 <\/tr>              <\/table>          <\/a>        <\/li>      <\/DataTemplate>    <\/ItemsControl.ItemTemplate>  <\/ItemsControl>\t<div data-tag="dirInstructions" style:display="{Binding showSeeAllRoutes Converter=boolToNotDisplay}">        <div class="dirPrintText" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">            <a style:display="{Binding showPrint Converter=boolToDisplay}" href="#" event:click="onPrintDirectionsClick">                <TextBlock Text="{Binding resources.L_Directions_Print}" />            <\/a>        <\/div>\t\t<ItemsControl ItemsSource="{Binding directionsResultsListSet}">\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t<DataTemplate>\t\t\t\t\t<div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave" event:blur="onInstructionsMouseLeave">                        <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t           <div class="{Binding legClassName}" data-tag="dirLegContainer">                                         <div data-index="{Binding index}" class="dirRouteLegTable" event:click="onLegTitleClick" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                                                 <div style:display="table-row">                                                     <div class="legSpace" style:display="table-cell"><\/div>                                                     <div class="dirLegIcons" style:display="{Binding showInstructions Converter=boolToNotDisplay}" data-tag="dirLegIconContainer">                                                         <div>                                                             <div class="{Binding index Converter=indexToStartClass}" data-tag="dirLegIcon">                                                                 <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                                             <\/div>                                                             <div class="dirLegIconsGap" data-tag="dirLegIconsGap"><\/div>                                                             <div class="{Binding index Converter=indexToEndClass}" data-tag="dirLegIcon">                                                                 <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                                                             <\/div>                                                         <\/div>                                                     <\/div>                                                     <div style:display="table-cell">                                                         <div data-tag="dirLegRouteInfoContainer">                                                             <p class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                                                                 <TextBlock Text="{Binding timeDistanceText}" />                                                             <\/p>                                                             <div class="dirLegTitle" data-tag="dirLegTitle">                                                                 <TextBlock text="{Binding legTitle}" />                                                             <\/div>                                                         <\/div>                                                     <\/div>                                                     <div style:display="table-cell">                                                         <div data-tag="arrow" class="{Binding showInstructions Converter=showGroupToClass}"><\/div>                                                     <\/div>                                                 <\/div>                                         <\/div>                                       <div class="{Binding legInstructionsClassName}"  style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                                         <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="div">\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t                <DataTemplate>                                                    <div style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" tabindex="0" event:click="onInstructionClick" event:mouseenter="onMouseEnter" event:keydown="onInstructionKeyDown" event:focus="onMouseEnter" data-tag="dirInstruction">                                                        <div class="bm_dirInstructionRow">                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div style:border-color="{Binding transitLineColor}" class="bm_dirLeftSpace">                                                                <TextBlock Text="{Binding timeText}" />                                                            <\/div>                                                            <div style:display="table-cell" aria-hidden="true">                                                                <div class="{Binding transitLineColor Converter=lineColorToIconClass}" style:background-color="{Binding transitLineColor}">                                                                    <TextBlock Text="{Binding iconText}" />                                                                    <div class="dirSvg svg"><\/div>                                                                    <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                <\/div>                                                            <\/div>                                                            <div class="dirInstruction">                                                                <p style:display="{Binding isClickable Converter=boolToNotDisplay}">                                                                    <TextBlock Text="{Binding stepText}" />                                                                <\/p>                                                                <a data-q="{Binding stepText}" data-eid="{Binding entityId}" data-sf="{Binding searchFilter}" style:display="{Binding isClickable Converter=boolToDisplay}" href="#" event:click="onStepTextClick" aria-label="{Binding waypointTitle}">                                                                    <TextBlock Text="{Binding stepText}" />                                                                <\/a>                                                                <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding stepAddress}" />                                                                <\/p>                                                                <ItemsControl ItemsSource="{Binding viaPoints}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p class="dirVia">                                                                                <span>                                                                                    <TextBlock Text="{Binding text}" />                                                                                <\/span>                                                                                <a href="#" event:click="onRemoveViaClick" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}">                                                                                    <TextBlock Text="{Binding removeLinkText}" />                                                                                <\/a>                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <ItemsControl ItemsSource="{Binding childSteps}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p>                                                                                <TextBlock Text="{Binding stepText}" />                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <ItemsControl ItemsSource="{Binding hints}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p class="dirHint" data-tag="dirHint">                                                                                <TextBlock Text="{Binding text}" />                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <ItemsControl ItemsSource="{Binding warnings}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                                <TextBlock Text="{Binding text}" />                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                    <a href="{Binding specialAttributionUri}" target="_blank">                                                                        <TextBlock Text="{Binding specialAttributionLink}" />                                                                    <\/a>                                                                <\/p>                                                                <a href="#" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                    <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                                <\/a>                                                            <\/div>                                                            <div class="bm_dirInstructionArrow">                                                                <div data-tag="arrow" class="{Binding showGroup Converter=showGroupToClass}" style:display="{Binding groupItems Converter=arrayToDisplay}">                                                                <\/div>                                                            <\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div class="bm_dirLeftSpace" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                                <div class="dirInstructionTravelDistance">                                                                    <TextBlock Text="{Binding travelDistanceText}" />                                                                <\/div>                                                            <\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                                                                            <\/div>                                                <\/DataTemplate>\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t                 <\/ItemsControl>                                       <\/div>                                   <\/div>                                 <\/DataTemplate>\t\t\t                <\/ItemsControl.ItemTemplate>\t\t               <\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t<\/DataTemplate>\t\t\t<\/ItemsControl.ItemTemplate>\t\t<\/ItemsControl>    <\/div>    <div class="reportProblemLink" data-tag="reportProblemLink" style:display="{Binding isSDK Converter=boolToNotDisplay}">       <a href="#" event:click="reportProblem">           <TextBlock Text="{Binding resources.L_Report_Problem_Link}" />       <\/a>    <\/div>    <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_Data_Attribution}" />        <ItemsControl ItemsSource="{Binding transitAttributions}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <p>                        <a href="{Binding uri}" target="_blank" data-tag="dirTransitAttribution">                            <TextBlock Text="{Binding agencyName}" />                        <\/a>                    <\/p>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="dirDisclaimer" data-tag="dirDisclaimer" style:display="{Binding showDisclaimer Converter=boolToDisplay}">    <TextBlock Text="{Binding disclaimerText}" />    <\/div>    <div class="dirTransitLogo" data-tag="dirTransitLogo" style:display="{Binding showTransitLogo Converter=boolToDisplay}">    <\/div><\/div>',lu='<div class="directionsPanel" data-tag="directionsPanel" class="{Binding showSeeAllRoutes Converter=boolToSeeAllRoutesClassName}">    <div class="seeAllRoutesPanel" data-tag="seeAllRoutesPanel" style:display="{Binding showSeeAllRoutes Converter=boolToDisplay}">      <div class="backArrowDiv directionsBack">        <a class="commonButton backArrowButton directionsBackButton" event:click="onSeeAllRoutesReturnClick" href="#" role="button" data-tag="backToDirectionsCardButton">          <div class="directionsBackButtonText">            <TextBlock text="{Binding resources.L_Directions_Back_Button}" />          <\/div>        <\/a>      <\/div>      <div class="editDir dirSeeAllComment"><TextBlock text="{Binding resources.L_Directions_See_All_Routes_Comment}" /><\/div>    <\/div>  \t<div data-tag="dirInstructions" style:display="{Binding showSeeAllRoutes Converter=boolToNotDisplay}">        <div class="dirPrintText" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">            <a style:display="{Binding showPrint Converter=boolToDisplay}" href="#" event:click="onPrintDirectionsClick">                <TextBlock Text="{Binding resources.L_Directions_Print}" />            <\/a>        <\/div>\t\t<ItemsControl ItemsSource="{Binding directionsResultsListSet}">\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t<DataTemplate>\t\t\t\t\t<div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave" event:blur="onInstructionsMouseLeave">                        <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t           <div class="{Binding legClassName}" data-tag="dirLegContainer">                                       <table data-index="{Binding index}" event:click="onLegTitleClick"  style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                                         <tbody>                                             <tr>                                                 <td class="legSpace"><\/td>                                                 <td class="dirLegIcons" style:display="{Binding showInstructions Converter=boolToNotDisplay}" data-tag="dirLegIconContainer">                                                     <div>                                                         <div class="{Binding index Converter=indexToStartClass}" data-tag="dirLegIcon">                                                            <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                                         <\/div>                                                         <div class="dirLegIconsGap" data-tag="dirLegIconsGap"><\/div>                                                         <div class="{Binding index Converter=indexToEndClass}" data-tag="dirLegIcon">                                                             <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                                                         <\/div>                                                     <\/div>                                                 <\/td>                                                 <td>                                                     <div data-tag="dirLegRouteInfoContainer">                                                         <p class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                                                             <TextBlock Text="{Binding timeDistanceText}" />                                                         <\/p>                                                         <div class="dirLegTitle" data-tag="dirLegTitle">                                                             <TextBlock text="{Binding legTitle}" />                                                         <\/div>                                                     <\/div>                                                 <\/td>                                                 <td>                                                    <div data-tag="arrow" class="{Binding showInstructions Converter=showGroupToClass}"><\/div>                                                 <\/td>                                             <\/tr>                                         <\/tbody>                                     <\/table>                                       <div class="{Binding legInstructionsClassName}"  style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                                         <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="table">\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t                <DataTemplate>\t\t\t\t\t\t\t\t\t                <tbody style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" tabindex="0" event:click="onInstructionClick" event:mouseenter="onMouseEnter" event:keydown="onInstructionKeyDown" event:focus="onMouseEnter" data-tag="dirInstruction">\t\t\t\t\t\t\t\t\t\t                <tr role="presentation" tabindex="-1" aria-hidden="true"><th colspan="4" role="presentation" tabindex="-1" aria-hidden="true"><\/th><\/tr>\t\t\t\t\t\t\t\t\t\t                <tr>\t\t\t\t\t\t\t\t\t\t\t                <td style:border-color="{Binding transitLineColor}">\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding timeText}"/>\t\t\t\t\t\t\t\t\t\t\t                <\/td>\t\t\t\t\t\t\t\t\t\t\t                <td>\t\t\t\t\t\t\t\t\t\t\t\t                <div class="{Binding transitLineColor Converter=lineColorToIconClass}" style:background-color="{Binding transitLineColor}">                                                                    <TextBlock Text="{Binding iconText}"/>\t\t\t\t\t\t\t\t\t\t\t\t\t                <div class="dirSvg svg"><\/div>\t\t\t\t\t\t\t\t\t\t\t\t\t                <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />\t\t\t\t\t\t\t\t\t\t\t\t                <\/div>\t\t\t\t\t\t\t\t\t\t\t                <\/td>\t\t\t\t\t\t\t\t\t\t\t                <td class="dirInstruction">\t\t\t\t\t\t\t\t\t\t\t\t                <p style:display="{Binding isClickable Converter=boolToNotDisplay}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding stepText}" />\t\t\t\t\t\t\t\t\t\t\t\t                <\/p>                                                                <a data-q="{Binding stepText}" data-eid="{Binding entityId}" data-sf="{Binding searchFilter}" style:display="{Binding isClickable Converter=boolToDisplay}" href="#" event:click="onStepTextClick" aria-label="{Binding waypointTitle}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding stepText}"/>\t\t\t\t\t\t\t\t\t\t\t\t                <\/a>                                                                <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding stepAddress}" />\t\t\t\t\t\t\t\t\t\t\t\t                <\/p>\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl ItemsSource="{Binding viaPoints}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <DataTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <p class="dirVia">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding text}"/>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <a href="#" event:click="onRemoveViaClick" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                 <TextBlock Text="{Binding removeLinkText}" />\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/DataTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl>\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl ItemsSource="{Binding childSteps}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <DataTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <TextBlock Text="{Binding stepText}"/>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/DataTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl>\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl ItemsSource="{Binding hints}">\t\t\t\t\t\t\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <DataTemplate>                                                                            <p class="dirHint" data-tag="dirHint">                                                                                <TextBlock Text="{Binding text}"/>                                                                            <\/p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/DataTemplate>\t\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t\t                <\/ItemsControl>\t\t\t\t\t\t\t\t\t\t\t                    <ItemsControl ItemsSource="{Binding warnings}">\t\t\t\t\t\t\t\t\t\t\t                        <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t                            <DataTemplate>\t\t\t\t\t\t\t\t\t\t\t                                <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">\t\t\t\t\t\t\t\t\t\t\t                                    <TextBlock Text="{Binding text}"/>\t\t\t\t\t\t\t\t\t\t\t                                <\/p>\t\t\t\t\t\t\t\t\t\t\t                            <\/DataTemplate>\t\t\t\t\t\t\t\t\t\t\t                        <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t\t                    <\/ItemsControl>                                                                                                                <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                    <a href="{Binding specialAttributionUri}" target="_blank">                                                                        <TextBlock Text="{Binding specialAttributionLink}" />                                                                    <\/a>                                                                <\/p>                                                                <a href="#" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                     <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                                <\/a>\t\t\t\t\t\t\t\t\t\t\t                <\/td>                                                            <td>                                                                <div data-tag="arrow" class="{Binding showGroup Converter=showGroupToClass}" style:display="{Binding groupItems Converter=arrayToDisplay}">                                                                <\/div>\t\t\t\t\t\t\t\t\t\t\t                <\/td>\t\t\t\t\t\t\t\t\t\t                <\/tr>                                                        <tr style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                            <td class="dirInstructionTravelDistance">                                                                <TextBlock Text="{Binding travelDistanceText}" />                                                            <\/td>                                                            <td role="presentation" tabindex="-1" aria-hidden="true"><\/td>                                                            <td role="presentation" tabindex="-1" aria-hidden="true"><\/td>                                                        <\/tr>\t\t\t\t\t\t\t\t\t\t                <tr role="presentation" tabindex="-1" aria-hidden="true"><th colspan="4" role="presentation" tabindex="-1" aria-hidden="true"><\/th><\/tr>\t\t\t\t\t\t\t\t\t                <\/tbody>\t\t\t\t\t\t\t\t                <\/DataTemplate>\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t                <\/ItemsControl>                                        <\/div>                                   <\/div>                                 <\/DataTemplate>\t\t\t                <\/ItemsControl.ItemTemplate>\t\t               <\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t<\/DataTemplate>\t\t\t<\/ItemsControl.ItemTemplate>\t\t<\/ItemsControl>    <\/div>    <div class="reportProblemLink" data-tag="reportProblemLink" style:display="{Binding isSDK Converter=boolToNotDisplay}">       <a href="#" event:click="reportProblem">           <TextBlock Text="{Binding resources.L_Report_Problem_Link}" />       <\/a>    <\/div>    <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_Data_Attribution}" />        <ItemsControl ItemsSource="{Binding transitAttributions}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <p>                        <a href="{Binding uri}" target="_blank" data-tag="dirTransitAttribution">                            <TextBlock Text="{Binding agencyName}" />                        <\/a>                    <\/p>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="dirDisclaimer" data-tag="dirDisclaimer" style:display="{Binding showDisclaimer Converter=boolToDisplay}">    <TextBlock Text="{Binding disclaimerText}" />    <\/div><\/div>',au='<div class="dragOverlay" data-events-for="ms-composite">    <div class="dragPin" style:visibility="{Binding ShowPin Converter=boolToVisibility}"><\/div>    <div class="clear"><\/div>    <div class="dragPinMessage" style:visibility="{Binding ShowTip Converter=boolToVisibility}">        <p style:display="{Binding ShowDragTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Drag_Pin_Tip}"/>        <\/p>        <p style:display="{Binding ShowPreviewTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Turn_Preview_Tip}"/>        <\/p>    <\/div><\/div>',vu='<div class="infoboxOverlay transitLandmarksToolTip">    <div class="overlayStopName">        <TextBlock Text="{StaticBinding stopName}" />    <\/div>    <div class="sectionSeparator" data-tag="sectionSeparator"><\/div>    <div class="overlayRoutesList">        <div class="{StaticBinding showLongList Converter=addNewLines}">            <TextBlock Text="{StaticBinding routeList}" />        <\/div>    <\/div><\/div>',yu='<div class="{Binding LabelRootClass}"  style:z-index="{Binding ZIndex}" data-tag="{Binding LabelRootClass}">    <p data-tag="routeLabelTime">            <TextBlock Text="{Binding TimeText}"/>    <\/p>    <p data-tag="routeLabelDistance">            <TextBlock Text="{Binding DistanceText}"/>    <\/p><\/div>',kt=function(){function t(){this.setToInitialState()}return t.prototype.setToInitialState=function(){var r,t;for(this.waypoints=[],t=0;t<2;t++)this.waypoints.push(new g);for(this.mode=i[i[n.defaultMode]],r=[],t=0;t<=8;t++)r.push(!0);this.options={unit:n.unit,avoidMotorWays:!1,avoidTollRoads:!1,roundTrip:!1,saveHistory:!0,timeType:y.firstAvailable,transitTypes:r}},t.prototype.tryAddWaypoint=function(n,t){var r=this.waypoints.length,i;if(t<0||t>r)return!1;for(i=r;i>t;i--)this.waypoints[i]=this.waypoints[i-1];return this.waypoints[i]=n,!0},t.prototype.tryRemoveWaypoint=function(n){var t=this.waypoints.length;return n<0||n>=t?!1:(this.waypoints.splice(n,1),!0)},t.prototype.tryUpdateWaypoint=function(n,t){var i=this.waypoints.length;return t<0||t>=i?!1:(this.waypoints[t]=n.getWayPointModel(),!0)},t.prototype.reorderWaypoint=function(n,t){var i=this.waypoints[n];this.tryRemoveWaypoint(n);this.tryAddWaypoint(i,t)},t.inputDataFromDirectionState=function(r,u,f){var c,e,o,h;if(f===void 0&&(f=!0),u=u||new t,r&&r.waypoints){if(c=r.waypoints.length,c===1){var a=r.waypoints[0],l=a.waypointType,s=g.createObjectFrom(a);if(l===1)u.waypoints[0]=s;else if(l===2)u.waypoints[u.waypoints.length-1]=s;else if(l===4){for(e=0;e<u.waypoints.length&&u.waypoints[e].name;)e++;e!==u.waypoints.length&&(u.waypoints[e]=s)}else f&&(u.waypoints[u.waypoints.length-1]=s)}else{for(u.waypoints=[],e=0;e<c;e++)u.waypoints.push(g.createObjectFrom(r.waypoints[e]));for(;e<2;e++)u.waypoints.push(new g);if(o=r.options,o)for(h in o)o[h]&&(u.options[h]=o[h])}r.mode&&(u.mode=n.enableDrivingMode&&r.mode===i.driving||n.enableTransitMode&&r.mode===i.transit||n.enableWalkingMode&&r.mode===i.walking||n.isSDK&&r.mode===i.truck?r.mode:n.defaultMode)}return u},t}(),pu=function(){function n(n,t){this._primitives=t;this._map=n}return n.prototype.getPrimitives=function(n,t){var r=[],u,i,f,e;if(this._primitives&&this._primitives.length)for(u=0;u<this._primitives.length;u++)i=this._primitives[u],i instanceof ki||i instanceof lt?(f=i,f.isRouteSelected()&&r.push(i)):i instanceof ii||i instanceof at?(e=i,e.isRouteSelected&&r.push(i)):r.push(i);t&&t({primitives:r})},n}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ct=function(f){function y(t,i,r,u,o,s){var h=f.call(this,s)||this;return h._minZoomToShowStreetside=16,h._currentPrimitiveMovedArg=null,h._zoomLevelBestMapView=0,et.setClientPerf(s),h._listeners=[],h._map=i,h._activationState=null,h._categoriesBar=null,h._reverseGeocoder=u,o&&!n.isSDK&&o.instanceAsync("TrafficLayerV2",function(n){h._trafficLayer=n}),h.displayState={colorIndex:0,groupName:"Directions"},h.invalidated=new e,h.type=v.directionsTask,h._controlTemplateFactory=t,h.inputData=new kt,h.showCloseButton=!0,h._geolocationProvider=r,h._primitives=[],h._dragonflyContainer=o,h._keyRoutePoints=[],n.enableHightlightInstruction&&(h.scrollLane=new e),h.directionsManagerCallback=new e,h.panelRoot[0].id="directionsPanelRoot",wr.addDataTag(h.panelRoot,"directionsPanelRoot"),h}return c(y,f),y.prototype.activate=function(i,r){var e=this,c,u,h,l,s,o,a;for(f.prototype.activate.call(this,i,r),this._map=i,c=!1,this.setTitle(t.L_DirectionsTaskTitle_Text),u=r,this._taskState=u,h=u&&u.waypoints&&u.waypoints.length===1&&u.waypoints[0],l=h&&(h.waypointType===3||h.waypointType===null)&&this._hasRoute(),this.inputData=kt.inputDataFromDirectionState(u,this.inputData,!l),u&&u.waypoints&&(l&&this._optimizedAddWaypoint(h),c=!0),n.isSDK&&u&&u.renderOptions&&(this._renderOptions=u.renderOptions),this.clearExistingRoutes(),this._directionsPanelViewModel&&this._taskState.renderOptions&&this._taskState.renderOptions.useExistingInputPanel?this._directionsPanelViewModel.updateInputControlsFromState(this._taskState):(this.disposables.push(this._directionsPanelViewModel=this._createDirectionsPanelViewModel()),this.disposables.push(this._directionsPanelViewModel.getDirectionsRequested.add(function(){u&&u.taskStartTime?(e._directionsRequestStartTime=u.taskStartTime.getTime(),u.taskStartTime=null):e._directionsRequestStartTime=Date.now()})),this.disposables.push(this._directionsPanelViewModel.waypointResolvedEvent.add(function(n){e._waypointResolved(n)})),this._directionsPanelViewModel.initializeControls(this._dragonflyContainer),this.disposables.push(this._directionsPanelViewModel.directionsResultsRequested.add(function(n){var t=!0;e._renderOptions&&typeof e._renderOptions.autoUpdateMapView=="boolean"?t=e._renderOptions.autoUpdateMapView:u.renderOptions&&typeof u.renderOptions.autoUpdateMapView=="boolean"&&(t=u.renderOptions.autoUpdateMapView);e._onDirectionsResultsRequested(n.DirectionsInputData,t,!1,null,null,null,n.viaPointRemoved,n.routeIndex,n.routeId||u&&u.routeId)})),this.disposables.push(this._directionsPanelViewModel.directionsModeChanged.add(function(){e.changed.invoke({name:"iconClass"})})),this.addControl(this._directionsPanelViewModel.getControl()),this._initAutosuggest()),c&&this._directionsPanelViewModel.getDirections(!0,u.routeIndex,u.routeId),s=0;s<this._directionsPanelViewModel.waypoints.length;s++)o=this._directionsPanelViewModel.waypoints[s].getWayPointModel(),!o.address&&!o.name&&o.point&&this._reverseGeocoder&&(a="{0}, {1}".replace("{0}",(Math.round(o.point.latitude*1e6)/1e6).toString()).replace("{1}",(Math.round(o.point.longitude*1e6)/1e6).toString()),this._directionsPanelViewModel.waypoints[s].update(a,o.point),this._submitGeoCodeRequest(o.point,s));this.disposables.push(this._directionsPanelViewModel.clearDirectionsResults.add(function(){e.clearExistingRoutes();e._updateKeyRoutePoints()}));this.disposables.push(this._directionsPanelViewModel.taskTitleRequestedEvent.add(function(n){e.setTitle(n)}));this.disposables.push(this._map.viewChanged.add(function(n){return e._onViewChanged(n)}));this.disposables.push(this._map.mapTypeChanged.add(function(n){return e._onMapTypeChanged(n)}));u&&u.entryPoint&&(this._activatedFromPermaLink=u.entryPoint===4||u.entryPoint===5,b.logInstrumentationEvent(p.A,{EP:u.entryPoint}));this._activatedFromHistoryManager=u&&u.preventHistoryPoint},y.prototype.deactivate=function(){this._notifyListenersBeforeDeactivation();f.prototype.deactivate.call(this);this.clearExistingRoutes();this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0,this._resultsViewModel.dispose());this._removeCategoriesBar();u._clearDisposables([this.templateSelector]);this.templateSelector=null;this._directionsPanelViewModel&&this._directionsPanelViewModel.dispose();u._clearDisposables(this._primitives);u._disposeEvents(this)},y.prototype.dispose=function(){this.deactivate();f.prototype.dispose.call(this)},y.prototype.serialize=function(n){var i,t,r,u;if(this.inputData.waypoints&&this.inputData.waypoints.length)for(i=0;i<this.inputData.waypoints.length;i++)t=this.inputData.waypoints[i],t.point&&(t.point.latitude=Math.round(t.point.latitude*1e6)/1e6,t.point.longitude=Math.round(t.point.longitude*1e6)/1e6);return r={waypoints:this.inputData.waypoints,mode:this.inputData.mode,options:this.inputData.options,taskTitle:this.getTitle()},n||(r.preventHistoryPoint=!0),this._resultsViewModel&&(u=this._resultsViewModel.getRouteSelected(),u>=0&&(r.routeIndex=u)),r},y.prototype.process=function(n,i){var r=n.requestState,c,l,y;if(this._canProcess(r)){var p=this._directionsPanelViewModel.getMode(),w=this.displayState.activationState,o=null;if(r.action===0){var f=this._directionsPanelViewModel.getRouteTitle(),u=this._directionsPanelViewModel.waypoints,s=u.length>=2&&!u[0].isEmpty()&&!u[u.length-1].isEmpty();if(s){for(var b=f,e=0,h="",a=0,v=0;e<u.length;)c=u[e].getWaypointTitle(),c!==""&&(a++,h===""&&(h=c,v=e)),e++;a!==u.length&&(f=(v===0?t.L_Directions_Add_From:t.L_Directions_Add_To).replace("{0}",h));f===b&&(s=!1)}o={mode:p,activationState:w,routeTitle:f,isIncomplete:s,pendingRemoval:this.displayState.pendingRemoval}}else r.action===1?o={TraceId:this._getTraceId()}:r.action===2?r.listenerId&&(this._listeners.push(r.listenerId),this._hasRoute()&&(this._listeners.length==1?(this._setMapViewIfPrimitivesOutOfBound(this._primitives,!0),this._updateKeyRoutePoints()):this._sendNotificationMessage(this._keyRoutePoints,[r.listenerId]))):r.action===3?r.listenerId&&(l=this._listeners.indexOf(r.listenerId),l!=-1&&this._listeners.splice(l,1)):r.action===4&&(y={prominence:2},this.setDisplayState(y));i&&i({processorId:this.id,data:o})}else i&&i({processorId:this.id,data:null})},y.prototype.processCallback=function(n){var u,r,t,f,i,e,o;if(n)if(n.processorType===v.localDetailsTask||n.processorType===v.polygonEntityDetailsTask){if(n.outData){for(t=n.outData,n.processorType===v.localDetailsTask?y.localDetailCardsData=t:y.polygonEntityDetailCardsData=t,u=[],i=0;i<t.length;i++)r=t[i].data,r&&r.length&&u.push(r[0]);this._directionsPanelViewModel.updateCurrentLocalDetailCards(u)}}else if(n.processorType===v.transitStopTask){if(n.outData){for(t=n.outData,y.transitStopCardsData=t,f=[],i=0;i<t.length;i++)e=t[i].data,e&&f.push(e);this._directionsPanelViewModel.updateCurrentTransitStopCards(f)}}else n.inData&&n.inData.requestState&&n.inData.requestorState&&n.inData.requestorState.callbackState&&this._directionsPanelViewModel&&(o=n.inData.requestState,o.entryPoint===wt.DirectionsWaypointSearch&&this._directionsPanelViewModel.waypointResolved(n))},y.prototype.setDisplayState=function(n){var i=this,r,u,t,o,s,h;if(this._isRouteBeingCalculated){r={activationState:n.activationState,prominence:n.prominence,animationState:n.animationState};this._delaySetDisplay||(this._delaySetDisplay=new e);this.disposables.push(this._delaySetDisplay.addOne(function(){i.setDisplayState(r);i._delaySetDisplay=null}));return}u=this.displayState.activationState;f.prototype.setDisplayState.call(this,n);n.activationState&&(this._activationState=n.activationState);n.activationState===1&&n.prominence===1?(this._primitives&&this._primitives.length>0&&(this._setMapViewIfPrimitivesOutOfBound(this._primitives),this._resultsViewModel&&this._resultsViewModel.taskStateChanged(1),this._invalidateMap()),this._directionsPanelViewModel.resetLocalDetailsCards(),t={searchEntitiesRequested:!0},o={requestorType:"DirectionsTask",requestorId:this.id,type:v.localDetailsTask,requestState:t,useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,o),s={requestorType:"DirectionsTask",requestorId:this.id,type:v.polygonEntityDetailsTask,requestState:t,useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,s),h={requestorType:"DirectionsTask",requestorId:this.id,type:v.transitStopTask,requestState:{searchEntitiesRequested:!0},useActiveTasks:!0},a.invokeHandler(l.taskProcessDataHandlerKey,h)):n.prominence&&this._primitives&&this._primitives.length>0?(n.prominence===1?this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2):this._resultsViewModel&&this._resultsViewModel.taskStateChanged(3),this._invalidateMap()):n.activationState===2&&n.activationState!==u&&(this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2),this._invalidateMap());this._directionsPanelViewModel.onTaskStateChanged(n)},y.prototype.getPrimitives=function(n,t){var i=[];this._primitives&&this._primitives.length&&i.push.apply(i,this._primitives);t&&t({primitives:i})},y.prototype.getAllStopPoints=function(){return this._resultsViewModel.allStopPoints},y.prototype.getMapLayer=function(){return this._layer},y.prototype.setMapLayer=function(n){this._layer=n},y.prototype.getCardIconInfo=function(){var t=this._directionsPanelViewModel.getMode(),n;switch(t){case i.driving:n="dirTsk";break;case i.transit:n="trnsTsk";break;case i.walking:n="wlkTsk";break;default:n="dirTsk"}return{iconClass:n}},y.prototype.getPrintInstrumentationData=function(){return{RI:this._resultsViewModel?this._resultsViewModel.getRouteSelected():-1,LOC:"H"}},y.prototype.hasPrintContent=function(){return ft.isEnabled&&this._hasRoute()},y.prototype.getPrintContent=function(){var n,t,i,r;return ft.isEnabled?(n=null,this._resultsViewModel&&(this._updatePrintImages(),n=this._resultsViewModel.getDirectionsHtmlContentForPrint()),t=new ti,this._layer&&(i=new di(this._layer.getId(),new pu(this._map,this._primitives),this._layer.getTemplateSelector(),this._layer.getZIndex()),i.setRenderTarget(this._layer.getRenderTarget()),t.insert(i)),r=new kr(n,null,t),r.setCssScope(this.type),n!==null?r:null):null},y.prototype._optimizedAddWaypoint=function(n){for(var i,w,s,t,a,c,l,r,d=n.waypointType,v=g.createObjectFrom(n),y=Number.MAX_VALUE,p=this.inputData.waypoints.length,b=ut.getMapBounds(this.map,!0),u,e,k,f,o=0;o<this._resultsViewModel.routelines.length;o++){for(u=this._resultsViewModel.routeStopPointPathIndices[o],e=this._resultsViewModel.routelines[o].coordinates,k=this._resultsViewModel.directionsResultsListSet[o],f=[],t=0;t<e.length;t++)i=e[t],b.containsLatLong(i[0],i[1])&&f.push({location:new h(i[0],i[1]),index:t});if(!f.length)for(t=0;t<e.length;t++)i=e[t],w=new h(i[0],i[1]),f.push({location:w,index:t});for(s=-1,t=0;t<f.length;t++)(a=f[t],c=u.indexOf(a.index),c>0&&c<u.length-1)||(l=li.greatCircleDistance(v.point,a.location),(c===0||c===u.length-1)&&(l=l*.9),l<y&&(y=l,s=a.index));if(s>=0)for(r=0;r<this._resultsViewModel.stopPoints.length;r++)if(u[r]>=s){p=r===this._resultsViewModel.stopPoints.length-1&&u[r]===s?r+1:r;break}}this.inputData.tryAddWaypoint(v,p)},y.prototype._processCategorySelection=function(n,t){var i={};i.taskTitle=n.displayName;i.query=n.displayName;i.category=n.category;i.directionsTaskId=t;i.entryPoint=wt.CategoriesBar;i.selectedCategoryId=n.categoryId;i.disableComputingMapViewForLoadingOnly=!0;this._updateKeyRoutePoints(!0);i.keyRoutePoints=this._keyRoutePoints;a.invokeHandler(l.taskDataHandlerKey,{state:i,type:v.localListingTask})},y.prototype._updateCategoriesBarVisibility=function(){var t=this,n=y._getSupportedCategoriesBarCreator();n!=null&&(n.shouldCategoriesBarBeVisible(this)&&!this._categoriesBar&&(this._categoriesBar=n.createCategoriesBar(this),this._categoriesBar.setIsVisible(!1),this._categoriesBar.categorySelected.add(function(n){t._processCategorySelection(n,t.id)})),this._categoriesBar&&(this._categoriesBar.setIsVisible(n.shouldCategoriesBarBeVisible(this)),this._categoriesBar.getControl().getParent()&&this._categoriesBar.getControl().getParent().has_class(y.RouteCategoriesBarPanelCssClass)&&this._directionsPanelViewModel.setShowRouteCategoriesPanel(this._categoriesBar.getIsVisible())))},y._getSupportedCategoriesBarCreator=function(){for(var f={isSupported:function(){return n.enableRouteCategoriesBar&&!n.isSDK},createCategoriesBar:function(t){var r=dt,i,u;return n.enableFastFoodIcon&&(r=wu),i=new pr(t._map,r,t._controlTemplateFactory,!1),u=t._directionsPanelViewModel.getControl().select("div."+y.RouteCategoriesBarPanelCssClass),u.append(i.getControl()),i},shouldCategoriesBarBeVisible:function(n){return n._hasRoute()&&n._directionsPanelViewModel.getMode()!==i.transit}},u=[f],r,t=0;t<u.length;t++)if(r=u[t],r.isSupported())return r;return null},y.prototype._removeCategoriesBar=function(){this._categoriesBar&&(this._directionsPanelViewModel.setShowRouteCategoriesPanel(!1),this._categoriesBar.deactivate(),this._categoriesBar=null)},y.prototype._canProcess=function(n){return this._directionsPanelViewModel?!n||n.action==null?!1:n.taskId!=null&&n.taskId!=this.id?!1:!0:!1},y.prototype.hasDefaultFocusElement=function(){return!0},y.prototype._calculateKeyRoutePoints=function(){var i=[],r,t,f,e;if(!this._hasRoute())return i;var o=ut.getMapBounds(this.map,!0),u=this._resultsViewModel.routelines[this._resultsViewModel.getRouteSelected()].coordinates,n=[];for(r=0;r<u.length;r++)t=u[r],o.containsLatLong(t[0],t[1])&&n.push(new h(t[0],t[1]));return n.length>y.KeyPointsCount?(f=this._calculateRouteLength(n),e=f/y.KeySegmentCount,i=this._filterRoutePoints(n,e)):i=n,i},y.prototype._calculateRouteLength=function(n){for(var i=0,t=0;t<n.length-1;t++)i+=li.greatCircleDistance(n[t],n[t+1]);return i},y.prototype._filterRoutePoints=function(n,t){var u,e,f,i;if(n.length<2)return[];for(u=[],u.push(n[0]),e=n[0],f=0,i=1;i<n.length-1;i++)f+=r.MapMath.greatCircleDistance(n[i-1],n[i]),f>t&&(u.push(n[i]),e=n[i],f=0);return u.push(n[n.length-1]),u},y.prototype._initAutosuggest=function(){this._directionsPanelViewModel.initAutosuggest()},y.prototype._onPrimitiveMoveStarted=function(n){if(this._currentPrimitiveMovedArg=null,this._isDragging=!0,this._processDragRequest(n),this._updateDragPin(!1,null,!1,!1,!1),this.displayState.activationState!==1){var t={action:"focus",id:this.id};a.invokeHandler(l.taskDataHandlerKey,t)}},y.prototype._updateDragPin=function(n,t,i,r,u){var f=this._primitives.length;f>0&&(n?vt.showDragTipPin(this._map,this._controlTemplateFactory,t,i,r,u):vt.hideDragTipPin(this._map))},y.prototype._onPrimitiveMoveContinued=function(n){if(this._isDragging){var t=n.location;this._updateDragPin(!0,t,!1,!1,!0);this._currentPrimitiveMovedArg=n}},y.prototype._processDragRequest=function(n){var i=n.location,t,u,f,e,r;y.isIDirectionsPushpin(n.primitive)?(t=n.primitive,t.pushpinIconType===s.start||t.pushpinIconType===s.end||t.pushpinIconType===s.middle?(t=n.primitive,this.inputData.waypoints[t.stopPointIndex].point=i,this.inputData.waypoints[t.stopPointIndex].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):t.pushpinIconType===s.via?(u=t.stopPointIndex,f=t.viaPointIndex,this.inputData.waypoints[u].viaWaypoints[f].point=i,this.inputData.waypoints[u].viaWaypoints[f].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):(r=new g(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,t.stopPointIndex,t.viaPointIndex))):(e=n.primitive,r=new g(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,e.legIndex,e.subLegIndex))},y.prototype._onPrimitiveMoveStopped=function(n){var a=this,i,t,o,h,c,l,f,r;if(this.primitiveInteracted.invoke(),this._currentPrimitiveMovedArg=null,this._isDragging=!1,this._updateDragPin(!1,null,!1,!1,!1),i=n.location,y.isIDirectionsPolyline(n.primitive)){var e=n.primitive,f=new g(null,i,null,!0),r=this.inputData.waypoints[e.legIndex].viaWaypoints;e.subLegIndex>=r.length?r.push(f):r.splice(e.subLegIndex,0,f)}else t=n.primitive,t.pushpinIconType===s.start||t.pushpinIconType===s.end||t.pushpinIconType===s.middle?(o=this.inputData.waypoints[t.stopPointIndex],h=u._formatLatLonString(i.latitude,i.longitude),this._directionsPanelViewModel.waypoints[t.stopPointIndex].setInputText(h),this._reverseGeocoder&&this._reverseGeocoder.reverseGeocode(i,function(n){return a._processGeocodeResponse(n,t.stopPointIndex)}),o.point=i):t.pushpinIconType===s.via?(c=t.stopPointIndex,l=t.viaPointIndex,this.inputData.waypoints[c].viaWaypoints[l].point=i):(f=new g(null,i,null,!0),r=this.inputData.waypoints[t.stopPointIndex].viaWaypoints,t.viaPointIndex>=r.length?r.push(f):r.splice(t.viaPointIndex,0,f));this._onDirectionsResultsRequested(this.inputData,!1)},y.prototype._onPrimitiveHover=function(t,r){var f=this,u;y.isIDirectionsPushpin(t.primitive)?(u=t.primitive,u.instructionViewModel&&u.instructionViewModel.transitStopID&&u.instructionViewModel.transitStopID>0?u.instructionViewModel.transitStaticResources?(r&&this.showTransitStopOverlay(u.instructionViewModel.transitStaticResources,u),r||ri.hideOverlay(this._map,u)):(u.instructionViewModel.transitStopInfoReadyPromise||(u.instructionViewModel.transitStopInfoReadyPromise=new Promise(function(n){u.instructionViewModel.processTransitStopInfo(u.instructionViewModel.transitStopID,n)})),u.instructionViewModel.transitStopInfoReadyPromise.then(function(){return new Promise(function(){r&&f.showTransitStopOverlay(u.instructionViewModel.transitStaticResources,u);r||ri.hideOverlay(f._map,u)})})):this._updateDragPin(r,t.location,r&&u.isMoveEnabled()&&this._isDraggable(),ht&&ht.isEnabled&&ht.streetsideInDirectionsFeatureEnabled&&!n.isSDK,!1),u.instructionViewModel&&u.instructionViewModel.setHover(r),vt.highlight(r?u:null)):(this._updateDragPin(r&&this.inputData.mode!=i.transit&&this._isDraggable(),t.location,r,!1,!0),this._isHovering=r)},y.prototype._onPointerMoved=function(n){this._isHovering&&n.primitive&&y.isIDirectionsPolyline(n.primitive)&&this._updateDragPin(this.inputData.mode!=i.transit&&this._isDraggable(),n.location,!0,!1,!0)},y.prototype.showTransitStopOverlay=function(n,t){var i={overlayTemplate:new gt(vu,n),overlayAnchor:new ar(-10,-10)};ri.showOverlay(this._map,i,t)},y.prototype._onPrimitiveTapped=function(t){var i,r,e;if(this.primitiveInteracted.invoke(),i=y.isIDirectionsPushpin(t.primitive)&&t.primitive,r=!n.isSDK&&i&&i.instructionViewModel&&i.instructionViewModel.transitStopID&&i.instructionViewModel.transitStopID>0,r)i.instructionViewModel.showTransitStop(),b.logInstrumentationEvent(p.RPPC,{});else if(this.displayState.activationState===1||r||(e={action:"focus",id:this.id},a.invokeHandler(l.taskDataHandlerKey,e)),this._hasRoute())if(i&&!n.isSDK&&ht&&ht.isEnabled&&ht.streetsideInDirectionsFeatureEnabled)this._showStreetsideBubble(i),b.logInstrumentationEvent(p.RPPC,{});else if(y.isIDirectionsPolyline(t.primitive)){var o=t.primitive,u=o.getIndex(),f=this._resultsViewModel;f&&f.getRouteSelected()!==u&&(f.select(u,!1),b.logInstrumentationEvent(p.ARCM,{I:u}))}},y.prototype._submitGeoCodeRequest=function(n,t){var i=this;this._reverseGeocoder.reverseGeocode(n,function(n){i._processGeocodeResponse(n,t)})},y.prototype._processGeocodeResponse=function(n,t){n&&n.success&&n.addressList&&n.addressList.length>0&&n.addressList[0].formattedAddress&&this._directionsPanelViewModel.waypoints[t].update(n.addressList[0].formattedAddress,n.location)},y.prototype._showStreetsideBubble=function(n){var t=n.getLocation(),i=n.routeMapEntities&&n.routeMapEntities.getRoutepointNeighbors(t),u,r,f,e;i&&i.length===2&&(u=t,r=i[0],r||(u=i[1],r=t),f=this.perfLog.start(dr.DirectionsIntegrationTime),e={action:"showDirectionsBubbleOverlay",location:t,directionsStartupOptions:{locationToLookAt:u,locationToLookFrom:r,maneuverType:this._resultsViewModel.instructionRowClass(n.getManeuverType()),perfState:f}},a.invokeHandler(l.streetsideDataHandlerKey,e))},y.prototype._onMapTypeChanged=function(n){var t,i;if(n.newMapTypeId!==n.oldMapTypeId)for(t=0;t<this._primitives.length;t++)i=this._primitives[t],y.isIDirectionsPolyline(i)&&(i.changeMapType(n.newMapTypeId),i.update())},y.prototype._updatePrimitivesZoom=function(n){for(var t,i=0;i<this._primitives.length;i++)t=this._primitives[i],y.isIDirectionsPushpin(t)?(t.changeZoom(n),t.update()):y.isIDirectionsPolyline(t)&&(t.changeZoom(n),t.update())},y.prototype._onViewChanged=function(n){var i=this._map.getMode(),t;i&&i.mapModeType!==2&&(t=ut.getMercatorZoomLevel(this._map),y.currentZoomLevel!==t&&(y.currentZoomLevel=t,this._zoomLevelBestMapView<0&&(this._zoomLevelBestMapView=Math.floor(y.currentZoomLevel)),y.currentZoomLevel<=this._zoomLevelBestMapView-1?this._resultsViewModel&&this._resultsViewModel.clearRoutesLabels():this._resultsViewModel&&this._resultsViewModel.showRoutesLabels(),this._updatePrimitivesZoom(t),this._invalidateMap()));this._updateKeyRoutePoints(!1,n&&n.cause)},y.prototype._onDirectionsResultsRequested=function(i,r,u,f,e,o,s,h,c){var l=this,y,v,a;this._isRouteBeingCalculated=!0;this._directionsPanelViewModel.setShowSuggestionsPanel(!1);this._directionsPanelViewModel.hideMessage();y=et.logPerfEvent(rt.TD,i.mode);v=new vt(this._map);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0);this.disposables.push(this._resultsViewModel=this._createDirectionsResultsSetViewModel(i,v,y));a=this._resultsViewModel.reportProblemClicked.add(function(){l.isReportable()&&l._resultsViewModel.setReportProblemLink(l._getFeedbackTaskState())});this.disposables.push(a);a=this._resultsViewModel.routeSelectedEvent.add(function(){l._updateKeyRoutePoints();l._resultsViewModel.setShowSeeAllRoutes(!1);l._resultsViewModel.seeAllRoutesReturnClick.invoke()});this.disposables.push(a);a=this._resultsViewModel.seeAllRoutesReturnClick.add(function(){l._directionsPanelViewModel.seeAllRoutesReturnClick();l.setTitle(l.getTitle().replace(t.L_Directions_See_All_Routes_Title,""))});this.disposables.push(a);a=v.invalidateMap.add(function(){l._invalidateMap()});this.disposables.push(a);a=v.addMapLayerPrimitives.add(function(n){l._addMapLayerPrimitives(n.primitives,n.needBestMapView)});this.disposables.push(a);a=v.setMapViewIfPrimitivesOutOfBound.add(function(n){var t=l._taskState&&!!l._taskState.category;l._setMapViewIfPrimitivesOutOfBound(n,t,t)});this.disposables.push(a);a=v.instructionClicked.add(function(t){n.enableHightlightInstruction&&l.scrollLane&&l.scrollLane.invoke(t)});this.disposables.push(a);this._resultsViewModel.getDirections(function(n,t,i,r,u,f){l._onDirectionsCallback(n,t,i,r,u,f,h,c);t!==1&&l.directionsManagerCallback.invoke({responseCode:t,message:i})},r,u,f,e,o,s);a=this._directionsPanelViewModel.seeAllRoutesClick.add(function(){l._resultsViewModel.seeAllRoutesClick();l.setTitle(t.L_Directions_See_All_Routes_Title+l.getTitle())});this.disposables.push(a)},y.prototype._onDirectionsCallback=function(r,u,f,e,s,h,c,l){var k=this,v,d,y,p,w,g,nt,tt,b,a;if(this._isRouteBeingCalculated=!1,h){this._currentPrimitiveMovedArg&&this._processDragRequest(this._currentPrimitiveMovedArg);return}if(this._traceId=r,this._currentResultsControl&&this._currentResultsControl.removeFromParent(),this._currentResultsControl=null,this._directionsPanelViewModel.setShowProgress(!1),u!==1&&f!==null)this._directionsPanelViewModel.clearResultsAndShowMessage(f,u,r);else{if(this._resultsViewModel.waypoints=this._directionsPanelViewModel.waypoints,this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!0),this._currentResultsControl=this._resultsViewModel.getControl(),n.isSDK||(this.appendControl(this._currentResultsControl),this._resultsViewModel.waitingOnRoadShieldEvent()||o(".svg",this._currentResultsControl[0]).inlineDataSvgs().remove_class("svg")),c=c||0,(c>=this._resultsViewModel.directionsResultsTitleSet.length||c<0)&&(c=0),l&&(v=l.split(","),v&&v.length>=2))for(d=v[1],a=0;a<this._resultsViewModel.directionsResultsListSet.length;a++)if(y=this._resultsViewModel.directionsResultsListSet[a].routeId,p=y&&y.split(","),p&&p[1]===d){c=a;break}if(w=!1,this._taskState.category&&this._activatedFromPermaLink&&this._taskState.mode!==i.transit&&(s=!0,w=!0),this._resultsViewModel.select(c,s,!0),this._updateCategoriesBarVisibility(),g=this._directionsPanelViewModel.waypoints[0].getWaypointTitle(),nt=this._directionsPanelViewModel.waypoints[this._directionsPanelViewModel.waypoints.length-1].getWaypointTitle(),this.setTitle(t.L_Directions_Process_Title_Text_Line.replace("{0}",g).replace("{1}",nt)),this._activatedFromPermaLink||this._activatedFromHistoryManager||this.serializableObjectChanged.invoke({magnitude:2}),this._updateKeyRoutePoints(),this._delaySetDisplay&&this._delaySetDisplay.invoke(),this._directionsPanelViewModel.showEditAndCollapseCard(),w){for(tt=this._taskState.category.toLowerCase(),a=0;a<dt.length;a++)if(dt[a].category.toLowerCase()===tt){b=dt[a];break}b&&this._dragonflyContainer.instanceAsync("BrowserHistoryManager",function(n){n.nextHistoryPointReplace();k._processCategorySelection(b,k.id)})}this._activatedFromPermaLink=!1}},y.prototype._updateLocationIdentifiers=function(){for(var r=0,t=-1,u=0,i,n;r<this.inputData.waypoints.length;)i=this.inputData.waypoints[r],t<0?(n=this._resultsViewModel.stopPoints[r],i.locationIdentifier=n&&n.locationIdentifier):(n=this._resultsViewModel.allStopPoints[u].routeLegStopPoint,i.viaWaypoints[t].locationIdentifier=n&&n.locationIdentifier),t++,u++,i&&t>=i.viaWaypoints.length&&(r++,t=-1)},y.prototype._getWaypointLabel=function(n){return this._directionsPanelViewModel!=null?this._directionsPanelViewModel.indexToIconText(n):"%20"},y.prototype._updatePrintImages=function(){var o,n,u,i;if(this._hasRoute()){var t=ft.printImgMiniMapUrlFormat,e="",f=this._resultsViewModel,r=f.waypoints;for(n=0;n<r.length;n++)u=r[n],i=u.getWayPointModel().point,e+="wp."+n+"="+i.latitude+","+i.longitude+";"+(n==0?y.startPrintIcon:n===r.length-1?y.endPrintIcon:y.stopPrintIcon)+";"+this._getWaypointLabel(n)+"&";for(t=t.replace("{wp}",e),t=t.replace("{credentials}",ft.credentials),t=t.replace("{culture}",d.dynamicProperties.market),o=f.getRouteSelected(),t=t.replace("{rid}",f.directionsResultsListSet[o].routeId),n=0;n<r.length;n++)u=r[n],i=u.getWayPointModel().point,u.setPrintImagePath(t.replace("{lat}",""+i.latitude).replace("{lon}",""+i.longitude))}},y.prototype._updateKeyRoutePoints=function(n,t){if(this._listeners.length!=0||n){var i=this._keyRoutePoints;this._keyRoutePoints=this._calculateKeyRoutePoints();this._arePointsDifferent(i,this._keyRoutePoints)&&this._notifyListeners(t)}},y.prototype._arePointsDifferent=function(n,t){if(n.length!=t.length)return!0;for(var i=0;i<n.length;i++)if(!h.areEqual(n[i],t[i]))return!0;return!1},y.prototype._notifyListeners=function(n){this._listeners.length!=0&&this._sendNotificationMessage(this._keyRoutePoints,this._listeners,n)},y.prototype._sendNotificationMessage=function(n,t,i){for(var u,f,r=0;r<this._listeners.length;r++)u={action:0,cause:i,keyRoutePoints:n,directionsTaskId:this.id},f={requestorType:"DirectionsTask",requestorId:this.id,type:v.localListingTask,requestState:u,taskId:t[r]},a.invokeHandler(l.taskProcessDataHandlerKey,f)},y.prototype._notifyListenersBeforeDeactivation=function(){for(var t,i,n=0;n<this._listeners.length;n++)t={action:1},i={requestorType:"DirectionsTask",requestorId:this.id,type:v.localListingTask,requestState:t,taskId:this._listeners[n]},a.invokeHandler(l.taskProcessDataHandlerKey,i)},y.prototype._addMapLayerPrimitives=function(n,t){var i=this,r,u,f;this._clearPrimitives();n&&n.length>0&&(r=this._map.getFrameManager(),r&&r.frameRendered.addOne(function(){i._directionsRequestStartTime>0&&(bi.log(bi.directionsTimeToGlass,i._directionsRequestStartTime),i._directionsRequestStartTime=-1)}),this._primitives=this._primitives.concat(n),this._associatePrimitivesWithLayer(n),u=ut.getMercatorZoomLevel(this._map),this._updatePrimitivesZoom(u),t&&(f=ni.getLocationsForPrimitivesInView(this._primitives),this._setMapViewWithPadding(f),this._zoomLevelBestMapView=-1),this._currentPrimitiveMovedArg||this.directionsManagerCallback.invoke(),this._invalidateMap())},y.prototype._invalidateMap=function(){var n=this;this._layerInitiated||(this.templateSelector||(this.templateSelector=new oi(this._map)),this._layer||(this._layer=new di("DirectionsTask_"+ni.getUniqueId(),this,this.templateSelector,uu.foregroundZOrder),this._map.getLayers().insert(this._layer)),this._layer.setRenderTarget(1),this._associatePrimitivesWithLayer(this._primitives),this.disposables.push(this._layer.primitiveTapped.add(function(t){n._onPrimitiveTapped(t)})),this._isDraggable()&&(this.disposables.push(this._layer.primitiveMoveStarted.add(function(t){n._onPrimitiveMoveStarted(t)})),this.disposables.push(this._layer.primitiveMoveContinued.addThrottled(function(t){n._onPrimitiveMoveContinued(t)},200)),this.disposables.push(this._layer.primitiveMoveStopped.add(function(t){n._onPrimitiveMoveStopped(t)}))),this.disposables.push(this._layer.primitiveHoverStarted.add(function(t){n._onPrimitiveHover(t,!0)})),this.disposables.push(this._layer.primitiveHoverStopped.add(function(t){n._onPrimitiveHover(t,!1)})),this.disposables.push(this._map.pointerMoved.add(function(t){return n._onPointerMoved(t)})),this._layerInitiated=!0);this.invalidated.invoke();r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.raiseInvalidatedEvent()},y.prototype._clearMap=function(){this._updateDragPin(!1,null,!1,!1,!1);this._primitives&&this._primitives.length&&(this._clearPrimitives(),this._invalidateMap())},y.prototype.clearExistingRoutes=function(){this._currentResultsControl&&(this._currentResultsControl.removeFromParent(),this._currentResultsControl=null,this._resultsViewModel&&this._resultsViewModel.clearRoutes(),this._resultsViewModel=null,this._clearMap());this._removeCategoriesBar();this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!1)},y.prototype._waypointResolved=function(){var u,n,i,r,f,t;if(!this._hasRoute()){for(this._clearPrimitives(),u=this._directionsPanelViewModel.waypoints.length,n=0;n<u;n++)i=this._directionsPanelViewModel.waypoints[n].getWayPointModel(),i.point&&(r=s.middle,n===0?r=s.start:n===u-1&&(r=s.end),f=i.name||i.address,t=vt.createStopPointPin(i.point,r,this._directionsPanelViewModel.getMode(),!1,null,n,0,null,f,this._renderOptions),t.changeCardTaskState(1),t.changeRouteSelectionState(!0),t.changeZoom(ut.getMercatorZoomLevel(this._map)),t.update(),this._primitives.push(t),this._associatePrimitivesWithLayer([t]));this._invalidateMap()}},y.prototype._associatePrimitivesWithLayer=function(n){var t=this._layer,i,u;if(t)if(r.Layer!==undefined&&t instanceof r.Layer)t.add(n);else for(i=0,u=n.length;i<u;i++)n[i].layer=t},y.prototype._setMapViewIfPrimitivesOutOfBound=function(n,t,i){var r;t===void 0&&(t=!1);i===void 0&&(i=!1);var e=ut.getMapBounds(this._map,!0),u=ni.getLocationsForPrimitivesInView(n),f=!1;for(r=0;r<u.length;r++)if(e.contains(u[r])){f=!0;break}(!f||i)&&this._setMapViewWithPadding(u,t)},y.prototype._setMapViewWithPadding=function(n,t){var i,r;t===void 0&&(t=!1);i=this._map.getMapType();i.id!==br.birdseyeV2&&(t||!this.displayState.activationState||this.displayState.activationState===1)&&(r=this._getAdditionalPadding(),this._map.setView(this._map.getMode().getMapViewForLocationsInView(n,r)))},y.prototype._getAdditionalPadding=function(){var t=this._map.getViewport(),i=Math.min(.07*t.pixelWidth,.07*t.pixelHeight),n=Math.max(10+23/2,i);return{left:n,top:n,right:n,bottom:n}},y.prototype.isSharable=function(){return this._primitives&&this._primitives.length>0},y.prototype.getMenuList=function(){var n=f.prototype.getMenuList.call(this);return this.isReportable()&&n.push({name:t.L_Menu_ReportProblem_Link_Text,options:{type:v.feedbackTask,activateOptions:{parentId:this.id},state:this._getFeedbackTaskState()},instData:this.getInstData("Report Problem")}),n},y.prototype.isReportable=function(){return this._resultsViewModel?!0:!1},y.prototype._getFeedbackTaskState=function(){return{entryPoint:2,feedbackTaskType:5,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},y.prototype.getReportOptions=function(){var n=this._resultsViewModel.directionsResultsListSet[this._resultsViewModel.getRouteSelected()],t=[];return n&&n.stepStrings&&(t=n.stepStrings),{reportType:this.getReportType(),taskState:this.serialize(),directionStepsList:t,directionRouteIndex:this._resultsViewModel.getRouteSelected()}},y.prototype.getReportType=function(){return 7},y.prototype._setMapLayerZIndex=function(n){this._layer&&this._layer.setZIndex(n)},y.prototype._getTraceId=function(){return this._traceId},y.prototype._hasRoute=function(){return this._resultsViewModel&&this._resultsViewModel.getRoutesLength()>0},y.prototype._createDirectionsPanelViewModel=function(){return d.isMobile?new MobileDirectionsPanelViewModel(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService):new fr(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService)},y.prototype._createDirectionsResultsSetViewModel=function(n,t,i){return d.isMobile?new MobileDirectionsResultsSetViewModel(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions):new or(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions)},y.prototype.getResultsPanel=function(){return this._resultsViewModel&&this._resultsViewModel.getControl()},y.prototype.clearDisplay=function(){this._layer&&this._map.getLayers().remove(this._layer)},y.prototype.getDirectionsResponse=function(){return this._resultsViewModel&&this._resultsViewModel.getRawResponse()},y.prototype.getPanelViewModel=function(){return this._directionsPanelViewModel},y.isIDirectionsPushpin=function(n){return n instanceof at?!0:typeof r.Directions.DirectionsSDKPushpin!="undefined"?n instanceof r.Directions.DirectionsSDKPushpin:!1},y.isIDirectionsPolyline=function(n){return n instanceof lt?!0:typeof r.Directions.DirectionsSDKPolyline!="undefined"?n instanceof r.Directions.DirectionsSDKPolyline:!1},y.prototype._clearPrimitives=function(){this._primitives=[];r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.clear()},y.prototype._isDraggable=function(){return this._taskState&&this._taskState.options&&typeof this._taskState.options.routeDraggable=="boolean"?this._taskState.options.routeDraggable:n.routeDraggable},y.KeySegmentCount=10,y.KeyPointsCount=y.KeySegmentCount+1,y.localDetailCardsData=[],y.polygonEntityDetailCardsData=[],y.transitStopCardsData=[],y.RouteCategoriesBarPanelCssClass="routecategoriesbar",y.startPrintIcon=155,y.stopPrintIcon=156,y.endPrintIcon=157,y}(vr),dt=[new k("attractionsIcon",t.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions"),new k("hotelsIcon",t.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","hotel"),new k("restaurantsIcon",t.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","restaurant"),new k("coffeeIcon",t.L_Directions_Categories_Bar_Entity_Coffee,3,"Coffee"),new k("gasStationsIcon",t.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations"),new k("groceryStoresIcon",t.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets")],wu=[new k("attractionsIcon",t.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions"),new k("hotelsIcon",t.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","hotel"),new k("restaurantsIcon",t.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","restaurant"),new k("fastFoodIcon",t.L_Directions_Categories_Bar_Entity_FastFood,6,"FastFood"),new k("gasStationsIcon",t.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations"),new k("groceryStoresIcon",t.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets")],p;(function(n){n[n.A=1]="A";n[n.GD=2]="GD";n[n.ARC=3]="ARC";n[n.SE=4]="SE";n[n.AC=5]="AC";n[n.RWTLC=6]="RWTLC";n[n.RPPC=7]="RPPC";n[n.WR=8]="WR";n[n.DR=9]="DR";n[n.PD=10]="PD";n[n.EXP=11]="EXP";n[n.COL=12]="COL";n[n.ARCM=13]="ARCM"})(p||(p={}));b=function(){function t(){}return t.logInstrumentationEvent=function(i,r){if(!n.isSDK){var u={logData:{feature:t.featureName,action:p[i],data:r}};a.invokeHandler(l.instrumentationDataHandlerKey,u)}},t.callMapSnRInstrumentation=function(t){if(!n.isSDK){var i={logData:{feature:"d",data:t}};a.invokeHandler(l.callServerInstrumentationDataHandlerKey,i)}},t.featureName="DD",t}(),function(n){n[n.RW=1]="RW";n[n.RR=2]="RR";n[n.PD=3]="PD";n[n.MR=4]="MR";n[n.PL=5]="PL";n[n.TD=6]="TD"}(rt||(rt={}));et=function(){function n(){}return n.setClientPerf=function(t){n.perfLog=t},n.logPerfEvent=function(t,r){if(!n.perfLog)return null;var u=n.featureName;if(u+="_",r)switch(r){case i.driving:u+="D_";break;case i.transit:u+="T_";break;case i.walking:u+="W_"}return u+=rt[t],n.perfLog.start(u)},n.featureName="DD",n.keyForDragRequest="DR",n}(),function(n){n[n.none=0]="none";n[n.minimizeHighways=1]="minimizeHighways";n[n.minimizeToll=2]="minimizeToll";n[n.avoidHighways=4]="avoidHighways";n[n.avoidToll=8]="avoidToll";n[n.avoidExpressTrain=16]="avoidExpressTrain";n[n.avoidAirline=32]="avoidAirline";n[n.avoidBulletTrain=64]="avoidBulletTrain"}(ui||(ui={}));var ir=function(){function t(){}return t.downloadRoutes=function(r,u){var f=r.requestOptions;if(!f)throw"options parameter must be defined!";if(!f.waypoints||f.waypoints.length===0)throw"options parameter is missing required properties!";f.mode===i.truck?t._downloadRoutesViaPost(r.mapCredentials,n.calculateTruckRouteServiceUrl,r,u):nr.instance.authenticateClientAndRetrieveSessionId(function(){var i=n.applicationKey||nr.instance.getSessionId();t._downloadRoutesViaGet(i,n.calculateRouteServiceUrl,r,u)})},t._downloadRoutesViaGet=function(r,u,f,e){for(var a,k,d,ut,ft,lt,at,et,y,g,w,ot,c=f.requestOptions,nt=f.isDragRequest,tt=f.viaPoint,st=f.subLegIndex,vt=f.legIndex,yt=f.viaPointRemoved,v={},l=u.replace("{app_key}",r).replace("{culture}",t._getUrlCultureParam()).replace("{travelMode}",i[c.mode]),o=[],ht="",it="",rt=!1,s=0;s<c.waypoints.length;s++)if(a=c.waypoints[s],o.push(a),ht+=a.waypointSource.toString(),a.point&&(it+=a.point.latitude+","+a.point.longitude),it+=s==c.waypoints.length-1?"":";",rt=rt||a.waypointSource==4||a.waypointSource==2,k=a.viaWaypoints,s===vt)if(st>=k.length)o=o.concat(k),o.push(tt);else for(d=0;d<k.length;d++)d===st&&o.push(tt),o.push(k[d]);else k&&(o=o.concat(k));for(s=0;s<o.length;s++)l+=t._createWaypointQueryParam(o[s],s),s!==o.length-1&&(l+="&");if(ut=o[0],ft=o[o.length-1],nt?(l+="&ra=routepath",c.mode!==i.transit&&(l+=",excludeitinerary"),lt=new h((ut.point.latitude+ft.point.latitude)/2,(ut.point.longitude+ft.point.longitude)/2),at=gi.toScale(lt,ct.currentZoomLevel,!1),l+="&res=",l+=at):c.mode===i.transit&&(l+="&ig=true&ra=routepath,transitStops"),et=t._createOptionsQueryParam(c.options,c.mode,v,nt),l+=et,ai.downloadJsonp(l,"routes",function(n,t){var u=t.requestOptions,i,r;n&&(i=n.statusCode!==200&&n.errorDetails&&n.errorDetails.length>0?4:n.resourceSets&&n.resourceSets.length>0?1:3,e&&e(t,n,i),i!==1||t.isDragRequest||(r={},r.NR=n.resourceSets[0].resources.length,b.logInstrumentationEvent(p.DR,r)))},function(n){e&&e(n,null,2)},null,!1,f,0),v.M=c.mode,v.NM=c.waypoints.length,v.O=et,nt)v.D=tt?2:yt?3:1;else{for(y="",g=0;g<o.length;g++)w=o[g],w.name?y+=w.name:w.address?y+=w.address:w.point&&(ot=w.point,y=y+ot.latitude+","+ot.longitude,n.enableApproximateLocation&&w.isApproximate&&(y+="a")),g!==o.length-1&&(y+="|");v.WS=ht;rt&&(v.WC=it);b.callMapSnRInstrumentation(y)}b.logInstrumentationEvent(p.GD,v)},t._downloadRoutesViaPost=function(n,i,r,u){var f=i.replace("{app_key}",n),e=t._constructPostBody(r),o=function(n){if(u){var t=null;try{t=JSON.parse(n)}catch(i){}t===null?u(r,null,3):u(r,t,1)}},s=function(){u&&u(r,null,2)};ai.doPost(f,e,{onSuccess:o,onError:s})},t._constructPostBody=function(i){var r={waypoints:[],routeAttributes:"routePath"},o=i.requestOptions,u,c,s,h,f,e;for(o.options&&(u=o.options,r.distanceBeforeFirstTurn=u.distanceBeforeFirstTurn,r.heading=u.heading,r.vehicleSpec=u.vehicleSpec,c=t._createAvoidList(u),c.length>0&&(r.avoid=c),s=u.optimize||n.optimize,s&&(r.optimize=nt[s],s===nt.timeWithTraffic&&u.dateTime&&(r.dateTime=t._createDateTimeString(new Date(u.dateTime)))),r.distanceUnit=t._createDistanceUnit(u)),h=0;h<o.waypoints.length;h++)f=o.waypoints[h],e={},e.address=f.address,e.isViaPoint=f.isViaWaypoint,f.point&&(e.latitude=f.point.latitude,e.longitude=f.point.longitude),r.waypoints.push(e);return JSON.stringify(r)},t._getUrlCultureParam=function(){if(!t._urlCultureParam){var n=d.dynamicProperties.uiLanguage;n.toLowerCase()==="yy-zz"&&(n="ja-ploc-jp");t._urlCultureParam=n}return t._urlCultureParam},t._createWaypointQueryParam=function(t,i){var r="",u,f;return t.isViaWaypoint&&(r+="v"),r+="wp.",r+=i,r+="=",t.locationIdentifier?r+=t.locationIdentifier:t.point?(u=t.point,r+=u.latitude,r+=",",r+=u.longitude,n.enableApproximateLocation&&t.isApproximate&&(r+="a")):t.address&&(f=t.address,r+=f),r},t._createAvoidList=function(n){var t=[],i="";return n&&(n.avoidHighways&&t.push("highways"),n.avoidTollRoads&&t.push("tolls"),n.minimizeHighways&&t.push("minimizeHighways"),n.minimizeTolls&&t.push("minimizeTolls"),n.avoidExpressTrains&&t.push("expresstrain"),n.avoidAirlines&&t.push("airline"),n.avoidBulletTrains&&t.push("bullettrain"),t.length>0&&(i=t.join())),i},t._createDistanceUnit=function(t){var i=n.unit;return t.unit&&(i=t.unit),i===st.miles?"mi":"km"},t._createDateTimeString=function(n){var t=n.getUTCMinutes();return t<10&&(t="0"+t),n.getUTCMonth()+1+"/"+n.getUTCDate()+"/"+n.getUTCFullYear()+" "+n.getUTCHours()+":"+t+":00"},t._createOptionsQueryParam=function(r,u,f,e){var o="",v,p,h,a,l,c,s,w;if(r){if(v=t._createAvoidList(r),v.length>0&&(o+="&avoid="+v),(u===i.driving||u===i.transit&&(n.enableOptimizeCost||n.enableOptimizeTime||n.enableOptimizeTransfers))&&(p=r.optimize||u===i.driving&&n.optimize,p&&(o+="&optmz="+nt[p])),u===i.transit&&r.transitTypes){for(h="&trt=",a=!0,l=1;l<r.transitTypes.length;l++)r.transitTypes[l]?h+=l+",":a&&(a=!1);a||(h=h.substring(0,h.length-1),o+=h)}o+="&du="+t._createDistanceUnit(r);(u===i.transit||u===i.driving&&n.enablePredictiveRouting)&&(c=r.timeType,f&&(f.TT=c),c===y.firstAvailable?(c=y.departure,s=new Date,s=new Date(s.getTime()-s.getTimezoneOffset()*6e4)):r.dateTime&&(s=new Date(r.dateTime)),c&&s&&(o+=["&dt=",t._createDateTimeString(s),"&tt=",y[c]].join("")));w=e?1:r.maxRoutes?r.maxRoutes:w=n.maxRoutes;o+="&maxSolns=";o+=w}return o+"&rpo=Points"},t}(),rr=function(){function n(){}return n.prototype.getTitle=function(){return""},n.prototype.getSubtitle=function(){return""},n.prototype.getDescriptionTime=function(){return null},n.prototype.getDescriptionTimeNoTraffic=function(){return null},n.prototype.getDescriptionVia=function(){return""},n.prototype.getHtmlFormattedInstruction=function(){return""},n.prototype.getInstruction=function(){return[]},n.prototype.getStartInstruction=function(n,i,r,u,f){var s=this._createWaypointInstruction(n,u?"dirRouteStart":"dirRouteStop bm_dirRouteLegStart",r[0].routeLegStopPoint,f),h,e,o,c;for(s.viaPoints=[],h=n.getWayPointModel(),e=1;e<r.length;e++)o=r[e].routeLegStopPoint,o.isVia&&h.viaWaypoints.length>=e&&(c={text:t.L_Directions_Via_Text.replace("{0}",o.description),removeLinkText:t.L_Directions_Via_Remove_Link,waypointIndex:n.getIndex(),viaPointIndex:e-1},s.viaPoints.push(c),h.viaWaypoints[e-1].address=o.description);return s},n.prototype.getEndInstruction=function(n,t,i,r,u){return this._createWaypointInstruction(n,u||u===undefined?"dirRouteEnd":"dirRouteStop bm_dirRouteLegEnd",i[i.length-1].routeLegStopPoint,r)},n.prototype.getFormattedDistanceText=function(n,t){return n?u._formatDistanceString(n,t.distanceUnit.toLowerCase()!=="mile"):""},n.prototype.getDurationString=function(n){var i=Math.round(n/60),r=i%60,f=Math.floor(i/60);return f==0?u._formatString(t.L_Directions_Duration_Min,r):u._formatString(t.L_Directions_Duration,f,r)},n.prototype.setRenderOptions=function(n){this.renderOptions=n},n.prototype.getCost=function(){return null},n.prototype._createWaypointInstruction=function(n,t,i,r){if(n)return new yt(r,i,null,t,n,this.renderOptions)},n}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),fi=function(i){function r(){var n=i.call(this)||this;return n.roadShieldsReadyEvent=new e,n.unloadedRoadShields=0,n}return c(r,i),r.prototype.setMap=function(n){var t=this;this._map=n;this._map&&this._map.getTemplateSelector().then(function(n){t._mapTemplateSelector=n})},r.prototype.getDescriptionVia=function(n){var i=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0].description;return i?u._formatString(t.L_Directions_Results_Title,i):null},r.prototype.getDescriptionTime=function(n){return n?this.getDurationString(n.travelDurationTraffic):null},r.prototype.getDescriptionTimeNoTraffic=function(n){var i=n?this.getDurationString(n.travelDuration):null;return i?u._formatString(t.L_Directions_Results_Description_Time,i):null},r.prototype.getTitle=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getFormattedDistanceText(n.travelDistance,n):""},r.prototype.getInstruction=function(n,t,i){var f=[],u,e;return n&&(u=new yt(i,n.maneuverPoint,n),u.setRenderOptions(this.renderOptions),u.travelDistanceText=this.getFormattedDistanceText(n.travelDistance,t),u.stepText=n.instruction.text,u.formattedText=this.getHtmlFormattedInstruction(n.instruction.formattedText),u.hints=n.hints,u.warnings=this._sortWarnings(n.warnings),n.travelDistance>=r.TravelDistanceThreshhold&&(u.travelDurationText=this.getDurationString(n.travelDuration)),e=n.instruction.maneuverType,this._constructRoadShieldUrl(u,n.details,e),f.push(u)),f},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/ExitNumber>|<\/TurnDir>|<\/RoadName>|<\/Sign>|<\/WaypointName>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype._constructRoadShieldUrl=function(t,i,u){var c=this,e,o,h,l,s,f,a,v;if(!i||!i.length){t.setStepIconClass(u);return}for(e=[],o=-1,h=0;h<i.length;h++)l=i[h],s=l.roadShieldRequestParameters,s&&(o===-1&&(o=s.bucket||r._defaultRoadShieldBucketId),s.shields&&Array.prototype.push.apply(e,s.shields));if(e.length)e.length>1&&e.sort(function(n,t){var i=n.roadShieldType,r=t.roadShieldType;return i!=r?i-r:t.labels[0].localeCompare(n.labels[0])});else{t.setStepIconClass(u);return}if(f=e[0],!this._shouldDisplayShield(o,f,u)){t.setStepIconClass(u);return}n.enableRoadShieldIconXsr?(this.unloadedRoadShields++,a=[f.roadShieldType-1],this._mapTemplateSelector.getShieldsAsync(r._roadShieldZoom,o,a,function(n){try{var i=c._getLabel(f.labels),r=n[0].renderIcon({id:null,name:i}),e=r[0].toDataURL();t.setRoadShieldUrl(e)}catch(o){t.setStepIconClass(u)}finally{--c.unloadedRoadShields==0&&c.roadShieldsReadyEvent.invoke()}})):(v=n.roadShieldServiceUrlFormat.replace("{bucket}",o).replace("{shield}",f.roadShieldType).replace("{label}",f.labels&&f.labels.length?f.labels[0]:""),t.setRoadShieldUrl(v))},r.prototype._getLabel=function(n){if(!n||!n.length)return"";if(n[0].indexOf("UP:")===0)try{var t=JSON.parse(n[0].substring(3));return t.label}catch(i){return n[0]}return n[0]},r.prototype._shouldDisplayShield=function(n,t,i){if(n===50360||n===50395){if(t.roadShieldType===1||t.roadShieldType===2)return!0}else if(t.roadShieldType===1)return!0;return i==="TakeRampLeft"||i==="TakeRampRight"||i==="TakeRampStraight"||i==="Merge"||i==="RampThenHighwayLeft"||i==="RampThenHighwayRight"||i==="RampToHighwayStraight"||i==="BearThenMerge"||i==="TurnThenMerge"||i==="RoadNameChange"},r.prototype._sortWarnings=function(n){if(n)return n.sort(function(n,t){var i=["Serious","Moderate","Minor","LowImpact","None"];return i.indexOf(n.severity)-i.indexOf(t.severity)})},r.TravelDistanceThreshhold=10,r._roadShieldZoom=14,r._defaultRoadShieldBucketId=787073,r}(rr),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ei=function(n){function t(){return n.call(this)||this}return c(t,n),t.prototype.getDescriptionTimeNoTraffic=function(){return null},t}(fi),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ur=function(i){function r(){return i.call(this)||this}return c(r,i),r.prototype.getDescriptionVia=function(n){var i=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0].itineraryItems,e="",f,o;if(i&&i.length)for(f=0,o=0;f<i.length;f++)i[f].transitLine&&(e+=u._formatString(o++>0?t.L_Directions_Transit_Via2:t.L_Directions_Transit_Via1,r.typeNames[i[f].iconType],i[f].transitLine.abbreviatedName));return e?e:null},r.prototype.getTitle=function(n){var i="",t,f,e;return n&&(t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0],t&&t.startTime&&t.endTime&&(f=u._getTimeString(t.startTime),e=u._getTimeString(t.endTime),i=u._formatString(r._transitTimeFormat,f,e))),i},r.prototype.getDescriptionTimeNoTraffic=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getDurationString(n.travelDuration):""},r.prototype.getInstruction=function(i,r,f){var w=[],e,a,s,b,o,v,it,l,p,c,y,d,g,k,nt,tt;if(i){if(e=new yt(f,i.maneuverPoint,i),e.setRenderOptions(this.renderOptions),i.groupText?(a=i.childItineraryItems[0],e.setStepIconClass(a.iconType),e.stepText=i.groupText,e.formattedText=e.stepText,e.itineraryItem.maneuverPoint=a.maneuverPoint,e.location=new h(a.maneuverPoint.coordinates[0],a.maneuverPoint.coordinates[1]),e.itineraryItem.instruction=a.instruction,e.setShow(!0)):(e.setStepIconClass(i.iconType),e.stepText=i.instruction.text,e.formattedText=this.getHtmlFormattedInstruction(i.instruction.formattedText),e.timeText=i.time?u._getTimeString(i.time):""),e.hints=i.hints||[],e.warnings=i.warnings||[],i.transitLine&&(i.transitLine.uri&&i.transitLine.uri.indexOf(n.specialAttributionLink)>-1&&(e.specialAttributionUri=i.transitLine.uri,e.specialAttributionLink=n.specialAttributionLink),i.transitLine.lineColor&&(e.transitLineColor=u._formatHexColorString(i.transitLine.lineColor,""))),w.push(e),e.groupItems=[],e.groupItemsLocations=[],b=i.childItineraryItems,b&&b.length)for(e.childSteps=[],l=0;l<b.length;l++)o=b[l],i.groupText?(v=this.getInstruction(o,r,f)[0],it=o.instruction.maneuverType,v.setShow(!1),v.setStepIconClass(it),v.parentStepIndex=i.parentInstructionIndex,w.push(v),e.groupItems.push(v),y=o.maneuverPoint.coordinates,e.groupItemsLocations.push(new h(y[0],y[1]))):o.instruction.maneuverType==="TransitArrive"?(s=new yt(f,o.maneuverPoint,o),s.setRenderOptions(this.renderOptions),s.setStepIconClass(o.instruction.maneuverType),s.parentStepIndex=i.parentInstructionIndex,s.stepText=o.instruction.text,s.formattedText=this.getHtmlFormattedInstruction(o.instruction.formattedText),s.timeText=u._getTimeString(o.time),s.transitArriveTime=u._getTime(o.time),s.needPushpin=!1,s.transitLineColor=e.transitLineColor):o.instruction.maneuverType==="TransitDepart"&&(e.transitDepartTime=u._getTime(o.time),e.timeText=u._getTimeString(o.time),e.childSteps=[{stepText:o.instruction.text,formattedText:this.getHtmlFormattedInstruction(o.instruction.formattedText)}]);if(i.transitStops&&i.transitStops.length)for(l=0;l<i.transitStops.length;l++)p=i.transitStops[l],c=new yt(f,p.position),c.setRenderOptions(this.renderOptions),c.setShow(!1),c.setStepIconClass("TransitStop"),c.stepText=p.stopName,c.parentStepIndex=i.parentInstructionIndex,c.formattedText=c.stepText,c.needPushpin=!0,c.transitStopID=p.stopId,c.transitStopName=p.stopName,c.transitLineColor=e.transitLineColor,w.push(c),e.groupItems.push(c),y=p.position.coordinates,e.groupItemsLocations.push(new h(y[0],y[1]));if(s){if(s.transitDepartTime=e.transitDepartTime,e.hints){for(d=[],g=[],k=0;k<e.hints.length;k++)nt=e.hints[k],tt=nt.hintType,(tt==="PreviousTransitStop"||tt==="NextTransitStop"?d:g).push(nt);e.hints=g;s.hints=d}w.push(s)}i.iconType==="Walk"&&i.travelDistance&&(e.hints=e.hints||[],e.hints.unshift({text:u._formatString(t.L_Directions_WalkDistance,this.getFormattedDistanceText(i.travelDistance,r),this.getDurationString(i.travelDuration))}))}return w},r.prototype.getStartInstruction=function(n,t,r,f,e){var o=i.prototype.getStartInstruction.call(this,n,t,r,f,e);return o.timeText=u._getTimeString(t.startTime),o},r.prototype.getEndInstruction=function(n,t,r,f){var e=i.prototype.getEndInstruction.call(this,n,t,r,f);return e.timeText=u._getTimeString(t.endTime),e},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/TransportType>|<\/TransitLineName>|<\/TransitLineTerminus>|<\/TransitStop>|<\/StartLocation>|<\/EndLocation>|<\/ServiceProvider>|<\/Phone>|<\/Action>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype.getCost=function(n){var r=0,i,u;if(n&&n.routeLegs&&n.routeLegs.length)for(i=0,u=n.routeLegs.length;i<u;i++)r+=n.routeLegs[i].cost;return t.L_Directions_Cost.replace("{0}",r)},r._transitTimeFormat="{0} - {1}",r.typeNames={Bus:t.L_Directions_Bus,Ferry:t.L_Directions_Ferry,Train:t.L_Directions_Train,Tube:t.L_Directions_Tube,Airline:t.L_Directions_Airline},r}(rr),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),fr=function(r){function f(i,u,o,s,h,c,l,a,v){var p=this,w={},b=a&&a.inputTemplate===f._serpTemplateName?ou:eu;return p=r.call(this,w,u,b)||this,p._perfLog=l,p.resources=t,p._map=c,p.geolocationProvider=s,p._featureName=n.featureType,p.enableHistory=!n.isSDK,p.resolveWaypointsInRoutingService=v,p._setEnabledOptions(),p._taskId=h,p._inputData=i,p.disposables.push(p.getDirectionsRequested=new e,p.directionsResultsRequested=new e,p.directionsModeChanged=new e,p.clearDirectionsResults=new e,p.waypointResolvedEvent=new e,p.taskTitleRequestedEvent=new e,p.seeAllRoutesClick=new e,p.resolveWaypointSDKEvent=new e),p._populateModes(a),p.disposables.push(p.waypoints=new ti),p.disposables.push(p.waypoints.changed.add(function(n){p._onWaypointsChanged(n)})),w.defineProperty("optionsClass",null,null,{defaultValue:""}),w.defineProperty("showTimeControls",p._onShowTimeControlsChanged,null,{defaultValue:!1}),w.defineProperty("scrollContainer",null,null,{defaultValue:null}),w.defineProperty("panelClass",null,null,{defaultValue:"directionsPanel"}),p._panelDim=0,w.defineProperty("showReverse"),w.defineProperty("showWaypoints",null,null,{defaultValue:!0}),w.defineProperty("showEditDirections",null,null,{defaultValue:!1}),w.defineProperty("messageText"),w.defineProperty("showProgress"),w.defineProperty("avoidHighways",p._onAvoidHighwaysChanged),w.defineProperty("avoidTolls",p._onAvoidTollsChanged),w.defineProperty("roundTrip",p._onRoundTripChanged),w.defineProperty("unitsKm",p._onUnitsKmChanged),w.defineProperty("unitsMiles",p._onUnitsMilesChanged),w.defineProperty("optimizeTime",p._onOptimizeTimeChanged,null,{defaultValue:!0}),w.defineProperty("optimizeCost",p._onOptimizeCostChanged),w.defineProperty("optimizeTransfers",p._onOptimizeTransfersChanged),p._setTransitModeOptions(w),w.defineProperty("saveHistory",function(n,t){bt.resetIsHistoryEnabled(t)},null,{defaultValue:bt.isHistoryEnabled()}),w.defineProperty("showSuggestionsPanel",null,null,{defaultValue:!0}),w.defineProperty("historyDeleted",null,null,{defaultValue:!1}),w.defineProperty("showRouteCategoriesPanel",null,null,{defaultValue:!1}),w.defineProperty("optionsText"),w.defineProperty("dateTimeSummary1"),w.defineProperty("dateTimeSummary2"),w.defineProperty("allowAddWp"),w.defineProperty("mode",p._onModeChanged),p.disposables.push(p.timeTypes=new ti),p.timeTypes.insert({text:t.L_Directions_Leave_Now,value:y.firstAvailable}),p.timeTypes.insert({text:t.L_Directions_Depart_At,value:y.departure}),n.enableDrivingArriveBy&&p.timeTypes.insert({text:t.L_Directions_Arrive_By,value:y.arrival}),w.defineProperty("transitTimeType",p._onTimeTypeChanged),w.defineProperty("date",p._onDateTimeChanged,null,{defaultValue:Date.now()}),w.defineProperty("time",p._onDateTimeChanged),w.defineProperty("editingTime"),w.defineProperty("timeCtrlDisabled"),p}return c(f,r),f.prototype.initializeControls=function(n){this.setShowProgress(!1);this.updateInputControlsFromModel();this._updateDateTimeSummary(!1);this.initializeCalendar(n)},f.prototype.initializeCalendar=function(n){var t=this,i=o(".calContainer",this.getControl()[0]);i&&n&&n.instanceAsync("SingleCalendar",function(n){n.init(i,t.getDate());n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);t.setDate(n.getTime());var i=o(".dirBtnGo",t.getControl()[0])[0];i.focus()});t._calendar=n})},f.prototype.onTaskStateChanged=function(n){var t,u,i,r,f;if(n.animationState===1){for(t=document.activeElement,u=this.getControl()[0];t&&t!==u;)t=t.parentNode;if(!t){for(i=0,r=-1;i<this.waypoints.length;i++)if(this.waypoints[i].isEmpty()){r=i;this.setFocusToWaypoint(r);break}r<0&&(f=o(".dirBtnGo",u)[0],f.focus())}}n.activationState===2&&(this.hideMessage(),this.setOptionsClass(""),this.setShowTimeControls(!1))},f.prototype.setResultsShowingFlag=function(n){this.isResultsPanelShowing=n},f.prototype.serializeTaskOptions=function(n){return o.Internals.stringify(n)},f.prototype.onGetDirectionsClick=function(n){n&&n.preventDefault();this.setEditingTime(!1);this.setShowTimeControls(!1);this.getDirections()},f.prototype.onDropdown=function(t){n.enableDimPanelOnDropdown&&(t?++this._panelDim:this._panelDim>0&&--this._panelDim,this.setPanelClass("directionsPanel"+(this._panelDim?" drPanelDimmed":"")))},f.prototype.initAutosuggest=function(){this.showAutosuggestPanel();this.contextId=u._generateRandomKey();for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)},f.prototype.setWaypointSuggestionRequestedHandler=function(n){this._suggestionRequestedHandler=n;for(var t=0;t<this.waypoints.length;t++)this.waypoints[t].setWaypointSuggestionRequestedHandler(this._suggestionRequestedHandler)},f.prototype.showAutosuggestPanel=function(){this.setShowSuggestionsPanel(!0);this.hideMessage();this.setShowTimeControls(!1)},f.prototype._updateWaypointsFromData=function(){if(this._inputData.waypoints&&this._inputData.waypoints.length){this.waypoints.clear();for(var n=0;n<this._inputData.waypoints.length;n++)this._addWaypointViewModel(this._inputData.waypoints[n])}},f.prototype.getRouteTitle=function(){var r=this.waypoints.length,n,i;return r>=2&&(n=this.waypoints[0].getWaypointTitle(),i=this.waypoints[r-1].getWaypointTitle(),n&&i)?t.L_Directions_Process_Title_Text_Line.replace("{0}",n).replace("{1}",i):null},f.prototype._filterAutosuggestDetailCards=function(n){var t,i;if(this._currentFocusedWaypoint&&this._inputData&&this._inputData.waypoints&&this._inputData.waypoints.length&&n){var r=this._currentFocusedWaypoint.getIndex(),u=this._inputData.waypoints[r-1],f=this._inputData.waypoints[r+1],e=[];for(t=0;t<n.length;t++)(i=n[t],u&&h.areEqual(u.point,i.getLocation())||f&&h.areEqual(f.point,i.getLocation()))||e.push(i);return e}return n},f.prototype.updateCurrentLocalDetailCards=function(n){f._localDetailCards=f._localDetailCards.concat(n);it.appendLocalDetailCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},f.prototype.resetLocalDetailsCards=function(){f._localDetailCards=[];it.resetCurrentLocalDetailsCards()},f.prototype.updateCurrentTransitStopCards=function(n){f._transitStopCards=n;it.updateCurrentTransitStopCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},f.prototype.onWaypointFocusChanged=function(n){!this._currentFocusedWaypoint||this._currentFocusedWaypoint===n||this._currentFocusedWaypoint.getWayPointModel().point||this._currentFocusedWaypoint.isBeingResolved||(this._currentFocusedWaypoint.isBeingResolved=!0,this._resolveWayPoint(this._currentFocusedWaypoint.getIndex(),!0));this._currentFocusedWaypoint=n;it.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(f._localDetailCards));it.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(f._transitStopCards))},f.prototype.waypointResolved=function(i){var o,u,c,r;i.inData.requestorState.perfState&&(o=i.inData.requestorState.perfState,o.end());var f=i.inData,l=f.requestState,s=f.requestorState.isBeingPrefetched,h=f.requestorState.waypointIndex,e=this.waypoints[h];e.isBeingResolved=!1;i.outData&&i.outData.length===1&&i.outData[0].data&&(n.isSDK?(u=i.outData[0].data,e.update(f.requestState.query,u)):i.outData[0].data.entities&&i.outData[0].data.entities.length>0&&(c=i.outData[0].data.entities,r=c[0],n.enableDisambig&&r.isUpHierarchy?e.setUpHierarchyResult(r):(u=r.getRoutableLocation()||r.getLocation(),e.update(r.getDescription(),u,r.getTitle(),r),this.addToHistory(r))));u&&!s&&this._invokeResolveWaypoint(h);u||s||this.clearResultsAndShowMessage(t.L_Directions_Error_Search_Fail,5)},f.prototype.addToHistory=function(n){this.getSaveHistory()&&(bt.saveWaypoint(n),this.setHistoryDeleted(!1))},f.prototype.getDirections=function(n,i,r){var e,f,o,s;for(this.contextId=u._generateRandomKey(),this.getDirectionsRequested.invoke(),this._dismissAllAutosuggests(),e=0,f=this.waypoints.length-1,o=0;f>=0;f--)s=this.waypoints[f],s.trim(),s.isEmpty()?this.waypoints.length>2&&this._deleteWaypoint(f):(o++,e=f);o<2?(n||this.clearResultsAndShowMessage(t.L_Directions_Error_Waypoints,1),o!==1||this._inputData.waypoints[e].point||this._resolveWayPoint(e,!0)):(this.setShowProgress(!0),this._invokeResolveWaypoint(0,i,r))},f.prototype.onGeolocationCallback=function(n){n.error?n.error&&this.clearResultsAndShowMessage(t.L_Directions_Error_User_Location_Not_Found,1):(this.waypoints[0].update(t.L_Directions_MyLocation,n.location,t.L_Directions_MyLocation),this.getDirections())},f.prototype.onReverseClick=function(n){n.preventDefault();this._reorderWaypoint(0,1);this._updateExistingDirections()},f.prototype.onEditDirectionsClick=function(){},f.prototype.onOptionsClick=function(n){var t,i;n.preventDefault();t=this.getOptionsClass()==="";this.setOptionsClass(t?"dropdownOpen":"");i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},f.prototype.onTimeClick=function(n){var t,i;n.preventDefault();t=!this.getShowTimeControls();this.setShowTimeControls(t);i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},f.prototype.onAddClick=function(t){this._invalidateResults();t.preventDefault();var i=o(".icon.end",this.getControl()[0]);i.swap_class("end","middle");this.addWaypoint(new g);this.hideMessage();n.enableFocusToWaypointOnAddClick&&this.setFocusToWaypoint(this.waypoints.length-1)},f.prototype.showEditAndCollapseCard=function(){},f.prototype.setFocusToWaypoint=function(n){var i=o(".dirWaypoints",this.getControl()[0])[0],t,r;i&&(t=o("input",i),r=t.length,n>=0&&n<r&&Microsoft.Maps.setTimeout(function(){t[n].focus()},50))},f.prototype.addWaypoint=function(n){this.getAllowAddWp()&&this._inputData.tryAddWaypoint(n,this._inputData.waypoints.length)&&this._addWaypointViewModel(n)},f.prototype.setWaypoint=function(n,t){t>=0&&t<this.waypoints.length&&(this._inputData.waypoints[t]=n)},f.prototype.removeViaPoint=function(n,t){if(n>=0&&n<this.waypoints.length){var i=this.waypoints[n].getWayPointModel().viaWaypoints;t>=0&&t<i.length&&(i.splice(t,1),this.directionsResultsRequested.invoke({DirectionsInputData:this._inputData,viaPointRemoved:!0}))}},f.prototype.onModeClick=function(n){n.preventDefault();var i=n.target,t=this._getModeData(Number(i.getAttribute("mode")));t&&t.enabled&&this.setMode(t.mode)},f.prototype.isSelectedMode=function(n){return Boolean(n===this.getMode()).toString()},f.prototype.selectedModeToDisplay=function(n){return this.boolToDisplay(n===this.getMode())},f.prototype.displayIfDriving=function(n){return this.boolToDisplay(n===i.driving)},f.prototype.displaySortByOptions=function(t){return this.boolToDisplay(t===i.transit&&(n.enableOptimizeCost||n.enableOptimizeTime||n.enableOptimizeTransfers))},f.prototype.displaySpecialTransitModeFilter=function(t){return this.boolToDisplay(t===i.transit&&n.specialTransitModeFilter)},f.prototype.displayTransitModeFilterROW=function(t){return this.boolToDisplay(t===i.transit&&!n.specialTransitModeFilter&&n.transitModeFilter)},f.prototype.displayIfTransit=function(n){return this.boolToDisplay(n===i.transit)},f.prototype.displayIfNotTransit=function(n){return this.boolToDisplay(n===i.driving||n===i.walking)},f.prototype.displayTimeControls=function(t){return this.boolToDisplay(t===i.transit||t===i.driving&&n.enablePredictiveRouting)},f.prototype.showTimeControlsToClass=function(n){return n?"dropdownOpen":""},f.prototype.indexToWaypointTitle=function(n){return n?t.L_Directions_Title_Destination:t.L_Directions_Title_Start},f.prototype.indexToIconText=function(n){return String.fromCharCode(n+65)},f.prototype.indexToIconClass=function(n){var t="icon ";switch(n){case 0:t+="start";break;case this._inputData.waypoints.length-1:t+="end";break;default:t+="middle"}return t},f.prototype.clearResultsAndShowMessage=function(n,i,r){this.setShowProgress(!1);this.clearDirectionsResults.invoke();this.showMessage(n,i,r);this.taskTitleRequestedEvent.invoke(t.L_DirectionsTaskTitle_Text)},f.prototype.showMessage=function(n,t,i){var u,r;this.setMessageText(n);u=o(".dirMessage",this.getControl()[0]);u[0]&&u[0].focus();t||(t=6);t!==1&&(r={},r.ET=t,r.TI=i,r.ED=n,b.logInstrumentationEvent(p.SE,r));this.setShowSuggestionsPanel(!1)},f.prototype.hideMessage=function(){this.setMessageText(null)},f.prototype.getWaypointDataModels=function(){return this._inputData.waypoints},f.prototype.onDragComplete=function(n){var t,i;if(n){for(t=0;t<this.waypoints.length;t++)this._inputData.tryUpdateWaypoint(this.waypoints[t],t);this._updateExistingDirections();i={};i.RT=2;b.logInstrumentationEvent(p.WR,i);n.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)}},f.prototype.updateInputControlsFromModel=function(){var n,t,u,i,r,f;if(this._isUpdating=!0,this.setMode(this._inputData.mode),n=this._inputData.options,this.setAvoidHighways(!!n.avoidHighways),this.setAvoidTolls(!!n.avoidTollRoads),this.setRoundTrip(!!n.roundTrip),this.setUnitsKm(n.unit===st.km),this.setUnitsMiles(n.unit===st.miles),this.setOptimizeTime(n.optimize===nt.time),this.setOptimizeCost(n.optimize===nt.money),this.setOptimizeTransfers(n.optimize===nt.transfers),this.setAvoidBulletTrains(!!n.avoidBulletTrains),this.setAvoidExpressTrains(!!n.avoidExpressTrains),this.setAvoidFlights(!!n.avoidAirlines),this._updateTransitModeOptionsFromData(),this._updateWaypointsFromData(),t=this.timeTypes[0],u=this._inputData.options.timeType,u)for(i=0;i<this.timeTypes.length;i++)if(u===this.timeTypes[i].value){t=this.timeTypes[i];break}this.setTransitTimeType(t);r=new Date;(t.value===y.departure||t.value==y.arrival)&&(f=this._inputData.options.dateTime,f&&(r=new Date(f+r.getTimezoneOffset()*6e4)));this._setDateAndTime(r.getTime());this._isUpdating=!1},f.prototype.updateInputControlsFromState=function(n){this._inputData=kt.inputDataFromDirectionState(n,this._inputData);this.updateInputControlsFromModel()},f.prototype.updateModeBtnState=function(){for(var n,i,t=0;t<this.modes.length;t++){if(n=this.modes[t],n.enabled=this.waypoints.length<=n.maxWaypoints,n.enabled&&!n.supportViaPoint)for(i=0;i<this.waypoints.length;i++)if(this.waypoints[i].getWayPointModel().viaWaypoints.length>0){n.enabled=!1;break}n.setBtnClass("dirBtn"+n.modeName+" dirBtn"+(this.getMode()===n.mode?"Selected":n.enabled?"Normal":"Disabled"))}},f.prototype.onDeleteHistory=function(n){n.preventDefault();bt.removeAll();this.setHistoryDeleted(!0);var t=o(".dirBtnOptions.dropdownBtn",this.getControl()[0])[0];t.focus()},f.prototype.dispose=function(){this._calendar&&(this._calendar.dispose(),this._calendar=null);r.prototype.dispose.call(this)},f.prototype._populateModes=function(t){if(this.modes=[],t&&t.inputViewModel){var r=t.inputViewModel.drivingViewModel;n.enableDrivingMode&&r&&this.modes.push(new si(i.driving,"Drive",r.title,r.reverseLink,r.getRoute));r=t.inputViewModel.transitViewModel;n.enableTransitMode&&r&&this.modes.push(new si(i.transit,"Transit",r.title,r.reverseLink,r.getRoute));r=t.inputViewModel.walkingViewModel;n.enableWalkingMode&&r&&this.modes.push(new si(i.walking,"Walk",r.title,r.reverseLink,r.getRoute))}else n.enableDrivingMode&&this.modes.push(new pt(i.driving,"Drive")),n.enableTransitMode&&this.modes.push(new pt(i.transit,"Transit")),n.enableWalkingMode&&this.modes.push(new pt(i.walking,"Walk")),n.isSDK&&this.modes.push(new pt(i.truck,"Truck"))},f.prototype._updateExistingDirections=function(){if(!this._isUpdating){for(var n=0,t=this._inputData.waypoints.length;n<t;n++)if(!this._inputData.waypoints[n].point){this._invalidateResults();return}this.getDirections()}},f.prototype._onWaypointsChanged=function(n){var i,u,f,r,t,e;for(this._isUpdating||(n.added?(i=n.added[0],u=n.addedIndex,u>0&&(this.waypoints[u-1].getWayPointModel().viaWaypoints=[])):n.removed&&(i=n.removed[0],f=n.removedIndex,f>0&&(this.waypoints[f-1].getWayPointModel().viaWaypoints=[]))),i&&(i.getWayPointModel().viaWaypoints=[]),r=this.waypoints.length-1,t=0;t<=r;t++)e=this.waypoints[t],e.setIndex(t),e.setShowDelete(r>1);this.setShowReverse(r<=1);this._updateAllowAddWp();this.updateModeBtnState();this.waypointResolvedEvent.invoke(null)},f.prototype._addWaypointViewModel=function(n){var i=this,t;n.isViaWaypoint||(t=new er(n,this),t.waypointDeleteEvent.add(function(n){i._deleteWaypoint(n);i._updateExistingDirections()}),t.changed.add(function(n){n.name==="inputText"&&i.hideMessage()}),this.waypoints.insert(t),t.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler),it.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(f._localDetailCards)),it.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(f._transitStopCards)),this.showAutosuggestPanel(),this.waypointResolvedEvent&&this.waypointResolvedEvent.invoke(t))},f.prototype._deleteWaypoint=function(n){this._inputData.tryRemoveWaypoint(n)&&(this._currentFocusedWaypoint===this.waypoints[n]&&(this._currentFocusedWaypoint=null),this.waypoints.removeAt(n))},f.prototype._onAvoidHighwaysChanged=function(n,t){this._inputData.options.avoidHighways=t;this._updateOptionsText();this._updateExistingDirections()},f.prototype._onAvoidTollsChanged=function(n,t){this._inputData.options.avoidTollRoads=t;this._updateOptionsText();this._updateExistingDirections()},f.prototype._onRoundTripChanged=function(n,t){this._inputData.options.roundTrip=t;this._updateExistingDirections()},f.prototype._onUnitsKmChanged=function(n,t){this.setUnitsMiles(!t);t&&(this._inputData.options.unit=st.km);t&&this._updateExistingDirections()},f.prototype._onUnitsMilesChanged=function(n,t){this.setUnitsKm(!t);t&&(this._inputData.options.unit=st.miles);t&&this._updateExistingDirections()},f.prototype._onOptimizeTimeChanged=function(t,i){i&&n.enableOptimizeTime&&(this.setOptimizeCost(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=nt.time,this._updateExistingDirections())},f.prototype._onOptimizeCostChanged=function(t,i){i&&n.enableOptimizeCost&&(this.setOptimizeTime(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=nt.money,this._updateExistingDirections())},f.prototype._onOptimizeTransfersChanged=function(t,i){i&&n.enableOptimizeTransfers&&(this.setOptimizeCost(!1),this.setOptimizeTime(!1),this._inputData.options.optimize=nt.transfers,this._updateExistingDirections())},f.prototype._onAvoidFlightsChanged=function(n,t){this._inputData.options.avoidAirlines=t;this._updateExistingDirections()},f.prototype._onAvoidExpressTrainsChanged=function(n,t){this._inputData.options.avoidExpressTrains=t;var i=o("[name='dirOptsBulletTrains']",this.getControl()[0]);i.for_each(function(n){t?n.setAttribute("disabled","true"):n.removeAttribute("disabled")});this._updateExistingDirections()},f.prototype._onAvoidBulletTrainsChanged=function(n,t){this.getAvoidExpressTrains()||(this.setUseBulletTrains(!t),this._inputData.options.avoidBulletTrains=t,this._updateExistingDirections())},f.prototype._onUseBulletTrainsChanged=function(n,t){this.setAvoidBulletTrains(!t)},f.prototype._updateOptionsText=function(){var n="",r,u;this.getMode()==i.driving&&(r=this.getAvoidHighways(),u=this.getAvoidTolls(),u&&r?n=t.L_Directions_NoTollsOrHighways:r?n=t.L_Directions_NoHighways:u&&(n=t.L_Directions_NoTolls));this.setOptionsText(n)},f.prototype._onModeChanged=function(r,u){var e,f;if(this.updateModeBtnState(),this._updateAllowAddWp(),this._updateOptionsText(),this.hideMessage(),this._inputData.mode=u,u!==i.walking&&(u!==i.driving||n.enablePredictiveRouting)||this.setShowTimeControls(!1),e=!0,u===i.transit&&n.enableOptimizeTime&&this.setOptimizeTime(!0),f=n.enableDrivingArriveBy?3:2,u===i.transit&&this.timeTypes.length===f)n.enableDrivingArriveBy||this.timeTypes.insert({text:t.L_Directions_Arrive_By,value:y.arrival}),n.enableLastAvailableOption&&this.timeTypes.insert({text:t.L_Directions_Last_Train,value:y.lastAvailable});else if(u===i.driving&&this.timeTypes.length>f)for(this.timeTypes.indexOf(this.getTransitTimeType())>=f&&(this.setTransitTimeType(this.timeTypes[0]),e=!1);this.timeTypes.length>f;)this.timeTypes.removeAt(f);e&&this._updateExistingDirections();this.directionsModeChanged.invoke(u)},f.prototype._onTimeTypeChanged=function(n,t){if(!this._isUpdating){if(this._inputData.options.timeType=t.value,this.setTimeCtrlDisabled(t.value===y.lastAvailable),t.value===y.firstAvailable||t.value===y.lastAvailable){this._isUpdating=!0;var i=new Date;this._setDateAndTime(i.getTime());this._calendar&&this._calendar.SetDate(this.getDate());this._writeDateTimeToModel();this._isUpdating=!1;this._updateExistingDirections()}else this._writeDateTimeToModel(),this._invalidateResults();this.getShowTimeControls()||this._updateDateTimeSummary(!1)}},f.prototype._setDateAndTime=function(n){var t=new Date(n);this.setTime((t.getHours()*60+t.getMinutes())*60);t.setHours(0,0,0,0);this.setDate(t.getTime())},f.prototype._onDateTimeChanged=function(){this._isUpdating||(this.getTransitTimeType().value==y.firstAvailable?this.setTransitTimeType(this.timeTypes[1]):(this._writeDateTimeToModel(),this._updateExistingDirections()),this.getShowTimeControls()||this._updateDateTimeSummary(!1))},f.prototype._writeDateTimeToModel=function(){this._inputData.options.dateTime=this.getDate()+this.getTime()*1e3-(new Date).getTimezoneOffset()*6e4},f.prototype._updateDateTimeSummary=function(n){var f="",r="",i;n||(i=this.getTransitTimeType().value,i===y.firstAvailable||i===y.lastAvailable?r=this.getTransitTimeType().text:(f=u._formatString(i===y.departure?t.L_Directions_Depart_Time:t.L_Directions_Arrive_Time,u._formatUTCTimeString(new Date(this.getTime()*1e3))),r=u._formatLongDateString(new Date(this.getDate()))));this.setDateTimeSummary1(f);this.setDateTimeSummary2(r)},f.prototype._onShowTimeControlsChanged=function(n,t){var r;if(this._updateDateTimeSummary(t),t){var u=o(".dirTimePopup",this.getControl()[0]),i=u.select("a:not([tabindex='-1']), [tabindex='0']"),f=i[0];f.focus();r=o(i[i.length-1]);r.add_event("keydown",this._onTimeControlKeyDown);this._timeControlLastElement=r}else this._timeControlLastElement&&this._timeControlLastElement.remove_event("keydown",this._onTimeControlKeyDown)},f.prototype._onTimeControlKeyDown=function(n){var u=n.keyCode,t,i,r;if(u===9&&!n.shiftKey){for(n.stopPropagation(),n.preventDefault(),t=n.currentTarget,i=t.getAttribute("class");!i||i.indexOf("dropdownOpen")<0;)t=t.parentElement,i=t.getAttribute("class");r=o(".dirBtnGo",t)[0];r.focus()}},f.prototype._getModeData=function(n){for(var i,t=0,r=this.modes.length;t<r;t++)if(i=this.modes[t],i.mode===n)return i;return null},f.prototype._dismissAllAutosuggests=function(){this.setShowSuggestionsPanel(!1);for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].cancelAutosuggest()},f.prototype._updateAllowAddWp=function(){this.setAllowAddWp(this.waypoints.length<this._getModeData(this.getMode()).maxWaypoints)},f.prototype._reorderWaypoint=function(n,t){var r=this.waypoints[n],i;this.waypoints.removeAt(n);this.waypoints.insert(r,t);this._inputData.reorderWaypoint(n,t);r.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler);i={};i.RT=1;b.logInstrumentationEvent(p.WR,i)},f.prototype._resolveWayPoint=function(t,i){var r,u;if(!this.resolveWaypointsInRoutingService){r=null;u=this.waypoints[t];t>0&&(r=this._getMapBoundsForWaypoint(this.waypoints[t-1]));var e={query:u.getInputText(),mapBounds:r,point:r?null:this._getValuesForPreviousLocation(t),disableTaskActivate:!0,filterUrlParam:u.getWayPointModel().filterUrlParam,entryPoint:wt.DirectionsWaypointSearch},o=et.logPerfEvent(rt.RW),f={requestorId:this._taskId,requestorState:{waypointIndex:t,callbackState:this._generateCallbackState(),perfState:o,isBeingPrefetched:i},type:v.localSearchTask,requestState:e};n.isSDK?this.resolveWaypointSDKEvent.invoke(f):a.invokeHandler(l.taskProcessDataHandlerKey,f)}},f.prototype._generateCallbackState=function(){for(var t="",n=0,i=this.waypoints.length;n<i;n++)t+=this.waypoints[n].getInputText();return t},f.prototype._invokeResolveWaypoint=function(n,i,r){for(var u,o,f,s,e;n<=this._inputData.waypoints.length-1&&this._inputData.waypoints[n].point;)n++;if(n<=this._inputData.waypoints.length-1&&!this.resolveWaypointsInRoutingService)this._resolveWayPoint(n);else{if(u=!0,o=this.waypoints[0].getWayPointModel().point,o){for(f=1;f<this.waypoints.length;f++)if(s=this.waypoints[f].getWayPointModel().point,!s||!h.areEqual(s,o)){u=!1;break}}else u=!1;u?this.clearResultsAndShowMessage(t.L_Directions_Error_Equal_Waypoints,1):(e={DirectionsInputData:this._inputData},i&&(e.routeIndex=i),r&&(e.routeId=r),this.directionsResultsRequested.invoke(e))}},f.prototype._getMapBoundsForWaypoint=function(n){var r=n.getEntity(),i=r&&r.getBoundingBox(),t;return i&&i.length===2?(t=ci.fromLocations(i[0],i[1]),[t.getNorth(),t.getWest(),t.getSouth(),t.getEast()]):null},f.prototype._getValuesForPreviousLocation=function(n){if(n>0&&n<this.waypoints.length){var i=this.waypoints[n-1],t=i.getWayPointModel().point;if(t)return[t.latitude,t.longitude]}return null},f.prototype._invalidateResults=function(){this.clearDirectionsResults.invoke()},f.prototype.onSeeAllRoutesClick=function(){},f.prototype.seeAllRoutesReturnClick=function(){},f.prototype._setEnabledOptions=function(){this.showOptimizeTime=n.enableOptimizeTime;this.showOptimizeCost=n.enableOptimizeCost;this.showOptimizeTransfers=n.enableOptimizeTransfers},f.prototype._setTransitModeOptions=function(n){n.defineProperty("avoidFlights",this._onAvoidFlightsChanged);n.defineProperty("avoidExpressTrains",this._onAvoidExpressTrainsChanged);n.defineProperty("avoidBulletTrains",this._onAvoidBulletTrainsChanged);n.defineProperty("useBulletTrains",this._onUseBulletTrainsChanged);var t=this._inputData.options.transitTypes;n.defineProperty("allowBuses",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[1]});n.defineProperty("allowCityRails",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[2]});n.defineProperty("allowSubways",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[7]});n.defineProperty("allowFerries",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[5]});n.defineProperty("allowTrains",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[4]})},f.prototype._updateTransitModeOptionsFromData=function(){var n=this._inputData.options.transitTypes;this.setAllowBuses(n[1]);this.setAllowCityRails(n[2]);this.setAllowSubways(n[7]);this.setAllowFerries(n[5]);this.setAllowTrains(n[4])},f.prototype._updateTransitModeOptionsFromSelection=function(){var n=this._inputData.options.transitTypes;n[1]=this.getAllowBuses();n[2]=this.getAllowCityRails();n[7]=this.getAllowSubways();n[5]=this.getAllowFerries();n[4]=this.getAllowTrains();this._updateExistingDirections()},f._serpTemplateName="InputTemplateSerp",f}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),bu=function(n){function i(i){var r=this,u={};return r=n.call(this,u)||this,u.defineProperty("isSelected",function(n,t){return r._onSelectionChanged(n,t)}),u.defineProperty("trafficConditionClassName"),r._parentViewModelSet=i,r.resources=t,r}return c(i,n),i.prototype.onResultsTitleClick=function(n){n.preventDefault();this.index!==this._parentViewModelSet.getRouteSelected()&&(this._parentViewModelSet.select(this.index,!1),b.logInstrumentationEvent(p.ARC,{I:this.index}));this.routeMode=this._parentViewModelSet.getRouteMode()},i.prototype.setTrafficCondition=function(n){n==="Heavy"?(this.trafficCondition=t.L_Directions_Heavy_Traffic,this._trafficConditionClassName="traffic heavy"):n==="Medium"?(this.trafficCondition=t.L_Directions_Moderate_Traffic,this._trafficConditionClassName="traffic moderate"):(this.trafficCondition=t.L_Directions_Light_Traffic,this._trafficConditionClassName="traffic light");this.setTrafficConditionClassName(this._trafficConditionClassName)},i.prototype._onSelectionChanged=function(n,t){n!==t&&(t?this.setTrafficConditionClassName(this._trafficConditionClassName+" selected"):this.setTrafficConditionClassName(this._trafficConditionClassName))},i}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ku=function(n){function i(i){var u=this,r={};return u=n.call(this,r,i,au)||this,r.defineProperty("showTip",null,null,{defaultValue:!1}),r.defineProperty("showPin",null,null,{defaultValue:!1}),r.defineProperty("showDragTip",null,null,{defaultValue:!1}),r.defineProperty("showPreviewTip",null,null,{defaultValue:!1}),u.resources=t,u}return c(i,n),i}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),du=function(n){function t(t,i,r,u,f,e){var o=this,h={},s;return o=n.call(this,h)||this,h.defineProperty("showInstructions",null,null,{defaultValue:!0}),o.instructionSteps=i,o.legTitle=r,o.index=f,o.timeDistanceText=u,o.showLegTitle=!1,s="dirLeg",o.legClassName=t&&t.displayManeuverIcons===!1?s+" hideManeuver":s,o.legInstructionsClassName="dirInstructions",o.legItemsLocations=[],e>1&&(o.showLegTitle=!0,o.legClassName+=" nLegs",o.legClassName+=f==0?" firstLeg":f==e-1?" lastLeg":"",o.legInstructionsClassName+=" nLegs",o.instructionSteps.forEach(function(n){o.legItemsLocations.push(n.location)})),o}return c(t,n),t}(tt),gu=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("showResults"),t.setShowResults(!1),t}return c(t,n),t}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),er=function(i){function r(n,r){var u=this,f={},o;return u=i.call(this,f)||this,u.resources=t,u.isBeingResolved=!1,u._waypointModel=n,u._panelViewModel=r,u.waypointDeleteEvent=new e,u._suggestionItemSelected=new e,u._suggestionItemSelected.add(function(n){u._onSuggestionItemSelected(n)}),u._suggestionItemClicked=new e,u._suggestionItemClicked.add(function(n){u._onSuggestionItemClicked(n)}),u._onFocus=new e,u._onFocus.add(function(n){u.onFocus(n)}),u._onAutosuggest=new e,u._onAutosuggest.add(function(n){r.onDropdown(n)}),u._onAutosuggestKeydown=new e,u._onAutosuggestKeydown.add(function(n){u.onAutosuggestKeydownFunction(n)}),f.defineProperty("index"),u.setIndex(-1),f.defineProperty("showDelete"),f.defineProperty("upHierarchy"),f.defineProperty("inputText",u._onInputTextChanged),f.defineProperty("printImagePath"),u.setPrintImagePath(""),u._updateInputText(),u.waypointType=1,o=t.L_InexactMatch.split("{0}"),u.resolveText1=o[0],u.resolveText2=o[1],u}return c(r,i),r.prototype.onDelete=function(n){if(n.preventDefault(),this._panelViewModel&&this.getIndex()===this._panelViewModel.waypoints.length-1){var t=this._panelViewModel.getControl().select(".dirWp")[this.getIndex()-1];o(t).select(".icon").swap_class("middle","end")}this.waypointDeleteEvent.invoke(this.getIndex())},r.prototype.setUpHierarchyResult=function(n){this._savedEntity=n;this.setUpHierarchy(n.getDescription())},r.prototype.onResolve=function(n){n.preventDefault();var t=this._savedEntity,i=t.getRoutableLocation();this.update(t.getDescription(),i?i:t.getLocation(),t.getTitle(),t);this._panelViewModel.addToHistory(t);this._clearSavedEntity()},r.prototype.onCloseResolve=function(n){n.preventDefault();this._clearSavedEntity()},r.prototype.getWayPointModel=function(){return this._waypointModel},r.prototype.update=function(n,t,i,r,u){var e,f,o,s;if(this.isBeingResolved=!1,this._waypointModel.address=n,this._waypointModel.point=t,this._waypointModel.name=i,this._waypointModel.isApproximate=!n,r&&!this._waypointModel.eid&&(this._waypointModel.eid=r.id),u&&(this._waypointModel.filterUrlParam=u.entityId),this._entity=r,this._updateInputText(),e=this.getIndex(),t){if(e<this._panelViewModel.waypoints.length-1)for(f=e+1;f<this._panelViewModel.waypoints.length;f++)if(o=this._panelViewModel.waypoints[f],s=o.getWayPointModel(),s.point)break;else o._autoSuggestModel.update(this._waypointModel,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.waypointResolvedEvent&&this._panelViewModel.waypointResolvedEvent.invoke(this)}},r.prototype.trim=function(){this._setInputTextFromCode(this.getInputText().trim())},r.prototype.isEmpty=function(){return!this.getInputText()},r.prototype.cancelAutosuggest=function(){this._autosuggest&&this._autosuggest.stopAutosuggest(!1)},r.prototype.initAutosuggest=function(n,t,i,r){var u=o(".dirWaypoints",n[0]),f=o("input",u[0]),l=o("a.backArrowButton",u[0]),e=o(".searchboxWithAS",n[0]),s,h,c;e&&f&&t&&(s=o(f[this.getIndex()]),h=o(e[0]),this._autoSuggestModel=new it,this._autosuggest&&this._autosuggest.removeEventHandlers(),this._autosuggestViewModel=new ru(this._autoSuggestModel,i),c="as_container_directions",this._autosuggest=this._createAutoSuggest(h,s,c,this._autosuggestViewModel,t,l),this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected),this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked),this._autosuggest.setFocusEventHandler(this._onFocus),this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown),this._autosuggest.setOnAutosuggestHandler(this._onAutosuggest),this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur),this._autosuggest.setSuggestionRequestHandler(r))},r.prototype.onFocus=function(n){var i,r,t,u;if(n){if(r=this.getIndex(),r>0)for(t=r-1;t>=0;t--)if(u=this._panelViewModel.waypoints[t].getWayPointModel(),u.point){i=u;break}i&&this._autoSuggestModel.update(i,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.getMessageText()===null&&this._panelViewModel.isResultsPanelShowing||(this._panelViewModel.showAutosuggestPanel(),this._autosuggest.refreshAutosuggest());this._panelViewModel.onWaypointFocusChanged(this)}else this._panelViewModel.setShowSuggestionsPanel(!1)},r.prototype.refreshAutosuggest=function(){this._autosuggest&&this._autosuggest.refreshAutosuggest()},r.prototype.onAutosuggestKeydownFunction=function(n){var r=n,u=r.keyCode||r.which,f,i;this._panelViewModel.hideMessage();u==13?(f=this._autosuggestViewModel.getSelectedSuggestion(),this._suggestionSelected(f)):u==8&&this.getInputText()===t.L_Directions_MyLocation&&(i=n.currentTarget,i&&(i.selectionStart=i.selectionEnd=0),this.update("",null))},r.prototype.getEntity=function(){return this._entity},r.prototype.setWaypointSuggestionRequestedHandler=function(n){this._autosuggest&&this._autosuggest.setSuggestionRequestHandler(n)},r.prototype.getWaypointTitle=function(){if(this._waypointModel.name)return this._waypointModel.name;if(this._waypointModel.address)return this._waypointModel.address;var n=this._waypointModel.point;return n?u._formatLatLonString(n.latitude,n.longitude):""},r.prototype.dispose=function(){this._autosuggestViewModel.dispose();this._autosuggest&&this._autosuggest.removeEventHandlers();i.prototype.dispose.call(this);u._disposeEvents(this);u._nullifyClass(this)},r.prototype._suggestionSelected=function(n){var i=1,r;n&&n.searchText===t.L_Directions_MyLocation?(this._getCurrentPosition(),i=2):(n&&(n.searchText===t.L_Directions_Home?i=4:n.searchText===t.L_Directions_Work?i=5:n.defaultSuggestion&&(i=3),this.update(n.formatedAddress,n.location,n.title,null,n),this._waypointModel.isApproximate=n.type==="Place"&&n.subType==="PopulatedPlace"),this._updateDirectionsOnSelection());n&&(r={},r.AST=i,b.logInstrumentationEvent(p.AC,r))},r.prototype._updateDirectionsOnSelection=function(){var t,i;if(n.enableUpdateDirectionsOnSelection){for(t=this.getIndex(),i=this._panelViewModel.waypoints.length;t<i;t++)if(this._panelViewModel.waypoints[t].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(t);return}for(t=0,i=this.getIndex();t<i;t++)if(this._panelViewModel.waypoints[t].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(t);return}this._panelViewModel.getDirections()}},r.prototype._onSuggestionItemSelected=function(n){this._waypointModel.eid=n.entityId;n.title!==t.L_Directions_MyLocation&&this.update(n.formatedAddress,n.location,n.title,null,n)},r.prototype.onGeolocationCallback=function(n){n.error?this._panelViewModel.clearResultsAndShowMessage(t.L_Directions_Error_User_Location_Not_Found,1):(this.update(t.L_Directions_MyLocation,n.location,t.L_Directions_MyLocation),this._updateDirectionsOnSelection())},r.prototype._onSuggestionItemClicked=function(n){this._waypointModel.eid=n.entityId;this._suggestionSelected(n)},r.prototype._getCurrentPosition=function(){var n=this,t={callback:function(t){return n.onGeolocationCallback(t)},performReverseGeocoding:!1};this._panelViewModel.geolocationProvider.GetCurrentPosition(t)},r.prototype._updateInputText=function(){var n="";n=this._waypointModel.name&&this._waypointModel.address?this._waypointModel.name!==this._waypointModel.address?t.L_Directions_Waypoint_Text_From_Name_Address.replace("{0}",this._waypointModel.name).replace("{1}",this._waypointModel.address):this._waypointModel.name:this.getWaypointTitle();this._setInputTextFromCode(n)},r.prototype._setInputTextFromCode=function(n){this._textModifiedFromCode=!0;this.setInputText(n);this._textModifiedFromCode=!1},r.prototype._onInputTextChanged=function(n,t){this._textModifiedFromCode||(this._panelViewModel&&this._panelViewModel.showAutosuggestPanel(),this._panelViewModel&&this._panelViewModel.clearDirectionsResults.invoke(),this._savedEntity&&this._clearSavedEntity(),this._waypointModel.clear(),this.isBeingResolved=!1,t===""&&this._panelViewModel.waypointResolvedEvent.invoke(this))},r.prototype._clearSavedEntity=function(){this.setUpHierarchy(null);this._savedEntity=null},r.prototype._createAutoSuggest=function(n,t,i,r,u,f){return d.isMobile?new iu(n,t,i,r,u,f):new tu(n,t,i,r,u)},r}(vi),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),or=function(r){function f(u,o,s,h,c,l,a,v,y){var p=this,w={},b=y&&y.resultsTemplate===f._serpTemplateName?lu:tr;return p=r.call(this,w,o,b)||this,w.defineProperty("disclaimerText"),w.defineProperty("showSeeAllRoutes",function(){y&&y.displayDisclaimer!==undefined||p.setShowDisclaimer(!p.getShowSeeAllRoutes())}),w.defineProperty("showDisclaimer"),w.defineProperty("showTransitLogo",null,null,{defaultValue:!0}),p._map=u,p._perfLog=l,p._totalDirectionsRequestPerfState=a,p._controlTemplateFactory=o,p.directionsResultsTitleSet=[],p.directionsResultsListSet=[],p.routelines=[],p.stopPoints=[],p.allStopPoints=[],p.routeStopPointPathIndices=[],p._requestOptions=s,p._panelViewModel=h,p._taskId=v,p.disposables.push(p._routeMapEntitiesCollection=c),p.resultsOnlyDisplayed=new e,p._directionsFormattedTextProvider=f._directionsFormattedTextProviders[i[s.mode]](),p._directionsFormattedTextProvider.roadShieldsReadyEvent&&p.disposables.push(p._directionsFormattedTextProvider.roadShieldsReadyEvent.add(function(){p._onRoadShieldReadyEvent()})),p._directionsFormattedTextProvider.setRenderOptions(y),p._routeSelected=-1,p.reportProblemClicked=new e,p.resources=t,p.routeSelectedEvent=new e,p.showPrint=ft.isEnabled,p.discarded=!1,p.seeAllRoutesReturnClick=new e,p.isSDK=n.isSDK,p.setShowDisclaimer(!p.getShowSeeAllRoutes()),y&&p._setRenderOptions(y),(s.mode===i.driving||s.mode===i.truck)&&p._directionsFormattedTextProvider.setMap(p._map),p._startClass=" startWaypointLetter",p._stopClass=" stopWaypointLetter",p._endClass=" endWaypointLetter",p}return c(f,r),f.prototype.hideDirectionsResultsListSet=function(){for(var n=0;n<this.directionsResultsListSet.length;n++)this.directionsResultsListSet[n].setShowResults(!1),this.directionsResultsTitleSet[n].setIsSelected(!1)},f.prototype.boolToSelectedTitleClassName=function(n){return n?"drTitle selected":"drTitle"},f.prototype.boolToSelectedDurationClassName=function(n){return this._requestOptions.mode===i.transit?"hide":n?"drDuration selected":"drDuration"},f.prototype.indexToOddEvenClass=function(n){return n===null||n===undefined||n===-1?"":"waypointPrintMaps "+(n%2==0?"even":"odd")},f.prototype.indexToOddEvenBackgroundClass=function(n){return n===null||n===undefined||n===-1?"":n%2==0?"bg":"noBg"},f.prototype.indexToWaypointTypeLabel=function(n){return n===null||n===undefined||n===-1?"":this.indexToIconTextStart(n)},f.prototype.getRouteMode=function(){return this._requestOptions.mode},f.prototype.getDirections=function(n,t,i,r,u,f,e){var s=this,h=et.logPerfEvent(rt.RR,this._requestOptions.mode),o=this._map&&this._map.getMapOptions(),c={requestOptions:this._requestOptions,needBestMapView:t,perfState:h,isDragRequest:i,viaPoint:r,legIndex:u,subLegIndex:f,viaPointRemoved:e,mapCredentials:o&&o.credentials};this._rawResponse=null;ir.downloadRoutes(c,function(t,i,r){s._onDownloadRouteCallback(t,i,r,n)})},f.prototype.taskStateChanged=function(n){this._routeMapEntitiesCollection.setTaskPrimitiveState(n)},f.prototype.onInstructionsMouseLeave=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(null)},f.prototype.onStepTextClick=function(n){var r,u,h;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var f=n.currentTarget,o=f.getAttribute("data-eid"),s=f.getAttribute("data-sf"),c=f.getAttribute("data-q"),t={};s?t.filterUrlParam=s:o&&(t.id=o);for(var i=0,e=ct.localDetailCardsData.length,y=ct.polygonEntityDetailCardsData.length;i<e+y;i++)if(r=i<e?ct.localDetailCardsData[i]:ct.polygonEntityDetailCardsData[i-e],u=r.data,u&&u.length===1&&(h=u[0],r.processorId&&h.id===t.id)){a.invokeHandler(l.taskDataHandlerKey,{action:"focus",id:r.processorId});return}t.query=c;t.entryPoint=wt.DirectionsRouteList;a.invokeHandler(l.taskProcessDataHandlerKey,{requestState:t,type:v.localSearchTask})},f.prototype.onRemoveViaClick=function(n){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var t=f.getAttributeFromHtmlElement(n.currentTarget,"data-wpi"),i=f.getAttributeFromHtmlElement(n.currentTarget,"data-vwpi");this._panelViewModel.removeViaPoint(t,i)},f.prototype.getRouteSelected=function(){return this._routeSelected},f.prototype.onPrintDirectionsClick=function(n){n&&n.preventDefault&&n.preventDefault();ft.isEnabled&&a.invokeHandler(l.printDataHandlerKey,{source:2,taskType:v.directionsTask,taskId:this._taskId,data:{RI:this.getRouteSelected(),LOC:"P"}})},f.prototype.dispose=function(){this._map=null;u._clearDisposables(this.directionsResultsListSet);u._clearDisposables(this.directionsResultsTitleSet);u._clearDisposables(this.waypoints);this._routeMapEntitiesCollection.dispose();this.clearRoutes();r.prototype.dispose.call(this)},f.prototype._buildAttributionsForPrint=function(){var t="",n;if(this._requestOptions.mode==i.transit&&this.showAttribution)for(n=0;this.transitAttributions&&n<this.transitAttributions.length;n++)this.transitAttributions[n].agencyName&&(t=t?t+this.resources.L_Directions_TimeDistance_Separator+this.transitAttributions[n].agencyName:this.transitAttributions[n].agencyName);return t},f.prototype.getDirectionsHtmlContentForPrint=function(){var n=this,r=this.getRouteSelected(),t,u,f;return this.printTitleViewModel=this.directionsResultsTitleSet[r],this.printInstructionsViewModel=this.prepareInstructionListViewModelForPrint(this.directionsResultsListSet[r]),this.printMode="directionsPanel "+(this._requestOptions.mode===i.transit?"transit":this._requestOptions.mode===i.walking?"walking":"driving"),this.printTitleViewModel.routeMode=this.getRouteMode(),this.attributionText=this._buildAttributionsForPrint(),this.notesMaxCharSize=ft.notesMaxChars,t={boolToSelectedDurationClassName:function(t){return n.boolToSelectedDurationClassName(t)},boolToSelectedTitleClassName:function(t){return n.boolToSelectedTitleClassName(t)},boolToDisplay:function(t){return n.boolToDisplay(t)},nullToDisplayNone:function(t){return n.nullToDisplayNone(t)},fractionToPercent:function(t){return n.fractionToPercent(t)},boolToNotDisplay:function(t){return n.boolToNotDisplay(t)},indexToStartClass:function(t){return n.indexToStartClass(t)},indexToEndClass:function(t){return n.indexToEndClass(t)},showGroupToClass:function(t){return n.showGroupToClass(t)},getWarningIconClass:function(t){return n.getWarningIconClass(t)},arrayToDisplay:function(t){return n.arrayToDisplay(t)},lineColorToIconClass:function(t){return n.lineColorToIconClass(t)},onPrintDirectionsClick:function(t){return n.onPrintDirectionsClick(t)},indexToOddEvenClass:function(t){return n.indexToOddEvenClass(t)},indexToWaypointTypeLabel:function(t){return n.indexToWaypointTypeLabel(t)},indexToOddEvenBackgroundClass:function(t){return n.indexToOddEvenBackgroundClass(t)},modeToDisplay:function(n){return n===i.transit?"none":"inline"},indexToIconTextStart:function(t){return n.indexToIconTextStart(t)},indexToIconTextEnd:function(t){return n.indexToIconTextEnd(t)},waypointTypeToClass:function(t){return"dirLegIconText"+(t==1?n._startClass:t==2?n._endClass:n._stopClass)}},this.titlePrintTemplate=new gt(su,t),this.instructionsPrintTemplate=new gt(hu,t),u=this._controlTemplateFactory({templateText:cu,staticResources:t}),f=u.applyDataTemplate(this),f[0].outerHTML},f.prototype.getWarningIconClass=function(n){var t="dirWarning";return n?t+" warning"+n:t},f.prototype.select=function(n,t,i){var r,u,f;if(n!==this._routeSelected&&n>=0&&n<this.directionsResultsTitleSet.length){for(r=0;r<this.directionsResultsTitleSet.length;r++)u=n===r,this.directionsResultsTitleSet[r].setIsSelected(u),this.directionsResultsListSet[r].setShowResults(u);this._routeSelected=n;this.routeSelectedEvent&&this.routeSelectedEvent.invoke();this._routeMapEntitiesCollection.select(n,t,i,this._requestOptions.mode);f=o(".drTitle.selected",this.getControl()[0]).select("a");f[0]&&f[0].focus()}},f.prototype.getRoutesLength=function(){return this.directionsResultsTitleSet.length},f.prototype.clearRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.clearRoutesLabels()},f.prototype.showRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.showRouteLabels()},f.prototype.clearRoutes=function(){this.directionsResultsTitleSet=[];this.directionsResultsListSet=[];this._routeMapEntitiesCollection.clearRoutesLabels();this.routeStopPointPathIndices=[];this.routelines=[];this.stopPoints=[];this._rawResponse=null},f.prototype.instructionRowClass=function(n){var t=" circleIcon";switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+t;case"UTurn":case"TurnBack":return"uTurnLeft"+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+t;case"Bus":case"Walk":case"Ferry":case"Tube":case"Train":return n+t;default:return n}},f.prototype.prepareInstructionListViewModelForPrint=function(n){for(var i,r,t=0;t<n.routeLegs.length;t++)i=n.routeLegs[t],r=i.instructionSteps,i.startWaypointAddress=r[0].stepText,i.endWaypointAddress=r[r.length-1].stepText,i.startIconType=t==0?1:3,i.endIconType=t==n.routeLegs.length-1?2:3,i.resources=this.resources;for(t=0;t<this.waypoints.length;t++)this.waypoints[t].waypointType=t==0?1:t==this.waypoints.length-1?2:3;return n.resources=this.resources,n},f.prototype._onDownloadRouteCallback=function(n,i,r,u){var s,c;if(!this.discarded){var e=n.requestOptions,f=n.isDragRequest,h=n.needBestMapView,o;(f&&(o="DR"),n&&n.perfState&&n.perfState.end(o),this._requestOptions===e)&&(this.clearRoutes(),s=null,c=i?i.traceId:null,r===1&&i&&i.resourceSets&&i.resourceSets.length>0?(this._rawResponse=i,this._setDirectionsResults(e,i,h,f)):s=r===4&&i&&i.errorDetails&&i.errorDetails.length>0?i.errorDetails[0]:t.L_Directions_Error_No_Results,u(c,r,s,e,h,f),!f&&this._totalDirectionsRequestPerfState&&(this._totalDirectionsRequestPerfState.end(o),this._totalDirectionsRequestPerfState=undefined))}},f.getAttributeFromHtmlElement=function(n,t){return o.Internals.parseJSON(n.getAttribute(t))},f.prototype.setReportProblemLink=function(n){this._feedBackState=n;this._feedBackState.entryPoint=3},f.prototype.reportProblem=function(n){n.preventDefault();this.reportProblemClicked.invoke();a.invokeHandler(l.taskDataHandlerKey,{type:v.feedbackTask,activateOptions:{parentId:this._taskId},state:this._feedBackState})},f.prototype._setDirectionsResults=function(n,r,u,f){var st,k,g,ht,p,a,s,c,o,v,bt,d,y,w,l,lt,ft,kt,h,dt,at,vt,b,ot;if(n===this._requestOptions){if(f||(st=et.logPerfEvent(rt.PD,n.mode)),k=r&&r.resourceSets[0],this.transitAttributions=[],k&&k.resources&&k.resources.length){for(g=0,ht=k.resources,p=0;p<ht.length;p++){var e=ht[p],yt=[],nt=[],ct=[],tt=new uf(p,this._map,this.controlTemplateFactory),pt=[],it=e.travelDuration,wt=[],ut=[];if((this._requestOptions.mode===i.driving||this._requestOptions.mode===i.truck)&&(it=e.travelDurationTraffic),g=Math.max(it,g),e.routeLegs&&e.routeLegs.length){for(a=[],s=0;s<e.routeLegs.length;s++)if(c=[],o=e.routeLegs[s],o.routeSubLegs&&(a.length>0&&(a.pop(),ut.pop()),v=this._getRouteLegPoint(o),bt=this._getRouteLegIndices(v),a=a.concat(v),this.allStopPoints=this.allStopPoints.concat(v),ut=ut.concat(bt)),d=0,y=[],o.itineraryItems&&o.itineraryItems.length){for(y=this._createItineraryList(o),w=0;w<y.length;w++)y[w].instructionIndex=y[w].parentInstructionIndex=w+1;for(l=this._directionsFormattedTextProvider.getStartInstruction(this._panelViewModel.waypoints[s],o,v,s===0,this._routeMapEntitiesCollection),c.push(l),this.disposables.push(l),ct.push(l),lt=0,ft=0,kt=y.length;ft<kt;ft++)h=y[ft],d<o.routeSubLegs.length&&(dt=o.routeSubLegs[d],h&&h.details&&h.details.length>0&&h.details[0].endPathIndices&&h.details[0].endPathIndices.length>0&&dt.endWaypoint.routePathIndex<=h.details[0].endPathIndices[0]&&d++),at=this._createInstructions(e,h,tt,v,o,s,d),Array.prototype.push.apply(c,at),at.forEach(function(n){wt.push(n.stepText)}),lt=this._buildTransitTimeline(h,c,lt,it,pt),this._buildTransitAttributions(h);vt=s===e.routeLegs.length-1;l=this._directionsFormattedTextProvider.getEndInstruction(this._panelViewModel.waypoints[s+1],o,v,this._routeMapEntitiesCollection,vt);c.push(l);this.disposables.push(l);vt&&ct.push(l);Array.prototype.push.apply(nt,c);var gt=c[0].stepText,ni=this._panelViewModel.waypoints[s+1].getWaypointTitle(),ti=t.L_Directions_Leg_Title.replace("{from}",gt).replace("{to}",ni),ii=this._directionsFormattedTextProvider.getDurationString(o.travelDuration),ri=this._directionsFormattedTextProvider.getFormattedDistanceText(o.travelDistance,e),ui=t.L_Directions_Leg_TimeDist_Text.replace("{time}",ii).replace("{distance}",ri),fi=new du(this._renderOptions,c,ti,ui,s,e.routeLegs.length);yt.push(fi)}nt.length>0&&(this._fillMissingPushpins(nt),b=new gu,b.routeLegs=yt,b.numberOfInstructions=nt.length,b.routeId=e.id,b.stepStrings=wt,this.directionsResultsListSet.push(b),ot=this._buildTitleViewModel(e,pt,it),ot.index=p,this.directionsResultsTitleSet.push(ot),f||this._buildRouteLabel(e,ot,tt));this._createRoutePolyline(e,tt,a,ct,f)}this.routeStopPointPathIndices.push(ut.slice(0));this._routeMapEntitiesCollection.addRoute(tt)}f&&this._routeMapEntitiesCollection.show(u,!0,n.mode,!f)}f||(this.directionsResultsTitleSet.length>0&&(this._panelViewModel.updateModeBtnState(),this._updateWaypoints(a),this._setTransitLineWidth(g),this._buildDisclaimer(),this._updateAdvertising()),st&&st.end())}},f.prototype.onLegTitleClick=function(n){var r,u;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var e=this.directionsResultsListSet[this._routeSelected],i=f.getAttributeFromHtmlElement(n.currentTarget,"data-index"),t=e.routeLegs[i],s=t.instructionSteps,o=!t.getShowInstructions();t.setShowInstructions(o);r=p.COL;o&&(this._map.setView(this._map.getMode().getMapViewForLocationsInView(t.legItemsLocations)),r=p.EXP);u={};u.CI=i===0?3:i===e.routeLegs.length-1?5:4;b.logInstrumentationEvent(r,u)},f.prototype.indexToIconTextStart=function(n){return String.fromCharCode(n+65)},f.prototype.indexToIconTextEnd=function(n){return String.fromCharCode(n+66)},f.prototype.indexToStartClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStart verticalTop":n<r-1?"dirLegStop verticalTop":"dirLegStop verticalTop"},f.prototype.indexToEndClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStop verticalBottom":n<r-1?"dirLegStop verticalBottom":"dirLegEnd verticalBottom"},f.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},f.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},f.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n&&n.substr(1),16),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},f.prototype._createInstructions=function(n,t,i,r,u,f,e){var o=this,s=this._directionsFormattedTextProvider.getInstruction(t,n,this._routeMapEntitiesCollection);return s.forEach(function(n){if(o.disposables.push(n),n.needPushpin){var t=n.itineraryItem&&n.itineraryItem.iconType||n.stepIconClass;i.addItineraryPin(t,n,f,e,o._requestOptions.mode,!n.getShow());r[e].itineraryItems.push(n.itineraryItem)}}),s},f.prototype._getRouteLegPoint=function(n){for(var r,t=[],i=0;i<n.routeSubLegs.length;i++)r=n.routeSubLegs[i],t.length==0&&t.push({routeLegStopPoint:r.startWaypoint,itineraryItems:[]}),t.push({routeLegStopPoint:r.endWaypoint,itineraryItems:[]});return t},f.prototype._getRouteLegIndices=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t].routeLegStopPoint,i.isVia===!1&&r.push(i.routePathIndex);return r},f.prototype._buildTitleViewModel=function(t,r,f){var e=new bu(this),o,s,h;return this._requestOptions.mode!==i.transit&&(o=t.travelDuration,t.travelDurationTraffic&&(o=t.travelDurationTraffic),s=Math.round(o/60),h=Math.floor(s/60),e.minutes=u._format2Digit(h?"mm":"m","m",s%60),e.hours=h),this._requestOptions.mode===i.driving&&n.displayTraffic&&e.setTrafficCondition(t.trafficCongestion),e.mainTitle=this._directionsFormattedTextProvider.getTitle(t),e.subtitle=this._directionsFormattedTextProvider.getSubtitle(t),e.descriptionVia=this._directionsFormattedTextProvider.getDescriptionVia(t),e.descriptionTimeNoTraffic=this._directionsFormattedTextProvider.getDescriptionTimeNoTraffic(t),n.displayCost&&(e.cost=this._directionsFormattedTextProvider.getCost(t)),r.length>0&&(e.timelineSegments=r,e.timelineWidth=f),e},f.prototype._setTransitLineWidth=function(n){if(this._requestOptions.mode==i.transit&&n>0)for(var t=0;t<this.directionsResultsTitleSet.length;t++)this.directionsResultsTitleSet[t].timelineWidth/=n},f.prototype._updateWaypoints=function(n){for(var t,r,f,u=0,i=0;i<n.length;i++)(t=n[i].routeLegStopPoint,t.isVia)||(r=this._panelViewModel.waypoints[u],r.getInputText()===""&&(f=new h(t.coordinates[0],t.coordinates[1]),r.update(t.description,f)),this.stopPoints.push(t),u++)},f.prototype._fillMissingPushpins=function(n){var r,u,f,t;if(this._requestOptions.mode===i.transit)for(r=null,u=0,f=n.length-1;u<f;u++)t=n[u],t.pushpin||t.stepIconClass!=="TransitArrive"?r&&t.pushpin&&(r.pushpin=t.pushpin,r=null):(r=t,t.pushpin=n[u+1].pushpin)},f.prototype._buildRouteLabel=function(t,r,u){if(n.enableRouteLabel){var f,e;this._requestOptions.mode===i.transit?f=r.subtitle:(f=this._directionsFormattedTextProvider.getDescriptionTime(t),e=r.subtitle);u.setLabel(f,e)}},f.prototype._buildDisclaimer=function(){var r,u=d.dynamicProperties.market.toLowerCase()==="ja-jp",f,n;if(this._requestOptions.mode==i.transit){if(this.transitAttributions.sort(function(n,t){return n.agencyName<t.agencyName?-1:n.agencyName>t.agencyName?1:n.uri<t.uri?-1:n.uri>t.uri?1:0}),this.transitAttributions.length>0){for(f=this.transitAttributions[0],n=1;n<this.transitAttributions.length;n++)f.agencyName===this.transitAttributions[n].agencyName?(this.transitAttributions.splice(n,1),n--):f=this.transitAttributions[n];this.showAttribution=!0}r=u?t.L_TransitDisclaimer_Text_Japan:t.L_TransitDisclaimer_Text;this.setShowTransitLogo(u)}else r=u?t.L_DirectionsDisclaimer_Text_Japan:t.L_DirectionsDisclaimer_Text.replace("{0}",t.L_TermsOfUse_Text).replace(/{year}/,(new Date).getFullYear()),this.setShowTransitLogo(!1);this.setDisclaimerText(r)},f.prototype._buildTransitAttributions=function(t){var i=t.transitLine;i&&i.uri&&i.uri.indexOf(n.specialAttributionLink)>-1&&i.uri.indexOf("&")>-1&&(i.uri=i.uri.slice(0,i.uri.indexOf("&")));i&&this.transitAttributions.push(i)},f.prototype._buildTransitTimeline=function(n,t,r,u,f){var e,o;return this._requestOptions.mode===i.transit&&u>0&&(e=t[t.length-1],r&&e.transitDepartTime&&(o=(e.transitDepartTime-r)/1e3,o>0&&f.push({width:o/u,className:"ttWait",lineColor:""})),f.push({width:n.travelDuration/u,className:"tt"+n.iconType,lineColor:e.transitLineColor}),e.transitArriveTime?r=e.transitArriveTime:r&&(r+=n.travelDuration*1e3)),r},f.prototype._createRoutePolyline=function(n,t,i,r,u){n.routePath&&n.routePath.line&&(this.routelines.push(n.routePath.line),t.createPolyLineAndStopPins(n.routePath.line.coordinates,this._routeMapEntitiesCollection.getMapType(),this._requestOptions.mode,i,r,u,this._renderOptions))},f.prototype._createItineraryList=function(n){var u=[],i,f,t,r,e;if(n.itineraryGroups&&n.itineraryGroups.length){for(i=0,f=n.itineraryGroups.length;i<f;i++)if(t=n.itineraryGroups[i],t.itineraryIndices&&t.itineraryIndices.length>1)for(t.iconType=n.itineraryItems[t.itineraryIndices[0]].iconType,t.childItineraryItems=[],r=0;r<t.itineraryIndices.length;r++)e=t.itineraryIndices[r],t.childItineraryItems.push(n.itineraryItems[e]);else n.itineraryGroups[i]=n.itineraryItems[t.itineraryIndices[0]];u=n.itineraryGroups}else u=n.itineraryItems;return u},f._initProviders=function(){var n={};return n[i[i.driving]]=function(){return new fi},n[i[i.truck]]=function(){return new ei},n[i[i.transit]]=function(){return new ur},n[i[i.walking]]=function(){return new ei},n},f.prototype.seeAllRoutesClick=function(){},f.prototype.onSeeAllRoutesReturnClick=function(){},f.prototype.boolToSeeAllRoutesClassName=function(){return"directionsPanel"},f.prototype.getRawResponse=function(){return this._rawResponse},f.prototype._setRenderOptions=function(n){this._renderOptions=n;n&&n.displayDisclaimer!==undefined&&this.setShowDisclaimer(n.displayDisclaimer)},f.prototype._updateAdvertising=function(){var s=n.maxAdCount,r,f,i,t,e,o,u;if(s)try{r=nu;f=this._panelViewModel.waypoints.length;f>1&&r.isEnabled()&&(i=this._panelViewModel.waypoints[f-1].getWayPointModel(),t=i.filterUrlParam||i.eid,t&&t.indexOf("ypid:")>=0&&i.name&&(e=t.indexOf("~"),e>0&&(t=t.substring(0,e)),o=this.getControl(),u=o&&o.select("div.reportProblemLink"),u&&u.length&&(this._ads||(this._ads=new r(this._controlTemplateFactory,lr.DR),u.getParent().insertBefore(this._ads.getControl(),u)),this._ads.requestAds(i.name,h.cloneFrom(i.point),s,t))))}catch(c){r&&r.logError(c)}},f.prototype.waitingOnRoadShieldEvent=function(){return this._directionsFormattedTextProvider.unloadedRoadShields>0},f.prototype._onRoadShieldReadyEvent=function(){o(".svg",this.getControl()[0]).inlineDataSvgs().remove_class("svg")},f._directionsFormattedTextProviders=f._initProviders(),f._serpTemplateName="ResultsTemplateSerp",f}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),yt=function(i){function r(u,f,e,o,s,h){var c=this,a={};if(c=i.call(this,a)||this,c.itineraryItem=e,c.itineraryItem&&(c.stepIndex=c.itineraryItem.instructionIndex,c.parentStepIndex=c.itineraryItem.parentInstructionIndex),c.itineraryItem&&c.itineraryItem.maneuverPoint?c.location=c._getLocation(c.itineraryItem.maneuverPoint):f&&(c.location=c._getLocation(f)),s){var v=s.getWayPointModel(),l=s.getWaypointTitle(),y=v.address;y&&l!==y&&(c.stepAddress=y);c.stepText=l;c.formattedText=l;c.isClickable=!(l===t.L_Directions_MyLocation||l===t.L_Directions_Home||l===t.L_Directions_Work)&&!n.isSDK;c.entityId=v.eid;c.searchFilter=v.filterUrlParam;c._setIconTextFromIndex(s.getIndex());c._setWaypointTitleFromIndex(s.getIndex())}return c.needPushpin=!0,c._routeMapEntitiesCollection=u,c._cssClassNormal=r._defaultCssClass,c.resources=t,c.showHints=c.showIcon=c.showWarnings=!0,c.setRenderOptions(h),a.defineProperty("cssClass",null,null,{defaultValue:r._defaultCssClass}),a.defineProperty("show",null,null,{defaultValue:!0}),a.defineProperty("showGroup",null,null,{defaultValue:!1}),a.defineProperty("roadShieldUrl"),o&&c.setStepIconClass(o),c.location&&pi.isEnabled&&o==="dirRouteEnd"&&c.entityId&&c.entityId.indexOf("ypid")!==-1&&(c.showNearbyParking=c._isAddressInsideSupportedCityForNearbyParking(c.location)),c}return c(r,i),r.prototype._setIconTextFromIndex=function(n){this.iconText=String.fromCharCode(n+65)},r.prototype.setStepIconClass=function(n){this.stepIconClass=n;this._cssClassNormal=this._stepIconClassToCssClass(n);this._updateCssClass()},r.prototype._setWaypointTitleFromIndex=function(n){this.waypointTitle=n?t.L_Directions_Title_Destination:t.L_Directions_Title_Start},r.prototype.setHover=function(n){this._isHover!==n&&(this._isHover=n,this._updateCssClass())},r.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},r.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},r.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},r.prototype.onMouseEnter=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(this.pushpin)},r.prototype.onInstructionClick=function(n){var t,r,u,i;this._routeMapEntitiesCollection.instructionClicked.invoke(o(n.currentTarget));this.groupItems&&this.groupItems.length?(t=!this.getShowGroup(),this.groupItems.forEach(function(n){n.setShow(t);n.pushpin.setVisibility(t)}),r=p.COL,t&&(u=this._routeMapEntitiesCollection.getMap(),u.setView(u.getMode().getMapViewForLocationsInView(this.groupItemsLocations)),r=p.EXP),this.setShowGroup(t),i={},i.CI=2,this.itineraryItem&&this.itineraryItem.transitStops&&this.itineraryItem.transitStops.length?i.CI=6:this.groupItems[0].itineraryItem&&this.groupItems[0].itineraryItem.details[0].startPathIndices[0]===0&&(i.CI=1),b.logInstrumentationEvent(r,i)):this.location&&(this.location.latitude||this.location.longitude)&&(this._routeMapEntitiesCollection.centerMap(this.location),this.transitStopID&&this.showTransitStop());this._routeMapEntitiesCollection.instructionClickedDone.invoke()},r.prototype.onInstructionKeyDown=function(n){var t=n,i=t.keyCode||t.which;if(i==13){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();this.onInstructionClick(n)}},r.prototype._updateCssClass=function(){var n=this._cssClassNormal;this._isHover&&(n+=" hover");this.setCssClass(n)},r.prototype._getLocation=function(n){var t=n.coordinates,i=new h(t[0],t[1]);return gi.toLocation(i,17,!0)},r.prototype._stepIconClassToCssClass=function(n){var i=" circleIcon",t=" "+r._defaultCssClass;switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+i+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+i+t;case"UTurn":case"TurnBack":return"uTurnLeft"+i+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+i+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+i+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+i+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+i+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+i+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+i+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+i+t;case"Bus":case"Walk":case"Ferry":case"Tube":case"Train":return n+i+t;default:return n?n+t:t}},r.prototype._isAddressInsideSupportedCityForNearbyParking=function(n){for(var t,u,r=JSON.parse(pi.supportedCities),i=0;i<r.length;i++)if(t=r[i],u=ci.fromEdges(t.top,t.left,t.bottom,t.right),u.contains(n))return!0;return!1},r.prototype.onNearbyParkingClick=function(n){if(n&&n.stopImmediatePropagation(),n&&n.preventDefault&&n.preventDefault(),this.location){var t={location:this.location,title:this.stepText,entryPoint:1};a.invokeHandler(l.taskDataHandlerKey,{type:v.nearbyParkingTask,state:t})}},r.prototype.showTransitStop=function(){if(this.transitStopID&&this.transitStopID>0){var n={id:this.transitStopID,title:this.transitStopName,location:this.location,activationEntryPoint:6};a.invokeHandler(l.taskDataHandlerKey,{action:"activate",type:v.transitStopTask,state:n})}},r.prototype.processTransitStopInfo=function(n,t){var i=this;fu.downloadTransitStop({stopId:n.toString(),dateTime:new Date},function(n,r){var f={},e,o,u,s;if(r&&r.resourceSets&&r.resourceSets.length&&r.resourceSets[0].resources&&r.resourceSets[0].resources.length){for(f=r.resourceSets[0].resources[0],e={},o=[],u=0;u<f.realTimeDataAtStop.length;u++)s=f.realTimeDataAtStop[u].line,o.push(s.abbreviatedName);e.stops=[{id:i.transitStopID,name:i.transitStopName,routes:[{count:u,names:o}]}];i.transitStaticResources=i._buildTransitStaticResources(e);t()}})},r.prototype._buildTransitStaticResources=function(n){var o="",s="",u=[],h=0,f=!1,i,t,r,e;if(n&&n.stops&&n.stops.length&&(s=n.stops[0].name,n.stops[0].routes&&n.stops[0].routes.length)){for(i=n.stops[0].routes,t=0;t<i.length;t++)for(r=0;r<i[t].names.length;r++)e=i[t].names[r],e.length>5&&h++,u.push(e);f=h>=u.length/2;o=u.join(f?"\n":", ")}return{transitLandmark:n,routeList:o,showLongList:f,stopName:s,addNewLines:this._addNewLines}},r.prototype._addNewLines=function(n){return n?"enableNewLines":""},r.prototype.setRenderOptions=function(n){n&&((n.displayPostItineraryItemHints===!1||n.displayPreItineraryItemHints===!1)&&(this.showHints=!1),n.displayManeuverIcons!==undefined&&(this.showIcon=n.displayManeuverIcons),n.displayStepWarnings!==undefined&&(this.showWarnings=n.displayStepWarnings))},r._defaultCssClass="bm_dirInstructionRowGroup",r}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),nf=function(n){function i(i){var r=this,u={};return r=n.call(this,u,i,yu)||this,r._zIndexLabelSelected=999,r._zIndexLabelNotSelected=998,u.defineProperty("isSelected",function(n,t){return r._onSelectionChanged(n,t)},null,{defaultValue:!1}),u.defineProperty("labelRootClass",null,null,{defaultValue:"labelOverlay"}),u.defineProperty("distanceText",null,null,{defaultValue:""}),u.defineProperty("timeText",null,null,{defaultValue:""}),u.defineProperty("zIndex",null,null,{defaultValue:998}),r.resources=t,r}return c(i,n),i.prototype._onSelectionChanged=function(n,t){if(n!==t){var i=t?this._zIndexLabelSelected:this._zIndexLabelNotSelected;this.setZIndex(i)}},i}(tt),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),lt=function(t){function r(n,i,r,u,f,e,o,s,h){return t.call(this,n,i,r,u,f,e,o,s,h)||this}return c(r,t),r.prototype._isAddingViaAllowed=function(){return this._routeMode!==i.transit&&this._numberOfViaPoints<n.maxViaPoints},r}(ki),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),at=function(n){function t(t,i,r,u,f,e,o,h,c,l,a,v){var y=n.call(this,t,i,u,f,o,h,c,l,a,v)||this;return y.routeMapEntities=e,y.instructionViewModel=r,y.bucket=hi.bucketIdForDirectionsPins,oi.majorPinTypes[s[i]]||(y.entity.collisionBehavior=0),y}return c(t,n),t.prototype.setLabel=function(n,t){n&&(!this.routeMapEntities||this.isRouteSelected)&&(this.entity.name=n,this.entity.iconText=t)},t.prototype.dispose=function(){u._nullifyClass(this)},t}(ii),oi=function(){function n(n){var t=this;this._map=n;this._disposables=[];this._disposables.push(n.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._reset=!0)}))}return n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._reset?this._map.getTemplateSelector().then(function(t){return n._directionsImagesPromise||(n._directionsImagesPromise=t.prefetchImagesByBucketIds(n._getDirectionsBucketIds(),!0)),n._directionsImagesPromise.then(function(){return n._baseMapTemplateSelector=t,n._reset=!1,n._baseMapTemplateSelector.selectorReady()})}):this._baseMapTemplateSelector.selectorReady()},n.prototype.getTemplates=function(n){var t,i;return n instanceof gr?(i=n,t=[new yr(i.image,1,i.anchor)]):n instanceof ii?t=this._getRoutePinTemplates(n):n.getTemplates?t=n.getTemplates():n.getTemplate&&(t=[n.getTemplate()]),t},n.prototype.dispose=function(){this._map=null;this._baseMapTemplateSelector=null;this._directionsImagesPromise=null;u._clearDisposables(this._disposables)},n.prototype._getDirectionsBucketIds=function(){var t=[],n=hi.directionIconTypeBuckets;for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},n.prototype._getRoutePinTemplates=function(t){var i=t.pushpinIconType,f=t.isRouteSelected,r=t.isPinHighlighted,u;return t.isRouteSelected?t.taskState!==1&&!n.majorPinTypes[s[i]]?null:(u=t.taskState===3?r?6:5:r?4:2,n.majorPinTypes[s[i]]||(i=s.turn),this._baseMapTemplateSelector&&this._baseMapTemplateSelector.getRoutePoiVectorImageTemplate(s[i],u,t.currentZoomLevel)):null},n.majorPinTypes={start:!0,end:!0,middle:!0,via:!0},n}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),tf=function(n){function t(t){var i=this,r=new h(0,0),u=new wi(0,0);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new ku(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return c(t,n),t.prototype.setShowTip=function(n,t){var i=n||t;i&&(this._overlayViewModel.setShowDragTip(n),this._overlayViewModel.setShowPreviewTip(t));this._overlayViewModel.setShowTip(i)},t.prototype.setShowPin=function(n){this._overlayViewModel.setShowPin(n)},t}(yi),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),rf=function(n){function t(t){var i=this,r=new h(0,0),u=new wi(23,15);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new nf(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return c(t,n),t.prototype.setIsSelected=function(n){this._overlayViewModel.setIsSelected(n);var t=n?"labelOverlay selected":"labelOverlay";this._overlayViewModel.setLabelRootClass(t)},t.prototype.setMessage=function(n,t){this._overlayViewModel.setTimeText(n);this._overlayViewModel.setDistanceText(t)},t}(yi),uf=function(){function t(n,t,i){this._map=t;this._controlTemplateFactory=i;this._routePins=[];this.routeLinePoints=[];this._primitivesPins=[];this._index=n;this._polylines=[];this._taskState=1}return t.prototype.select=function(){this._isCurrentlySelected=!0;this._updatePrimitives();this._labelOverlay&&this._labelOverlay.setIsSelected(!0)},t.prototype.unSelect=function(){this._isCurrentlySelected=!1;this._updatePrimitives();this._labelOverlay&&this._labelOverlay.setIsSelected(!1)},t.prototype.show=function(){this._updatePrimitives()},t.prototype.setTaskPrimitiveState=function(n){this._taskState=n;this._taskState===1?this.showLabel():this.hideLabel();this._updatePrimitives()},t.prototype.createPolyLineAndStopPins=function(u,f,e,o,c,l,a){var g,nt=null,tt,ct,at,pt,k,ft,v,rt,b,w,et,d,yt,ut,ot,st,ht;if(n.isSDK&&typeof r.Directions.DirectionsSDKPolyline!="undefined"&&(g=r.Directions.DirectionsSDKPolyline,a))switch(e){case i.transit:nt=a.transitPolylineOptions;break;case i.walking:nt=a.walkingPolylineOptions;break;default:nt=a.drivingPolylineOptions}if(tt=[],ct=!0,!this.routeLinePoints.length){for(v=0;v<u.length;v++)at=u[v],pt=new h(at[0],at[1]),this.routeLinePoints.push(pt);ct=!1}if(o){for(k=[],ft=0,v=1;v<o.length;v++)o[v].routeLegStopPoint.isVia?ft++:(k.push(ft),ft=0);var y=0,p=0,vt=0,wt=[],bt=[];for(v=0;v<o.length;v++){if(rt=o[v],l||e!==i.transit){if(v!==0){var yt=o[v-1].routeLegStopPoint.routePathIndex,kt=o[v].routeLegStopPoint.routePathIndex,ut=this.routeLinePoints.slice(yt,kt+1),it;it=n.isSDK&&g?new g(ut,nt,this._index,f,y,p,e,k[y],w,!1):new lt(ut,this._index,f,y,p,e,k[y],w,!1);tt.push(it)}}else if(rt.itineraryItems&&rt.itineraryItems.length>0){for(b=[],w=rt.itineraryItems[0].iconType,et=0;et<rt.itineraryItems.length;et++)d=rt.itineraryItems[et],yt=vt,d&&d.details&&(vt=d.details[d.details.length-1].endPathIndices[0],ut=this.routeLinePoints.slice(yt,vt+1),d.iconType===w?b=b.concat(ut):b.length&&d.iconType!==w&&(n.isSDK&&g?(nt=w==="Walk"?a.walkingPolylineOptions:a.transitPolylineOptions,it=new g(b,nt,this._index,f,y,p,e,k[y],w,!1)):it=new lt(b,this._index,f,y,p,e,k[y],w,!1),tt.push(it),b=ut),w=d.iconType);b.length&&(it=n.isSDK&&g?new g(b,nt,this._index,f,y,p,e,k[y],w,!1):new lt(b,this._index,f,y,p,e,k[y],w,!1),tt.push(it))}v!==0&&(o[v].routeLegStopPoint.isVia?p++:(y++,p=0));ct||(v===0?this.addStopPointPin(o[0].routeLegStopPoint,s.start,c[0],e,a,0,p-1):(ot=s.middle,st=null,o[v].routeLegStopPoint.isVia?(ht=t._constructWaypointQueueItem(o[v].routeLegStopPoint,s.via,null,e,a,y,p-1),wt.push(ht)):(st=c[y],v===o.length-1?(ot=s.end,this.addStopPointPin(o[v].routeLegStopPoint,ot,st,e,a,y,p-1)):(ht=t._constructWaypointQueueItem(o[v].routeLegStopPoint,ot,st,e,a,y,p-1),bt.push(ht)))))}this._commitStopPointPin(bt);this._commitStopPointPin(wt)}tt&&tt.length&&this._polylines.push(tt)},t.prototype.dispose=function(){u._disposeEvents(this);this._map=null;this._controlTemplateFactory=null;u._clearDisposables([this._primitivesPins,this._labelOverlay,this._routePins]);for(var n=0;n<this._polylines.length;n++)u._clearDisposables(this._polylines[n]);this._polylines=[]},t._constructWaypointQueueItem=function(n,t,i,r,u,f,e){return{stopPoint:n,pushpinType:t,instructionViewModel:i,routeMode:r,renderOptions:u,stopPointIndex:f,viaPointIndex:e}},t.prototype._commitStopPointPin=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this.addStopPointPin(t.stopPoint,t.pushpinType,t.instructionViewModel,t.routeMode,t.renderOptions,t.stopPointIndex,t.viaPointIndex)},t.prototype.addStopPointPin=function(n,t,i,r,u,f,e){var s,o;i?s=i.stepText:n&&(s=n.description);o=vt.createStopPointPin(new h(n.coordinates[0],n.coordinates[1]),t,r,!0,i,f,e,this,s,u);o&&this._primitivesPins.push(o);o&&i&&(i.pushpin=o)},t.prototype.addItineraryPin=function(n,t,i,r,u,f){var o=s[n.toLowerCase()],e=new at(t.location,o,t,u,!0,this,t.stepIconClass,i,r,null,null,f);this._primitivesPins.push(e);t.pushpin=e},t.prototype.getPrimitives=function(){var n=[];return this._polylines.forEach(function(t){t.forEach(function(t){n.push.apply(n,t.GetPrimitives())})}),n.push.apply(n,this._primitivesPins),n},t.prototype.getRoutepointNeighbors=function(n){var i;if(!this.routeLinePoints)return null;var e=n.latitude.toFixed(3),o=n.longitude.toFixed(3),r=[],u=null,f=null,t=-1;for(i=0;i<this.routeLinePoints.length;i++)if(this.routeLinePoints[i].latitude.toFixed(3)===e&&this.routeLinePoints[i].longitude.toFixed(3)===o){t=i;break}return t!==-1&&(t<this.routeLinePoints.length-1&&(f=this.routeLinePoints[t+1]),t>0&&(u=this.routeLinePoints[t-1])),r.push(u),r.push(f),r},t.prototype._updatePrimitives=function(){var t=this,n;for(this._polylines.forEach(function(n){n.forEach(function(n){n.changeCardTaskState(t._taskState);n.changeRouteSelectionState(t._isCurrentlySelected);n.update()})}),n=0;n<this._primitivesPins.length;n++)this._primitivesPins[n].changeCardTaskState(this._taskState),this._primitivesPins[n].changeRouteSelectionState(this._isCurrentlySelected),this._primitivesPins[n].update()},t.prototype.setLabel=function(n,t){this._labelOverlay||(this._labelOverlay=new rf(this._controlTemplateFactory));this._labelOverlay.setMessage(n,t)},t.prototype.setLabelLocation=function(n,t){this.labelLocation=n;this._isLabelLocationMiddle=t},t.prototype.showLabel=function(){this.labelLocation&&this._labelOverlay&&(this._taskState===1&&!this._labelOverlayShowing&&(!this._isLabelLocationMiddle||this._isLabelLocationMiddle&&this._isCurrentlySelected)&&(this._map.getOverlays().insert(this._labelOverlay),this._labelOverlayShowing=!0),this._labelOverlay.setAlignment(this.labelLocation))},t.prototype.hideLabel=function(){this._labelOverlay&&this._map.getOverlays().remove(this._labelOverlay);this._labelOverlayShowing=!1},t}(),fe=function(){function n(){this.changed=new e}return n.prototype.getIgnoreOverlayOnTapped=function(){return!0},n}(),vt=function(){function t(n){this.routeMapEntitiesCollection=[];this._primitives=[];this.addMapLayerPrimitives=new e;this.instructionClicked=new e;this.instructionClickedDone=new e;this.setMapViewIfPrimitivesOutOfBound=new e;this.invalidateMap=new e;this._map=n}return t.prototype.select=function(n,t,i,r){var e,u,f;if(this.routeMapEntitiesCollection&&this.routeMapEntitiesCollection.length!==0){for(this._selectedIndex=n,this._primitives=[],u=0;u<this.routeMapEntitiesCollection.length;u++)f=this.routeMapEntitiesCollection[u],u==n?(f.select(),e=f.getPrimitives()):(f.unSelect(),this._primitives=this._primitives.concat(f.getPrimitives()));e&&(this._primitives=this._primitives.concat(e));t&&this.setMapViewIfPrimitivesOutOfBound.invoke(e);this.show(t,i,r,!0)}},t.prototype.getMapType=function(){return this._map.getMapType().id},t.prototype.getMap=function(){return this._map},t.showDragTipPin=function(n,i,r,u,f,e){t._tipOverlay||(t._tipOverlay=new tf(i));t._tipOverlayShowing||(n.getOverlays().insert(t._tipOverlay),t._tipOverlayShowing=!0);t._tipOverlay.setAlignment(r);t._tipOverlay.setShowPin(e);t._tipOverlay.setShowTip(u,f)},t.hideDragTipPin=function(n){t._tipOverlay&&(t._tipOverlayShowing=!1,n.getOverlays()&&n.getOverlays().remove(t._tipOverlay))},t.prototype.clearRoutes=function(){this.clearRoutesLabels()},t.prototype.clearRoutesLabels=function(){if(n.enableRouteLabel)for(var t=0;t<this.routeMapEntitiesCollection.length;t++)this.routeMapEntitiesCollection[t].hideLabel()},t.prototype.centerMap=function(n){ut.setMapCenter(this._map,n,16)},t.prototype.highlightAndInvalidate=function(n){t.highlight(n)},t.prototype.dispose=function(){u._clearDisposables(this.routeMapEntitiesCollection);u._clearDisposables(this._primitives);u._disposeEvents(this);this._map=null},t.highlight=function(n){if(n instanceof at){var i=t._highlightedPin;i!==n&&(i&&i.entity&&(i.isPinHighlighted=!1,i.update(),i.entity.changed.invoke()),n&&n.entity&&(n.isPinHighlighted=!0,n.update(),n.entity.changed.invoke()),t._highlightedPin=n)}},t.createStopPointPin=function(t,i,u,f,e,o,h,c,l,a){if(t){var v="",y=null;return(i===s.start?(v="start",y=a&&(a.firstWaypointPushpinOptions||a.waypointPushpinOptions)):i===s.end?(v="end",y=a&&(a.lastWaypointPushpinOptions||a.waypointPushpinOptions)):i===s.middle?(v="middle",y=a&&a.waypointPushpinOptions):v="via",n.isSDK&&typeof r.Directions.DirectionsSDKPushpin!="undefined")?new r.Directions.DirectionsSDKPushpin(t,y,i,e,u,f,c,v,o,h,l,String.fromCharCode(o+65)):new at(t,i,e,u,f,c,v,o,h,l,String.fromCharCode(o+65))}return null},t.prototype.addRoute=function(n){this._primitives.push.apply(this._primitives,n.getPrimitives());this.routeMapEntitiesCollection.push(n)},t.prototype.show=function(n,t,i,r){var o=this,f,e,u;for(t&&(f=et.logPerfEvent(rt.MR,i),e=this._map.getFrameManager(),f&&e&&e.frameRendered.addOne(function(){f.end()})),u=0;u<this.routeMapEntitiesCollection.length;u++)this.routeMapEntitiesCollection[u].show();this.addMapLayerPrimitives.invoke({primitives:this._primitives,needBestMapView:n});r&&Microsoft.Maps.setTimeout(function(){o.showRouteLabels()},0)},t.prototype.showRouteLabels=function(){var r,i,e,a,c,o,l,s;if(n.enableRouteLabel)for(r=0;r<this.routeMapEntitiesCollection.length;r++){var u=[],f=[],t=this.routeMapEntitiesCollection[r];if(t.labelLocation){t.showLabel();continue}for(i=t.routeLinePoints,e=0;e<this.routeMapEntitiesCollection.length;e++)if(u=[],a=this.routeMapEntitiesCollection[e],c=a.routeLinePoints,e!==r)for(o=0;o<i.length;o++){for(l=!1,s=0;s<c.length;s++)if(h.areEqual(i[o],c[s])){l=!0;break}l?(u.length>f.length&&(f=u),u=[]):u.push(i[o])}f.length?t.setLabelLocation(f[Math.floor(f.length/2)]):t.setLabelLocation(i[Math.floor(i.length/2)],!0);t.showLabel()}},t.prototype.setTaskPrimitiveState=function(n){for(var t=0;t<this.routeMapEntitiesCollection.length;t++)this.routeMapEntitiesCollection[t].setTaskPrimitiveState(n)},t.prototype.getRoutepointNeighbors=function(n){return this.routeMapEntitiesCollection[this._selectedIndex].getRoutepointNeighbors(n)},t}(),c=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),pt=function(r){function u(u,f){var e=this,o={};return e=r.call(this,o)||this,o.defineProperty("btnClass"),e.supportViaPoint=!0,u===i.driving?(e.maxWaypoints=n.maxDriveWaypoints,e.tooltip=t.L_Directions_Title_Drive):u===i.transit?(e.maxWaypoints=n.maxTransitWaypoints,e.tooltip=t.L_Directions_Title_Transit,e.supportViaPoint=!1):u===i.walking?(e.maxWaypoints=n.maxWalkWaypoints,e.tooltip=t.L_Directions_Title_Walk):u===i.truck&&(e.maxWaypoints=n.maxDriveWaypoints),e.mode=u,e.modeName=f,e.enabled=!1,e}return c(u,r),u}(vi),si=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i)||this;return e.title=r||"",e.reverseLink=u||{},e.getRoute=f||{},e}return c(t,n),t}(pt);w.DefaultDirectionsFormattedTextProvider=fi;w.DirectionsInputData=kt;w.DirectionsPanelViewModel=d.isMobile?MobileDirectionsPanelViewModel:fr;w.DirectionsPolyline=lt;w.DirectionsPushpin=at;w.DirectionsResultsSetViewModel=d.isMobile?MobileDirectionsResultsSetViewModel:or;w.DirectionsTask=ct;w.DirectionsTemplateSelector=oi;w.Optimize=nt;w.RouteResultsDataModel=ir;w.TransitDirectionsFormattedTextProvider=ur;w.WaypointViewModel=er;w.WalkingDirectionsFormattedTextProvider=ei;w.DirectionsResultsPanelTemplate=tr;w.RouteAvoidance=ui;w.DistanceUnit=st}catch(sr){if(r.logger)r.logger.logCriticalError(sr);else throw sr;}}).call(window)