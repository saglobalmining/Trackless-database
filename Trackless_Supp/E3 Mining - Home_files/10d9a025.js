(function(){var ki,e,di,ft,ht,vr;try{(function(){var n={L_CreateNewCollection:"Create a new collection...",L_AddFavorite:"As a Favourite",L_SetAsHome:"As your Home address",L_SetAsWork:"As your Work address",L_MoveToFavorites:"Favourites",L_MoveToHome:"Home address",L_MoveToWork:"Work address",L_CreateNewItinerary:"Create a new itinerary",L_DirectionAction_Text:"Click the Map layers button on the right side of the map.",L_DirectionHdg_Text:"Preview turns on a route",L_Direction_Text:"See the turns on your route before you leave. Click the white circle under each turn.",L_SignInLink_Text:"Sign in",L_Dlg_Close:"Close",L_Add_To_Current_Route:"Add to this route",L_Directions_From:"Directions from here",L_Directions_To:"Directions to here",L_Directions_AddToRoute:"Add to route",L_Landmark_TaskBar_Aria_Label:"Search, get directions, set favourites",L_Landmark_CategoriesBar_Aria_Label:"Categories bar",L_Landmark_PreviewBar_Aria_Label:"Bing Maps preview, exit, feedback and Tips",L_Home:"Home",L_Work:"Work",L_MyLocation:"My location",L_SignInRequired:"<link>Sign in<\/link> to add this place to your favourites.",L_SavedCollection:"Successfully added {0}.",L_SaveFailed:"There was a problem adding {1} to {0}. Try again.",L_SeeIt:"View it in<link>{0}<\/link>",L_AddFavoriteFailed:"There was a problem saving this place as a Favourite. Try again.",L_AddFavoriteSucceeded:"{0} is now saved.",L_AddTemporaryCollectionTitle:"your temporary collection",L_SetHomeFailed:"There was a problem saving this place as your Home. Try again.",L_SetHomeSucceeded:"This place is now saved as your Home.",L_SetWorkFailed:"There was a problem saving this place as your Work. Try again.",L_SetWorkSucceeded:"This place is now saved as your Work.",L_EntityUpdateSucceeded:"This place has been updated.",L_SaveUpdateButton:"Save",L_UpdateNicknameMessage:"Add a nickname (optional)",L_Menu_Text:"Menu",L_CategoriesBar_Header_Text:"Along the route:",L_FiltersBar_Less_Text:"Less",L_FiltersBar_More_Text:"More",L_Landmark_FiltersBar_Aria_Label:"Filters bar",L_EditFavorite_Text:"Edit",L_Favorite_Text:"Favourites",L_EditMapDone_Text:"Finished",L_EditMap_Text:"Move or zoom map",L_AddFavoriteExists_Text:"The place you are trying to save already exists in your Favourites.",L_AddTemporaryExists:"The place you are trying to save already exists in your temporary collection.",L_CalendarSync_Export:"Save",L_CalendarSync_Google:"Google Calendar",L_CalendarSync_Outlook:"Outlook Calendar",L_CalendarSync_Message:"Saved into {0}",L_CalendarSync_EventMessage_HTML:"<STRONG>{0}<\/STRONG><BR>...powered by <STRONG>Bing Maps<\/STRONG><BR><BR>View on Bing Maps here:<BR> ",L_CalendarSync_EventMessage:"{0}\\n...powered by Bing Maps\\n\\nView on Bing Maps here: ",L_CalendarSync_EventMessage_PlainText:"{0}\r\n...powered by Bing Maps\r\n\r\nView on Bing Maps here:",L_CalendarSync_OutlookDesktop:"Download Calendar item",L_CalendarSync_EndTimeLink:"Add End Time",L_CalendarSync_StartTime:"Start Time: ",L_CalendarSync_EndTime:"End Time: ",L_CalendarSync_SelectDateTime:"Select date and time",L_CalendarSync_APIErrorMessage:"Sorry. There was an error accessing your calendar! Please log out and try again.",L_CalendarSync_StartEndDateError:"End date/time must be after start date/time.",L_CalendarSync_LoginErrorMessage:"Sorry. There was an error logging in! Try again. (You can also try clearing your cache or using a different browser.)",L_CalendarSync_ICS_Downloaded:"Calendar event file has been downloaded. Open to add to your calendar.",L_CalendarSync_TimeZoneDisclaimer:"All times are shown in the event's local time zone.",L_CalendarSync_AllDayEvent:"All day event",L_AdSlug:"Ad",L_AdRating:"{0} is rated {1} ({3})",L_AdReviewCount:"{0} reviews",L_AdRatingTooltip:"Rating: {0} out of 5.\r\n",L_Nearby_Attractions:"Attractions",L_Nearby_Bars:"Bars",L_Nearby_Coffee:"Coffee",L_Nearby_Hotels:"Hotels",L_Nearby_Restaurants:"Restaurants",L_Nearby_Transit:"Transit",L_TooManyFavorites:"You have reached the maximum number of Favourites. To save this place as a favourite, delete an existing favourite and try again.",L_PhoneWatermark:"(000) 000-0000\r\n",L_SendToMobile_PanelTitle:"Send directions to your phone",L_SendToMobile_SentMessage:"Text message sent. You should receive it soon.",L_SendToMobile_ErrorMessage:"Something went wrong. Please try again.\r\n",L_SendToMobile_LimitErrorMessage:"Sorry, you have reached the maximum text message limit for the day.\r\n",L_SendToMobile_PhoneNumberField:"Enter your mobile phone number\r\n",L_SendToMobile_SubmitText:"Send to phone\r\n",L_SendToMobile_SubmitTip:"Send a text to your phone with this place's information.\r\n",L_SendToMobile_AdditionalInfo:"In addition to directions, we will send you more info for {entity} that you can view in the Bing App\r\n",L_SendToMobile_MoreInfo:"Microsoft will use your phone number only for this one-time transactional purpose. The information will not be stored. Standard SMS rates may apply.\r\n",L_EntityPreviouslySaved:"{0} has been previously added to your collection.",L_DirectionsPopOutAriaLabel:"Directions Dropdown Menu",L_CollectionsPopOutAriaLabel:"Collections Dropdown Menu\r\n",L_TravelPopOutAriaLabel:"Itineraries Dropdown Menu",L_AlongTheRouteText:"{0} Along the Route",L_DropdownMenuDescription:"Dropdown Menu",L_ShortMonthJanuary:"JAN",L_ShortMonthFebruary:"FEB",L_ShortMonthMarch:"MAR",L_ShortMonthApril:"APR",L_ShortMonthMay:"MAY",L_ShortMonthJune:"JUN",L_ShortMonthJuly:"JUL",L_ShortMonthAugust:"AUG",L_ShortMonthSeptember:"SEP",L_ShortMonthOctober:"OCT",L_ShortMonthNovember:"NOV",L_ShortMonthDecember:"DEC"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("CommonControls",n):window.$MicrosoftMaps8.ResourcesObject=n})();var t=window.$MicrosoftMaps8,o=t.Internal,ui=o.TaskData,ve=t.Local=t.Local||{},tt=t.GlobalConfig.features.advertising,ye=t.Anchor,g=t.GlobalConfig.features.autosuggest,it=o._BaseMapTemplateSelector,pe=o.BaseTask,at=o.BaseTaskViewModel,pr=t.BirdseyeV2Manager,we=t.BitmapImageTemplate,s=ui.CollectionActions,et=t.GlobalConfig.features.collections,vt=o._ComponentNames,d=t.GlobalConfig.features.calendar,wr=t.GlobalConfig.features.calendarSync,be=o.CanvasDrawingContext,yt=o.Control,b=o.ControlTemplate,u=t.DataHandlerKeys,fi=o._Debug,ke=t.DefaultTemplateSelector,pt=ui.DirectionsMode,ct=o._EntityHelper,h=o._EntryPoints,de=o._FeatureNames,ge=o.GeolocationProvider,r=o._Gimme,w=t.GlobalConfig,f=t.GlobalDataEventHandler,a=o._Helper,no=t.ImageFromCssHelper,br=t.Infobox,v=o._JSEvent,wt=w.features.localSearch,lt=o._LocalStorageCache,y=o._LoggerConstants,kr=o._LruCache,bt=w.features.mapDelay,p=t.ResourceManager.MapDelay,to=o.MapInteractionBehavior,kt=o.MapHelper,dt=t.Location,k=t.MapTypeId,dr=t.MapView,gr=t.MapViewAnimator,c=t.MapQuadrant,io=t.MoveableSimplePointPrimitive,nt=o._Network,ot=o._ObservableObject,nu=o._ObservableCollection,pi=o._OverlayEntity,ro=o._Overlay,tu=t.Point,uo=o.Permalink,ei=t.PrimitiveOverlayHelper,fo=t.GlobalConfig.features.print,eo=o.PrintContent,iu=ui.RecommendationEntity,i=t.ResourceManager.CommonControls,oo=o.ReverseGeocoder,oi=t.SimplePointPrimitive,so=t.GlobalConfig.features.sharing,ru=o._StreetsidePerfConstants,ti=t.GlobalConfig.features.streetside,wi=t.GlobalConfig.features.travel,rt=o._TaskDataHandlerHelper,l=t.TaskTypes,uu=t.VectorMapLayer,ho=t.VectorImageTemplate,fu=t.ZoomLevel,co=o._MapAuthentication,si='<div class="dropdownTitleList">    <a class="dropdownFocusDummy" tabindex="-1" title="{Binding resources.L_DropdownMenuDescription}"><\/a>    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" event:onEntryMouseover="onEntryMouseover" event:onEntryMouseout="onEntryMouseout" Class="{Binding dropdownClass}" AriaLabel="{Binding ariaLabel}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <TextBlock Text="{Binding name}" />                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',eu='<div class="dropdownTitleSelection">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <CheckBox Content="{Binding name}" Checked="{Binding isSelected}" Value="" onClick="return false;" />                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',ou='<div class="dropdownTitleList">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <div class="ratingStars"><div class="yellowStars"><\/div><div class="regularStars"><\/div><\/div>                    <div><TextBlock Text="{Binding name}" /><\/div>                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',su='<div class="dropdownTitleList">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div>                    <div class="nearbyCatIcon">                    <\/div>                    <div class="{Binding cssClass}">                        <TextBlock Text="{Binding name}" />                    <\/div>                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',hu='<div class="popupMessage" data-tag="popupMessage">    <PopOut Content="{Binding PopOut}">        <PopOut.ContentTemplate>            <DataTemplate>                <div class="messageContainer" event:click="onPopOutClick">                    <div class="saveMessage" data-tag="saveMessage">                        <TextBlock text="{Binding title}" />                        <PopUpMessageControl linkTitle="{Binding linkTitle}" showLink="{Binding showLink}" event:popupLinkClicked="onPopOutLinkClick"/>                    <\/div>                    <div style:display="{Binding ShowAnnotate Converter=boolToDisplay}">                        <div class="annotateContainer" data-tag="AnnotateContainer" style:display="{Binding showFooter}">                            <div>                                <TextBlock text="{Binding updateNicknameMessage}" />                            <\/div>                            <div class="nameInputContainer">                                <input type="text" class="nameEditBox" data-tag="editItemTitleControl" maxlength="100" value="{Binding NickName Mode=TwoWay}" event:keydown="onPopOutKeyPressed" />                                <a href="#" class="popoutSaveButton" data-tag="popoutSaveButton" event:click="onPopOutSaveLinkClick" event:touchend="onPopOutSaveLinkClick">                                    <TextBlock Text="{Binding saveButtonTitle}" />                                <\/a>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/PopOut.ContentTemplate>    <\/PopOut><\/div>',cu='<PopOutButton PopOutContent="{Binding popOutContent}" PopOutTemplate="{Binding popOutTemplate}" IsDisplayed="{Binding isDisplayed Mode=TwoWay}" ButtonClass="{Binding buttonClass}"><\/PopOutButton>',lu='<div class="dropdownTitleList">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" event:onEntryMouseover="onEntryMouseover" event:onEntryMouseout="onEntryMouseout" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <div class="{Binding iconClass}">                    <\/div>                    <div class="listItemText">                        <TextBlock Text="{Binding name}" />                    <\/div>                    <div class="arrow" style:display="{Binding showArrow Converter=boolToDisplay}"><\/div>                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),bi=function(n){function t(t,u,f,e,o,s){var h=n.call(this,e)||this,c,l;return h.resources=o||i,c=f||{},c.onCloseClick||(c.onCloseClick=function(n){n.preventDefault();h.CloseDialog()}),c.onDlgKeydown=function(n){var t=n,f=t.keyCode||t.which,i,u;f===27&&h.CloseDialog();f===9&&(i=h.getFirstTabbableChild(h._getRootElement()),u=r(".dialogClose")[0],t.target!==u||t.shiftKey?t.target===i&&t.shiftKey&&(u.focus(),t.preventDefault()):(i.focus(),t.preventDefault()))},l=s?' id="'+s+'"':"",h.setTemplate(new b('<div class="bm_modalDialog MicrosoftMap" event:keydown="onDlgKeydown" tabindex="-1"><div><div class="'+u+'"'+l+">"+t+'<a href="#" class="dialogClose closeIcon" data-tag="Dialog.Close" event:click="onCloseClick" title="'+i.L_Dlg_Close+'" role="button"><\/a><\/div><\/div><\/div >',c)),h}return e(t,n),t.prototype.OpenDialog=function(){var n=this._getRootElement();n&&(document.body.appendChild(n),n.focus())},t.prototype.CloseDialog=function(){this.getRootElement().removeFromParent()},t.prototype._getRootElement=function(){var n=this.getRootElement();return n?n[0]:null},t}(yt),au='<div>    <div class="{TemplateBinding RequestSent Converter=getTitleClass}">        <TextBlock Text="{TemplateBinding TitleMessage}" />    <\/div>    <div class="infoIcon" style:display="{TemplateBinding RequestSent Converter=hideInfo}" event:mouseover="onInfoHovered" event:mouseout="onInfoExited"><\/div>    <div class="moreInfoBox" style:display="{TemplateBinding ShowInfoBox Converter=boolToDisplay}">        <TextBlock Text="{TemplateBinding resources.L_SendToMobile_MoreInfo}" />    <\/div>    <div class="{TemplateBinding RequestSent Converter=getFinishedClass}">        <div class="phoneTitle">            <TextBlock Text="{TemplateBinding resources.L_SendToMobile_PhoneNumberField}" />        <\/div>        <div class="sendToMobilePhoneNumber">            <input type="text" class="phoneField" maxlength="14" placeholder="{TemplateBinding resources.L_PhoneWatermark}" value="{TemplateBinding PhoneNumber Mode=TwoWay}" event:keydown="onKeyPress" />            <a class="{TemplateBinding IsValidPhone Converter=getButtonClass}" event:click="onSendClick" href="#" role="button" title="{TemplateBinding resources.L_SendToMobile_SubmitTip}">                <TextBlock Text="{TemplateBinding resources.L_SendToMobile_SubmitText}" />            <\/a>        <\/div>        <div class="additionalInfo">            <TextBlock Text="{TemplateBinding resources.L_SendToMobile_AdditionalInfo Converter=formatTitle}" />        <\/div>    <\/div><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),vu=function(n){function t(t,u,f,e){var o=this,s={},h,c;return o=n.call(this,au,"sendToMobileDialog",{onCloseClick:function(n){return o._onCloseClick(n)},onSendClick:function(n){return o._onSendClick(n)},onKeyPress:function(n){return o._onKeyPress(n)},onInfoHovered:function(n){return o._onInfoHovered(n)},onInfoExited:function(n){return o._onInfoExited(n)},getButtonClass:function(n){return o.getButtonClass(n)},formatTitle:function(n){return o.formatTitle(n)},getFinishedClass:function(n){return o.getFinishedClass(n)},getTitleClass:function(n){return o.getTitleClass(n)},boolToDisplay:function(n){return o.boolToDisplay(n)},hideInfo:function(n){return o.hideInfo(n)}},s)||this,s.defineProperty("phoneNumber",function(n,t){o._onPhoneNumberChange(n,t)}),s.defineProperty("titleMessage"),s.defineProperty("isValidPhone"),s.defineProperty("requestSent"),s.defineProperty("showInfoBox"),o.resources=i,o._entity=t,o.setPhoneNumber(""),o.setRequestSent(0),o.setTitleMessage(o.resources.L_SendToMobile_PanelTitle),o.setIsValidPhone(!1),o._time=u,o._hash=f,h=o.getRootElement(),h&&h.length&&(c=r(".phoneField",h[0]),c&&c.length&&(o._phoneInput=c[0])),o._instrumentationHelper("A",{EP:e}),o}return e(t,n),t.prototype.CloseDialog=function(){sj_evt&&sj_evt.fire("onSendToMobileClosing");n.prototype.CloseDialog.call(this);this._instrumentationHelper("DC",{FT:this.getRequestSent()===0?"false":"true"})},t.prototype.focusInput=function(){this._phoneInput&&this._phoneInput.focus()},t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype.hideInfo=function(n){return n===0?"":"none"},t.prototype.getButtonClass=function(n){return n?"textButton":"textButton dimmed"},t.prototype.getFinishedClass=function(n){return n!==0?"actionFinished":""},t.prototype.getTitleClass=function(n){return"sendToMobileHeader"+(n===1?" actionFinished":"")},t.prototype.formatTitle=function(n){return n&&n.replace("{entity}",this._entity.getTitle())},t.prototype._onCloseClick=function(n){n.preventDefault();this.CloseDialog()},t.prototype._onSendClick=function(n){var t=this,r,u,i,f,e,o;(n.preventDefault(),this._validPhoneNumber&&this.getIsValidPhone())&&(this.setRequestSent(1),r=this._entity.id,r=r.replace("ypid:",""),r=r.replace("sid:",""),u="",i=wt.sendToMobileEndpoint,i=i.replace("{phone}",this._validPhoneNumber),i=i.replace("{id}",r),i=i.replace("{name}",encodeURI(this._entity.getTitle())),i=i.replace("{addr}",encodeURI(this._entity.getAddress())),i=i.replace("{time}",this._time),i=i.replace("{hash}",this._hash),f=this._entity.getSegmentTypes(),u=f&&f.length&&f[0],u&&(i+="&oentitytype="+u),e=function(n){var f;t.setRequestSent(2);var r=n&&n.answers&&n.answers[0],i=r&&r.sMSNotifications&&r.sMSNotifications[0],e=i&&i.isSucceeded,u=n&&n.traceId;e?(t.setTitleMessage(t.resources.L_SendToMobile_SentMessage),t._instrumentationHelper("MS",{S:"true",TID:u}),Microsoft.Maps.setTimeout(function(){t.CloseDialog()},5e3)):i?(f=i.message,f==="SMS limit reached"?t.setTitleMessage(t.resources.L_SendToMobile_LimitErrorMessage):t.setTitleMessage(t.resources.L_SendToMobile_ErrorMessage),t._instrumentationHelper("MS",{S:"false",TID:u,R:f})):(t.setTitleMessage(t.resources.L_SendToMobile_ErrorMessage),t._instrumentationHelper("MS",{S:"false",TID:u,R:"APIResponse Malformed"}))},o=function(){t.setRequestSent(2);t.setTitleMessage(t.resources.L_SendToMobile_ErrorMessage);t._instrumentationHelper("MS",{S:"false",R:"APIResponse Failed"})},nt.downloadJson(i,"sendmob",e,o,null,!0,0,!1),this._instrumentationHelper("SC",{TYPE:"Local"}))},t.prototype._onKeyPress=function(n){var t=n;(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=96&&t.keyCode<=105||t.keyCode===8||t.keyCode===46)&&!t.shiftKey||n.preventDefault()},t.prototype._onInfoHovered=function(){this.setShowInfoBox(!0)},t.prototype._onInfoExited=function(){this.setShowInfoBox(!1)},t.prototype._onPhoneNumberChange=function(n,t){var i,r;n&&n.length<10&&t.length>=10?(t=t.slice(0,10),this._validPhoneNumber=t,this.setIsValidPhone(!0),i="({1}) {2}-{3}".replace("{1}",t.slice(0,3)).replace("{2}",t.slice(3,6)).replace("{3}",t.slice(6,10)),this._phoneInput.value=i,this.setPhoneNumber(i)):n&&n.length===14&&t.length<n.length?(this._validPhoneNumber=null,this.setIsValidPhone(!1),r=t.replace(" ","").replace("-","").replace("(","").replace(")",""),this._phoneInput.value=r,this.setPhoneNumber(r)):t.length!==14&&this.setIsValidPhone(!1)},t.prototype._instrumentationHelper=function(n,t){f.invokeHandler(u.instrumentationDataHandlerKey,{logData:{feature:"STM",action:n,data:t},isMapsAction:!0})},t}(bi),yu='<div class="{Binding cssClass}" id="as_container" style:visibility="{Binding showSuggestionsPanel Converter=boolToVisibility}" style:width="{Binding width Converter=numberToPixelString}" data-tag="as_container">    <div class="asOuterContainer">        <div style:display="{Binding showNearBySearchText Converter=boolToDisplay}" >            <p class="nearBySearchText b_secondaryText">                <TextBlock text="{Binding nearBySearchText}" />            <\/p>        <\/div>        <ItemsControl ItemsSource="{Binding suggestions}" panelTagName="ul" role="listbox">            <ItemsControl.ItemTemplate>                <DataTemplate>\t                        <li data-q="{Binding searchText}" id="{Binding optionId}" event:mousedown="handleSuggestionClick" role="option" aria-selected="{Binding isSelected}">                                                   <a class="{Binding isSelected Converter=boolToSelectedClassName}" data-tag="as_suggestion">                                <div class="as_suggestion_root_inside" data-tag="as_suggestion_root_inside">                                    <div class="{Binding suggestionImgClass}" data-tag="as_img">                                    <\/div>                                                                    <div class="as_lines_root" data-tag="as_lines_root">                                        <p class="line1" data-tag="as_suggestion_line">                                            <TextBlock Text="{Binding suggestionTextLine1}" />                                        <\/p>                                        <p class="line2" data-tag="as_suggestion_line">                                            <TextBlock Text="{Binding suggestionTextLine2}" />                                        <\/p>                                    <\/div>                               <\/div>                            <\/a>                        <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div style:display="{Binding showBingLogo Converter=boolToDisplay}" class="bingLogoContainer">            <span class="bingLogoLight"><\/span>        <\/div>    <\/div>    <div class="clear"><\/div> <\/div>>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),hi=function(n){function t(){var i=this,r;return t.instance?(t.instance.tryUpdateIsSignedIn(),t.instance):(r={},i=n.call(this,r)||this,r.defineProperty("isSignedIn",function(n,t){return i._onSignInStateChange(n,t)}),i.notifySignedIn=new v,sj_evt&&sj_evt.bind("wl:auth",function(){i._updateIsSignedIn()}),i._updateIsSignedIn(),t.instance=i,i)}return e(t,n),t.prototype.signIn=function(){typeof Identity!="undefined"&&Identity.popupAuthenticate&&(Identity.headerLoginMode=1,Identity.popupAuthenticate("WindowsLiveId"))},t.prototype.tryUpdateIsSignedIn=function(){if(!fi.getFunctionalTestHooksEnabled()){var t=this.getIsSignedIn(),i=typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile(),n=i!==null;n!==t&&(this.setIsSignedIn(n),f.invokeHandler(u.instrumentationDataHandlerKey,{logData:{feature:"CX",action:"SI",data:{BSI:this.getIsSignedIn()}},isMapsAction:!0}))}},t.prototype._onSignInStateChange=function(n,t){this.notifySignedIn.invoke(t)},t.prototype._updateIsSignedIn=function(){var n=typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile();this.setIsSignedIn(n!==null);f.invokeHandler(u.instrumentationDataHandlerKey,{logData:{feature:"CX",action:"SI",data:{BSI:this.getIsSignedIn()}},isMapsAction:!0})},t.instance=null,t}(ot),pu=function(){function n(){}return n.requestTabControl=function(t,i,r){var e=function(t){var r=n._convertToResponseObject(t),u=r.select(".tab-container"),f=u.length&&u[0].id;i(r,f);n.prepareTabControl(r)},o=function(){},f=t.join("_"),u;f=encodeURI(f);u=et.tabCreatorUrl.replace("{names}",f);u+="&count="+n.count;r&&(u+="&w="+r);fi.getFunctionalTestHooksEnabled()&&(u+="&testhooks=1");nt.downloadGeneric(u,"tabctrl",e,null,o,null,0);n.count++},n.prepareTabControl=function(n){var t=n.select(".tabControlRoot");t&&t.length&&Microsoft.Maps.setTimeout(function(){sj_evt.fire("tab_init",tabcontrol)},200)},n._convertToResponseObject=function(n){var t=r(document.createElement("div"));return t.set_html(n),t},n.count=0,n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wu=function(n){function t(){var r=n.call(this)||this;r.resources=i;r.defineProperty("linkTitle",null,function(n,t){return r._convertSaveMessage(n,t)});r.defineProperty("showLink",null,null,{defaultValue:!0});r._baseTemplate='<div class="saveLink" data-tag="saveLink" style:display="{TemplateBinding ShowLink Converter=displaySeeItLink}">{0}<\/div>';var f=i.L_SeeIt,e="seeItLink"+(f.indexOf("<link>")!==0?" spaceBeforeLink":""),o=t._linkStart.replace("{0}",e),u=f.replace("<link>",o).replace("<\/link>",t._linkEnd);return u=u.replace("{0}",'<TextBlock Text="{TemplateBinding LinkTitle}" />'),r._templateString=r._baseTemplate.replace("{0}",u),r._resetTemplate(r._templateString),r.popupLinkClicked=new v,r}return e(t,n),t.prototype._resetTemplate=function(n){var t=this;this.setTemplate(new b(n,{onPopOutLinkClick:function(n){return t._popupLinkClicked(n)},displaySeeItLink:function(n){return t.displaySeeItLink(n)}}))},t.prototype._popupLinkClicked=function(n){(n&&n.preventDefault&&n.preventDefault(),n.type!=="pointerup"||r(".mapContainer .MicrosoftMap").has(n.target))&&this.popupLinkClicked.invoke(n)},t.prototype.displaySeeItLink=function(n){return n?"":"none"},t.prototype._convertSaveMessage=function(n){return n&&n.length>0||(n=i.L_Favorite_Text),n},t._linkStart='<a href="#" class="{0}" data-tag="seeItLink" event:click="onPopOutLinkClick" event:touchend="onPopOutLinkClick">',t._linkEnd="<\/a>",t._linkText="",t}(yt);b.registerControl("PopUpMessageControl",wu);e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();ki=function(n){function t(){var t=n.call(this)||this;return t.signInStateHandler=new hi,t.resources=i,t.defineProperty("signInMessage",null,function(n,i){return t._convertSignInMessage(n,i)}),t._baseTemplate='<div class="signInControlTop" style:display="{TemplateBinding signInStateHandler.IsSignedIn Converter=displaySignInPopUpControl}"><div class="signInMessage">{0}<\/div>{1}<\/div>',t._templateString=t._baseTemplate.replace("{0}","").replace("{1}",""),t._resetTemplate(t._templateString),t.signInClicked=new v,t.signedIn=new v,t.signInStateHandler.notifySignedIn.add(function(n){n&&t.signedIn&&t.signedIn.invoke()}),t}return e(t,n),t.prototype.displaySignInPopUpControl=function(){return this.signInStateHandler.tryUpdateIsSignedIn(),this.signInStateHandler.getIsSignedIn()?"none":"block"},t.prototype._resetTemplate=function(n){var t=this;this.setTemplate(new b(n,{onSignInLinkClick:function(n){return t._onSignInLinkClick(n)},displaySignInPopUpControl:function(n){return t.displaySignInPopUpControl(n)}}))},t.prototype._onSignInLinkClick=function(n){f.invokeHandler(u.instrumentationDataHandlerKey,{logData:{feature:"CX",action:"SI",data:{SGNIN:"SigningIn"}},isMapsAction:!0});n.preventDefault();this.signInStateHandler.signIn();this.signInClicked.invoke(n);n&&n.preventDefault&&n.preventDefault()},t.prototype._convertSignInMessage=function(n){var i="",r="",u;if(n)switch(n.indexOf("<link>")){case-1:i=n;u=et.oneMapStyleChanges?t._oneMapSignInButton:t._signInButton;r=u.replace("{0}",this.resources.L_SignInLink_Text);break;case 0:i=n.replace("<link>",t._linkStart).replace("<\/link>",t._linkEnd);break;default:i=n.replace("<link>",t._linkStartSpaceBefore).replace("<\/link>",t._linkEnd)}else i=t._linkStart.concat(this.resources.L_SignInLink_Text,t._linkEnd);return this._templateString=this._baseTemplate.replace("{0}",i).replace("{1}",r),this._resetTemplate(this._templateString),n},t._linkStart='<a href="#" class="signInLink" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">',t._linkStartSpaceBefore='<a href="#" class="signInLink spaceBeforeLink" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">',t._linkEnd="<\/a>",t._signInButton='<a href="#" class="signInButton" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">{0}<\/a>',t._oneMapSignInButton='<a href="#" class="signInButton secondaryButton" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">{0}<\/a>',t}(yt);b.registerControl("SignInPopUpControl",ki);e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();di=function(n){function t(){var t=n.call(this)||this;return t._templateString='<div class="{TemplateBinding Class}" data-tag="canvasIcon"><\/div>',t.defineProperty("class",null,null,{defaultValue:""}),t.defineProperty("vectorTemplate",function(n,i){t._onVectorTemplateChanged(n,i)}),t.setTemplate(new b(t._templateString,null)),t}return e(t,n),t.prototype._onVectorTemplateChanged=function(n,t){var i=this.getRootElement();i.clear();t&&i.append(t.renderIcon())},t}(yt);b.registerControl("CanvasControl",di);var gi='<div class="bm_categoriesBar" data-tag="categoriesBar" role="search" aria-label="{Binding resources.L_Landmark_CategoriesBar_Aria_Label}" style:display="{Binding isVisible Converter=boolToDisplay}">    <div class="categoriesBarHeader"><TextBlock text="{Binding resources.L_CategoriesBar_Header_Text}" /><\/div>    <ItemsControl ItemsSource="{Binding categoriesBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="categories"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="category" data-tag="category">                    <a href="#" class="{Binding cssClass}" data-instrumentation="{Binding instrumentationData}" event:mouseover="onMouseOverHandler" event:mouseleave="onMouseLeaveHandler" event:click="clickHandler" role="button" title="{Binding itemData.titleString}"><TextBlock text="{Binding itemData.displayName}" /><\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),bu=function(n){function t(t,r,u,f,e){var o=this,s={};return o=n.call(this,s,f,u)||this,s.defineProperty("isVisible"),o._map=t,o.resources=i,o.categorySelected=new v,o._createCategoriesBarItems(r),e&&o._setMapModeEventsHandlers(),o}return e(t,n),t.prototype.stringify=function(n){return r.Internals.stringify(n)},t.prototype._createCategoriesBarItems=function(n){var t,i;for(this.categoriesBarItems=[],t=0;t<n.length;t++)i=this._createCategoriesBarItem(n[t]),this.categoriesBarItems.push(i)},t.prototype._createCategoriesBarItem=function(n){var i=this,t=new du(n);return t.clickHandler=function(t){i.categorySelected.invoke(n);t.preventDefault()},t},t.prototype._setMapModeEventsHandlers=function(){var n=this;this._map&&(this.disposables.push(this._map.mapTypeChanged.add(function(t){n._setLightOrDark(0,t.newMapTypeId)})),this.disposables.push(this._map.mapModeChanged.add(function(t){n._setLightOrDark(t.newMode)})),this._setLightOrDark(this._map.getMode().mapModeType))},t.prototype._setLightOrDark=function(n,t){var i=!0,r=this.getControl(),u="Dark";n===0&&(t||(t=this._map.getMapType().id),i=t===k.aerial||t===k.birdseye);i?r.add_class(u):r.remove_class(u)},t}(at),ku=function(){function n(n,t,i,r){if(gi)this._viewModel=new bu(n,t,gi,i,r),this.categorySelected=this._viewModel.categorySelected;else throw"Template is not defined!";}return n.prototype.setIsVisible=function(n){this._viewModel.setIsVisible(n)},n.prototype.getIsVisible=function(){return this._viewModel.getIsVisible()},n.prototype.deactivate=function(){this._viewModel.getControl().removeFromParent()},n.prototype.getControl=function(){return this._viewModel.getControl()},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),du=function(n){function t(t){var i=this,r={};return i=n.call(this,r)||this,r.defineProperty("cssClass"),i.itemData=t,i.setCssClass(t.cssClassName),i.instrumentationData=i._createInstrumentationData(t.instrumentationId),i}return e(t,n),t.prototype._createInstrumentationData=function(n){var t={logData:{feature:vt.CategoriesBar,action:y.Clicked,data:{CT:n}}};return r.Internals.stringify(t)},t}(ot),gu=function(){function n(n,t,r,u,f){this.cssClassName=n;this.displayName=t;this.instrumentationId=r;this.category=u;this.titleString=i.L_AlongTheRouteText.replace("{0}",t);this.categoryId=f}return n}(),nf=function(){function n(){this._store=window.sessionStorage}return n.prototype.set=function(n,t){this._store.setItem(n,t)},n.prototype.get=function(n){return this._store.getItem(n)},n.prototype.clear=function(){this._store.clear()},n.prototype.remove=function(n){this._store.removeItem(n)},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),tf=function(){function n(){}return n}(),rf=function(n){function t(t){var i=this,r={};return i=n.call(this,r)||this,i._store=new nf,i._config=d,i._calendarSync=t,r.defineProperty("isSignedIn",function(n,t){return i._onSignInStateChange(n,t)}),i._consumersPayloadTypeId="9188040d-6c67-4c5b-b112-36a304b66dad",i._silentAuthUrl="{authUrl}&prompt=none&domain_hint={userDomainType}&login_hint={userSigninName}",i._issuerTenantId="https://login.microsoftonline.com/{payloadTid}/v2.0",i.isUserSignedIn()||i.clearUserState(),i}return e(t,n),t.prototype.CreateMapsAuthCallback=function(){var i=this,n=this,t=this._store;return function(r){if(r.accessToken&&r.idToken){t.remove("accessToken");t.remove("idToken");var u=t.get("authState");if(r.state!==u){t.remove("authState");t.remove("authNonce");n.logError("Invalid state","The state in the authorization response did not match the expected value. Please try signing in again.");return}t.set("authState","");t.set("accessToken",r.accessToken);t.set("tokenExpires",r.expires);t.set("idToken",r.idToken);n.validateIdToken(function(t){var u,f,r;t?(n.logTokens(),i.setIsSignedIn(!0),sj_evt&&sj_evt.fire("wl:auth"),Identity&&Identity.wlProfile&&Identity.popupLoginUrls&&(u=Identity.popupLoginUrls,u&&(f=u.WindowsLiveId,f&&(r=document.createElement("iframe"),r.style.display="none",r.src=f+"&checkda=1",document.body.appendChild(r))))):n.clearUserState();n._authCallback&&n._authCallback(t)})}else n.logError(r.error,r.errorDescription),n.clearUserState(),n.getCalendarSync().log("ERR",0..toString(),r.error)}},t.prototype.isAuthenticated=function(){if(!this.isUserSignedIn())return this.clearUserState(),!1;var n=this._store.get("accessToken");return n!==null&&n.length>0},t.prototype.getCalendarSync=function(){return this._calendarSync},t.prototype.retrieveEmailIfSignedIn=function(){var n=this;this.isUserSignedIn()&&this.getSignedInUserEmail(function(t){t&&n._store.set("WindowsLiveEmail",t)})},t.prototype.isUserSignedIn=function(){return typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile()!==null},t.prototype.dispose=function(){if(this._disposables){for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=null}},t.prototype.logTokens=function(){var r=this._store.get("accessToken"),i,n,t;console.info("Access Token - ["+r+"]");i=this._store.get("tokenExpires");n=new Date(parseInt(i));console.info("Token Expires - ["+n.toLocaleDateString()+" "+n.toLocaleTimeString()+"]");t=this._store.get("idToken");t&&console.info("Id Token - ["+t+"]")},t.prototype.logError=function(n,t){console.warn("ERROR : ("+this.decodePlusEscaped(n)+") - "+this.decodePlusEscaped(t))},t.prototype.logWelcome=function(){if(this.isAuthenticated){var n=this._store.get("userDisplayName");console.info("Welcome ["+n+"]")}else console.info("SignIn")},t.prototype.logComment=function(n){console.log("-> "+n)},t.prototype.sendInvite=function(n,t){var i=this;this.getUserEmailAddress(function(r,u){u?(i.logError("getUserEmailAddress FAILED",u.responseText),t&&t(!1)):i.sendCalendarInvite(r,n,function(n,i){i||t&&t(!0)})})},t.prototype.addDays=function(n,t){var i=new Date(n.valueOf());return i.setDate(i.getDate()+t),i},t.prototype.addHours=function(n,t){var i=new Date(n.valueOf());return i.setTime(i.getTime()+t*36e5),i},t.prototype._onSignInStateChange=function(n,t){this.notifySignedIn&&this.notifySignedIn.invoke(t)},t.prototype.buildAuthUrl=function(){var u=this.guid(),f=this.guid(),n,t,i,r;this._store.set("authState",u);this._store.set("authNonce",f);n={};n.response_type="id_token token";n.client_id=this._config.appId;n.redirect_uri=this._config.authorizationRedirectUrl;n.scope=this._config.scopes.replace("+"," ");n.state=u;n.nonce=f;n.response_mode="fragment";t=this._config.authorizationEndpointBase+this._config.authorizationEndpoint;i=0;for(r in n)t+=r+"="+n[r]+"&",i++;return i>1&&(t=t.slice(0,-1)),t},t.prototype.popupAuthenticate=function(n,t){var i=this.buildAuthUrl(),f=this._store.get("WindowsLiveEmail"),u,r;this.isUserSignedIn()&&t?(u=this._store.get("userDomainType"),r=this._store.get("userSigninName"),r=r||f,u=u||"consumers",r&&(i=this._silentAuthUrl.replace("{authUrl}",i).replace("{userDomainType}",u).replace("{userSigninName}",r),this.openPopupAuthWindow(i,n))):t?n&&n(!1):(this.isUserSignedIn()&&f&&(i=i+"&login_hint="+f),this.openPopupAuthWindow(i,n))},t.prototype.openPopupAuthWindow=function(n,t){this._authPopupWindow=window.open(n,"_blank","resizable,scrollbars,status");t&&(this._authCallback=t)},t.prototype.validateIdToken=function(n){var u=this._store.get("idToken"),c=this._store.get("authNonce"),i,o,t,f;if(null===u||u.length<=0){n(!1);return}if(i=u.split("."),i.length!==3){n(!1);return}if(o=r.Internals.parseJSON(atob(i[0])),t=r.Internals.parseJSON(atob(i[1])),t.nonce!==this._store.get("authNonce")){this._store.set("authNonce","");n(!1);return}if(t.aud!=this._config.appId){n(!1);return}if(f=this._issuerTenantId.replace("{payloadTid}",t.tid),t.iss!==f){n(!1);return}var e=new Date,s=new Date((t.nbf-300)*1e3),h=new Date((t.exp+300)*1e3);if(e<s||e>h){n(!1);return}this._store.set("userDisplayName",t.name);this._store.set("userSigninName",t.preferred_username);this._store.set("userDomainType",t.tid===this._consumersPayloadTypeId?"consumers":"organizations");n(!0)},t.prototype.makeSilentTokenRequest=function(n){var t=this;this.popupAuthenticate(function(i){i&&n&&n(t._store.get("accessToken"))},!0)},t.prototype.getAccessToken=function(n){var i=this._store.get("tokenExpires"),t=this._store.get("accessToken"),r=(new Date).getTime(),u=r>parseInt(i);t&&!u?n&&n(t):this.makeSilentTokenRequest(n)},t.prototype.makeApiCall=function(n,t){var i={Authorization:"Bearer "+n.token,"client-request-id":this.guid(),"return-client-request-id":"true"},r;n.email&&(i["X-AnchorMailbox"]=n.email);n.method==="POST"&&(i["Content-Type"]="application/json",i.Accept="application/json");r={url:n.url,dataType:"json",type:n.method,headers:i};n.query&&(r.data=n.query);this.makeRequest(r,t)},t.prototype.makeRequest=function(n,t){n.type==="POST"?(n.onSuccess=function(n){t(n)},n.onError=function(n,i,r){i>400||!n?t(null,r+","+n):r==="Created"?t(n):t(null,r+","+n)},nt.doPost(n.url,n.data,n)):nt.downloadJson(n.url,"tokens",function(n){t(n)},function(n,i,r){t(null,r)},n,!1,0,!0,n.headers)},t.prototype.getSignedInUserEmail=function(n){this.isUserSignedIn()?nt.downloadGeneric(this._config.emailEndpoint,"email",function(t){n&&n(t)},null,function(){n&&n(null)}):n&&n(null)},t.prototype.getUserEmailAddress=function(n){var t=this,i=this._store.get("userEmail");if(i)return i;this.getAccessToken(function(i){var r,u;i?(r={url:t._config.apiEndpoint+"/Me",token:i,method:"GET"},t.makeApiCall(r,function(t,i){i||!t?n(null,i):n({email:t.EmailAddress,name:t.DisplayName})})):(u={responseText:"Could not retrieve access token"},n(null,u))})},t.prototype.sendCalendarInvite=function(n,t,i){var r=this,u=n.email,e=n.name,f=t.isAllDayEvent?Intl.DateTimeFormat().resolvedOptions().timeZone:"UTC",o='{"Subject": "'+t.title+'","Location":{"DisplayName": "'+t.location+'"},"Body": {"ContentType": "HTML","Content": "'+t.description+'" },"Start": {"DateTime": "'+t.eventStart+(t.isAllDayEvent?"T00:00:00":"")+'", "TimeZone": "'+f+'"}, "End": { "DateTime": "'+t.eventEnd+(t.isAllDayEvent?"T00:00:00":"")+'", "TimeZone": "'+f+'"}, "IsAllDay": '+t.isAllDayEvent+', "Attendees": [{"EmailAddress": {"Address": "'+u+'", "Name": "'+e+'" }, "Type": "Required" } ]}';this.getAccessToken(function(n){var t,f;n?(t={url:r._config.apiEndpoint+"/Me/events",token:n,method:"POST",email:u,query:o},r.makeApiCall(t,function(n,t){t?i(null,t):i(n.value)})):(f={responseText:"Could not retrieve access token"},i(null,f))})},t.prototype.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})},t.prototype.decodePlusEscaped=function(n){return n?decodeURIComponent(n.replace(/\+/g," ")):""},t.prototype.clearUserState=function(){this._store.clear();this.setIsSignedIn(!1)},t.prototype.formatDate=function(n){var t=new Date(n);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},t}(ot),nr='<div class="CalendarSync">\t<div class="calendarSelect" data-tag="calendarSyncSelect">\t\t<SelectControl ItemsSource="{Binding calendarTypes}" SelectedItem="{Binding calendarType Mode=TwoWay}" event:dropdown="onDropdown" />\t<\/div>    \t<div id="startCalendar">\t\t<div>\t\t\t<span class="startTimeLabel">\t\t\t\t<TextBlock Text="{Binding resources.L_CalendarSync_StartTime}" />\t\t\t<\/span>\t\t\t<span class="startDateAndTime" >\t\t\t\t<a class="dateTimeSelector dropdownBtn" event:click="onStartTimeClick" href="#">\t\t\t\t\t<TextBlock Text="{Binding startDateTime}" />\t\t\t\t<\/a>\t\t\t<\/span>\t\t<\/div>\t\t<div style:display="{Binding showStartCalendarSelector Converter=boolToDisplay}">\t\t\t<div class="calendarSyncStartDate" data-tag="calendarSyncDate"><\/div>            <div class="calendarTime">                <TimeControl Time="{Binding startTime Mode=TwoWay}" Editing="{Binding startEditingTime Mode=TwoWay}" Disabled="{Binding timeControlDisabled}"/>                <div class="allDayEventCheckbox">                    <CheckBox Checked="{Binding isAllDayEvent Mode=TwoWay}" Value="{Binding resources.L_CalendarSync_AllDayEvent}" Content="{Binding resources.L_CalendarSync_AllDayEvent}" />                <\/div>            <\/div>\t\t<\/div>\t<\/div>\t\t<div class="endTimeLink" style:display="{Binding showEndTimeLink Converter=boolToDisplay}">\t\t<a event:click="onEndTimeLinkClick" href="#"><TextBlock Text="{Binding resources.L_CalendarSync_EndTimeLink}" /><\/a>\t<\/div>\t<div class="endCalendar" style:display="{Binding showEndCalendar Converter=boolToDisplay}">\t\t<div>\t\t\t<span class="endTimeLabel">\t\t\t\t<TextBlock Text="{Binding resources.L_CalendarSync_EndTime}" />\t\t\t<\/span>\t\t\t<span class="endDateAndTime">\t\t\t\t<a class="dateTimeSelector dropdownBtn" event:click="onEndTimeClick" href="#">\t\t\t\t\t<TextBlock Text="{Binding endDateTime}" />\t\t\t\t<\/a>\t\t\t<\/span>\t\t<\/div>\t\t<div style:display="{Binding showEndCalendarSelector Converter=boolToDisplay}">\t\t\t<div class="calendarSyncEndDate" data-tag="calendarSyncDate"><\/div>            <div class="calendarTime">                <TimeControl Time="{Binding endTime Mode=TwoWay}" Editing="{Binding endEditingTime Mode=TwoWay}" Disabled="{Binding timeControlDisabled}"/>                <div class="allDayEventCheckbox">                    <CheckBox Checked="{Binding isAllDayEvent Mode=TwoWay}" Value="{Binding resources.L_CalendarSync_AllDayEvent}" Content="{Binding resources.L_CalendarSync_AllDayEvent}" />                <\/div>            <\/div>\t\t<\/div>\t<\/div>    \t<div class="calendarSyncExportButton">\t\t<a title="{Binding resources.L_CalendarSync_Export}" event:click="onExportClick" href="#" role="button" data-tag="calendarSyncExportButton">            <span class="cbtn b_highlighted">                <input type="submit" value="{Binding resources.L_CalendarSync_Export}" />            <\/span>\t\t<\/a>\t<\/div>    <div class="calendarSyncTimeZoneDisclaimer" style:display="{Binding showTimeZoneDisclaimer Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_CalendarSync_TimeZoneDisclaimer}" />    <\/div><\/div>',uf=function(){function n(n){this.loggedIn=!1;this._calendarSync=n;this._calendarHelper=new rf(n);window.MapsAuthCallback=this._calendarHelper.CreateMapsAuthCallback()}return n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n.prototype.createOrUpdateEventWithAPI=function(n,t,i){this._calendarSync.createdEventIdO365?this.updateEvent(n,this._calendarSync.createdEventIdO365,t,i):this.createNewEvent(n,t,i)},n.prototype.createOrUpdateEvent=function(n,t,i){var r=this;this._calendarHelper.popupAuthenticate(function(u){u?(r._writeInviteToCalendar(n),t&&t()):(r._calendarHelper.logError("Authentication FAILED","Failed to get authentication token to write to outlook calendar"),i&&i())})},n.prototype._writeInviteToCalendar=function(n){var i=new Date,t=this._calendarHelper;t.sendInvite(n,function(n){n&&t.logComment("Invite sent at "+(new Date).toTimeString())})},n.prototype.createNewEvent=function(n,t,i){this.createOrUpdateEvent(n,t,i)},n.prototype.updateEvent=function(n,t,i,r){this.createOrUpdateEvent(n,i,r)},n.prototype._parseEvent=function(n){return JSON.stringify({Subject:n.title,Body:{ContentType:"HTML",Content:n.description},Location:{DisplayName:n.location},Start:n.eventStart,End:n.eventEnd})},n.prototype.logIn=function(n){n&&n()},n.prototype.preAuth=function(){this._calendarHelper.retrieveEmailIfSignedIn()},n.prototype.logOut=function(){this.loggedIn=!1},n.prototype.getEventsByDateRange=function(n,t,i,r){r&&r()},n}(),ff=function(){function n(n){this._clientId=d.gCalClientId;this._scopes=d.gCalScopes;this.loggedIn=!1;this._calendarSync=n;this._addRemoteAPIScript()}return n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n.prototype.logOut=function(){gapi.auth.signOut();this.loggedIn=!1},n.prototype.logIn=function(n,t){var i=this;gapi.auth.authorize({client_id:this._clientId,scope:this._scopes,immediate:!1},function(r){return i._handleAuthenticationResult(r,n,t)})},n.prototype.preAuth=function(n){n&&n()},n.prototype._addRemoteAPIScript=function(){window.AM&&window.AM.push("google.com");var t=document.head,n=document.createElement("script");n.type="text/javascript";n.src=d.gCalApiSource;t.appendChild(n)},n.prototype._handleAuthenticationResult=function(n,t,i){n&&!n.error?(gapi.client.load("calendar",d.gCalVersion,function(){t&&t()},function(){i&&i()}),this.loggedIn=!0):i&&i()},n.prototype.createOrUpdateEvent=function(n,t,i){this.createNewEvent(n,t,i)},n.prototype.createNewEvent=function(n,t,i){var r=this,u=this._parseEvent(n);gapi.client.load("calendar",d.gCalVersion,function(){var n=gapi.client.calendar.events.insert({calendarId:"primary",resource:u});n.execute(function(n){n.error?i&&i():(console.log("Event created in Google: "+n.htmlLink),r._calendarSync.createdEventIdGoogle=n.id,t&&t())})})},n.prototype.updateEvent=function(n,t,i,r){var u=this,f=this._parseEvent(n);gapi.client.load("calendar",d.gCalVersion,function(){var n=gapi.client.calendar.events.update({calendarId:"primary",eventId:t,resource:f});n.execute(function(n){n.error?r&&r():(console.log("Event updated in Google: "+n.htmlLink),u._calendarSync.createdEventIdGoogle=n.id,i&&i())})})},n.prototype._parseEvent=function(n){return n.isAllDayEvent?{summary:n.title,location:n.location,description:n.description,start:{date:n.eventStart},end:{date:n.eventEnd}}:{summary:n.title,location:n.location,description:n.description,start:{dateTime:n.eventStart},end:{dateTime:n.eventEnd}}},n.prototype.getEventsByDateRange=function(n,t,i,r){var u=gapi.client.calendar.events.list({calendarId:"primary",timeMin:n,timeMax:t,maxResults:20,singleEvents:!0,orderBy:"startTime"});u.execute(function(n){var u,t;if(n.error)r&&r();else{for(u=n.items,t=0;t<u.length;t++)console.log(u[t].summary);i&&i()}})},n}(),ef=function(){function n(){this.loggedIn=!0}return n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n.prototype.logIn=function(n){n&&n()},n.prototype.logOut=function(){},n.prototype.preAuth=function(n){n&&n()},n.prototype.createOrUpdateEvent=function(n,t){var r="BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:"+n.title+"\nDESCRIPTION:"+n.description+"\nLOCATION:"+n.location+"\nDTSTART;"+(n.isAllDayEvent?"VALUE=DATE:":"TZID=UTC:")+n.eventStart+"\nDTEND;"+(n.isAllDayEvent?"VALUE=DATE:":"TZID=UTC:")+n.eventEnd+"\nEND:VEVENT\nEND:VCALENDAR",u,i;window.navigator.msSaveOrOpenBlob?(u=new Blob([r]),window.navigator.msSaveOrOpenBlob(u,n.title+".ics")):(i=document.createElement("a"),i.href="data:text/calendar;charset=utf-8,"+encodeURIComponent(r),i.setAttribute("download",n.title+".ics"),document.body.appendChild(i),i.click(),document.body.removeChild(i));t&&t()},n.prototype.updateEvent=function(){},n.prototype.getEventsByDateRange=function(){},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ci=function(n){function t(t,r,u,f,e,o,s,h,c,l){var a,v,p,y,w,b;return l===void 0&&(l=!1),a=this,v={},a=n.call(this,v)||this,a._map=r,a._container=u,a._label=f,a._message=e,a._calendarSync=t,a.resources=i,p=r.getContainer(),a._showDateTimeOnLabel=!1,a.updatingStartTime=!1,a.updatingEndTime=!1,a._startCalendar=null,a._endCalendar=null,a.OneMinute=6e4,a.OneHour=36e5,a.TwentyFourHours=864e5,a.ElevenFiftyFivePm=1435*a.OneMinute,a._allowPastTimes=l,a._userUtcOffset=-(new Date).getTimezoneOffset(),h&&(a._utcOffset=h,a._userUtcOffset===a._utcOffset||c||(a._displayLocalTime=!0,o&&!isNaN(o)&&(o+=(a._utcOffset-a._userUtcOffset)*a.OneMinute),s&&!isNaN(s)&&(s+=(a._utcOffset-a._userUtcOffset)*a.OneMinute))),v.defineProperty("startDate",a._onStartDateTimeChanged),v.defineProperty("startTime",a._onStartDateTimeChanged),v.defineProperty("endDate",a._onEndDateTimeChanged),v.defineProperty("endTime",a._onEndDateTimeChanged),v.defineProperty("calendarType",a._onCalendarTypeChanged),v.defineProperty("isAllDayEvent",a._onIsAllDayEventChanged),v.defineProperty("startEditingTime"),v.defineProperty("endEditingTime"),v.defineProperty("showStartCalendarSelector"),v.defineProperty("showEndCalendarSelector"),v.defineProperty("showEndCalendar"),v.defineProperty("showEndTimeLink"),v.defineProperty("timeControlDisabled"),v.defineProperty("showTimeZoneDisclaimer"),a._prePopulateCalendarTypeDropdowns(),a.startDateTime=a.endDateTime=i.L_CalendarSync_SelectDateTime,a.setShowStartCalendarSelector(!1),a.setShowEndCalendarSelector(!1),a.setShowEndCalendar(s&&!isNaN(s)?!0:!1),a.setShowEndTimeLink(!1),a.setTimeControlDisabled(!1),a.setIsAllDayEvent(!1),a.setShowTimeZoneDisclaimer(a._displayLocalTime),c&&o&&!isNaN(o)&&(a.setIsAllDayEvent(!0),a.setTimeControlDisabled(!0),o=Math.floor(o/a.TwentyFourHours)*a.TwentyFourHours,o-=a._userUtcOffset*a.OneMinute,s&&!isNaN(s)?(s=Math.floor(s/a.TwentyFourHours)*a.TwentyFourHours,s-=a._userUtcOffset*a.OneMinute,s===o&&(s=s+a.ElevenFiftyFivePm)):s=o+a.ElevenFiftyFivePm),y=new Date,o&&!isNaN(o)?(y=new Date(o),a._setDateAndTime(o,!1,!1)):a._setDateAndTime(y.getTime(),!1,!0),s&&!isNaN(s)?a._setDateAndTime(s,!0,!1):(w=!(o&&!isNaN(o)),y.setHours(y.getHours()+1),a._setDateAndTime(y.getTime(),!0,w)),b={boolToDisplay:function(n){return a.boolToDisplay(n)}},u&&p&&p.instanceAsync("ControlTemplate",function(n){var t=n.applyDataTemplate(a);t.appendTo(u);a._addCalendar(t,o)},{templateText:nr,staticResources:b}),f.add_event("click",function(n){a._onLabelClick(n)}),a._showHideCalendarSyncControl(!1),a}return e(t,n),t.prototype.adjustEndTime=function(){if(!this.updatingEndTime){this.updatingEndTime=!0;var i=t.getDate(this.getStartDate(),this.getStartTime()),n=new Date(this.getStartDate()+this.getStartTime()*1e3);n.setTime(n.getTime()+this.OneHour);this.setEndTime(t.getTimeInSeconds(n));n.setHours(0,0,0,0);this.setEndDate(n.getTime());this.endDateTime=t.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent());this._endCalendar&&this._endCalendar.SetDate(this.getEndDate());this.updatingEndTime=!1}},t.prototype._onStartDateTimeChanged=function(){var n,i,r;this.updatingStartTime||(this.updatingStartTime=!0,n=new Date(Date.now()),i=t.getDate(this.getStartDate(),this.getStartTime()),!this._allowPastTimes&&i<n&&(this.setStartTime(n.getHours()*this.OneHour),this.setStartDate(n.getTime())),this.startDateTime=t.formatDateTimeString(this.getStartDate(),this.getStartTime(),this.getIsAllDayEvent()),this.updatingStartTime=!1,r=t.getDate(this.getEndDate(),this.getEndTime()),(r<i||!this.getShowEndCalendar())&&this.adjustEndTime(),this._showHideMessage(!1))},t.prototype._onEndDateTimeChanged=function(){if(!this.updatingEndTime){var n=t.getDate(this.getStartDate(),this.getStartTime()),i=t.getDate(this.getEndDate(),this.getEndTime());i<n&&this.adjustEndTime();this.endDateTime=t.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent());this._showHideMessage(!1)}},t.prototype._onCalendarTypeChanged=function(){this._message.set_style({display:"none"})},t.prototype._onIsAllDayEventChanged=function(){this.setTimeControlDisabled(this.getIsAllDayEvent());this.startDateTime=t.formatDateTimeString(this.getStartDate(),this.getStartTime(),this.getIsAllDayEvent());this.endDateTime=t.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent())},t.prototype._setDateTimeToLabel=function(){this._calendarSync.getPermalink()},t.prototype._addCalendar=function(n,t){var i=this,r=this._map.getContainer(),f=n.select(".calendarSyncStartDate"),e,u;f&&r&&r.instanceAsync("SingleCalendar",function(n){i._startCalendar=n;n.init(f,t);n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);i.setStartDate(n.getTime())})});e=t;u=n.select(".calendarSyncEndDate");u&&r&&r.instanceAsync("SingleCalendar",function(n){i._endCalendar=n;n.init(u,e);n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);i.setEndDate(n.getTime())})})},t.prototype.onStartTimeClick=function(n){n.preventDefault();n.stopPropagation();this.setShowStartCalendarSelector(!this.getShowStartCalendarSelector());this.getShowStartCalendarSelector()&&(this.getShowEndCalendar()||this.setShowEndTimeLink(!0),this.setShowEndCalendarSelector(!1),this._calendarSync.log("C","STC"))},t.prototype.onEndTimeClick=function(n){n.preventDefault();n.stopPropagation();this.setShowEndCalendarSelector(!this.getShowEndCalendarSelector());this.getShowEndCalendarSelector()&&(this.setShowStartCalendarSelector(!1),this.setShowEndTimeLink(!1),this._calendarSync.log("C","ETDD"))},t.prototype.onEndTimeLinkClick=function(n){n.preventDefault();n.stopPropagation();this.getShowEndTimeLink()&&(this.setShowStartCalendarSelector(!1),this.setShowEndTimeLink(!1),this.setShowEndCalendar(!0),this.setShowEndCalendarSelector(!0),this._calendarSync.log("C","ETL"))},t.prototype.onExportClick=function(n){var t=this;n.preventDefault();n.stopPropagation();this.setStartEditingTime(!1);this.setEndEditingTime(!1);this.setShowEndCalendarSelector(!1);this.setShowStartCalendarSelector(!1);this.setShowEndCalendar(!0);this.setShowEndTimeLink(!1);this._calendarSync.log("S",this.getCalendarType().value.toString(),this._calendarSync.getEntityInfoForLogging());this._calendarSync.logIn(this.getCalendarType().value,function(){var r=t.getStartDate()+t.getStartTime()*1e3,n=t.getEndDate()+t.getEndTime()*1e3,u,f;t._displayLocalTime&&(r-=(t._utcOffset-t._userUtcOffset)*t.OneMinute,n-=(t._utcOffset-t._userUtcOffset)*t.OneMinute);t.getIsAllDayEvent()&&(t._utcOffset?(r+=t._utcOffset*t.OneMinute,n+=t._utcOffset*t.OneMinute):t._userUtcOffset&&(r+=t._userUtcOffset*t.OneMinute,n+=t._userUtcOffset*t.OneMinute),n+=t.TwentyFourHours);u=new Date(r);f=new Date(n);r>=n?(t._updateCalendarText(a._formatString(i.L_CalendarSync_StartEndDateError),!1,!0),t._calendarSync.log("ERR",t.getCalendarType().value.toString(),"Start Date greater End Date Mismatch")):t._calendarSync.createEvent(u,f,t.getIsAllDayEvent(),t._calendarSync.entity,function(){t.getCalendarType().value!==2?t._updateCalendarText(a._formatString(i.L_CalendarSync_Message,t.getCalendarType().text),!0):t._updateCalendarText(a._formatString(i.L_CalendarSync_ICS_Downloaded),!0)},function(){t._updateCalendarText(a._formatString(i.L_CalendarSync_APIErrorMessage),!1,!0);t._calendarSync.log("ERR",t.getCalendarType().value.toString(),"Login Failed")})},function(){t._updateCalendarText(a._formatString(i.L_CalendarSync_LoginErrorMessage),!1,!0)})},t.prototype._updateCalendarText=function(n,t,i){this._message.set_html(a._formatString(n));(t||i)&&(t?this._message.remove_class("failureMessage").add_class("successMessage"):this._message.remove_class("successMessage").add_class("failureMessage"));this._showHideMessage(!0)},t.prototype._onLabelClick=function(n){n.stopPropagation();n.preventDefault();this._calendarSync.getPermalink();this._container&&this._showHideCalendarSyncControl(this._container.get_style("display")==="none");this._showHideMessage(!1);this._calendarSync.preAuth();this._calendarSync.log("A")},t.prototype._setDateAndTime=function(n,t,i){var r=new Date(n),u,f;i&&r.setHours(r.getHours()+1,0,0,0);u=r.getHours()*3600+r.getMinutes()*60+r.getSeconds()*60;t?this.setEndTime(u):this.setStartTime(u);r.setHours(0,0,0,0);f=r.getTime();t?this.setEndDate(f):this.setStartDate(f);this._calendarSync.entity.setDateTime(n)},t.prototype.getStartDateTime=function(){return this.getStartDate()+this.getStartTime()*1e3},t.prototype._prePopulateCalendarTypeDropdowns=function(){this.calendarTypes=[{text:i.L_CalendarSync_Outlook,value:0},{text:i.L_CalendarSync_Google,value:1},{text:i.L_CalendarSync_OutlookDesktop,value:2}];this.setCalendarType({text:i.L_CalendarSync_Outlook,value:0})},t.prototype._showHideCalendarSyncControl=function(n){this._container&&this._container.set_style({display:n?"block":"none"});var t="expandArrow",i="collapseArrow";n?(this._label.add_class(i),this._label.remove_class(t)):(this._label.add_class(t),this._label.remove_class(i))},t.prototype._showHideMessage=function(n){this._message.set_style({display:n?"inline":"none"})},t.getDate=function(n,i){return new Date(t.getDateInMilliseconds(n,i))},t.getDateInMilliseconds=function(n,t){return n+t*1e3},t.formatDateTimeString=function(n,t,i){return i?a._formatLongDateString(new Date(n)):a._formatLongDateString(new Date(n))+" "+a._formatUTCTimeString(new Date(t*1e3))},t.getTimeInSeconds=function(n){return n.getHours()*3600+n.getMinutes()*60+n.getSeconds()},t}(at),wr=function(){function n(n,t,i,r,u,f){var e=this;this.APIs={};n.getContainer()&&n.getContainer().instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"}],function(u){e.permalinkAPI=u.Permalink;e.taskManager=u.TaskManager;t&&(e._calendarSyncViewModel=f?new ci(e,n,t,i,r,f.getDateTime(),f.getEndDateTime(),f.getUtcOffset(),f.getIsAllDayEvent(),!0):new ci(e,n,t,i,r))});this.map=n;this.entity=f;this.taskId=u;d.saveIntoCalendar&&(this.APIs[1]=ff.getInstance(this),this.APIs[2]=ef.getInstance(this),this.APIs[0]=uf.getInstance(this))}return n.prototype.logOut=function(){this.selectedAPI.logOut()},n.prototype.logIn=function(n,t,i){this.selectedAPI=this.APIs[n];this.currentCalendarType=n;this.selectedAPI&&(this.selectedAPI.loggedIn?t():this.selectedAPI.logIn(t,i))},n.prototype.preAuth=function(n,t){this.APIs[0].preAuth(n,t)},n.prototype.getPermalink=function(){var n=this;this.permalinkAPI.getGeneralPermalink(this.map,function(t){if(t){var i=t.permalink;n._permalink=i.toLowerCase().indexOf("form=")!=-1?i.replace(/(form=).*?(&|$)/,"$1"+d.formCode+"$2"):i+"&form="+d.formCode;n.permalinkAPI.shorten(function(t){t&&(n._shortLink=t)},function(){n.log("ERR","Permalink Shortening","Error while shortening permalink");n._shortLink=null},null,d.formCode)}},function(){n.log("ERR","Permalink Generation","Error while building permalink");n._permalink=d.defaultPermalink},null,!0)},n.prototype.createEvent=function(n,t,r,u,f,e){var s,h,o;if(u){s=u.getTitle();s||(s=u.getAddress());h=u.getAddress();h||(h=u.getTitle());o=new tf;o.title=s;o.location=h;var c=this._shortLink?this._shortLink:this._permalink,l=null,a=null;switch(this.currentCalendarType){case 0:l=i.L_CalendarSync_EventMessage_HTML;a='<a href=\\"'+c+'\\">'+c+"<\/a>";break;case 1:l=i.L_CalendarSync_EventMessage_PlainText;a=c;break;default:case 2:l=i.L_CalendarSync_EventMessage;a=c}o.description=l.replace("{0}",u.getTitle())+a;r?(o.eventStart=n.toISOString().substring(0,10),o.eventEnd=t.toISOString().substring(0,10),o.isAllDayEvent=!0):(o.eventStart=n.toISOString(),o.eventEnd=t.toISOString(),o.isAllDayEvent=!1);this.selectedAPI.createOrUpdateEvent(o,f,e)}},n.prototype.getStartDateTime=function(){var n;return this._calendarSyncViewModel&&(n=this._calendarSyncViewModel.getStartDateTime()),n},n.prototype.getEntityInfoForLogging=function(){var n=[];return this.entity&&(n.push(this.entity.id?this.entity.id:""),n.push(this.entity.entitySource.toString()),n.push(this.entity.getSegmentTypes()?this.entity.getSegmentTypes().join("~"):"")),n.join("|")},n.prototype.log=function(n,t,i){var r={logData:{feature:"CAL",action:n,data:{}}};switch(n){case"ERR":r.logData.data.TYP=t;r.logData.data.Error=i;break;case"C":r.logData.data.TYP=t;break;case"S":r.logData.data.TYP=t;r.logData.data.EntityInfo=i}f.invokeHandler(u.instrumentationDataHandlerKey,r)},n}(),of='<div class="{Binding primitive.mapTypeClass}" data-tag="transientLensRoot">    <div id="transientLens" event:click="clickHandler" event:touchend="clickHandler" event:keydown="clickHandler" data-tag="transientLens" style="visibility:hidden;">        <div class="transientLensImg"><\/div>        <div class="transientLensActions">                        <ItemsControl ItemsSource="{Binding primitive.entity.actions}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <a href="#" class="{Binding cssClass}" event:click="handler" event:touchend="handler" event:keydown="handler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" data-instrumentation="{Binding instData}" data-tag="{Binding cssClass}">                                <div class="icon" ><\/div>                                <div class="actionText">                                    <TextBlock Text="{Binding text}" />                                <\/div>                                <div class="{Binding secTextClass}" style:display="{Binding showSecText Converter=boolToDisplay}"  event:click="secTextLinkHandler" event:touchend="clickHandler" data-tag="{Binding secTextClass}">                                    <TextBlock Text="{Binding secText}"/>                                <\/div>                                <div class="arrow" style:display="{Binding showArrow Converter=boolToDisplay}"><\/div>                            <\/a>                            <div class="transientLensSeparator" style:display="{Binding showSeparator Converter=boolToDisplay}"><\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>        <div class="directionsPopOut" data-tag="directionsPopOut">        <\/div>        <div class="travelPopOut" data-tag="travelPopOut">        <\/div>        <div class="collectionsPopOut" data-tag="collectionsPopOut">        <\/div>        <div class="nearbyPopOut" data-tag="nearbyPopOut">        <\/div>    <\/div><\/div>',sf='<div class="bm_filtersBar" data-tag="filtersBar" role="search" aria-label="{Binding resources.L_Landmark_FiltersBar_Aria_Label}">    <ItemsControl ItemsSource="{Binding _filtersViewModels}">        <ItemsControl.Template>            <DataTemplate>                <ul class="filters"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="filter" data-tag="filter">                    <a href="#" class="{Binding filterItem.cssClass}" data-instrumentation="{Binding filterItem.instrumentationData}" event:click="clickHandler" role="button"><TextBlock text="{Binding filterItem.displayName}" /><\/a>                    <div class="{Binding filterItem.cssClass}"><div class="routesPopOut"><\/div><\/div>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <a href="#" class="expandFiltersButton" role="button"><\/a><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),tr=function(n){function t(i,r,u){var f=this;return f=n.call(this,{},r,sf)||this,t._initializeFilterItemTemplates(),f._eventHandlers=[],f._filtersBar=i,f.filterOptionClicked=new v,f._createFiltersViewModels(),f._expansionState=u||{isExpanded:!1},f._processExpansionState(),f}return e(t,n),t.prototype.unselectItem=function(n){for(var i,t=0;t<this._filtersViewModels.length;t++)if(i=this._filtersViewModels[t],n.id===i.filterItem.id){i.filterItem.unselectAllOptions();i.refresh();break}},t.prototype.dispose=function(){this._eventHandlers.forEach(function(n){n.item.remove_event(n.eventName,n.handler)});this._eventHandlers=[]},t._initializeFilterItemTemplates=function(){t._filterItemTemplates[2]=eu;t._filterItemTemplates[1]=ou;t._filterItemTemplates[0]=si},t._resolveFilterItemTemplate=function(n){var i=t._filterItemTemplates[n.filterType];return i?i:(fi.logDebugData("There's no template defined for filter type: "+n.filterType+", returning ListDropdownTemplate as default one."),si)},t.prototype._processExpansionState=function(){var n=this,t=this._getExpandButton(),i;if(!this._isExpandable()){this._expansionState.isExpanded=!1;t&&t.length===1&&t.removeFromParent();return}this._synchronizeExpansionStateWithView();i=function(t){t.preventDefault();n._expansionState.isExpanded=!n._expansionState.isExpanded;n._synchronizeExpansionStateWithView();n._logExpandButtonClick(n._expansionState.isExpanded)};t.add_event("click",i);this._addEventsToEventList(t,"click",i)},t.prototype._getExpandButton=function(){var n="a[class="+t._expandButtonCssClass+"]";return this.getControl().select(n)},t.prototype._synchronizeExpansionStateWithView=function(){var n=this._getExpandButton(),r=this.getControl();this._expansionState.isExpanded?(r.add_class(t._filtersBarExpandedCssClass),n.set_text(i.L_FiltersBar_Less_Text)):(r.remove_class(t._filtersBarExpandedCssClass),n.set_text(i.L_FiltersBar_More_Text))},t.prototype._isExpandable=function(){return this._filtersViewModels.length>=t._expandButtonThreshold},t.prototype._logExpandButtonClick=function(n){var t={logData:{feature:vt.FiltersBar,action:y.Expanded,data:{ED:n}}};f.invokeHandler(u.instrumentationDataHandlerKey,t)},t.prototype._createFiltersViewModels=function(){var r=this,n;for(this._filtersViewModels=[],this._filtersBar.getItems().forEach(function(n){if(n.options.length>0){var i=new df(n,t._resolveFilterItemTemplate(n));i.filterOptionClicked.add(function(n){r.filterOptionClicked.invoke(n)});r._filtersViewModels.push(i)}}),n=0;n<this._filtersViewModels.length;n++){var i=this._filtersViewModels[n],u=i.filterItem,f=this.getControl().select("a."+u.cssClass),e=this.getControl().select("div."+u.cssClass);i.setViewModelData(e,f);this._addFilterButtonClickHandler(f,i)}},t.prototype._addFilterButtonClickHandler=function(n,t){var i=function(n){return t.filterButtonButtonClicked(n)};n.add_event("click",i);this._addEventsToEventList(n,"click",i)},t.prototype._addEventsToEventList=function(n,t,i){this._eventHandlers.push({item:n,eventName:t,handler:i})},t._filterItemTemplates={},t._expandButtonCssClass="expandFiltersButton",t._expandButtonThreshold=4,t._filtersBarExpandedCssClass="Expanded",t}(at),hf='<div class="bm_filtersStatusBar" data-tag="filtersStatusBar" aria-label="{Binding resources.L_Landmark_FiltersBar_Aria_Label}" style:display="{Binding isVisible Converter=boolToDisplay}">    <ItemsControl ItemsSource="{Binding selectedItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="filtersStatus"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="{Binding cssClass}" data-tag="filterStatus">                    <div><TextBlock Text="{Binding id Converter=itemToString}" /><\/div>                    <a href="#" class="{Binding id}" data-instrumentation="{Binding instrumentationData}" event:click="onDiscardFilterItemSelection" role="button"><\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ir=function(n){function t(t,i){var r=this,u={};return r=n.call(this,u,i,hf)||this,u.defineProperty("selectedItems",function(n,t){r.setIsVisible(t.length>0)}),u.defineProperty("isVisible"),r.setSelectedItems(t.getSelectedItems()),r.filterItemDiscardedFromSelection=new v,r}return e(t,n),t.prototype.onDiscardFilterItemSelection=function(n){n.stopPropagation();n.preventDefault();var t=r(n.target).get_attr("class"),u=this._getItemById(t),i=this.getSelectedItems().slice();i.splice(this._getItemIndex(t),1);this.setSelectedItems(i);this.filterItemDiscardedFromSelection.invoke(u)},t.prototype.itemToString=function(n){if(n){var t=this._getItemById(n);return t.displaySelection()}return""},t.prototype._getItemById=function(n){var t=this._getItemIndex(n);return t==-1?null:this.getSelectedItems()[t]},t.prototype._getItemIndex=function(n){for(var i,t=0;t<this.getSelectedItems().length;t++)if(i=this.getSelectedItems()[t],n===i.id)return t;return-1},t}(at),cf=function(){function n(n,t){var i=this;this._items=[];n.forEach(function(n){i.addItem(n)});this._isAlongTheRouteItemSupported=t||!1}return n.prototype.getItems=function(){return this._items.slice()},n.prototype.isAlongTheRouteItemSupported=function(){return this._isAlongTheRouteItemSupported},n.prototype.getItemsNumber=function(){return this._items.length},n.prototype.getItemAt=function(n){return this._checkRange(n),this._items[n]},n.prototype.addItem=function(n){this._items.push(n)},n.prototype.addItemAt=function(n,t){if(t<0||t>this._items.length)throw"Index ["+t+"] is out of bound, must be in [0, "+this._items.length+"] range!";this._items.splice(t,0,n)},n.prototype.removeItemAt=function(n){return this._checkRange(n),this._items.splice(n,1)[0]},n.prototype._checkRange=function(n){if(n<0||n>=this._items.length)throw"Index ["+n+"] is out of bound, must be in [0, "+this._items.length+") range!";},n.prototype.removeItem=function(n){var t=this.indexOf(n);return t>=0?(this.removeItemAt(t),!0):!1},n.prototype.clear=function(){this._items=[]},n.prototype.indexOf=function(n){for(var t=0;t<this._items.length;t++)if(n.id===this._items[t].id)return t;return-1},n.prototype.hasSelectedOptions=function(){for(var n=0;n<this._items.length;n++)if(this._items[n].hasSelectedOptions())return!0;return!1},n.prototype.getItemById=function(n){for(var t=0;t<this._items.length;t++)if(n===this._items[t].id)return this._items[t];return null},n.prototype.getSelectedItems=function(){var n=[];return this._items.forEach(function(t){t.hasSelectedOptions()&&n.push(t)}),n},n.prototype.applyHistograms=function(t){var u=this,i,r;if(t){for(this._isAlongTheRouteItemSupported=t._isAlongTheRouteItemSupported,i=this.getItemsNumber()-1;i>=0;i--)r=this.getItemAt(i),r.id!==n.AlongTheRouteItemId&&this.removeItemAt(i);t._items.forEach(function(n){u.addItem(n)})}},n.AlongTheRouteItemId="AlongTheRoute",n}(),lf=function(){function n(n,t,i,r,u,f){this.id=n;this.cssClass=t;this.displayName=i;this.filterType=r;this.options=[];this.selectionRenderer=f;this.instId=u;this.instrumentationData=this._createInstrumentationData(this.instId)}return n.prototype.getSelectedOptions=function(){for(var t=[],n=0;n<this.options.length;n++)this.options[n].isSelected&&t.push(this.options[n]);return t},n.prototype.hasSelectedOptions=function(){for(var n=0;n<this.options.length;n++)if(this.options[n].isSelected)return!0;return!1},n.prototype.isEnabled=function(){if(this.options.length==0)return!1;for(var n=0;n<this.options.length;n++)if(this.options[n].isEnabled)return!0;return!1},n.prototype.addAllOptions=function(n){var t=this;return n.forEach(function(n){t.addOption(n)}),this},n.prototype.addOption=function(n){return this.options.push(n),n.item=this,this},n.prototype.removeOptionAt=function(n){if(n<0||n>=this.options.length)throw"Index ["+n+"] of option to remove is out of bound, must be in (0, "+this.options.length+"] range!";return this.options.splice(n,1)[0]},n.prototype.getOptionByValue=function(n){for(var t=0;t<this.options.length;t++)if(n==this.options[t].value)return this.options[t];return null},n.prototype.equals=function(n){if(!n)return!1;if(n==this)return!0;if(this.id!==n.id||this.options.length!=n.options.length)return!1;for(var t=0;t<this.options.length;t++)if(this.options[t].value!=n.options[t].value||this.options[t].label!=n.options[t].label)return!1;return!0},n.prototype.applySelection=function(n){var i,t,r;if(this.id!=n.id)throw"Filter items id missmatch "+this.id+"/"+n.id+"! Selection could not be applied!";for(i=0;i<this.options.length;i++)t=this.options[i],r=n.getOptionByValue(t.value),r&&(t.isSelected=r.isSelected,t.isEnabled=t.isEnabled||t.isSelected)},n.prototype.displaySelection=function(){return this.selectionRenderer?this.selectionRenderer(this):this.getSelectedOptions().map(function(n){return n.label}).join(", ")},n.prototype.unselectAllOptions=function(){for(var n=0;n<this.options.length;n++)this.options[n].isSelected=!1},n.prototype.prune=function(){for(var t,n=this.options.length-1;n>=0;n--)t=this.options[n],t.isEnabled||this.removeOptionAt(n)},n.prototype.clear=function(){this.options=[]},n.prototype.hasOptions=function(){return this.options&&this.options.length>0},n.prototype._createInstrumentationData=function(n){var t={logData:{feature:vt.FiltersBar,action:y.Clicked,data:{FT:n}}};return r.Internals.stringify(t)},n}(),af=function(){function n(n,t,i,r,u){this.value=n;this.label=t;this.augmentation=i||"";this.isSelected=r||!1;this.isEnabled=typeof u=="undefined"?!0:u}return n}(),vf=function(){function n(n){this._controlTemplateFactory=n;this._filtersBarViewModelExpansionState={isExpanded:!1};this.filterOptionClicked=new v;this.filtersBarRecreated=new v;this.filterItemDiscardedFromSelection=new v}return n.prototype.update=function(n,t){var i=this;this.dispose();this._control=t;t.getParent().remove_class("withFilters");t.clear();n&&n.getItemsNumber()>0&&(this._filtersBarViewModel=new tr(n,this._controlTemplateFactory,this._filtersBarViewModelExpansionState),this._filtersBarViewModel.filterOptionClicked.add(function(t){i._filtersStatusBarViewModel.setSelectedItems(n.getSelectedItems());i.filterOptionClicked.invoke(t)}),t.append(this._filtersBarViewModel.getControl()),this._filtersStatusBarViewModel=new ir(n,this._controlTemplateFactory),this._filtersStatusBarViewModel.filterItemDiscardedFromSelection.add(function(n){i._filtersBarViewModel.unselectItem(n);i.filterItemDiscardedFromSelection.invoke(n)}),t.append(this._filtersStatusBarViewModel.getControl()),t.getParent().add_class("withFilters"),this.filtersBarRecreated.invoke())},n.prototype.disableInteraction=function(){if(this._control){var n=a._createElement("div").add_class("bm_filtersBarModuleOverlay").set_html("&nbsp;");this._control.append(n);Microsoft.Maps.setTimeout(function(){n.append(a._createElement("div").add_class("spinner"))},400)}},n.prototype.enableInteraction=function(){this._control&&this._control.select(".bm_filtersBarModuleOverlay").removeFromParent()},n.prototype.dispose=function(){this._filtersBarViewModel&&this._filtersBarViewModel.dispose();this._filtersStatusBarViewModel&&this._filtersStatusBarViewModel.dispose()},n}(),yf='<div class="signInPopup">    <PopOut Content="{Binding PopOut}">        <PopOut.ContentTemplate>            <DataTemplate>                <div>                    <SignInPopUpControl SignInMessage="{Binding title}" event:signInClicked="onPopOutLinkClick" event:signedIn="onSignedIn"/>                <\/div>            <\/DataTemplate>        <\/PopOut.ContentTemplate>    <\/PopOut><\/div>',rr=function(){function n(){}return n.processResponse=function(n){var u=n&&n.inData&&n.inData.requestState&&n.inData.requestState,t=u&&u.action,i,r;if(n&&n.outData&&n.outData.length!==0){if(i=n.outData&&n.outData[0].data,i.notSignedIn)return 2;if(r=i.actionSucceeded,t===s.SetHome)return r?10:i.favorite?15:i.maxFavorites?16:9;if(t===s.SetWork)return r?12:i.favorite?15:i.maxFavorites?16:11;if(t===s.AddFavorite)return r?8:i.favorite?15:i.maxFavorites?16:7;if(t===s.AddToTemporaryCollection)return r?20:i.favorite?22:7;if(t===s.UpdateEntity)return r?25:7;if(t===s.AddEntity)return r&&i.collections?6:i.failureMessage?24:i.collections?17:3;if(i.collections.length===0){if(t===s.GetAllCollectionNamesAndIds)return 4;if(t===s.GetActiveTasks)return 13}else{if(t===s.GetAllCollectionNamesAndIds)return u.isMove?23:5;if(t===s.GetActiveTasks)return 13}}else return t&&t===s.GetActiveTasks?13:t&&t===s.AddToTemporaryCollection?21:1;return 1},n}(),pf=function(){function n(){this._events=[];this._viewModelInitialized=!1;this.hideParent=new v;this.moveToNewCollection=new v;var n=w.features.collections}return n.prototype.setEntityData=function(n,t,i){this._entity=n;this._options=t;this._rootElement=i},n.prototype.setAddToRouteMode=function(n,t){this._directionsButton=n;this._addToRouteMode=t},n.prototype.setTravelButton=function(n){this._travelButton=n},n.prototype.processDirectionsData=function(n,t){this._showDirectionsPopOut(n.outData,t,n.inData.requestorState)},n.prototype.processCollectionsData=function(n,t){this._showCollectionsPopOut(n,t,n.inData.requestorState)},n.prototype.processTravelData=function(n,t){this._showItineraryPopOut(n.outData,t,n.inData.requestorState)},n.prototype.directionButtonClicked=function(n,t,i,e){n&&n.preventDefault();this._directionsButton=r(n.target);var o={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.directionsTask,requestState:{action:0},requestorState:{location:t,instData:i,entryPoint:e},useActiveTasks:!0};f.invokeHandler(u.taskProcessDataHandlerKey,o)},n.prototype.collectionButtonClicked=function(n,t,i,u){var f,e,o,h,c;n&&n.preventDefault();this._collectionsButton=r(n.target);f=this._entity;e={title:f.getTitle(),address:f.getAddress&&f.getAddress(),location:t,id:f.id};this.entityNickName&&this.entityOriginalName&&(e.nickName=this.entityNickName,e.title=this.entityOriginalName);this.entityDescription&&(e.description=this.entityDescription);o=f.getImageUrl();o&&o.length&&(e.photoUrl=o);h=w.features.collections.enableTemporaryCollection;c=h?s.AddToTemporaryCollection:s.AddFavorite;this._trySaveProcessCall(e,c,i,u,h);this._logData(i)},n.prototype.collectionMenuButtonClicked=function(n,t,i,e,o){var h,c;n&&n.preventDefault();this._collectionsButton=r(n.target);h={action:s.GetAllCollectionNamesAndIds};o&&(h.isMove=!0);c={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.collectionsTask,requestState:h,requestorState:{location:t,instData:i,entryPoint:e}};f.invokeHandler(u.taskProcessDataHandlerKey,c);this._logData(i)},n.prototype.travelButtonClicked=function(n,t,i,e){n&&n.preventDefault();this._travelButton=r(n.target);var o={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.itineraryDetailsTask,requestState:{action:0},requestorState:{location:t,instData:i,entryPoint:e},useActiveTasks:!0};f.invokeHandler(u.taskProcessDataHandlerKey,o)},n.prototype.nearbyButtonClicked=function(n,t,i,u,f,e){var s=this,o,h;n&&n.preventDefault();this._nearbyButton=r(n.target);this._initializeViewModels(null,null,null,t,null,null,null);o=this._rootElement?this._rootElement:r("#transientLens");this._nearbyListDropdownViewModel?(this._nearbyListDropdownViewModel.setAddress(e),this._nearbyListDropdownViewModel.setButtonElement(this._nearbyButton),this._nearbyListDropdownViewModel.setDropdownData(i,t)):(this._nearbyListDropdownViewModel=new hr(i,t,this._nearbyButton,e),this._nearbyControlTemplate=new b(su,{onEntryClicked:function(n){s._nearbyListDropdownViewModel.onEntryClicked(n);s._popOutButtonViewModel.setIsDisplayed(!1)}}));this._popOutButtonViewModel.setPopOutTemplate(this._nearbyControlTemplate);this._popOutButtonViewModel.setAriaLabel(null);this._popOutButtonViewModel.setDropdown(this._nearbyListDropdownViewModel,this._nearbyControlTemplate);this._nearbyButton.add_class("selected");h=o.select("div.nearbyPopOut");h.append(this._popOutElement);this._nearbyListDropdownViewModel.buildCategoryIcons(u,o,f);this._displayPopOut();this._popOutElement.select&&this._popOutElement.select(".popOutTop").set_attr("aria-hidden","false")},n.prototype.hidePopout=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.setIsDisplayed(!1)},n.prototype.dispose=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.dispose()},n.prototype._showDirectionsPopOut=function(n,t,e){if(this._initializeViewModels(n,null,null,e.location,e.instData,null,null),this._directionsListDropdownViewModel.dropdownList.length>1){var o=this._rootElement?this._rootElement:r("#transientLens"),s=o.select("div.directionsPopOut");this._popOutButtonViewModel.setAriaLabel(i.L_DirectionsPopOutAriaLabel);this._updatePopOutListDropdownViewModel(this._directionsListDropdownViewModel);s.append(this._popOutElement);this._displayPopOut();this._popOutElement.select&&this._popOutElement.select(".popOutTop").set_attr("aria-hidden","false")}else this.hideParent.invoke(),f.invokeHandler(u.taskDataHandlerKey,t)},n.prototype._showItineraryPopOut=function(n,t,e){if(this._initializeViewModels(null,n,null,e.location,null,e.instData,null),this._itineraryListDropdownViewModel.dropdownList.length>1){var o=this._rootElement?this._rootElement:r("#transientLens"),s=o.select("div.travelPopOut");this._popOutButtonViewModel.setAriaLabel(i.L_TravelPopOutAriaLabel);this._updatePopOutListDropdownViewModel(this._itineraryListDropdownViewModel);s.append(this._popOutElement);this._displayPopOut();this._popOutElement.select&&this._popOutElement.select(".popOutTop").set_attr("aria-hidden","false")}else this.hideParent.invoke(),f.invokeHandler(u.taskDataHandlerKey,t)},n.prototype._showCollectionsPopOut=function(n,t,r){var u=rr.processResponse(n),r;switch(u){case 2:this._showSignInMessage(r.location);break;case 1:case 4:case 5:case 23:this._showCollectionsList(n.outData[0].data,t,r.location,r.instData,u===23);break;case 3:this._showAddEntityMessage(!1,n.inData.requestState,n.inData.requestorState);break;case 24:this._showAddEntityMessage(!1,n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 6:this._showAddEntityMessage(!0,n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 7:this._showCollectionsMessage(i.L_AddFavoriteFailed);break;case 15:this._showCollectionsMessage(i.L_AddFavoriteExists_Text);break;case 22:this._showCollectionsMessage(i.L_AddTemporaryExists);break;case 16:this._showCollectionsMessage(i.L_TooManyFavorites);break;case 8:this._showAddFavoriteMessage(n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 20:this._showAddTemporaryMessage(n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 21:r=n.inData.requestorState;this._trySaveProcessCall(n.inData.requestState.data,s.AddToTemporaryCollection,r.instData,r.entryPoint);break;case 9:this._showCollectionsMessage(i.L_SetHomeFailed);break;case 10:this._showCollectionsMessage(i.L_SetHomeSucceeded);break;case 11:this._showCollectionsMessage(i.L_SetWorkFailed);break;case 12:this._showCollectionsMessage(i.L_SetWorkSucceeded);break;case 13:this._openCollection(n.inData.requestState,n.inData.requestorState,n.outData);break;case 25:this._showCollectionsMessage(i.L_EntityUpdateSucceeded);break;case 17:this._showAddEntityMessage(!0,n.inData.requestState,n.inData.requestorState,n.outData[0].data)}},n.prototype._showSignInMessage=function(n){this._initializeViewModels(null,null,null,n,null,null,null);var t=this._rootElement?this._rootElement:r("#transientLens"),u=t.select("div.collectionsPopOut");this._collectionsPopOutMessageViewModel.title=i.L_SignInRequired;this._collectionsPopOutMessageViewModel.linkTitle=null;this._collectionsPopOutMessageViewModel.linkData=null;this._collectionsPopOutMessageViewModel.setButtonElement(this._collectionsButton);this._popOutButtonViewModel.setPopOutTemplate(this._signInControlTemplate);this._collectionsButton.add_class("selected");this._popOutButtonViewModel.setPopOut(this._collectionsPopOutMessageViewModel);u.append(this._popOutElement);this._displayPopOut()},n.prototype._showAddEntityMessage=function(n,t,r,u){var e={action:s.GetActiveTasks,collectionId:t.collectionId,data:t.data,entityId:u&&u.entityId},f="",o="",h;n?(t.collectionId&&(f=e.entityId?i.L_SavedCollection.replace("{0}",t.data.title):i.L_EntityPreviouslySaved.replace("{0}",t.data.title)),o=r.title,h={type:l.collectionsTask,requestorType:this._options.requestorType,requestorId:this._options.requestorId,requestState:e,requestorState:r,useActiveTasks:!0}):f=u?u.failureMessage:i.L_SaveFailed.replace("{0}",r.title).replace("{1}",t.data.title);this._showCollectionsMessage(f,o,null,h)},n.prototype._showAddTemporaryMessage=function(n,t,r){var e={action:s.GetActiveTasks,data:n.data,entityId:r&&r.entityId,collectionId:r&&r.collections&&r.collections.length&&r.collections[0].id},u="",o=i.L_AddTemporaryCollectionTitle,f,h;r&&r.entityId&&(u=i.L_AddFavoriteSucceeded.replace("{0}",n.data.title),h=r.taskId,f={type:l.collectionsTask,requestorId:this._options.requestorId,requestorType:this._options.requestorType,requestState:e,requestorState:t,useActiveTasks:!0});this._showCollectionsMessage(u,o,null,f,null,!0)},n.prototype._showAddFavoriteMessage=function(n,t,r){var e={action:s.GetActiveTasks,data:n.data,entityId:r&&r.entityId},u="",f;r.entityId&&(u=i.L_AddFavoriteSucceeded.replace("{0}",n.data.title),f={type:l.collectionsTask,requestorType:this._options.requestorType,requestorId:this._options.requestorId,requestState:e,requestorState:t,useActiveTasks:!0});this._showCollectionsMessage(u,"",null,f)},n.prototype._showCollectionsMessage=function(n,t,u,f,e,o){var h,c,l,s;this._initializeViewModels(null,null,null,null,null,null,null);h=this._rootElement?this._rootElement:r("#transientLens");c=h.select("div.collectionsPopOut");this._collectionsPopOutMessageViewModel.title=n;this._collectionsPopOutMessageViewModel.linkTitle=t||"";this._collectionsPopOutMessageViewModel.editButtonTitle=i.L_EditFavorite_Text;this._collectionsPopOutMessageViewModel.closeButtonTitle=i.L_Dlg_Close;this._collectionsPopOutMessageViewModel.saveButtonTitle=i.L_SaveUpdateButton;this._collectionsPopOutMessageViewModel.updateNicknameMessage=i.L_UpdateNicknameMessage;this._collectionsPopOutMessageViewModel.linkData=u;this._collectionsPopOutMessageViewModel.processOptions=f;this._collectionsPopOutMessageViewModel.activateOptions=e;this._collectionsPopOutMessageViewModel.isTempCollectionMessage=o;this._collectionsPopOutMessageViewModel.setShowLink(u||f||e?!0:!1);f&&f.requestState?(s=f.requestState,this._collectionsPopOutMessageViewModel.entityId=s.entityId,l=s.data&&s.data.nickName):e&&(this._collectionsPopOutMessageViewModel.requestorId=this._options.requestorId,this._collectionsPopOutMessageViewModel.requestorType=this._options.requestorType,this._collectionsPopOutMessageViewModel.entityId=e.state.entityId);this._collectionsPopOutMessageViewModel.setShowAnnotate(!l&&!!t);this._collectionsPopOutMessageViewModel.showFooter=this._collectionsPopOutMessageViewModel.entityId&&this._collectionsPopOutMessageViewModel.entityId.length>0?"":"none";this._collectionsPopOutMessageViewModel.setButtonElement(this._collectionsButton);this._popOutButtonViewModel.setTemplateToPopOutMessage();this._popOutButtonViewModel.setPopOut(null);this._popOutButtonViewModel.setPopOut(this._collectionsPopOutMessageViewModel);c.append(this._popOutElement);this._displayPopOut()},n.prototype._showCollectionsList=function(n,t,e,o,s){if(this._initializeViewModels(null,null,n,e,null,null,o,s),this._collectionsListDropdownViewModel.dropdownList.length>1){var h=this._rootElement?this._rootElement:r("#transientLens"),c=h.select("div.collectionsPopOut");this._popOutButtonViewModel.setAriaLabel(i.L_CollectionsPopOutAriaLabel);this._updatePopOutListDropdownViewModel(this._collectionsListDropdownViewModel);c.append(this._popOutElement);this._displayPopOut();this._popOutElement.select&&this._popOutElement.select(".popOutTop").set_attr("aria-hidden","false")}else f.invokeHandler(u.taskDataHandlerKey,t)},n.prototype._openCollection=function(n,t,i){var e=i&&i.length&&i[0].data,o=e&&e.taskId,r=n.collectionId?s.ViewCollection:s.ViewFavorites,h,c;this._collectionsPopOutMessageViewModel.isTempCollectionMessage&&(r=s.ShowTemporaryCollection);h=n.collectionId?{action:r,collectionId:n.collectionId}:{action:r,entityId:n.entityId};c={action:o?"focus":"activate",id:o,type:l.collectionsTask,state:h};f.invokeHandler(u.taskDataHandlerKey,c)},n.prototype._updatePopOutListDropdownViewModel=function(n){this._popOutButtonViewModel.setDropdown(n)},n.prototype._displayPopOut=function(){var n=this;Microsoft.Maps.setTimeout(function(){if(n._popOutButtonViewModel.setIsDisplayed(!0),n._popOutElement.select){var t=n._popOutElement.select(".dropdownFocusDummy");t&&t.length>0&&t[0].focus()}},0)},n.prototype._initializeViewModels=function(n,t,u,f,e,o,s,h){var c=this;this._viewModelInitialized?(this.entityNickName&&(this._collectionsListDropdownViewModel.entityNickName=this.entityNickName),this.entityOriginalName&&(this._collectionsListDropdownViewModel.entityOriginalName=this.entityOriginalName),this.entityDescription&&(this._collectionsListDropdownViewModel.entityDescription=this.entityDescription),this._directionsListDropdownViewModel.setButtonElement(this._directionsButton),this._directionsListDropdownViewModel.setDropdownData(n,this._entity,f,e),this._itineraryListDropdownViewModel.setButtonElement(this._travelButton),this._itineraryListDropdownViewModel.setDropdownData(t,this._entity,f,o),this._collectionsListDropdownViewModel.setButtonElement(this._collectionsButton),this._collectionsListDropdownViewModel.setDropdownData(u,this._entity,f,this._options.requestorId,this._options.requestorType,s)):(this._directionsListDropdownViewModel=new fr(n,this._entity,f,this._directionsButton,e,this._addToRouteMode),this._collectionsListDropdownViewModel=new or(u,this._entity,f,this._options.requestorId,this._options.requestorType,this._collectionsButton,s,h,this.entityNickName,this.entityOriginalName,this.entityDescription),this._itineraryListDropdownViewModel=new er(t,this._entity,f,this._travelButton,o),this._events.push(this._collectionsListDropdownViewModel.newCollectionCreated.add(function(){c.hideParent.invoke();c._collectionsListDropdownViewModel.isMoveToMenu&&c.moveToNewCollection.invoke()})),this._collectionsPopOutMessageViewModel=new vi(i.L_SignInRequired,null,null,this._collectionsButton),this._signInControlTemplate=new b(yf,{onPopOutLinkClick:function(n){return c._popOutButtonViewModel.onPopOutLinkClicked(n)},onSignedIn:function(){return c._collectionsButton.fireEvent("click")}}),this._popOutButtonViewModel=new ai(this._directionsListDropdownViewModel,this._collectionsPopOutMessageViewModel),this._events.push(this._popOutButtonViewModel.popOutHidden.add(function(){c._directionsListDropdownViewModel!=null&&c._directionsListDropdownViewModel.dropdownList.length>1?c.hideParent.invoke():c._popOutButtonViewModel.isPopOutInListMode()||c._popOutButtonViewModel.getPopOutTemplate()===c._signInControlTemplate||c.hideParent.invoke();c._popOutElement.select&&c._popOutElement.select(".popOutTop").set_attr("aria-hidden","true")})),this._popOutElement=this._popOutButtonViewModel.buildPopOut(),this._popOutElement.getRootElement&&(this._popOutElement=r(this._popOutElement.getRootElement())),this._viewModelInitialized=!0)},n.prototype._logData=function(n){f.invokeHandler(u.instrumentationDataHandlerKey,n)},n.prototype._trySaveProcessCall=function(n,t,i,r,e){var o={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.collectionsTask,requestState:{action:t,data:n},requestorState:{location:location,instData:i,entryPoint:r}};e&&(o.useActiveTasks=!0);f.invokeHandler(u.taskProcessDataHandlerKey,o)},n}(),n;(function(n){n[n.Search=1]="Search";n[n.Directions=2]="Directions";n[n.Streetside=3]="Streetside";n[n.Favorites=4]="Favorites";n[n.Zoom=5]="Zoom";n[n.Menu=6]="Menu";n[n.DirectionsTo=7]="DirectionsTo";n[n.DirectionsFrom=8]="DirectionsFrom";n[n.AddToRoute=9]="AddToRoute";n[n.SaveToCollection=10]="SaveToCollection";n[n.OpenNewCard=11]="OpenNewCard";n[n.Nearby=12]="Nearby";n[n.Coordinates=13]="Coordinates";n[n.SaveWithTempCollection=14]="SaveWithTempCollection";n[n.MoveTo=15]="MoveTo";n[n.Measure=16]="Measure";n[n.editName=17]="editName";n[n.editDescription=18]="editDescription";n[n.deleteName=19]="deleteName";n[n.deleteDescription=20]="deleteDescription";n[n.editHomeWork=21]="editHomeWork";n[n.BirdseyeV2=22]="BirdseyeV2";n[n.hideHomeWork=23]="hideHomeWork";n[n.addToItinerary=24]="addToItinerary"})(n||(n={}));var gt=function(){function t(t,i,u,f){var e=this,o;this._events=[];this._map=t;this._reverseGeocoder=i;o={templateText:of,staticResources:{clickHandler:function(n){return e.clickHandler(n)},boolToDisplay:function(n){return e.boolToDisplay(n)}}};this._controlTemplate=u(o);this._events.push(this._map.viewChanged.add(function(){return e.hide()}));this._events.push(this._map.mapTapped.add(function(){return e.hide()}));this._events.push(this._map.mapZoomStarted.add(function(){return e.hide()}));this._events.push(this._map.primitiveTapped.add(function(){return e.hide()}));this._streetsideBubbleInfo=null;this._hideTransientLensClickHandler=function(n){return e._onClick(n)};r(window).add_event("click,touchend",this._hideTransientLensClickHandler);this._hideTransientLensKeyDownHandler=function(n){return e._onKeyDown(n)};r(window).add_event("keydown",this._hideTransientLensKeyDownHandler);this.actionList=[];this.actionList.push(n.DirectionsTo);this.actionList.push(n.DirectionsFrom);this.actionList.push(n.AddToRoute);this.actionList.push(n.Search);wi&&wi.isEditable&&this.actionList.push(n.addToItinerary);ti&&ti.isEnabled&&this.actionList.push(n.Streetside);a._isFeatureEnabled("birdseyeV2UI")&&!this._map.getMapOptions().disableBirdseye&&this._map.getMapTypes()[k.birdseyeV2]&&this.actionList.push(n.BirdseyeV2);et&&et.isEnabled&&(et.enableTemporaryCollection?this.actionList.push(n.SaveWithTempCollection):(this.actionList.push(n.Favorites),this.actionList.push(n.SaveToCollection)));this.actionList.push(n.Zoom);et&&et.isEnabled&&et.enableMeasuringTool&&this.actionList.push(n.Measure);wt&&wt.contextMenuNearbyCategories.length>0&&this.actionList.push(n.Nearby);this.actionList.push(n.Coordinates);this.invalidateLayer=new v;this.moveToNewCollection=new v;this._buttonGroupViewModel=f;this._events.push(this._buttonGroupViewModel.hideParent.add(function(){return e.hide()}));this._events.push(this._buttonGroupViewModel.moveToNewCollection.add(function(){return e.moveToNewCollection.invoke()}));this._vectorImage=this._getVectorImage();this._ignoreHideEventOnce=!1;this._isDirectionsPopOutVisible=!1;this._isCollectionsPopOutVisible=!1;this._isTravelPopOutVisible=!1;this._isNearbyPopOutVisible=!1;this._populateNearbyCategories();this._adjustmentValueForTop=0;this.signInStateHandler=new hi}return t.prototype.selectorReady=function(){var n=this;return this._templateSelector?this._templateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._templateSelector=t,n._templateSelector.selectorReady()})},t.prototype.getPrimitive=function(){return this._primitive},t.prototype.getActionList=function(){var t=[];return this.actionList.forEach(function(i){t.push(n[i])}),t},t.prototype.setOptions=function(n){this._options=n},t.prototype.processDirectionsData=function(t){var h=this,f,u,r,e,i,o,s,c;if(this._primitive){if(this._directionsListCount=0,f=null,t.outData&&t.outData.length>0){for(u=0,r=0;r<t.outData.length;r++)e=t.outData[r].data,e.routeTitle&&e.mode!==pt.transit&&(f||(f=t.outData[r].processorId),u++),e.activationState===1&&(this._activeDirectionTaskId=t.outData[r].processorId);u>0&&(this._directionsProcessData=t,this._directionsListCount=u,u===1&&(this._addToRouteDirectionTaskId=f))}i=t.inData.requestorState.location;this._populateActions(i);ti&&ti.isEnabled&&this._map.getContainer().instanceAsync("StreetsideMiniBootstrapper",function(n){n.isAvailable(i,function(n){return h._isStreetsideAvailable(n,i)})});this._map.getMapType().id!==k.birdseyeV2&&this.actionList&&this.actionList.indexOf(n.BirdseyeV2)>=0&&(o=void 0,s=this._map.getView(),s&&s.cameraLocation&&(o=i.clone(),o.altitude=s.cameraLocation.altitude),pr.getIsBirdseyeV2Available(this._map.getConfig(),o||i,null,function(n){h._isBirdseyeV2Available(n)},this._map.getViewport()));c=this._buildLogData(y.Activated,{CP:i,AS:this.getActionList()});this._logData(c);this.showOverlay();this._updateOverlayPosition(t.inData.requestorState.args,t.inData.requestorState.preventInvalidate);this._updateEntityData()}},t.prototype.showOverlay=function(){var n={overlayTemplate:this._controlTemplate,overlayEvent:0};ei.hideOverlay(this._map,this._sourcePrimitive);ei.showOverlay(this._map,n,this._primitive)},t.prototype.processCollectionsData=function(n){var t=null,i=n&&n.inData&&n.inData.requestState&&n.inData.requestState,r=i&&i.action;this._primitive&&this._primitive.entity?(t=this._primitive.entity.getMyPlacesTaskOptions(n.inData.requestorState.location),t.state.data.id=this._primitive.entity.id):i.data&&(t=rt.getMyPlacesTaskOptions(n.inData.requestState.data.title,n.inData.requestorState.location),t.state.action=n.inData.requestState.action,t.state.data.id=n.inData.requestState.collectionId);t&&(t.activateOptions={parentId:this._options.requestorId});this._buttonGroupViewModel.processCollectionsData(n,t)},t.prototype.processTravelData=function(n){var t=n.inData.requestorState.location,i=this._primitive.entity.getTravelTaskOptions(t,h.ContextMenu);this._buttonGroupViewModel.processTravelData(n,i)},t.prototype.show=function(n,t){n&&n.preventDefault&&n.preventDefault();this._ignoreHideEventOnce=!1;this._isDirectionsPopOutVisible=!1;this._isCollectionsPopOutVisible=!1;this._isTravelPopOutVisible=!1;this._isNearbyPopOutVisible=!1;this.populatePrimitive(n);this._update(n,t);this.initializeCollections();t||this.invalidateLayer.invoke()},t.prototype.hide=function(){if(this._ignoreHideEventOnce){this._ignoreHideEventOnce=!1;return}this._primitive&&(window.clearTimeout(t._mouseoverDelayHandle),window.clearTimeout(t._copyToClipboardHandle),ei.hideOverlay(this._map,this._primitive),this._reset())},t.prototype.dispose=function(){this._primitive&&this.hide();for(var n=this._events.length-1;n>=0;n--)this._events[n].dispose();this._events=[];r(window).remove_event("click,touchend",this._hideTransientLensClickHandler);r(window).remove_event("keydown",this._hideTransientLensKeyDownHandler);this._categories=[];this._buttonGroupViewModel.dispose()},t.prototype.clickHandler=function(n){n&&n.stopPropagation()},t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype.populatePrimitive=function(n){var s=this,e,r,f;this._primitive&&this._cleanup();var u=n.location,t=n.primitive,o="",i="";t&&t.geometryType===1&&(e=t.crs,r=t.geometry,u=new dt(e.toLatitude(r.x,r.y),e.toLongitude(r.x,r.y)),o=ct.getDisplayName(t.entity),i=ct.getYpid(t.entity),!i&&n.primitive.entity.getBusinesslistingid&&(i=n.primitive.entity.getBusinesslistingid()),this._sourcePrimitive=t);f=new pi(o,"",null);i&&(f.id=i);f.collisionBehavior=2;this._primitive=new oi(u,f,this._vectorImage);this._primitive.bucket=null;this.updateMapQuadrant(this._map,u,n);this._reverseGeocoder&&(this._reverseGeocodingRequestId=this._reverseGeocoder.reverseGeocodeWithNetworkId(u,function(n){return s._processGeocodeResponse(n)}))},t.prototype._cleanup=function(){this._primitive.entity.dispose()},t.prototype._update=function(n,i){this._primitive.mapTypeClass=t._getMapTypeClass(this._map,this._mapQuadrant);this._getDirectionsProcessData(n,i)},t.prototype._updateEntityData=function(){var n=r("#transientLens");this._buttonGroupViewModel.setEntityData(this._primitive.entity,this._options);this._buttonGroupViewModel.setAddToRouteMode(n.select(".directionsAddToRoute"),!0)},t.prototype._buildDirectionsAction=function(t,i,r,u){var c,l;if(this.actionList.indexOf(i)!==-1){var f=this._primitive.entity,e=f.entitySource,o={AN:n[i],CP:t,ID:f.id,EP:h.ContextMenu},s=e?e===1:!1;return s&&(o.AL=s),c=this._buildLogData(y.Clicked,o),l=this._buildActionEventHandlers(t,i,c,r,u),l}return null},t.prototype._buildTravelAction=function(t,i){if(this.actionList.indexOf(i)!==-1){var r=this._primitive.entity,u={AN:n[i],CP:t,ID:r.id,EP:h.ContextMenu},f=this._buildLogData(y.Clicked,u);return this._buildActionEventHandlers(t,i,f)}return null},t.prototype._buildLocalSearchAction=function(t){if(this.actionList.indexOf(n.Search)!==-1&&!(this._primitive&&this._primitive.entity&&this._primitive.entity.isRecommendationEntity)){var i=this._buildLogData(y.Clicked,{AN:n[n.Search],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu});return this._buildActionEventHandlers(t,n.Search,i)}return null},t.prototype.buildLocalDetailAction=function(){return null},t.prototype.buildNearbyAction=function(t){if(this.actionList.indexOf(n.Nearby)!==-1)return this._buildActionEventHandlers(t,n.Nearby,null)},t.prototype._isCardInFocus=function(){return!1},t.prototype.buildStreetsideAction=function(t){if(this.actionList.indexOf(n.Streetside)!==-1){var i=this._buildLogData(y.Clicked,{AN:n[n.Streetside],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu}),r=this._buildActionEventHandlers(t,n.Streetside,i);return this._streetsideBubbleInfo=null,r}return null},t.prototype.buildBirdseyeV2Action=function(t){if(this.actionList.indexOf(n.BirdseyeV2)!==-1){var i=this._buildLogData(y.Clicked,{AN:n[n.BirdseyeV2],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu});return this._buildActionEventHandlers(t,n.BirdseyeV2,i)}return null},t.prototype._buildMyPlacesRelatedActions=function(t,i){if(this.actionList.indexOf(i)!==-1){var r=this._buildLogData(y.Clicked,{AN:n[i],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu});return this._buildActionEventHandlers(t,i,r)}return null},t.prototype.buildMyPlacesEditActions=function(){return null},t.prototype._buildZoomAction=function(t){if(this.actionList.indexOf(n.Zoom)!==-1&&!this._sourcePrimitive){var i=this._buildLogData(y.Clicked,{AN:n[n.Zoom],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu});return this._buildActionEventHandlers(t,n.Zoom,i)}return null},t.prototype._buildMeasureAction=function(t){var i=null,r;return this.actionList.indexOf(n.Measure)!==-1&&(r=this._buildLogData(y.Clicked,{AN:n[n.Measure],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu}),i=this._buildActionEventHandlers(t,n.Measure,r)),i},t.prototype.buildCoordinatesAction=function(t){var e=this,r,u,f,i;return bt.hideCoordinates?null:this.actionList.indexOf(n.Coordinates)!==-1&&this._map.getMapType().id!==k.birdseye?(r=t.latitude.toLocaleString(w.dynamicProperties.market,{minimumFractionDigits:6,maximumFractionDigits:6})+", "+t.longitude.toLocaleString(w.dynamicProperties.market,{minimumFractionDigits:6,maximumFractionDigits:6}),bt.enableCopyLinkInContextMenu?(u=r,f="secTextLink"):(u=p.L_OverlayEntity_Coordinates,f="secText"),i=this._primitive.entity.getGenericAction(u,"coordinates",function(n){n.preventDefault&&n.preventDefault()}),i.showSecText=!0,i.secText=bt.enableCopyLinkInContextMenu?p.L_OverlayEntity_Copy_Coordinates:r,i.secTextClass=f,i.secTextLinkHandler=bt.enableCopyLinkInContextMenu?function(n){return e._copyToClipboardClickEventBuilder(n,t,e._primitive.entity.id)}:null,i):null},t.prototype._buildMenuAction=function(){return null},t.prototype._processMouseOverEvent=function(t,i,r){var f=this,s,c,l,u,e,o;t.preventDefault&&t.preventDefault();t.stopPropagation&&t.stopPropagation();switch(r){case n.AddToRoute:this._directionsListCount>1&&!this._isDirectionsPopOutVisible&&(s=this._buildLogData(y.Focused,{AN:n[n.AddToRoute],CP:i,ID:this._primitive.entity.id,EP:h.ContextMenu}),c=this._primitive.entity.getDirectionTaskOptions(i,h.ContextMenu),this._directionsProcessData.inData.requestorState.instData=s,this._isDirectionsPopOutVisible=!0,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,this._buttonGroupViewModel.processDirectionsData(this._directionsProcessData,c));break;case n.addToItinerary:this._isTravelPopOutVisible||(l=this._buildLogData(y.Focused,{AN:n[n.addToItinerary],CP:i,ID:this._primitive.entity.id,EP:h.ContextMenu}),this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!0,this._isNearbyPopOutVisible=!1,this._processTravelEvent(t,i,l));break;case n.SaveToCollection:this._isCollectionsPopOutVisible||(this._hidePopOut(t),this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!0,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,u=this._buildLogData(y.Clicked,{AN:n[n.SaveToCollection],CP:i,ID:this._primitive.entity.id,EP:h.ContextMenu}),this._processCollectionsEvent(t,i,u,!0));break;case n.SaveWithTempCollection:this._isCollectionsPopOutVisible||(this._hidePopOut(t),this.signInStateHandler.getIsSignedIn()&&(this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!0,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,u=this._buildLogData(y.Clicked,{AN:n[n.SaveWithTempCollection],CP:i,ID:this._primitive.entity.id,EP:h.ContextMenu}),this._processCollectionsEvent(t,i,u,!0)));break;case n.MoveTo:this._isCollectionsPopOutVisible||(this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!0,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,u=this._buildLogData(y.Clicked,{AN:n[n.MoveTo],CP:i,ID:this._primitive.entity.id,EP:h.ContextMenu}),this._processCollectionsEvent(t,i,u,!0,!0));break;case n.Nearby:this._isNearbyPopOutVisible||(this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!0,e=this._primitive.mapTypeClass.indexOf("Dark")!==-1?!0:!1,o=this._primitive.entity.getTitle(),this._templateSelector?this._buttonGroupViewModel.nearbyButtonClicked(t,i,this._categories,this._templateSelector,e,o):this.selectorReady().then(function(){f._buttonGroupViewModel.nearbyButtonClicked(t,i,f._categories,f._templateSelector,e,o)}));break;default:this._hidePopOut(t)}},t.prototype._processMouseOutEvent=function(n){n&&n.preventDefault&&n.preventDefault();window.clearTimeout(t._mouseoverDelayHandle)},t.prototype._openCardButtonClicked=function(n,t){var o,s,y;n&&n.preventDefault();var r=this._sourcePrimitive&&this._sourcePrimitive.entity,c=ct.getYpid(r),a=ct.getTransitJson(r),v=u.taskDataHandlerKey,i,e;c?(i={id:c,taskTitle:ct.getDisplayName(r),entryPoint:h.ContextMenu},e=l.localDetailsTask):a?(o=JSON.parse(a),o.stops&&o.stops.length&&(s=this._primitive.getLocation(),i={id:o.stops[0].id,title:o.stops[0].name,location:s},e=l.transitStopTask)):ct.isTransitEntity(r)&&(s=this._primitive.getLocation(),i={id:r.id,title:r.title,location:s},e=l.transitStopTask);i||(y=this._primitive.geometry.y+","+this._primitive.geometry.x,v=u.taskProcessDataHandlerKey,i={query:y,taskTitle:this._primitive.entity.getTitle(),entryPoint:h.ContextMenu},e=l.localSearchTask);this._logData(t);this.hide();f.invokeHandler(v,{requestState:i,state:i,type:e})},t.prototype.updateMapQuadrant=function(n,t,i,r){var s=n.getViewport(),u=n.getViewportPadding(),h=s.pixelWidth-u.left-u.right,l=s.pixelHeight-u.top-u.bottom,o=this.getRightClickPoint(n,t,i),f,e;f=r?o.x-u.left+r>h:o.x-u.left>h/2;e=o.y-u.top<l/2;this._mapQuadrant=e&&f?c.TopRight:e&&!f?c.TopLeft:!e&&f?c.BottomRight:c.BottomLeft},t.prototype.getRightClickPoint=function(n,t){return n.getMode().tryLocationToPoint(t)},t.prototype._getVectorImage=function(){return{hitTest:1,hotspotX:0,hotspotY:0,records:[{centerX:0,centerY:0,radiusX:20,radiusY:20,style:{},vectorType:2}]}},t.prototype._buildLogData=function(n,t){return{logData:{feature:vt.ContextMenu,action:n,data:t}}},t.prototype._logData=function(n){f.invokeHandler(u.instrumentationDataHandlerKey,n)},t.prototype.initializeCollections=function(){if(this.signInStateHandler.getIsSignedIn()){var n={action:s.GetAllCollectionNamesAndIds},t={requestorType:"TransientLens",type:l.collectionsTask,requestState:n};f.invokeHandler(u.taskProcessDataHandlerKey,t)}},t._getMapTypeClass=function(n,t){var i;switch(n.getMapType().id){case k.road:case k.roadVector1:case k.roadVector2:i="Light";break;case k.aerial:case k.birdseye:i="Dark";break;default:i="Light"}return i+(" "+c[t])},t.prototype.buildOverlaySearchAction=function(n){var u=this,i=this._primitive.entity,f=this._sourcePrimitive&&this._sourcePrimitive.entity,r=function(i){window.clearTimeout(t._mouseoverDelayHandle);u._openCardButtonClicked(i,n)};return f?i.getLocalListingAction(!1,r):i.getAddPushpinAction(!1,r)},t.prototype._updateOverlayPosition=function(n,i){var u=r("#transientLens"),v;if(u.length!==0){var k=u.select(".transientLensActions"),e=u.select(".directionsPopOut"),y=u.select(".travelPopOut"),s=u.select(".collectionsPopOut"),o=u.select(".nearbyPopOut"),h=u.select("a.nearby").length>0,d=Math.max(e.get_size().width,s.get_size().width,o.get_size().width),g=this._overwriteMapQuadrantUsingMenuWidth(d,n,i),p=t._defaultDirectionPopOutTop,f=u.get_size(),l=f.width,w=f.width,b=f.width,a=f.width;this._mapQuadrant===c.TopRight||this._mapQuadrant===c.BottomRight?(l=t._leftPaddingForActions-e.get_size().width-f.width,w=t._leftPaddingForActions-y.get_size().width-f.width,b=t._leftPaddingForActions-s.get_size().width-f.width,a=t._leftPaddingForActions-o.get_size().width-f.width):g||(l=t._leftPaddingForActions-e.get_size().width,w=t._leftPaddingForActions-y.get_size().width,b=t._leftPaddingForActions-s.get_size().width,a=t._leftPaddingForActions-o.get_size().width);this._mapQuadrant===c.BottomLeft||this._mapQuadrant==c.BottomRight?(p-=f.height-t._bottomPaddingForActions,v=h&&u.select("a.nearby").get_relative_pos().y-20-f.height):v=h&&u.select("a.nearby").get_relative_pos().y-20;e.set_style({top:p+"px",left:l+"px"});y.set_style({left:w+"px"});s.set_style({left:b+"px"});h&&o.set_style({top:v+"px",left:a+"px"});this._updateContextMenuPosition(u,k,i);this._adjustmentValueForTop!==0&&(e.set_style({top:p+this._adjustmentValueForTop+"px",left:l+"px"}),h&&o.set_style({top:+v+this._adjustmentValueForTop+"px",left:a+"px"}))}},t.prototype._updateContextMenuPosition=function(n,i,r){var f=n.get_size(),u=t._topPaddingForBottomQuadrants,e;this._mapQuadrant===c.TopRight?e=-f.width:this._mapQuadrant===c.BottomLeft?u=-f.height+t._topPaddingForBottomQuadrants:this._mapQuadrant===c.BottomRight&&(u=-f.height+t._topPaddingForBottomQuadrants,e=-f.width);i.set_style({position:"relative",top:u+"px",left:e+"px"});this._adjustmentValueForTop=this._getAdjustmentForTop();this._adjustmentValueForTop!==0&&(u+=this._adjustmentValueForTop,i.set_style({position:"relative",top:u+"px",left:e+"px"}),this._updateBucketId(r));n.set_style({visibility:"visible"})},t.prototype._getAdjustmentForTop=function(){var o=r("#transientLens"),t=o.select(".transientLensActions");if(this._mapQuadrant===c.TopLeft||this._mapQuadrant===c.TopRight){var s=t.get_absolute_pos(),i=this._map.getViewportPadding(),u=this._map.getViewport().pixelHeight-(i.top+i.bottom),n=s.y+t.get_size().height;if(n>u)return u-n}else{var n=t.get_absolute_pos().y,f=r(".taskBar"),e=f.get_absolute_pos().y+f.get_size().height;if(e>n)return e-n}return 0},t.prototype._overwriteMapQuadrantUsingMenuWidth=function(n,i,u){var o=this._primitive.getLocation(),s=r("#transientLens").get_size().width,f=this._mapQuadrant,h;this.updateMapQuadrant(this._map,o,i,s);h=r("."+c[f]);f!==this._mapQuadrant&&(h.swap_class(c[f],c[this._mapQuadrant]),this._primitive.mapTypeClass=t._getMapTypeClass(this._map,this._mapQuadrant),this._updateBucketId(u));var l=this._map.getViewport(),e=this._map.getViewportPadding(),a=l.pixelWidth-e.left-e.right,v=this.getRightClickPoint(this._map,o,i);return v.x-e.left+s+n<a?!0:!1},t.prototype._populateActions=function(t){var i,v,y,f,e,o,w,s,h,c,b,l,r,u,k,d,g,nt,tt,it,a,rt,ut;this._primitive.entity&&t&&(i=[],v=this._buildDirectionsAction(t,n.DirectionsTo,p.L_OverlayEntity_DirectionsTo,"directionsTo"),v&&i.push(v),y=this._buildDirectionsAction(t,n.DirectionsFrom,p.L_OverlayEntity_DirectionsFrom,"directionsFrom"),y&&i.push(y),this._directionsProcessData?(f=this._buildDirectionsAction(t,n.AddToRoute,p.L_OverlayEntity_AddToRoute,"directionsAddToRoute"),f?(f.showSeparator=!0,this._directionsListCount>1&&(f.showArrow=!0),i.push(f)):i.length>1&&(i[1].showSeparator=!0)):i.length>1&&(i[1].showSeparator=!0),e=this.buildNearbyAction(t),e&&(e.showSeparator=!0,e.showArrow=!0,i.push(e)),o=this._buildTravelAction(t,n.addToItinerary),o&&(o.showArrow=!0,o.showSeparator=!0,i.push(o)),this._primitive.entity.isRecommendationEntity||(w=this._buildMyPlacesRelatedActions(t,n.Favorites),w&&i.push(w),s=this._buildMyPlacesRelatedActions(t,n.SaveToCollection),s&&(s.showSeparator=!0,s.showArrow=!0,i.push(s)),h=this._buildMyPlacesRelatedActions(t,n.SaveWithTempCollection),h&&(h.showSeparator=!0,h.showArrow=this.signInStateHandler.getIsSignedIn()?!0:!1,i.push(h))),c=this._buildMyPlacesRelatedActions(t,n.MoveTo),c&&(c.showSeparator=!0,c.showArrow=!0,i.push(c)),b=this.buildMyPlacesEditActions(n.editName),b&&i.push(b),l=this.buildMyPlacesEditActions(n.editDescription),l&&i.push(l),r=this.buildMyPlacesEditActions(n.deleteName),r&&i.push(r),u=this.buildMyPlacesEditActions(n.deleteDescription),u&&i.push(u),k=this.buildMyPlacesEditActions(n.hideHomeWork),k&&i.push(k),d=this.buildMyPlacesEditActions(n.editHomeWork),d&&i.push(d),r||u||!l?u?u.showSeparator=!0:r&&(r.showSeparator=!0):l.showSeparator=!0,g=this._buildLocalSearchAction(t),g&&i.push(g),nt=this.buildLocalDetailAction(t),nt&&i.push(nt),tt=this.buildStreetsideAction(t),tt&&i.push(tt),it=this.buildBirdseyeV2Action(t),it&&i.push(it),a=this._buildZoomAction(t),a&&i.push(a),rt=this._buildMeasureAction(t),rt&&i.push(rt),ut=this.buildCoordinatesAction(t),ut&&(a&&(a.showSeparator=!0),i.push(ut)),this._primitive.entity.setActions(i))},t.prototype._populateNearbyCategories=function(){var t=this,n;wt.contextMenuNearbyCategories.length>0&&(this._categories=[],wt.contextMenuNearbyCategories.forEach(function(n){var i=n.split(":");i&&i.length===2&&t._categories.push({Name:i[0],Id:i[1]})}),n=w.features,n&&n.transit&&n.transit.isEnabled&&this._categories.push({Name:i.L_Nearby_Transit,Id:hr.nearbyTransitCategoryId}))},t.prototype._buildActionEventHandlers=function(i,r,u,f,e){var s=this,o,h=this._primitive.entity,c;switch(r){case n.Zoom:o=h.getZoomAction(!1,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._zoomButtonClicked(n,i,u)});c=this._map.getMercatorZoomLevel();c<t._streetZoomLevel?o.cssClass="zoomEnabled":c>=t._streetZoomLevel&&(o.cssClass="zoomout",o.text=p.L_OverlayEntity_ZoomOut);break;case n.Measure:o=h.getGenericAction(p.L_OverlayEntity_Measure,"measure",function(n){window.clearTimeout(t._mouseoverDelayHandle);s._measureActionClicked(n,i,u)});break;case n.SaveToCollection:o=h.getGenericAction(p.L_OverlayEntity_SaveAs,"saveas",function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processCollectionsEvent(n,i,u,!0)});break;case n.Favorites:o=h.getMyPlacesAction(!1,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processCollectionsEvent(n,i,u,!1)});break;case n.SaveWithTempCollection:o=h.getMyPlacesAction(!1,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processCollectionsEvent(n,i,u,s.signInStateHandler.getIsSignedIn()?!0:!1)},!0);break;case n.MoveTo:o=h.getMyPlacesAction(!1,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processCollectionsEvent(n,i,u,!0,!0)},!0,!0);break;case n.addToItinerary:o=h.getGenericAction(p.L_OverlayEntity_AddToItineraries,"addToItinerary",function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processTravelEvent(n,i,u)});break;case n.Directions:case n.DirectionsTo:case n.DirectionsFrom:case n.AddToRoute:o=h.getGenericAction(f,e,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processDirectionsEvent(n,i,u,r)});break;case n.Search:o=this.buildOverlaySearchAction(u);break;case n.Streetside:o=h.getStreetsideAction(!0,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._streetsideButtonClicked(n,i,u)});break;case n.BirdseyeV2:o=h.getBirdseyeV2Action(!0,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._birdseyeV2ButtonClicked(n,i,u)});break;case n.Nearby:o=h.getNearbyAction(!1,function(n){window.clearTimeout(t._mouseoverDelayHandle);s._processNearbyEvent(n,i)});break;case n.Menu:default:return null}return this.addMouseHoverHandlers(o,i,r)},t.prototype.addMouseHoverHandlers=function(n,i,r){var u=this;return n.mouseoverHandler=function(n){window.clearTimeout(t._mouseoverDelayHandle);t._mouseoverDelayHandle=Microsoft.Maps.setTimeout(function(){u._processMouseOverEvent(n,i,r)},t._mouseoverTimeout)},n.mouseoutHandler=function(n){return u._processMouseOutEvent(n)},n},t.prototype._processDirectionsEvent=function(t,i,r,e){var o,s,c,l;t&&t.preventDefault&&t.preventDefault();l=this._primitive.entity.getTitle();switch(e){case n.DirectionsTo:o=2;s=this._activeDirectionTaskId;c=this._activeDirectionTaskId?"focus":"activate";break;case n.DirectionsFrom:o=1;s=this._activeDirectionTaskId;c=this._activeDirectionTaskId?"focus":"activate";break;case n.AddToRoute:if(this._directionsListCount===1)o=3,s=this._addToRouteDirectionTaskId,c="focus";else{if(this._isDirectionsPopOutVisible)return;this._processMouseOverEvent(t,i,e);return}break;default:throw"Error action type";}var v=this._primitive.entity.entitySource,y=v?v===1:!1,a=rt.getDirectionTaskOptions(l,i,h.ContextMenu,l,this._primitive.entity.id,o,y);a.id=s;a.action=c;this.hide();f.invokeHandler(u.taskDataHandlerKey,a);this._logData(r)},t.prototype._processTravelEvent=function(n,i,u){n&&n.preventDefault&&n.preventDefault();var f=r("#transientLens"),o=f.select(".transientLensActions"),s=f.select(".travelPopOut"),e,l=f.select(".addToItinerary");e=l.get_relative_pos().y-20;this._buttonGroupViewModel.travelButtonClicked(n,i,u,h.ContextMenu);(this._mapQuadrant===c.BottomLeft||this._mapQuadrant===c.BottomRight)&&(e-=o.get_size().height+t._bottomPaddingForActions);s.set_style({top:e+this._adjustmentValueForTop+"px"})},t.prototype._processNearbyEvent=function(t,i){this._processMouseOverEvent(t,i,n.Nearby)},t.prototype._processCollectionsEvent=function(n,i,u,f,e){var o=r("#transientLens"),v=o.select(".transientLensActions"),y=o.select(".collectionsPopOut"),s,l,a;f?(l=o.select(".saveas"),s=l.get_relative_pos().y-20,this._buttonGroupViewModel.collectionMenuButtonClicked(n,i,u,h.ContextMenu,e)):(a=o.select(".savefavorite"),s=a.get_relative_pos().y-20,this._buttonGroupViewModel.collectionButtonClicked(n,i,u,h.ContextMenu));(this._mapQuadrant===c.BottomLeft||this._mapQuadrant===c.BottomRight)&&(s-=v.get_size().height+t._bottomPaddingForActions);y.set_style({top:s+this._adjustmentValueForTop+"px"})},t.prototype._reset=function(){this._reverseGeocodingRequestId&&nt.abortRequest(this._reverseGeocodingRequestId);this._primitive&&(this._directionsProcessData=null,this._activeDirectionTaskId=null,this._addToRouteDirectionTaskId=null,this._adjustmentValueForTop=0,this._cleanup(),this._primitive=null,this._sourcePrimitive=null,this.invalidateLayer.invoke())},t.prototype._hidePopOut=function(n){(this._isDirectionsPopOutVisible||this._isCollectionsPopOutVisible||this._isTravelPopOutVisible||this._isNearbyPopOutVisible)&&(n&&n.preventDefault&&n.preventDefault(),this._ignoreHideEventOnce=!0,this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,this._buttonGroupViewModel.hidePopout(),this._ignoreHideEventOnce=!1)},t.prototype._streetsideButtonClicked=function(n,t,i){var r=this;n&&n.preventDefault();n&&n.stopPropagation();this._streetsideBubbleInfo&&(this._logData(i),this.hide(),this._map.getContainer().instanceAsync("StreetsideMiniBootstrapper",function(n){n.show(r._streetsideBubbleInfo,{locationToLookAt:t,entryPoint:h.ContextMenu,perfClickToImmersionTimeSource:ru.ContextMenuClickToImmersionTime})}))},t.prototype._birdseyeV2ButtonClicked=function(n,t,i){var r=this;n&&n.preventDefault();n&&n.stopPropagation();this._logData(i);kt.setMapCenter(this._map,t,null,null,new gr(this._map.getView(),new dr(fu.toLocation(t,this._map.getMercatorZoomLevel(),!0))),null,null,{top:0,right:0,bottom:0,left:0});Microsoft.Maps.setTimeout(function(){r._map.setMapType(r._map.createMapType(k.birdseyeV2));r._addContextPoiForBirdseyeV2(t)},1200);this.hide()},t.prototype._addContextPoiForBirdseyeV2=function(n){var t=this;this._map.getBirdseyeV2Manager().then(function(i){var r,u;t._map.getMapType().id===k.birdseyeV2&&(r=t._primitive&&t._primitive.entity&&t._primitive.entity.getTitle(),r?i&&i.addContextPoi(n,r,1):t._reverseGeocoder?t._reverseGeocoder.reverseGeocodeWithNetworkId(n,function(n){u(n)}):t._map.getContainer().instanceAsync("ReverseGeocoder",function(t){t.reverseGeocodeWithNetworkId(n,function(n){u(n)})}),u=function(r){if(t._map.getMapType().id===k.birdseyeV2&&r&&r.success&&r.location&&r.addressList){var u=r.addressList[0].formattedAddress;i&&i.addContextPoi(n,u,1)}})})},t.prototype._measureActionClicked=function(n,t,i){n&&n.preventDefault();this._logData(i);this.hide();var r={location:t},e={type:l.measureMap,state:r};f.invokeHandler(u.taskDataHandlerKey,e)},t.prototype._zoomButtonClicked=function(n,i,r){n&&n.preventDefault();var u=this._map.getMercatorZoomLevel();this._logData(r);u<=t._cityZoomLevel-1?(this.hide(),kt.setMapCenter(this._map,i,t._cityZoomLevel)):u>=t._cityZoomLevel&&u<t._streetZoomLevel?(this.hide(),kt.setMapCenter(this._map,i,t._streetZoomLevel)):u>=t._streetZoomLevel&&(this.hide(),kt.setMapCenter(this._map,i,t._cityZoomLevel))},t.prototype._processGeocodeResponse=function(n){var t,i,u,r;(this._reverseGeocodingRequestId=null,t=this._primitive,t)&&(n&&n.success&&n.location&&n.addressList?i=n.addressList[0].formattedAddress:(u=t.geometry,i=a._formatLatLonString(u.y,u.x)),r=t.entity,r.getTitle()||r.setTitle(i),r.setAddress(i),this._updateBucketId())},t.prototype._updateBucketId=function(n){var t=this._primitive;t.bucket=this._adjustmentValueForTop!==0?this._mapQuadrant===c.TopLeft||this._mapQuadrant===c.BottomLeft?it.bucketIdForTransientLensLeft:it.bucketIdForTransientLensRight:this._mapQuadrant===c.TopLeft||this._mapQuadrant===c.TopRight?it.bucketIdForTransientLensTop:it.bucketIdForTransientLensBottom;t.revision=t.revision||1;n||this.invalidateLayer.invoke()},t.prototype._isStreetsideAvailable=function(n,t){var r=this,i;n&&this._primitive&&this._primitive.geometry.y===t.latitude&&this._primitive.geometry.x===t.longitude&&(this._streetsideBubbleInfo=n,i=this._primitive.entity.getActions(),i.forEach(function(n,t){if(n.getCssClass&&n.getCssClass()==="streetside"){r._primitive.entity.getActions()[t].setCssClass("streetsideEnabled");return}}))},t.prototype._isBirdseyeV2Available=function(n){var i=this,t;n&&this._primitive&&(t=this._primitive.entity.getActions(),t.some(function(n,t){var r=!1;return n.getCssClass&&n.getCssClass()==="birdseyeV2"&&(i._primitive.entity.getActions()[t].setCssClass("birdseyeV2Enabled"),r=!0),r}))},t.prototype._getDirectionsProcessData=function(n,t){var i=this._primitive.getLocation(),r={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.directionsTask,requestState:{action:0},requestorState:{location:i,args:n,preventInvalidate:t},useActiveTasks:!0};f.invokeHandler(u.taskProcessDataHandlerKey,r)},t.prototype._getTravelProcessData=function(n,t){var i=this._primitive.getLocation(),r={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:l.itineraryDetailsTask,requestState:{action:0},requestorState:{location:i,args:n,preventInvalidate:t},useActiveTasks:!0};f.invokeHandler(u.taskProcessDataHandlerKey,r)},t.prototype._onClick=function(n){n.target&&r(n.target.parentElement).has_class("ms-composite")||this.hide()},t.prototype._onKeyDown=function(n){if(n.type==="keydown")[13,27,32,37,38,39,40,61,65,66,72,79,82,107,109,173,187,189].indexOf(n.keyCode)>=0&&this.hide()},t.prototype._copyToClipboardClickEventBuilder=function(i,u,f){var s=document.querySelector("#transientLens .coordinates .actionText"),c,e,o,l;if(window.getSelection&&document.createRange&&bt.enableAutoCopyToClipboard){e=document.createRange();e.selectNodeContents(s);window.getSelection().removeAllRanges();window.getSelection().addRange(e);try{c=document.execCommand("copy")}catch(a){}window.getSelection().removeAllRanges()}o=r("#transientLens .coordinates .secTextLink");o.swap_class("secTextLink","secText");c?(o.set_text(p.L_OverlayEntity_Copy_Succeeded),window.clearTimeout(t._copyToClipboardHandle),t._copyToClipboardHandle=Microsoft.Maps.setTimeout(function(){var n=r("#transientLens .coordinates .secText");n.swap_class("secText","secTextLink");n.set_text(p.L_OverlayEntity_Copy_Coordinates)},t._copyToClipboardTimeout)):(e=document.createRange(),e.selectNodeContents(s),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),o.set_text("Ctrl + C"));l={AN:n[n.Coordinates],CP:u,ID:f,EP:h.ContextMenu};this._logData(this._buildLogData(y.Clicked,l))},t._convertToRGBA=function(n,t){var i=n.replace("#",""),r=parseInt(i.substring(0,2),16),u=parseInt(i.substring(2,4),16),f=parseInt(i.substring(4,6),16);return"rgba("+r+","+u+","+f+","+t+")"},t._copyToClipboardTimeout=1e3,t._cityZoomLevel=11,t._streetZoomLevel=16,t._topPaddingForBottomQuadrants=-8,t._bottomPaddingForActions=-6,t._mouseoverTimeout=350,t._leftPaddingForActions=15,t._defaultDirectionPopOutTop=50,t}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ur=function(n){function t(t,i,r,u,f,e,o){var s=n.call(this,t,i,null,null,null,e)||this;return s._taskDisplayState=r,s._menuUrl=u,s.entitySource=f,s.isRecommendationEntity=!1,s.categoryId=o,s}return e(t,n),t.prototype.getDirectionTaskOptions=function(n,t){var i=this.getDescription()||this.getTitle(),r=this.entitySource==1;return rt.getDirectionTaskOptions(i,n,t,this.getTitle(),this.id,null,r)},t.prototype.getTaskDisplayState=function(){return this._taskDisplayState},t.prototype.getMenuUrl=function(){return this._menuUrl},t}(pi),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),li=function(t){function i(n,i,r){var u=t.call(this,n,null,i,r)||this;return u.updateActionList(),u.poiSelected=new v,u._buildMode=!1,u}return e(i,t),i.prototype.buildMenu=function(n,t,i){this._buildMode=!0;this._buildCallback=i;this.show({primitive:n,item:t},!0)},i.prototype.showOverlay=function(){if(this._buildMode&&this._buildCallback){var n=this._controlTemplate.applyDataTemplate({primitive:this._primitive});this._buildCallback(n)}else t.prototype.showOverlay.call(this);this._buildMode=!1;this._buildCallback=null},i.prototype.populatePrimitive=function(n){this._primitive&&this._cleanup();var r=n.primitive.geometry,u=new dt(r.y,r.x),t=n.primitive.entity,i=new ur(t.getTitle(),t.getDescription(),n.primitive.taskDisplayState,t.getMenuUrl(),t.entitySource,t.getAddress(),t.getSelectedCategoryForIcon&&t.getSelectedCategoryForIcon());i.collisionBehavior=2;i.id=t.id;i.isRecommendationEntity=n.primitive.entity instanceof iu;this._primitive=new oi(u,i,this._getVectorImage());this.updateMapQuadrant(this._map,u,n);this._primitive.bucket=this._mapQuadrant===c.TopLeft||this._mapQuadrant===c.TopRight?it.bucketIdForTransientLensTop:it.bucketIdForTransientLensBottom;this._primitive.taskDisplayState=n.primitive.taskDisplayState},i.prototype.getRightClickPoint=function(n,i,r){if(r&&r.item){var u=r.item.get_absolute_pos();return new tu(u.x,u.y)}return t.prototype.getRightClickPoint.call(this,n,i,r)},i.prototype.updateActionList=function(){this.actionList.push(n.OpenNewCard)},i.prototype._openCardButtonClicked=function(n,t){n&&n.preventDefault();var i={entryPoint:h.ContextMenu,id:this._primitive.entity.id,flippingCard:!0,taskTitle:this._primitive.entity.getTitle(),selectedCategoryId:this._primitive.entity.categoryId};this._logData(t);this.poiSelected.invoke(this._primitive);this.hide();f.invokeHandler(u.taskDataHandlerKey,{type:l.localDetailsTask,state:i,activateOptions:{parentId:this._options.requestorId}})},i.prototype._buildLocalSearchAction=function(n){var i=t.prototype._buildLocalSearchAction.call(this,n);return i&&(i.cssClass=this._isCardInFocus()?"flipcard":"flipcardEnabled"),i},i.prototype.buildLocalDetailAction=function(t){var u=this,i,r;return this.actionList.indexOf(n.OpenNewCard)!==-1||this._primitive&&this._primitive.entity&&this._primitive.entity.isRecommendationEntity?(i=this._buildLogData(y.Clicked,{AN:n[n.OpenNewCard],CP:t,ID:this._primitive.entity.id,EP:h.ContextMenu}),r=this._primitive.entity.getLocalDetailsAction(!1,function(n){window.clearTimeout(gt._mouseoverDelayHandle);u.openNewCardButtonClicked(n,i)}),this.addMouseHoverHandlers(r,t,n.OpenNewCard)):null},i.prototype.buildStreetsideAction=function(n){return this._buildMode?null:t.prototype.buildStreetsideAction.call(this,n)},i.prototype._buildZoomAction=function(n){return this._buildMode?null:t.prototype._buildZoomAction.call(this,n)},i.prototype.buildOverlaySearchAction=function(n){var t=this;return this._primitive.entity.getLocalListingAction(!1,function(i){window.clearTimeout(gt._mouseoverDelayHandle);t._openCardButtonClicked(i,n)})},i.prototype.openNewCardButtonClicked=function(n,t){n&&n.preventDefault();var i={entryPoint:h.ContextMenu,listingTaskId:this._options.requestorId,id:this._primitive.entity.id,openingNewCard:!0,taskTitle:this._primitive.entity.getTitle(),selectedCategoryId:this._primitive.entity.categoryId},r=this._primitive.taskDisplayState.colorIndex;this._logData(t);this.hide();f.invokeHandler(u.taskDataHandlerKey,{type:l.localDetailsTask,state:i,activateOptions:{taskColorIndex:r,groupName:this._options.requestorId}})},i}(gt),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wf=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return e(t,n),t.prototype.updateActionList=function(){},t.prototype._isCardInFocus=function(){var n=this._primitive.entity.getTaskDisplayState();return n&&n.activationState&&n.activationState===1?!0:!1},t.prototype._openCardButtonClicked=function(n,t){(n&&n.preventDefault(),this._isCardInFocus())||(this._logData(t),this.hide(),f.invokeHandler(u.taskDataHandlerKey,{action:"focus",id:this._options.requestorId}))},t}(li),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),bf=function(t){function i(n,i,r){var u=t.call(this,n,i,r)||this;return u.editEvent=new v,u}return e(i,t),i.prototype.updateActionListWithMoveTo=function(){var i,t;if(this.signInStateHandler.getIsSignedIn()&&this.actionList){for(i=!1,t=0;t<this.actionList.length;t++)this.actionList[t]===n.MoveTo&&(i=!0);i||this.actionList.push(n.MoveTo)}},i.prototype.updateActionListWithEdits=function(t,i){this.updateActionList();this.actionList.push(n.editName);this.actionList.push(n.editDescription);t&&this.actionList.push(n.deleteName);i&&this.actionList.push(n.deleteDescription)},i.prototype.updateActionListWithHomeWorkEdit=function(){this.actionList=[];this.actionList.push(n.DirectionsTo);this.actionList.push(n.DirectionsFrom);this.actionList.push(n.AddToRoute);this.actionList.push(n.OpenNewCard);this.actionList.push(n.editHomeWork);this.actionList.push(n.hideHomeWork)},i.prototype.updateActionListForEvent=function(){this.actionList=[];this.actionList.push(n.DirectionsTo);this.actionList.push(n.DirectionsFrom);this.actionList.push(n.AddToRoute);this.actionList.push(n.OpenNewCard)},i.prototype.updateActionList=function(){this.actionList=[];this.actionList.push(n.DirectionsTo);this.actionList.push(n.DirectionsFrom);this.actionList.push(n.AddToRoute);this.actionList.push(n.OpenNewCard);this.signInStateHandler.getIsSignedIn()&&this.actionList.push(n.MoveTo)},i.prototype.openNewCardButtonClicked=function(n,t){var r;n&&n.preventDefault();var i=this._primitive.entity,e=i.getTitle(),o="";i.getNickname()&&(o=e,e=i.getNickname());r={entryPoint:h.ContextMenu,listingTaskId:this._options.requestorId,id:i.id,openingNewCard:!0,taskTitle:e,originalName:o,selectedCategoryId:i.categoryId};r.hideBackButton=!0;!r.id&&this._primitive.geometry&&(r.query=this._primitive.geometry.y.toFixed(6)+", "+this._primitive.geometry.x.toFixed(6));this._logData(t);this.hide();f.invokeHandler(u.taskDataHandlerKey,{type:l.localDetailsTask,state:r,activateOptions:{groupName:this._options.requestorId}})},i.prototype.populatePrimitive=function(n){var l,a,r,e,u;this._primitive&&this._cleanup();this.collectionPrimitive=n.primitive;var o=n.primitive.geometry,s=new dt(o.y,o.x),t=n.primitive.entity,i=n.primitive.entity,h=t.getTitle(),f="";t.originalName?f=t.originalName:i.getOriginalName&&(f=i.getOriginalName());l=t.getDescription();a=t.getAddress();t.businesslistingid?r=t.businesslistingid:i.getBusinesslistingid&&(r=i.getBusinesslistingid(),r.indexOf("ypid:")===-1&&r.indexOf("sid:")===-1&&(r=""));t.photoUrl?e=t.photoUrl:i.getPhotoUrl&&(e=i.getPhotoUrl());u=new ur(f||h,l,n.primitive.taskDisplayState,null,null,a,n.primitive.entity.getSelectedCategoryForIcon&&n.primitive.entity.getSelectedCategoryForIcon());f&&u.setNickname(h);e&&u.setImageUrl(e);u.collisionBehavior=2;u.id=r;this._primitive=new oi(s,u,this._getVectorImage());this.updateMapQuadrant(this._map,s,n);this._primitive.bucket=this._mapQuadrant===c.TopLeft||this._mapQuadrant===c.TopRight?it.bucketIdForTransientLensTop:it.bucketIdForTransientLensBottom;this._buildMode&&(this._primitive.taskDisplayState=n.primitive.taskDisplayState)},i.prototype.buildMyPlacesEditActions=function(t){var u=this,i,r,f,e,o;if(this.actionList.indexOf(t)===-1)return null;i="";r=!1;switch(t){case n.editName:i=this.actionList.indexOf(n.deleteName)===-1?p.L_AddNickNameOption:p.L_EditNickNameOption;break;case n.editDescription:i=this.actionList.indexOf(n.deleteDescription)===-1?p.L_AddNoteOption:p.L_EditNoteOption;break;case n.deleteName:i=p.L_DeleteNickNameOption;break;case n.deleteDescription:i=p.L_DeleteNoteOption;break;case n.editHomeWork:i=p.L_EditHomeWorkOption;r=!0;break;case n.hideHomeWork:this.collectionPrimitive&&this.collectionPrimitive.entity.getIsHomeOrWork&&(f=this.collectionPrimitive,i=f.entity.getShowOnMap()?p.L_HideHomeWorkOption:p.L_DisplayHomeWorkOption)}return e=function(n){window.clearTimeout(gt._mouseoverDelayHandle);u.editEvent.invoke(t);n.stopPropagation();n.preventDefault();u.hide()},o={text:i,cssClass:"edit",handler:e,mouseoverHandler:null,showSeparator:r,showSecText:!1,secText:null},o},i}(li),kf=function(){function n(n,t,i){var r=this;this._events=[];this._map=n;this._templateSelector=t;this.invalidated=new v;this._events.push(this._map.contextMenuInvoked.add(function(n){return r._onContextMenuInvoked(n)}));this._transientLensViewModel=i;this._transientLensViewModel.setOptions({requestorType:"TransientLens"});this._events.push(this._transientLensViewModel.invalidateLayer.add(function(){r._layer&&r._layer.setVisible(!!r._transientLensViewModel.getPrimitive());r.invalidated.invoke()}))}return n.prototype.getPrimitives=function(n,t){this._transientLensViewModel.getPrimitive()?t&&t({primitives:[this._transientLensViewModel.getPrimitive()]}):t&&t({primitives:[]})},n.prototype.getViewModel=function(){return this._transientLensViewModel},n.prototype.dispose=function(){this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._map=null;this._templateSelector=null;for(var n=this._events.length-1;n>=0;n--)this._events[n].dispose();this._events=[];this._transientLensViewModel.dispose()},n.prototype.processCallback=function(n){n&&n.inData&&n.processorType&&n.outData&&(n.processorType===l.directionsTask&&n.inData.requestorState?this._transientLensViewModel.processDirectionsData(n):n.processorType===l.collectionsTask&&n.inData.requestorState?this._transientLensViewModel.processCollectionsData(n):n.processorType===l.itineraryDetailsTask&&n.inData.requestorState&&this._transientLensViewModel.processTravelData(n))},n.prototype.hide=function(){this._transientLensViewModel.hide()},n.prototype._onContextMenuInvoked=function(n){this._map.getMode().mapModeType===0&&(a._isSmallMapShownOnSerp()||(this._layer||(this._layer=new uu("TransientLens",this,this._templateSelector,1e4),this._map.getLayers().insert(this._layer)),this._transientLensViewModel.hide(),n.primitive&&n.exclusiveHitTest)||(!n.location||n.primitive&&n.layer.hasCustomContextMenu?n.layer.getId&&n.layer.getId()==="TransientLens"&&this._transientLensViewModel.show(n):this._transientLensViewModel.show(n)))},n}(),st=function(){function n(n){this._buttonElement=n;this.setDropdown([])}return n.prototype.getButtonElement=function(){return this._buttonElement},n.prototype.setButtonElement=function(n){this._buttonElement=n},n.prototype.setDropdown=function(n){this.dropdownList=n||[]},n.prototype.onEntryClicked=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.options?f.invokeHandler(u.taskDataHandlerKey,t.options):t.handler&&t.handler.call(this,null,n);t.instData&&f.invokeHandler(u.instrumentationDataHandlerKey,this.dropdownList[n].instData)}},n.prototype.onEntryMouseover=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.mouseoverhandler&&(t.mouseoverhandler.call(this,null,n),t.instData&&f.invokeHandler(u.instrumentationDataHandlerKey,this.dropdownList[n].instData))}},n.prototype.onEntryMouseout=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.mouseouthandler&&t.mouseouthandler.call(this,null,n)}},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),fr=function(n){function t(t,i,r,u,f,e){var o=n.call(this,u)||this;return o._addToRouteMode=e,o.setDropdownData(t,i,r,f),o}return e(t,n),t.prototype.setDropdownData=function(t,i,r,u){n.prototype.setDropdown.call(this,this._populateDropDownListData(t,i,r,u))},t.prototype._populateDropDownListData=function(n,t,r,u){var e=[],c,o,l,a,f,nt,tt,w,it,b,k,ut,ft;if(!n||!t||!r)return e;var v,y,s,p=t.getDescription()||t.getTitle(),d=t.entitySource,h=d?d===1:!1,g=rt.getDirectionTaskOptions(p,r,u.logData.data.EP,t.getTitle(),t.id,null,h);if(u){v={logData:{feature:u.logData.feature,action:u.logData.action,data:{}}};y={logData:{feature:u.logData.feature,action:u.logData.action,data:{}}};s={logData:{feature:u.logData.feature,action:u.logData.action,data:{}}};h&&(s.logData.data.ID=t.id,s.logData.data.AL=h);c=u.logData.data;for(o in c)c.hasOwnProperty(o)&&(v.logData.data[o]=c[o],y.logData.data[o]=c[o],s.logData.data[o]=c[o]);v.logData.data.DT="DirectionsTo";y.logData.data.DT="DirectionsFrom";s.logData.data.DT="AddWaypoint"}for(l=null,a=0;a<n.length;a++)f=n[a].data,f.activationState!==1||this._addToRouteMode?(f.routeTitle&&f.mode!==pt.transit||f.isIncomplete)&&(w="",this._addToRouteMode||(w=i.L_Directions_AddToRoute+"\n"),w+=f.routeTitle,f.isIncomplete&&(g.state.waypoints[0].waypointType=4),it={action:"focus",state:g.state,id:n[a].processorId},e.push({name:w,options:it,instData:s})):(l=n[a].processorId,f.routeTitle&&f.mode!==pt.transit&&(nt=rt.getDirectionTaskOptions(p,r,u.logData.data.EP,t.getTitle(),t.id,3,h),tt={action:"focus",state:nt.state,id:l},e.splice(0,0,{name:i.L_Add_To_Current_Route,options:tt,instData:s})));return this._addToRouteMode||(b=rt.getDirectionTaskOptions(p,r,u.logData.data.EP,t.getTitle(),t.id,2,h),k=rt.getDirectionTaskOptions(p,r,u.logData.data.EP,t.getTitle(),t.id,1,h),l?(ut={action:"focus",state:k.state,id:l},e.splice(0,0,{name:i.L_Directions_From,options:ut,instData:y}),ft={action:"focus",state:b.state,id:l},e.splice(0,0,{name:i.L_Directions_To,options:ft,instData:v})):(e.splice(0,0,{name:i.L_Directions_From,options:k,instData:y}),e.splice(0,0,{name:i.L_Directions_To,options:b,instData:v}))),e},t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),er=function(n){function t(t,i,r,u,f){var e=n.call(this,u)||this;return e.setDropdownData(t,i,r,f),e}return e(t,n),t.prototype.setDropdownData=function(t,i,r,u){n.prototype.setDropdown.call(this,this._populateDropDownListData(t,i,r,u))},t.prototype.onEntryClicked=function(n){if(!(n<0)&&!(n>=this.dropdownList.length)){var t=this.dropdownList[n].options,i;i=t.requestState?u.taskProcessDataHandlerKey:u.taskDataHandlerKey;f.invokeHandler(i,t)}},t.prototype._populateDropDownListData=function(n,t,r){var e=[],u,s,o,f,h,c;if(!n||!t||!r)return e;for(u=t,u.getImageUrl()&&u.getImageUrl().length>0&&(s=u.getImageUrl()),o=rt.getTravelTaskOptions(u.getTitle(),r,t.id,s),e.push({name:i.L_CreateNewItinerary,options:o}),f=0;f<n.length;f++)h=n[f].data,c={type:o.type,taskId:n[f].processorId,requestState:o.state},e.push({name:h.title,options:c});return e},t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),or=function(n){function t(t,i,r,u,f,e,o,s,h,c,l){var a=n.call(this,e)||this;return a.entityDescription=l,a.entityNickName=h,a.entityOriginalName=c,a.isMoveToMenu=s,a.setDropdownData(t,i,r,u,f,o),a.newCollectionCreated=new v,a}return e(t,n),t.prototype.setDropdownData=function(n,t,i,r,u,f){this._entityId=t.id;this.dropdownList=this._populateDropDownListData(n,t,i,r,u,f)},t.prototype.onEntryClicked=function(n){if(!(n<0)&&!(n>=this.dropdownList.length)){var i=this.dropdownList[n].options,t;i.requestState?t=u.taskProcessDataHandlerKey:(t=u.taskDataHandlerKey,this.newCollectionCreated.invoke());f.invokeHandler(t,i)}},t.prototype._populateDropDownListData=function(n,t,r,u,f,e){var c=[],l,o,a,y,v,p;if(!n||!t||!r||!u&&!f)return c;for(l=t,o=rt.getMyPlacesTaskOptions(l.getTitle(),r,null,l.getAddress()),o.activateOptions={parentId:u},o.state.data.id=this._entityId,this.entityDescription&&(o.state.data.description=this.entityDescription),this.entityNickName&&this.entityOriginalName?(o.state.data.nickName=this.entityNickName,o.state.data.title=this.entityOriginalName):l.getNickname&&l.getNickname()&&(o.state.data.nickName=l.getNickname()),a=e.logData.data,o.state.entryPoint=a&&(a.EP&&a.EP===h.LocalDetails||a.ID)?3:2,l.getImageUrl()&&l.getImageUrl().length>0&&(o.state.data.photoUrl=l.getImageUrl()),this.isMoveToMenu&&(o.state.isMove=!0),this._pushFavoritesAction(c,this.isMoveToMenu?i.L_MoveToFavorites:i.L_AddFavorite,s.AddFavorite,o,f,e),this._pushFavoritesAction(c,this.isMoveToMenu?i.L_MoveToHome:i.L_SetAsHome,s.SetHome,o,f,e),this._pushFavoritesAction(c,this.isMoveToMenu?i.L_MoveToWork:i.L_SetAsWork,s.SetWork,o,f,e),c.push({name:"",separator:!0}),c.push({name:i.L_CreateNewCollection,options:o}),w.features.collections.enableTemporaryCollection&&!this.isMoveToMenu&&this._pushSaveToTempAction(c,o,f,e),y=0;y<n.collections.length;y++)v=n.collections[y],p={type:o.type,requestorId:u,requestorType:f,requestState:{action:s.AddEntity,data:o.state.data,collectionId:v.id},requestorState:{title:v.name,entryPoint:e.logData.data.EP}},v.name&&c.push({name:v.name,options:p});return c},t.prototype._pushFavoritesAction=function(n,t,i,r,u,f){var e={type:r.type,requestorId:r.activateOptions.parentId,requestorType:u,requestState:{action:i,data:r.state.data},requestorState:{entryPoint:f.logData.data.EP}};n.push({name:t,options:e})},t.prototype._pushSaveToTempAction=function(n,t,i,r){var u={requestorId:t.activateOptions.parentId,requestorType:i,type:l.collectionsTask,requestState:{action:s.AddToTemporaryCollection,data:t.state.data},requestorState:{entryPoint:r.logData.data.EP}};n.push({name:"Temporary Collection",options:u})},t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),sr=function(n){function t(t,i,r){var u=n.call(this,i)||this;return u.setDropdown(t),u._isMultipleSelection=r||!1,u._updateItemsCssClasses(),u}return e(t,n),t.prototype.onEntryClicked=function(t){if(t>=0&&t<this.dropdownList.length){var i=this.dropdownList[t];if(i.isSelected&&!this._isMultipleSelection)return;i.isSelected||this._isMultipleSelection||this._unselectAllItems();i.isSelected=!i.isSelected;this._updateItemsCssClasses();n.prototype.onEntryClicked.call(this,t)}},t.prototype._unselectAllItems=function(){for(var n=0;n<this.dropdownList.length;n++)this.dropdownList[n].isSelected=!1},t.prototype._updateItemsCssClasses=function(){for(var i=0;i<this.dropdownList.length;i++){var n=this.dropdownList[i],r=t._selectedCssClass,u=n.cssClass&&n.cssClass.search(r)!=-1;n.isSelected&&!u?n.cssClass&&n.cssClass.length>0?n.cssClass+=" "+r:n.cssClass=r:!n.isSelected&&u&&(n.cssClass=n.cssClass.replace(r,""),n.cssClass=n.cssClass.replace("  "," ").trim())}},t._selectedCssClass="selected",t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),hr=function(n){function t(t,i,r,u){var f=n.call(this,r)||this;return f._address=u,f.setDropdownData(t,i),f}return e(t,n),t.prototype.setDropdownData=function(t,i){n.prototype.setDropdown.call(this,this._populateDropDownListData(t,i))},t.prototype.setAddress=function(n){this._address=n},t.prototype.buildCategoryIcons=function(n,t,i){var u,f,r;if(this._categories&&this._categories.length!==0&&t&&t.length!==0)for(u=t.select(".nearbyCatIcon"),f=this._categories.length,r=0;r<f;r++)this._drawIcon(n,this._categories[r],u[r],i)},t.prototype.onEntryClicked=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.options&&t.options.type===l.nearbyTransitTask?f.invokeHandler(u.taskDataHandlerKey,t.options):f.invokeHandler(u.taskProcessDataHandlerKey,t.options);f.invokeHandler(u.instrumentationDataHandlerKey,t.instData)}},t.prototype._populateDropDownListData=function(n,i){var f=[],r,e,o,u;if(!n||n.length===0||!i)return f;for(this._categories=n,r=0;r<this._categories.length;r++)e={logData:{feature:vt.NearbyControl,action:y.Clicked,data:{query:this._categories[r].Name,lat:i.latitude,lon:i.longitude}}},this._categories[r].Id===t.nearbyTransitCategoryId?(o={location:i,title:this._address,entryPoint:2},f.push({name:this._categories[r].Name,options:{state:o,type:l.nearbyTransitTask},cssClass:"nearbyItem",instData:e})):(u={},u.entryPoint=h.ContextMenu,u.query=this._categories[r].Name,u.point=[i.latitude,i.longitude],f.push({name:this._categories[r].Name,options:{requestState:u,type:l.localSearchTask},cssClass:"nearbyItem",instData:e}));return f},t.prototype._drawIcon=function(n,i,r,u){var o=i.Name,e=i.Id,f=u?t._suggestionAerialIconColor:t._suggestionRoadIconColor;a._isHighContrastMode()&&(f=t._suggestionHighContrastIconColor);n.getCardVectorImageTemplateAsync(function(n){n&&r.appendChild(n.renderIcon()[0])},e,null,f,1,24)},t._suggestionRoadIconColor="rgb(64,64,64)",t._suggestionAerialIconColor="rgba(255, 255, 255, 0.8)",t._suggestionHighContrastIconColor="rgb(255, 255, 0)",t.nearbyTransitCategoryId="250",t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ai=function(n){function t(t,r,u,f){var e=this,o={},s,h;return e=n.call(this,o)||this,o.defineProperty("popOutTemplate",function(n,t){return e._onTemplateChange(n,t)}),o.defineProperty("popOutContent"),o.defineProperty("isDisplayed",function(n,t){return e._onDisplayChange(n,t)},null,{defaultValue:!1}),o.defineProperty("buttonClass"),e.setButtonClass("hidePopupButton"),o.defineProperty("popOut"),o.defineProperty("ariaLabel"),e.resources=i,e.dropdownList=new nu,e.dropdownClass="popOutTop",t&&e.setDropdown(t),r&&e.setPopOut(r),s=u?u:si,h=f?f:hu,e._dropdownListTemplate=new b(s,{onEntryClicked:function(n){e._dropdownListViewModel.onEntryClicked(n);t.dropdownList&&t.dropdownList[n]&&t.dropdownList[n].subMenu||e.setIsDisplayed(!1)},onEntryMouseover:function(n){e._dropdownListViewModel.onEntryMouseover(n);t.dropdownList&&t.dropdownList[n]&&t.dropdownList[n].subMenu||e.setIsDisplayed(!0)},onEntryMouseout:function(n){e._dropdownListViewModel.onEntryMouseout(n)}}),e._popoutMessageTemplate=new b(h,{onPopOutLinkClick:function(n){return e.onPopOutLinkClicked(n)},onPopOutEditLinkClick:function(n){return e.onPopOutEditLinkClick(n)},onPopOutCloseLinkClick:function(n){return e.onPopOutCloseLinkClick(n)},onPopOutSaveLinkClick:function(n){return e.onPopOutSaveLinkClick(n)},onPopOutKeyPressed:function(n){return r.onKeyPress(n)},onTextBoxClick:function(n){return e.onTextBoxClick(n)},onPopOutClick:function(n){return e.onPopOutClick(n)},boolToDisplay:function(n){return r.boolToDisplay(n)},boolToNotDisplay:function(n){return r.boolToNotDisplay(n)}}),e.popOutHidden=new v,e.setPopOutTemplate(e._dropdownListTemplate),e.setPopOutContent(e),e}return e(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.dropdownList.clear()},t.prototype.isPopOutInListMode=function(){return this.getPopOutTemplate()===this._dropdownListTemplate},t.prototype.setDropdown=function(n,t){var r=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),i;r&&r.remove_class("selected");this._dropdownListViewModel=n;i=this._dropdownListViewModel.getButtonElement();i&&i.add_class("selected");this.dropdownList.clear();this.dropdownList.insertAll(this._dropdownListViewModel.dropdownList);this.setPopOutTemplate(t?t:this._dropdownListTemplate)},t.prototype.setDropdownClass=function(n){this.dropdownClass=n},t.prototype.setTemplateToPopOutMessage=function(){this.setPopOutTemplate(this._popoutMessageTemplate);var n=this.getPopOut();n&&n instanceof vi&&n.focusTextBox()},t.prototype.onPopOutLinkClicked=function(n){this.getPopOut().onLinkClick(n);this.setIsDisplayed(!1)},t.prototype.onPopOutEditLinkClick=function(n){this.getPopOut().onEditLinkClick(n);this.setIsDisplayed(!1)},t.prototype.onPopOutCloseLinkClick=function(n){this.getPopOut().onCloseLinkClick(n);this.setIsDisplayed(!1)},t.prototype.onPopOutSaveLinkClick=function(n){var t=this.getPopOut().onSaveLinkClick(n);this.setIsDisplayed(!t)},t.prototype.onTextBoxClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.onPopOutClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.buildPopOut=function(n){var t=n?n:cu,i=new b(t);return i.applyDataTemplate(this)},t.prototype._onTemplateChange=function(n,t){var i=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),r=this.getPopOut()&&this.getPopOut().getButtonElement();n===this._dropdownListTemplate?i&&i.remove_class("selected"):n===this._popoutMessageTemplate?r&&r.remove_class("selected"):(i&&i.remove_class("selected"),r&&r.remove_class("selected"));t===this._dropdownListTemplate?i&&i.add_class("selected"):t===this._popoutMessageTemplate&&r&&r.add_class("selected")},t.prototype._onDisplayChange=function(n,t){var i=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),r=this.getPopOut()&&this.getPopOut().getButtonElement(),f=this.getPopOutTemplate(),u;f===this._dropdownListTemplate?(r&&r.remove_class("selected"),i&&(t?i.add_class("selected"):i.remove_class("selected"))):f===this._popoutMessageTemplate&&(i&&i.remove_class("selected"),r&&(t?r.add_class("selected"):r.remove_class("selected")));n&&!t?(this.popOutHidden.invoke(),i&&i.remove_class("selected"),r&&r.remove_class("selected")):!n&&t&&(u=this.getPopOut(),u&&u.setNickName(""))},t}(ot),df=function(){function n(n,t){this._events=[];this.filterItem=n;this._filterItemTemplateName=t;this.filterOptionClicked=new v;this._viewModelInitialized=!1;this.hideParent=new v}return n.prototype.setViewModelData=function(n,t){this._popOutRootElement=n;this._filterButton=t},n.prototype.filterButtonButtonClicked=function(n){if(n.preventDefault(),this.filterItem.isEnabled()){var t=this._popOutButtonViewModel&&this._popOutButtonViewModel.getIsDisplayed();t||this._showPopOut()}},n.prototype._updatePopOutListDropdownViewModel=function(n){this._popOutButtonViewModel.setDropdown(n)},n.prototype.dispose=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.dispose()},n.prototype.refresh=function(){this._viewModelInitialized&&this._dropdownViewModel.setDropdown(this._createDropdownListData())},n.prototype._displayPopOut=function(){var n=this;Microsoft.Maps.setTimeout(function(){n._popOutButtonViewModel.setIsDisplayed(!0)},0)},n.prototype._showPopOut=function(){if(this._initializeViewModels(),this._dropdownViewModel.dropdownList.length>0){var t=this._popOutRootElement.select("div."+n.popOutCssClass);this._updatePopOutListDropdownViewModel(this._dropdownViewModel);t.append(this._popOutElement);this._displayPopOut()}else this.hideParent.invoke()},n.prototype._initializeViewModels=function(){var n=this;this._viewModelInitialized?this._dropdownViewModel.setButtonElement(this._filterButton):(this._dropdownViewModel=new sr(this._createDropdownListData(),this._filterButton,this.filterItem.filterType===2),this._popOutButtonViewModel=new ai(this._dropdownViewModel,this._PopOutMessageViewModel,this._filterItemTemplateName,null),this._events.push(this._popOutButtonViewModel.popOutHidden.add(function(){n._dropdownViewModel!=null&&n._dropdownViewModel.dropdownList.length>1?n.hideParent.invoke():n._popOutButtonViewModel.isPopOutInListMode()||n.hideParent.invoke()})),this._popOutElement=this._popOutButtonViewModel.buildPopOut(),this._viewModelInitialized=!0)},n.prototype._createDropdownListData=function(){for(var n,t=this,r=[],i=0;i<this.filterItem.options.length;i++)n=this.filterItem.options[i],r.push({value:n.value,name:n.label,isSelected:n.isSelected,cssClass:"variant",handler:function(n,i){t._applyViewModelSelection();t.filterOptionClicked.invoke(t.filterItem.options[i])}});return r},n.prototype._applyViewModelSelection=function(){for(var n=0;n<this._dropdownViewModel.dropdownList.length;n++)this.filterItem.options[n].isSelected=this._dropdownViewModel.dropdownList[n].isSelected},n.popOutCssClass="routesPopOut",n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),cr=function(n){function t(t,i,r,u){var f=this,e={};return f=n.call(this,e)||this,f.title=t,f.linkTitle=i,f.linkData=r,f._buttonElement=u,e.defineProperty("showLink",null,null,{defaultValue:!0}),e.defineProperty("nickName"),e.defineProperty("showAnnotate"),f.setShowAnnotate(!1),f}return e(t,n),t.prototype.getButtonElement=function(){return this._buttonElement},t.prototype.setButtonElement=function(n){this._buttonElement=n},t.prototype.onLinkClick=function(n){this.linkData&&f.invokeHandler(u.taskDataHandlerKey,this.linkData);n&&n.preventDefault&&n.preventDefault()},t.prototype.onEditLinkClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.onCloseLinkClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.onSaveLinkClick=function(n){return n&&n.preventDefault&&n.preventDefault(),!0},t.prototype.onKeyPress=function(){},t.prototype.boolToDisplay=function(n){return n?"inline":"none"},t.prototype.boolToNotDisplay=function(n){return n?"none":"block"},t}(ot),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),vi=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,i,r,u)||this;return o.setShowLink(!0),o.processOptions=f,o.entityId=e,o.showFooter=f&&f.requestState&&f.requestState.entityId?"":"none",o}return e(t,n),t.prototype.onLinkClick=function(t){this.linkData?n.prototype.onLinkClick.call(this,t):this.processOptions?f.invokeHandler(u.taskProcessDataHandlerKey,this.processOptions):this.activateOptions&&this.isTempCollectionMessage&&f.invokeHandler(u.taskDataHandlerKey,this.activateOptions);t&&t.preventDefault&&t.preventDefault()},t.prototype.onSaveLinkClick=function(t){var i,r,e,o;return n.prototype.onSaveLinkClick.call(this,t),i=this.getNickName().trim(),i?(this.processOptions&&this.processOptions.requestState?(r=this.processOptions.requestState,r.action=s.UpdateEntity,r.entityId=this.entityId,r.data={title:i},this.processOptions.useActiveTasks=!1,f.invokeHandler(u.taskProcessDataHandlerKey,this.processOptions)):(e=this.activateOptions&&this.activateOptions.state&&this.activateOptions.state.collectionId,o={type:l.collectionsTask,requestorType:this.requestorType,requestorId:this.requestorId,requestState:{action:s.UpdateEntity,entityId:this.entityId,collectionId:e,data:{title:i}}},f.invokeHandler(u.taskProcessDataHandlerKey,o)),!0):(this.focusTextBox(),!1)},t.prototype.onKeyPress=function(n){if(n.keyCode===13)this.onSaveLinkClick(null)},t.prototype.focusTextBox=function(){this.getShowAnnotate()&&Microsoft.Maps.setTimeout(function(){var n=r(".nameEditBox");n&&n.length&&n[0].focus()},500)},t}(cr),ii=function(){function n(n){this._suggestionTypes=n||"";this._parseLocationFromAS=!0}return n.prototype.addExtraASParams=function(n){return n},n.prototype.setInstrumentationHelper=function(n){this.instrumentationHelper=n},n.prototype.getDefaultSuggestions=function(){return[]},n.prototype.getSuggestions=function(t,i){var r=this,u,f,e,o;if(!t.disableThisRequest){if((!t.searchText||t.searchText.trim()==="")&&(!g.autosuggestFavorites||!this._useFavoriteSuggestions)){this._currentRequestCallbackId="";u=this.getDefaultSuggestions();f=this.getHistorySuggestions();u=this._combineSuggestions(f,u);e={suggestions:u};i(e);return}o=this._constructASRequestUrl(t);this._currentRequestCallbackId=(new Date).getTime().toString()+t.searchText;this._currentNetworkRequestId=nt.downloadJson(o,n.autosuggestCallerId,function(n,u){var e;if(u===r._currentRequestCallbackId){var f=r._parseSuggestionsV6(n),o=r.getHistorySuggestions(t.searchText),s=!t.searchText||t.searchText.trim()===""?r.getDefaultSuggestions():[];f.suggestions=r._combineSuggestions(f.suggestions,o);f.suggestions=r._combineSuggestions(f.suggestions,s);i(f);n.instrumentation&&r.instrumentationHelper&&(e=n.instrumentation.pageLoadPingUrl,r.instrumentationHelper.instrumentLoadCompeleteEvent(e))}},function(){},this._currentRequestCallbackId,!0,null,!1,null)}},n.prototype.getHistorySuggestions=function(){return[]},n.prototype._constructASRequestUrl=function(n){var t=g.autoSuggestServiceUrlFormat,e=encodeURIComponent(n.searchText),f=g.autoSuggestServiceHostUrl.replace("{urischeme}","https://"),i=w.dynamicProperties,r,u;if(g.enableAutoSuggestEndpointUrlParam&&(r=window.location.search.substr(1),u=r.indexOf("asep"),u>=0)){t=t.replace("?","&");var o=r.substr(u),s=o.split("&"),h=s[0].split("=");f=decodeURIComponent(h[1])}return t=t.replace("{host_url}",f).replace("{local_map_view}",n.localMapView||"").replace("{user_location}",n.userLocation||"").replace("{max_results}",n.maxResults?n.maxResults+"":"5").replace("{app}",n.applicationName||"webv8").replace("{query}",e).replace("{ig}",i.impressionGuid).replace("{conversation_id}",this.instrumentationHelper&&this.instrumentationHelper.getConversationId()).replace("{appid}",n.applicationId||g.autosuggestAppid||i.appId).replace("{market}",n.market||i.market).replace("{lang}",i.uiLanguage).replace("{suggestionTypes}",n.suggestionTypes||this._suggestionTypes),t=this.addExtraASParams(t),n.countryCode&&n.countryCode.length===2&&(t+="&constraints=country:"+n.countryCode),g.autosuggestFavorites&&!n.disableFavorites&&(t+="&ptypes=favorite"),t+("&clientid="+i.clientId)},n.prototype._combineSuggestions=function(n,t){var u=[],f,i,o,r;if(t&&t.length)for(u=t,f=!1,i=0;i<n.length;i++){var l=n[i].root,e=n[i].address,s=e&&e.streetAddress,h=e&&e.addressLocality,c=n[i].name;for(o=0;o<t.length;o++)if(r=t[o],s&&r.formatedAddress&&r.formatedAddress.indexOf(s)>-1&&(h&&r.formatedAddress.indexOf(h)>-1||c&&r.title&&r.title.indexOf(c)>-1)){f=!0;break}if(f){f=!1;continue}else u.push(n[i])}else u=n;return u},n.prototype._parseSuggestionsV6=function(n){var f={},l=[],a,v,s,r,t,i,e,u,o,h,c;if(n)for(a=n.instrumentation,f.formattingRules=this._createFormattingRulesV6(n.formattingRules),v=this._getFormattingRuleV6(f.formattingRules),this.instrumentationHelper&&this.instrumentationHelper.setResponseModel(n.model),s=n.value,r=0;r<s.length;r++){t={};i=s[r];try{t.root=i;t.type=i._type;t.readLink=i.readLink;t.readLinkPingSuffix=i.readLinkPingSuffix;t.formattingRule=v;t.instrumentationInfo=a;t.suggestionRank=r;t.entityId=i.id;t.name=i.name;t.query=i.query;e=i.categories;t.primaryCategoryPath=e&&e.length&&e[0];u=i.entityPresentationInfo;u&&u.entitySubTypeHints&&u.entitySubTypeHints.length&&(t.subType=u.entitySubTypeHints[0]);o=i.geo;o&&this._parseLocationFromAS&&(h=o.latitude,c=o.longitude,h&&c&&(t.location=new dt(h,c)));i.address?t.address=i.address:i.location&&i.location.length?t.address=i.location[0].address:t.type==="PostalAddress"&&(t.address=i);t.type=="Favorite"&&(t.alternateName=i.alternateName,t.subType=i.subType,this._processFavoriteItemId(i,t));l.push(t)}catch(y){}}return f.suggestions=l,f},n.prototype._createFormattingRulesV6=function(n){var r={},t,i;if(n)for(t=0;t<n.length;t++)i=JSON.parse(n[t]),r[i.identifier]=i;return r},n.prototype._getFormattingRuleV6=function(n){var t=n&&n.Default||null,i,r;for(i in n)if(t||(t=n[i]),r=w.dynamicProperties.market.toLowerCase(),r.indexOf(i.toLowerCase())>-1){t=n[i];break}return t},n.prototype._processFavoriteItemId=function(n,t){var i=n.bingId;i&&(i.indexOf("local_ypid:")===0||i.indexOf("sid")===0||i.indexOf("local_vdpid")===0)&&(t.entityId=i);t.bingId=i},n.autosuggestCallerId="autosug",n}(),gf=function(){function n(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){this._title=n;this._description=t;this._address=t;this.id=i;this._location=r;this._routableLocation=u;this._menuUrl=f;this._imageUrl=e;this.entitySource=o;this._primaryCategoryPath=s||"";this._primaryCategoryName=h||"";this._vdpId=c;this._locationType=l;this._dateTime=a;this._endDateTime=v;this._utcOffset=y;this._isAllDayEvent=p;this._segmentTypes=w;this.isApproximateLocation=b;this.isPaginationReducedPoi=!1}return n.prototype.getLocation=function(){return this._location},n.prototype.getRoutableLocation=function(){return this._routableLocation},n.prototype.getBoundingBox=function(){return this._boundingBox},n.prototype.setBoundingBox=function(n){this._boundingBox=n},n.prototype.getTitle=function(){return this._title},n.prototype.setTitle=function(n){this._title=n},n.prototype.getDescription=function(){return this._description},n.prototype.setDescription=function(n){this._description=n},n.prototype.getMenuUrl=function(){return this._menuUrl},n.prototype.setMenuUrl=function(n){this._menuUrl=n},n.prototype.getImageUrl=function(){return this._imageUrl},n.prototype.setImageUrl=function(n){this._imageUrl=n},n.prototype.getPrimaryCategoryPath=function(){return this._primaryCategoryPath},n.prototype.setPrimaryCategoryPath=function(n){this._primaryCategoryPath=n},n.prototype.getPrimaryCategoryName=function(){return this._primaryCategoryName},n.prototype.setPrimaryCategoryName=function(n){this._primaryCategoryName=n},n.prototype.getSelectedCategoryForIcon=function(){return this._selectedCategoryForIcon},n.prototype.setSelectedCategoryForIcon=function(n){this._selectedCategoryForIcon=n},n.prototype.getAddress=function(){return this._address},n.prototype.setVdpId=function(n){this._vdpId=n},n.prototype.getVdpId=function(){return this._vdpId},n.prototype.setLocationType=function(n){this._locationType=n},n.prototype.getLocationType=function(){return this._locationType},n.prototype.setSegmentTypes=function(n){this._segmentTypes=n},n.prototype.getSegmentTypes=function(){return this._segmentTypes},n.prototype.getDateTime=function(){return this._dateTime},n.prototype.setDateTime=function(n){this._dateTime=n},n.prototype.getEndDateTime=function(){return this._endDateTime},n.prototype.setEndDateTime=function(n){this._endDateTime=n},n.prototype.getUtcOffset=function(){return this._utcOffset},n.prototype.setUtcOffset=function(n){this._utcOffset=n},n.prototype.getIsAllDayEvent=function(){return this._isAllDayEvent},n.prototype.setIsAllDayEvent=function(n){this._isAllDayEvent=n},n.prototype.setPhone=function(n){this._phone=n},n.prototype.getPhone=function(){return this._phone},n.prototype.setWebsite=function(n){this._website=n},n.prototype.getWebsite=function(){return this._website},n.prototype.setBrand=function(n){this._brand=n},n.prototype.getBrand=function(){return this._brand},n.prototype.setChainId=function(n){this._chainId=n},n.prototype.getChainId=function(){return this._chainId},n.prototype.clone=function(){return n.cloneFrom(this)},n.cloneFrom=function(t){var i=new n(t._title,t._address,t.id,t._location,t._routableLocation,t._menuUrl,t._imageUrl,t.entitySource,t._primaryCategoryPath,t._primaryCategoryName,t._vdpId,t._locationType,t._dateTime,t._endDateTime,t._utcOffset,t._isAllDayEvent,t._segmentTypes,t.isApproximateLocation);return i.setDescription(t._description),i.setBoundingBox(t._boundingBox),i.setSelectedCategoryForIcon(t._selectedCategoryForIcon),i.setPhone(t._phone),i.setWebsite(t._website),i.setChainId(t._chainId),i.setBrand(t._brand),i.htmlElement=t.htmlElement,i.representsTransitStop=t.representsTransitStop,i.renderBranded=t.renderBranded,i.isUpHierarchy=t.isUpHierarchy,i},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ni=function(n){function t(t){var i=n.call(this,t&&t.suggestionTypes?t.suggestionTypes:"place,business,address")||this;return i._parseLocationFromAS=g.useAutosuggestLocationForDirections,i._useDefaultSuggestions=!0,i._useFavoriteSuggestions=!0,i._parseLocationFromAS=!0,i._setDefaultOptions(),i.updateOptions(t),i}return e(t,n),t.updateCurrentLocalDetailCards=function(n){t.localDetailCards=n},t.appendLocalDetailCards=function(n){t.localDetailCards=t.localDetailCards.concat(n)},t.resetCurrentLocalDetailsCards=function(){t.localDetailCards=[]},t.updateCurrentTransitStopCards=function(n){t.transitStopCards=n},t.prototype.updateOptions=function(n){n&&(this._options.suggestionTypes=n.suggestionTypes?n.suggestionTypes:this._options.suggestionTypes,this._options.showHistorySuggestions=typeof n.showHistorySuggestions=="boolean"?n.showHistorySuggestions:this._options.showHistorySuggestions,this._options.showMyLocation=typeof n.showMyLocation=="boolean"?n.showMyLocation:this._options.showMyLocation,this._options.prevWaypoint=n.prevWaypoint!==undefined?n.prevWaypoint:this._options.prevWaypoint,this._options.dirMode=n.dirMode!==undefined?n.dirMode:this._options.dirMode,this._options.width=n.width!==undefined?n.width:0,this._options.maxHistoryWaypoints=typeof n.maxHistoryWaypoints=="number"?n.maxHistoryWaypoints:this._options.maxHistoryWaypoints,this._prevWaypoint=n.prevWaypoint?n.prevWaypoint:this._prevWaypoint,this._dirMode=n.dirMode?this._getDirMode(n.dirMode):this._dirMode)},t.prototype.update=function(n,t,i,r){this._prevWaypoint=n;this._dirMode=this._getDirMode(t);this.instrumentationHelper&&this.instrumentationHelper.createDirectionsInstrumentationData(this._dirMode,i,r)},t.prototype._setDefaultOptions=function(){this._options={suggestionTypes:"place,business,address",showHistorySuggestions:!0,showMyLocation:!0,maxHistoryWaypoints:5}},t.prototype._getDirMode=function(n){var t="car";switch(n){case pt.transit:t="bus";break;case pt.walking:t="walk"}return t},t.prototype.getDefaultSuggestions=function(){var r,e,f,n,u;if(!this._useDefaultSuggestions)return[];if(r=[],this._options.showMyLocation&&(u=this.createSuggestion(i.L_MyLocation,null),r.push(u)),t.localDetailCards||t.transitStopCards)for(e=Array.prototype.concat.apply(t.localDetailCards,t.transitStopCards),f=0;f<e.length;f++)n=e[f],n&&(u=this.createSuggestion(n.getTitle(),n.getDescription(),n.getRoutableLocation(),n.id,n.getPrimaryCategoryPath(),!!n.getLocationType()),r.push(u));return r},t.prototype.addExtraASParams=function(n){if(this._dirMode&&(n+="&cmdir="+this._dirMode),this._prevWaypoint){n+="&ctx=to";var t=this._prevWaypoint.point;t&&(n+="&clFrom="+t.latitude.toString()+","+t.longitude.toString());this._prevWaypoint.eid&&(n+="&ceFrom="+this._prevWaypoint.eid);this._prevWaypoint.type&&(n+="&ccFrom="+this._prevWaypoint.type)}else n+="&ctx=from";return n},t.prototype.createSuggestion=function(n,t,i,r,u,f){var e={defaultSuggestion:!0,title:n,formatedAddress:t,location:i,entityId:r,primaryCategoryPath:u};return f&&(e.type="Place"),e},t.prototype.getHistorySuggestions=function(n){var r,u,t,i,f;if(this._options&&!this._options.showHistorySuggestions)return[];for(r=[],u=lr.getWaypoints(n),t=0;t<Math.min(u.length,this._options.maxHistoryWaypoints);t++)i=u[t],i&&(f=this.createSuggestion(i.getTitle(),i.getAddress()),f.type=yi.HistorySuggestionType,r.push(f));return r},t.localDetailCards=[],t}(ii),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ne=function(n){function t(){var t=n.call(this)||this;return t._defaultSuggestions=[],t._useFavoriteSuggestions=!0,t}return e(t,n),t.prototype.updateDefaultSuggestions=function(n,t){this._defaultSuggestions=n;this._mapBounds=t;this._useDefaultSuggestions=!0;this._useFavoriteSuggestions=!1},t.prototype.clearDefaultSuggestions=function(){this._defaultSuggestions=[];this._mapBounds=null;this._useDefaultSuggestions=!1;this._useFavoriteSuggestions=!0},t.prototype.getDefaultSuggestions=function(){var r=[],t,i,n;if(this._defaultSuggestions&&this._useDefaultSuggestions)for(t=0;t<this._defaultSuggestions.length;t++)i=this._defaultSuggestions[t],i&&(n={},n.defaultSuggestion=!0,n.title=i,n.searchText=i,n.mapBounds=this._mapBounds,r.push(n));return r},t}(ii),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),te=function(n){function t(){return n.call(this)||this}return e(t,n),t.prototype.getDefaultSuggestions=function(){var r,u,t,n;if(!this._useDefaultSuggestions)return[];if(r=[],n={},n.title=i.L_MyLocation,n.defaultSuggestion=!0,r.push(n),ni.localDetailCards)for(u=0;u<ni.localDetailCards.length;u++)t=ni.localDetailCards[u],t&&(n=this.createSuggestion(t.getTitle(),t.getDescription(),t.getRoutableLocation(),t.id),r.push(n));return r},t}(ni),ut=function(){function n(){}return n.autosuggestFeature="MapsAutoSuggest",n.actionSearchEvent="Search Event",n.searchEventSuggestionSelectSuggestionClick="Suggestion Select:Suggestion Click",n.searchEventSuggestionSelectEnterPress="Suggestion Select:Enter Press",n.searchEventSuggestionSelectSearchButtonClick="Suggestion Select:Search Button Click",n.searchEventEnterPress="Enter Press",n.searchEventSuggestionShown="Suggestions Shown",n.searchEventSearchButtonClick="Search Button Click",n.AppNameSpace="App",n.AppName="web",n.UIFieldName="UI",n.UIType="sbx",n.LocalTime="LTime",n.suggestionSourceServer="S",n}(),ie=function(){function n(){this._resetConversationId()}return n.prototype.setRequestAndSuggestions=function(n,t){this._request=n;this._suggestions=t},n.prototype.setResponseModel=function(n){this._responseModel=n},n.prototype.createDirectionsInstrumentationData=function(n,t,i){var r,u;for(this._directionsInstrumentationData={},this._directionsInstrumentationData.cmdir=n,this._directionsInstrumentationData.contextId=i,r=0;r<t.length;r++)u="from",r===1?u="to":r>=2&&(u="to"+r),t[r].address&&(this._directionsInstrumentationData["cq"+u]=t[r].address),t[r].eid&&(this._directionsInstrumentationData["ce"+u]=t[r].eid),t[r].type&&(this._directionsInstrumentationData["cc"+u]=t[r].type),t[r].stype&&(this._directionsInstrumentationData["cg"+u]=t[r].stype)},n.prototype.resetLastShownSuggestionsTime=function(){this._lastShownSuggestionsTimeStamp=new Date},n.prototype.resetSearchStartTimeStam=function(){this._searchStartTimeStamp=new Date},n.prototype.instrumentSearchEvent=function(n,t,i){var r,o,e;if(n&&n.length&&this._request&&(!i||!i.defaultSuggestion)){if((t===1||t===3)&&this.instrumentSelectionEvent(i),r={},this._responseModel&&(r.Md=this._responseModel),r.App=ut.AppName,r.LTime=this._getFormattedDate(new Date,"{yyyy}{mm}{dd}{hh}{nn}"),r.FN=ut.autosuggestFeature,r.UL=this._request.userLocation,r.Bx=this._request.localMapView,r.M=w.dynamicProperties.market,r.L=w.dynamicProperties.uiLanguage,r.E=this._searchStartTimeStamp?(new Date).getTime()-this._searchStartTimeStamp.getTime():0,r.Q=n,r.NS=this._suggestions.length,r.NR=this._suggestions.length,r.S=this._getEventNameFromType(t),r.Cid=this._conversationId,i&&(r.Clk=i.suggestionRank),t!==4&&this._resetConversationId(),this._directionsInstrumentationData&&(r.Direction=this._directionsInstrumentationData),this._suggestions){for(o=[],e=0;e<this._suggestions.length;e++)o.push(this._getSuggestionItemInstrumentationData(this._suggestions[e]));r.Sg=o}f.invokeHandler(u.instrumentationDataHandlerKey,{logData:r})}},n.prototype.instrumentLoadCompeleteEvent=function(n){nt.downloadJson(n,ii.autosuggestCallerId,null,null,null,!1,null,!1)},n.prototype.instrumentSelectionEvent=function(n){if(n.instrumentationInfo){var t=n.instrumentationInfo.pingUrlBase;t+=n.readLinkPingSuffix;nt.downloadGeneric(t,ii.autosuggestCallerId,null)}},n.prototype.getConversationId=function(){return this._conversationId},n.prototype._resetConversationId=function(){this._conversationId=a._generateRandomKey()},n.prototype._getFormattedDate=function(n,t){var o=n.getFullYear().toString(),i=n.getMonth()+1,r=n.getDate(),u=n.getHours(),f=n.getMinutes(),e=n.getSeconds();return t.replace("{yyyy}",o).replace("{mm}",i<10?"0"+i.toString():i.toString()).replace("{dd}",r<10?"0"+r.toString():r.toString()).replace("{hh}",u<10?"0"+u.toString():u.toString()).replace("{nn}",f<10?"0"+f.toString():f.toString()).replace("{ss}",e<10?"0"+e.toString():e.toString())},n.prototype._getEventNameFromType=function(n){switch(n){case 1:return ut.searchEventSuggestionSelectSuggestionClick;case 2:return ut.searchEventEnterPress;case 3:return ut.searchEventSuggestionSelectEnterPress;case 4:return ut.searchEventSuggestionShown;case 6:return ut.searchEventSearchButtonClick;case 5:return ut.searchEventSuggestionSelectSearchButtonClick}},n.prototype._getSuggestionItemInstrumentationData=function(n){var t={};return n&&(t.S=ut.suggestionSourceServer,t.Eid=n.suggestionTextLine1+"~"+n.suggestionTextLine2+"~"+(n.suggestion.entityId||""),t.C=n.suggestion.type,t.G=n.suggestion.subType),t},n}(),lr=function(){function n(){}return n.saveWaypoint=function(t){var u=t.getAddress(),i,r;if(u&&n._saveHistoryEnabled()){if(n.getWaypoints(),n.historyWaypoints.length)for(i=0;i<n.historyWaypoints.length;i++)if(r=n.historyWaypoints[i],r.getAddress().toLowerCase()===u.toLowerCase()&&r.getTitle().toLowerCase()===t.getTitle().toLowerCase()){n.historyWaypoints.splice(i,1);break}n.historyWaypoints.unshift(t);n.historyWaypoints.length>=n.Max_limit&&n.historyWaypoints.splice(n.Max_limit,n.historyWaypoints.length-n.Max_limit);n.commitChanges()}},n.getWaypoints=function(t){var f,e,r,o,u,s,h,i;if(!n._saveHistoryEnabled())return[];if((!n.historyWaypoints||n.historyWaypoints.length===0)&&(f=lt.getItem(n.SearchHistoryLocalStorageKey),n.historyWaypoints=[],f))for(e=f.split("$"),i=0;i<e.length;i++)r=e[i].split("|"),o=null,r[2].length>0&&r[3].length>0&&(o=new dt(parseFloat(r[2]),parseFloat(r[3]))),u=new gf(r[0],r[1],"",null,o),n.historyWaypoints.push(u);if(!t||t.length===0)return n.historyWaypoints;for(t=t.toLowerCase(),s=[],h=[],i=0;i<n.historyWaypoints.length;i++){var u=n.historyWaypoints[i],c=u.getAddress(),l=u.getTitle(),a=c&&c.toLowerCase().indexOf(t),v=l&&l.toLowerCase().indexOf(t);a===0||v===0?h.push(u):Math.max(a,v)>0&&s.push(u)}return h.concat(s)},n.commitChanges=function(){var r,t;if(n.historyWaypoints.length>0){for(r="",t=0;t<n.historyWaypoints.length;t++){var i=n.historyWaypoints[t],u=i.getRoutableLocation(),f=u&&i.getLocationType()==="StreetAddress",e=n.SerializedWaypointFormat.replace("{title}",i.getTitle().replace(/[\|$]/g,"")).replace("{address}",i.getAddress().replace(/[\|$]/g,"")).replace("{lat}",f?u.latitude.toString():"").replace("{long}",f?u.longitude.toString():"");t!==n.historyWaypoints.length-1&&(e+="$");r+=e}lt.setItem(n.SearchHistoryLocalStorageKey,r)}},n.removeAll=function(){n._saveHistoryEnabled()&&(n.historyWaypoints=[],lt.removeItem(n.SearchHistoryLocalStorageKey))},n.isHistoryEnabled=function(){if(n._saveHistoryEnabled()){var t=lt.getItem(n.SaveSearchHistoryKey);return t==="0"?!1:!0}return!1},n.resetIsHistoryEnabled=function(t){n._saveHistoryEnabled()&&lt.setItem(n.SaveSearchHistoryKey,t?"1":"0")},n._saveHistoryEnabled=function(){return lt.isEnabled()},n.SearchHistoryLocalStorageKey="BingMapsSearchHistory",n.SaveSearchHistoryKey="BingMapsSaveSearchHistory",n.historyWaypoints=[],n.Max_limit=100,n.SerializedWaypointFormat="{title}|{address}|{lat}|{long}",n}(),ar=function(){function n(n,t,i,u,f){var e=t[0];this._map=f;this._searchBoxContainer=n;this._instrumentationHelper=new ie;this._autosuggestViewModel=u;this._autosuggestViewModel.setAsTextBox(e);this._autosuggestViewModel.setInstrumentationHelper(this._instrumentationHelper);this._autosuggestViewModel.setCssClass(i+" as_container");this._autosuggestViewModel.setMap(f);this.asTextBox=t;r(e).set_attr("autocorrect","off").set_attr("autocapitalize","off");this.attachEvents()}return n.prototype.stopAutosuggest=function(n){n===void 0&&(n=!0);this._removeGlobalEventHandlers();this._onAutosuggest&&this._onAutosuggest.invoke(!1);this._onFocusEvent&&this._onFocusEvent.invoke(!1);this._autosuggestViewModel.stopAutosuggestion();n&&this.asTextBox[0].blur()},n.prototype.removeEventHandlers=function(){this._onKeyDownHandler&&this.asTextBox.remove_event("keydown",this._onKeyDownHandler);this._onKeyDownHandler=null;this._onFocusHandler&&this.asTextBox.remove_event("focus",this._onFocusHandler);this._onFocusHandler=null;this._onClickHandler&&this.asTextBox.remove_event("click",this._onClickHandler);this._onClickHandler=null;this._onTextboxBlurHandler&&this.asTextBox.remove_event("blur",this._onTextboxBlurHandler);this._onTextboxBlurHandler=null;this._onInputChangeHandler&&this.asTextBox.remove_event("input",this._onInputChangeHandler);this._onInputChangeHandler=null},n.prototype.setItemSelectionEventHandler=function(n){this._autosuggestViewModel.setItemSelectionEventHandler(n)},n.prototype.setItemClickEventHandler=function(n){this._autosuggestViewModel.setItemClickEventHandler(n)},n.prototype.setSuggestionRequestHandler=function(n){this._suggestionRequestHandler=n},n.prototype.setFocusEventHandler=function(n){this._onFocusEvent=n},n.prototype.setClickEventHandler=function(n){this._onClickEvent=n},n.prototype.setAutosuggestKeydownHandler=function(n){this._onAutosuggestKeydown=n},n.prototype.setOnAutosuggestHandler=function(n){this._onAutosuggest=n},n.prototype.setAutosuggestBlurHandler=function(n){this._onAutosuggestBlur=n},n.prototype.instrumentSearchButtonClickEvent=function(){var n=this._autosuggestViewModel.getSelectedSuggestion(),t=6;n&&(t=5);this._instrumentationHelper&&this._instrumentationHelper.instrumentSearchEvent(this._getSearchTerm(),t,n)},n.prototype.refreshAutosuggest=function(){g.isEnabled&&this._updateSuggestions()},n.prototype.attachEvents=function(){var n=this;this._onKeyDownHandler||(this._onKeyDownHandler=function(t){return n._onKeyDown(t)},this.asTextBox.add_event("keydown",this._onKeyDownHandler));this._onFocusHandler||(this._onFocusHandler=function(){return n.onFocus()},this.asTextBox.add_event("focus",this._onFocusHandler));this._onClickHandler||(this._onClickHandler=function(){return n._onClick()},this.asTextBox.add_event("click",this._onClickHandler));this._onTextboxBlurHandler||(this._onTextboxBlurHandler=function(){return n._onBlur()},this.asTextBox.add_event("blur",this._onTextboxBlurHandler));this._onInputChangeHandler||(this._onInputChangeHandler=function(){return n._startAutosuggest()},this.asTextBox.add_event("input",this._onInputChangeHandler))},n.prototype._attachGlobalEvents=function(){var n=this;this._onWindowsBlurHandler||(this._onWindowsBlurHandler=function(t){t.target.tagName==="INPUT"||document.activeElement.tagName==="INPUT"||n._searchBoxContainer.has(t.target)||n._onBlur()},r(window).add_event("blur,mousewheel,mousedown,touchmove",this._onWindowsBlurHandler));!this._onMapObjectBlurHandler&&this._map&&(this._onMapObjectBlurHandler=function(){return n._onBlur()},this._map.mapTapped.add(this._onMapObjectBlurHandler),this._map.mapPanStarted.add(this._onMapObjectBlurHandler))},n.prototype._removeGlobalEventHandlers=function(){this._onWindowsBlurHandler&&r(window).remove_event("blur,mousewheel,mousedown,touchmove",this._onWindowsBlurHandler);this._onWindowsBlurHandler=null;this._onMapObjectBlurHandler&&this._map&&(this._map.mapTapped.remove(this._onMapObjectBlurHandler),this._map.mapPanStarted.remove(this._onMapObjectBlurHandler),this._onMapObjectBlurHandler=null)},n.prototype.onFocus=function(){this._attachGlobalEvents();this.asTextBox.set_style({"background-color":"#fff"});this._onAutosuggest&&this._onAutosuggest.invoke(!0);this._onFocusEvent&&this._onFocusEvent.invoke(!0)},n.prototype._onClick=function(){this._onClickEvent&&this._onClickEvent.invoke()},n.prototype._onBlur=function(){w.isMapsVertical&&this.asTextBox.set_style({"background-color":"transparent"});this.stopAutosuggest();this._onAutosuggestBlur&&this._onAutosuggestBlur.invoke()},n.prototype._onKeyDown=function(n){var i=n,t=i.keyCode||i.which,r,u;t===38?(n.preventDefault(),this._autosuggestViewModel.selectPreviousItem()):t===40?(n.preventDefault(),this._autosuggestViewModel.selectNextItem()):t===27?(n.preventDefault(),this._autosuggestViewModel.stopAutosuggestion()):t===13&&(r=this._autosuggestViewModel.getSelectedSuggestion(),u=2,r&&(u=3),this._instrumentationHelper&&this._instrumentationHelper.instrumentSearchEvent(this._getSearchTerm(),u,r));this._onAutosuggestKeydown&&this._onAutosuggestKeydown.invoke(i)},n.prototype._startAutosuggest=function(){var n=this,t=function(){n.refreshAutosuggest()};Microsoft.Maps.setTimeout(t,0)},n.prototype._updateSuggestions=function(){var n={searchText:this._getSearchTerm(),userLocation:this._getUserLocation(),localMapView:this._getMapViewPort()};this._suggestionRequestHandler&&this._suggestionRequestHandler.invoke(n);this._autosuggestViewModel.updateSuggestions(n,this._searchBoxContainer)},n.prototype._getMapViewPort=function(){if(this._map){var n=kt.getMapBounds(this._map),t=[n.getNorth(),n.getWest(),n.getSouth(),n.getEast()];return t.join(",")}return""},n.prototype._getUserLocation=function(){return w.dynamicProperties.location?w.dynamicProperties.location+",100":""},n.prototype._getSearchTerm=function(){return this.asTextBox[0].value},n}(),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),re=function(n){function t(t,i,u,f,e,o){var s=n.call(this,t,i,u,f,e)||this;return s._backButton=o,s._rootContainer=r("#container"),s.attachEvents(),s}return e(t,n),t.prototype.stopAutosuggest=function(){n.prototype.stopAutosuggest.call(this);this._onBackButtonClick(null)},t.prototype.removeEventHandlers=function(){n.prototype.removeEventHandlers.call(this);this._onBackButtonClickHandler&&this._backButton&&this._backButton.remove_event("click",this._onBackButtonClickHandler)},t.prototype.attachEvents=function(){var t=this;n.prototype.attachEvents.call(this);!this._onBackButtonClickHandler&&this._backButton&&(this._onBackButtonClickHandler=function(n){return t._onBackButtonClick(n)},this._backButton.add_event("click",this._onBackButtonClickHandler))},t.prototype._onBackButtonClick=function(n){this.asTextBox.remove_class("focused");this.asTextBox.set_style({width:null});this._rootContainer.remove_class("hideAll");n&&n.preventDefault();n&&n.stopPropagation()},t.prototype.onFocus=function(){var i,r;n.prototype.onFocus.call(this);this.asTextBox.add_class("focused");i=parseInt(this._backButton.get_style("width").replace("px",""));this.asTextBox.set_style({width:window.innerWidth-i-t.focusedInputboxMargin+"px"});this._rootContainer.add_class("hideAll");r={action:"updateLayout",state:{layoutType:"expandCard"}};f.invokeHandler(u.layoutDataHandlerKey,r)},t.focusedInputboxMargin=16,t}(ar),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ue=function(n){function t(t,i,r,u,f,e){var o=this,s={};return o=n.call(this,s)||this,s.defineProperty("showNearBySearchText"),s.defineProperty("showSuggestionsPanel",function(n,t){o._onVisibleChanged(n,t)},null,{defaultValue:!1}),s.defineProperty("showBingLogo",null,null,{defaultValue:!w.isMapsVertical}),s.defineProperty("width",null,null,{defaultValue:0}),s.defineProperty("cssClass"),o._displayWaterMarkText=r,o._controlTemplateFactory=i,o._autosuggestDataModel=t,o.templateId=yu,o._suggestions=[],o._mapTemplateSelectorReadyEvent=new v,o.taskName=u||a._generateRandomKey(),o._visibilityChangedEvent=f,o._selectionChangedEvent=e,o}return e(t,n),t.prototype.setMap=function(n){var t=this;this._map=n;this._map&&this._map.getTemplateSelector().then(function(n){t._mapTemplateSelector=n;t._mapTemplateSelectorReadyEvent.invoke()})},t.prototype.setAsTextBox=function(n){this._asTextBox=n},t.prototype.setItemSelectionEventHandler=function(n){this._itemSelectionEvent=n},t.prototype.setItemClickEventHandler=function(n){this._itemClickEvent=n},t.prototype.updateSuggestions=function(n,t){var i=this;this.selectedItemIndex=-1;this._request=n;this.setSuggestions([]);this._autosuggestDataModel.getSuggestions(n,function(r){i._onSuggestionsCallBack(n.searchText,t,r)})},t.prototype.boolToVisibility=function(n){return n?"visible":"hidden"},t.prototype.boolToSelectedClassName=function(n){return n?"suggestLink selected":"suggestLink"},t.prototype.boolToDisplay=function(n){return n?"inline":"none"},t.prototype.numberToPixelString=function(n){return n?n.toString()+"px":""},t.prototype.stopAutosuggestion=function(){this.removeWidth();this.setShowSuggestionsPanel(!1)},t.prototype.selectNextItem=function(){var n=this._suggestions.length;if(n!==0)return(this.selectedItemIndex>=0&&this._suggestions[this.selectedItemIndex].setIsSelected(!1),this.selectedItemIndex++,this.selectedItemIndex>=n)?(this.selectedItemIndex=-1,!1):(this._suggestions[this.selectedItemIndex].setIsSelected(!0),this._suggestions[this.selectedItemIndex].select(),this._selectionChangedEvent&&this._selectionChangedEvent.invoke(this._suggestions[this.selectedItemIndex].optionId),!0)},t.prototype.selectPreviousItem=function(){var n=this._suggestions.length;if(n!==0)return(this.selectedItemIndex>=0&&this._suggestions[this.selectedItemIndex].setIsSelected(!1),this.selectedItemIndex--,this.selectedItemIndex<0)?(this.selectedItemIndex=-1,!1):(this._suggestions[this.selectedItemIndex].setIsSelected(!0),this._suggestions[this.selectedItemIndex].select(),this._selectionChangedEvent&&this._selectionChangedEvent.invoke(this._suggestions[this.selectedItemIndex].optionId),!0)},t.prototype.removeWidth=function(){var n=r(".as_container_search"),t;n&&(t=n.get_attr("style"),t.indexOf("width")>-1&&t.indexOf("visibility")===-1&&(n.remove_attr("style"),n.set_attr("style","visibility: hidden")))},t.prototype._setWidth=function(){var t=r(".as_container_search")[0],n,i,u;t&&this._asTextBox.id&&this._asTextBox.id.indexOf("maps_sb")>-1?(n=t.parentElement,n&&n.id.indexOf("maps_sb_container")>-1&&n.querySelector(":focus")&&(i=n.parentElement,u=Number(i.clientWidth),t.setAttribute("style","width: "+u+"px"),this._adjustIconCentering())):this.removeWidth()},t.prototype._onSuggestionsCallBack=function(n,t,i){var u=i.suggestions,f,r;if((document.activeElement===this._asTextBox||!this._asTextBox)&&n===this._request.searchText)if(u.length>0){for(f=[],r=0;r<u.length;r++)f.push(new yi(u[r],this._itemSelectionEvent,this._itemClickEvent,this._instrumentationHelper,this.taskName+"-as-"+r));this._instrumentationHelper&&this._instrumentationHelper.resetLastShownSuggestionsTime();this.setSuggestions(f);this._instrumentationHelper&&this._instrumentationHelper.instrumentSearchEvent(n,4,this.getSelectedSuggestion());this._applyAutoSuggestControlTemplateBinding(t,n);this._updateCategoryIconsAfterSelectorReady(t);this.removeWidth();this._setWidth();this._adjustIconCentering()}else this.removeWidth(),this.setShowSuggestionsPanel(!1)},t.prototype._updateCategoryIconsAfterSelectorReady=function(n){var t=this;!this._mapTemplateSelector&&this._map?this._mapTemplateSelectorReadyEvent.addOne(function(){t._updateCategoryIcons(n)}):this._mapTemplateSelector&&this._updateCategoryIcons(n)},t.prototype._updateCategoryIcons=function(n){for(var e,t,i,o,f=this.getSuggestions(),s=n.select("[data-tag=as_img]"),u=0;u<f.length;u++)if(e=f[u].suggestion.primaryCategoryPath,e&&(t=e.split("."),t&&t.length>0))for(i=t.length-1;i>=0;i--)if(it.localCatIdBucketMapping[t[i]]){f[u].categoryId=t[i];o=r(s[u]);this._updateCategoryIconAfterDownload(t[i],o);break}},t.prototype._updateCategoryIconAfterDownload=function(n,t){this._mapTemplateSelector.getCardVectorImageTemplateAsync(function(n){n&&(t.clear(),t.remove_class("search business address skiarea airport"),t.append(n.renderIcon()))},n)},t.prototype._onVisibleChanged=function(n,t){r.Browser.is_ie&&n!==t&&(this.nearBySearchText=this._asTextBox&&this._displayWaterMarkText?this._asTextBox.getAttribute("placeholder"):"");this.setShowNearBySearchText(this.nearBySearchText&&this.nearBySearchText!=="");this.removeWidth();this._visibilityChangedEvent&&this._visibilityChangedEvent.invoke(t)},t.prototype._applyAutoSuggestControlTemplateBinding=function(n,t){var u={templateText:this.templateId,staticResources:this},f=this._controlTemplateFactory(u),e=f.applyDataTemplate(this),i=r(".as_container",n[0]);i&&i.removeFromParent();t===this._request.searchText&&(n.append(e),this.setShowSuggestionsPanel(!0))},t.prototype.setSuggestions=function(n){this._suggestions=n;this._instrumentationHelper&&this._instrumentationHelper.setRequestAndSuggestions(this._request,n)},t.prototype.setInstrumentationHelper=function(n){n&&(this._instrumentationHelper=n,this._autosuggestDataModel.setInstrumentationHelper(this._instrumentationHelper))},t.prototype.getSuggestions=function(){return this._suggestions},t.prototype.getSelectedSuggestion=function(){return this.selectedItemIndex>=0?this._suggestions[this.selectedItemIndex].suggestion:null},t.prototype.getFirstSuggestion=function(){return this._suggestions.length>0?this._suggestions[0].suggestion:null},t.prototype.dispose=function(){this._map=null;a._disposeEvents(this);a._clearDisposables(this._suggestions);n.prototype.dispose.call(this)},t.prototype._adjustIconCentering=function(){for(var n,u,f,i=r(".as_suggestion_root_inside"),t=0;t<i.length;t++)n=i[t],n&&(u=n.clientHeight,f=n.getElementsByClassName("as_img")[0],r(f).set_style({height:u}))},t}(ot),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),yi=function(n){function t(t,i,r,u,f){var e=this,o={};return e=n.call(this,o)||this,e.suggestion=t,o.defineProperty("isSelected",null,null,{defaultValue:!1}),e._formatSuggestion(e.suggestion),e._applyImageClass(t),e.setSimpleSearchText(),e._itemSelectionEvent=i,e._itemClickEvent=r,e._instrumentationHelper=u,e.optionId=f,e}return e(t,n),t.prototype.setSimpleSearchText=function(){var n=this._formattingRule&&this._formattingRule["b:groupSeparator"]||", ";if(this.suggestion.type==="Favorite"&&this.suggestionTextLine2){var t=this.suggestion,i=t.name,r=t.address&&t.address.streetAddress;this._searchText=i===r||!r?i:i+n+r}else this._searchText=this.suggestionTextLine2?g.searchTextFormat?g.searchTextFormat.replace("{line1}",this.suggestionTextLine1).replace("{line2}",this.suggestionTextLine2).replace("{separator}",n):this.suggestionTextLine1+n+this.suggestionTextLine2:this.suggestionTextLine1;this.suggestion&&(this.suggestion.searchText=this._searchText)},t.prototype.handleSuggestionClick=function(n){n.currentTarget&&(this._itemClickEvent&&this._itemClickEvent.invoke(this.suggestion),this._instrumentationHelper&&this._instrumentationHelper.instrumentSearchEvent(this._searchText,1,this.suggestion))},t.prototype.select=function(){this._itemSelectionEvent&&this._itemSelectionEvent.invoke(this.suggestion)},t.prototype.dispose=function(){a._disposeEvents(this);this.suggestion=null;n.prototype.dispose.call(this)},t.prototype._formatSuggestion=function(n){var r=this.suggestion.formattingRule,t=n;if(n.type==="Favorite"){this.suggestionTextLine1=t.subType==="Home"?i.L_Home:t.subType==="Work"?i.L_Work:t.alternateName?t.alternateName:t.name;this.suggestionTextLine2=t.address&&t.address.streetAddress;this.suggestion.formatedAddress=t.address&&t.address.streetAddress;this.suggestion.title=t.name;return}t.name&&(this.suggestionTextLine1=t.name,n.title=t.name);t.query&&(this.suggestionTextLine1=t.query);r?(this._formattingRule=r,this.suggestion.address?this._applyFormattingRule(this.suggestion.address):this._applyFormattingRule(n.root)):(this.suggestionTextLine1=n.title,this.suggestionTextLine2=n.formatedAddress)},t.prototype._applyFormattingRule=function(n){var t=0,i=this._formattingRule["b:fieldGroups"]||this._formattingRule.fieldGroups,r,u,f,e;if(!this.suggestionTextLine1)for(;t<i.length;t++)if(r=this._getFormattedGroupString(n,i[t]),r){this.suggestionTextLine1=r;this.suggestion.title=r;++t;break}for(u=[];t<i.length;t++)f=this._getFormattedGroupString(n,i[t]),f&&u.push(f);e=this._formattingRule["b:groupSeparator"]||this._formattingRule.groupSeparator||", ";this.suggestionTextLine2=u.join(e);this.suggestion.formatedAddress=this.suggestionTextLine2},t.prototype._applyImageClass=function(n){if(n.type==="s:BusinessEntityType"&&n.subType==="BusinessCategory"||n.type==="SearchAction")this.suggestionImgClass="as_img search";else if(n.type==="s:LocalBusiness"&&n.subType)switch(n.subType){case"SkiArea":this.suggestionImgClass="as_img skiarea";break;case"Airport":this.suggestionImgClass="as_img airport";break;case"Business":default:this.suggestionImgClass="as_img business"}else this.suggestionImgClass=n.type&&(n.type.indexOf("Place")>=0||n.type.indexOf("PostalAddress")>=0)?"as_img address":n.title===i.L_Work||n.subType==="Work"?"as_img work":n.title===i.L_Home||n.subType==="Home"?"as_img home":n.type==="Favorite"?"as_img favorite":n.title===i.L_MyLocation?"as_img mylocation":n.type===t.HistorySuggestionType?"as_img history":n.entityId&&n.entityId.indexOf("local_geoid")<0?"as_img business":"as_img search"},t.prototype._getFormattedGroupString=function(n,t){for(var e,f=[],i,u=t.fields,r=0;r<u.length;r++)i=this._getPrimaryField(n,u[r]),i||(i=this._getAlternateField(n,u[r])),i&&f.push(i);return e=t.fieldSeparator||" ",f.join(e)},t.prototype._getPrimaryField=function(n,t){var i;return n&&t&&(i=n[t.name]),i},t.prototype._getAlternateField=function(n,t){var r,u,f,i;if(n&&t&&(u=t.alternateField,u))for(f=u.split(","),i=0;i<f.length;i++)if(r=n[f[i]],r)break;return r},t.HistorySuggestionType="history",t}(ot),fe='<div class="{Binding className}" style:display="{Binding ads Converter=adsToDisplay}" data-tag="ad_container">\t<a class="adChoiceIcon" href="{Binding choiceUrl}" target="_blank"><\/a>\t<ItemsControl ItemsSource="{Binding ads}" panelTagName="ul">\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li>\t\t\t\t\t<a href="{Binding title.url}" data-log="{Binding title.log}" event:click="onClick" target="_blank">\t\t\t\t\t\t<h2><TextBlock Text="{Binding title.text}" /><\/h2>\t\t\t\t\t\t<span class="b_adSlug"><TextBlock Text="{StaticBinding resources.L_AdSlug}" /><\/span><cite><TextBlock Text="{Binding displayUrl}" /><\/cite>\t\t\t\t\t\t<div><TextBlock Text="{Binding description}" /><\/div>\t\t\t\t\t\t<AdRating data="{Binding rating}" rank="{Binding rank}" />\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ee=function(n){function t(t,r){var u=this,e={},f;return u=n.call(this,e,r,fe)||this,u.resources=i,e.defineProperty("ads"),u._syndicatedAds=t,u.choiceUrl=tt.choiceUrl,u.className="syndicatedAds",f=tt.adsFlightId,f&&(u.className+=" saFlight"+f),u}return e(t,n),t.prototype.onClick=function(n){var f="data-log",t=n.target,i=t&&t.getAttribute(f),r,u;if(i||(t=n.currentTarget,i=t&&t.getAttribute(f)),i){var e=i.split("|"),o={L:e[0]},s=this._syndicatedAds.getLogData();s&&(o.D=s);ht.logEvent(this._syndicatedAds.getTracingTag(),ft.C,o);r=e[1];this._pingUrlBase&&r&&(u=new XMLHttpRequest,u.open("GET",this._pingUrlBase+r,!0),u.send())}},t.prototype.SetResponse=function(n){var h=[],i={},l=!0,r,f,u,e,c,t,o,s;try{if(n&&n.length&&(r=JSON.parse(n),r))if(r._type==="Ads"){if(f=r,u=f.value,u&&u.length)for(e=0;e<u.length;e++)c=this._buildAdV5(u[e],i),c&&h.push(c);f.instrumentation&&(this._pingUrlBase=f.instrumentation.pingUrlBase);i.C=h.length;l=!1}else if(r._type==="ErrorResponse"){if(t="",o=r.errors,o)for(s=0;s<o.length;s++)t.length>0&&(t+=","),t+=o[s].code;i.ER=t}this.setAds(h)}catch(t){this.setAds(null);i.EX=t&&t.message}return l&&(i.RE=typeof n=="string"?n.substring(0,50):""),i},t.prototype.Clear=function(){this.setAds(null)},t.prototype._buildAdV5=function(n,t){var i,s,u,f,r,e,o,h,c;if(n.extensions)for(f=0;f<n.extensions.length;f++)if(r=n.extensions[f],r)switch(r._type){case"Ads/MerchantRatingExtension":s=r;break;case"Ads/LocationExtension":u=u||[];u.push(r);break;case"Ads/CreativeAnnotation":if(e=r.overrides,e)for(o=0;o<e.length;++o)h=e[o],(!i||h.maxTitleLength<i.maxTitleLength)&&(i=h)}return c={rank:n.rank,title:{text:i&&i.title?i.title:n.title,url:n.url,log:"T,"+n.rank+"|"+n.urlPingSuffix},displayUrl:n.displayUrl,description:i&&i.description?i.description:n.description},u,s&&(c.rating=s,t.M=t.M?t.M+1:1),c},t.prototype.adsToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},t}(at),oe=function(){function n(n,t){this._controlTemplateFactory=n;this.setScenario(t)}return n.prototype.getControl=function(){return this._getViewModel().getControl()},n.prototype.requestAds=function(t,i,r,u){var o=this,f,e,h;if(n.isEnabled()&&(t&&(t=t.trim()),this._query!==t)){if(this._query=t,f=this._getViewModel(),!t||!t.length||!r){f.Clear();return}if(u){if(e=n._cache=n._cache||new kr(16),h=e.getItem(u),h){f.SetResponse(h);return}e.addItem(u,"{}")}var s=tt,c=s.tag1,l=s.tag2,v=i.latitude.toFixed(5),y=i.longitude.toFixed(5),p=a._formatString(s.adsEndpointUrl,encodeURIComponent(t),v,y,r,s.ratings?"r":"",w.dynamicProperties.market,this._tracingTag+(c?","+c:"")+(l?","+l:""));nt.downloadGeneric(p,"ads",function(n){var i=f.SetResponse(n);i.Q=t;o._logData&&(i.D=o._logData);ht.logEvent(o._tracingTag,ft.R,i);u&&e&&i.C&&e.addItem(u,n)},null,function(n,t,i){f.Clear();ht.logEvent(o._tracingTag,ft.N,{ER:(t||"")+","+(i||"")})},null,0);ht.logEvent(this._tracingTag,ft.Q,{Q:t,CP:v+","+y})}},n.prototype.setAds=function(n){ht.logEvent(this._tracingTag,ft.R,this._getViewModel().SetResponse(n))},n.isEnabled=function(){if(tt&&tt.detectHidden&&!n.hiddenTested){n.hiddenTested=!0;var i=document.body,t=document.createElement("div");t.className="syndicatedAds";i.appendChild(t);n.hidden=!t.offsetHeight;i.removeChild(t)}return!!(tt&&tt.isEnabled&&!n.hidden)},n.prototype.setScenario=function(n,t){this._tracingTag=n?ri[n]:"";var t=t||tt&&tt.adsFlightId;t&&(this._tracingTag+=t)},n.prototype.getTracingTag=function(){return this._tracingTag},n.prototype.setLogData=function(n){this._logData=n},n.prototype.getLogData=function(){return this._logData},n.logError=function(n){var t=typeof n=="string"?n:n&&(n.message||n.result);ht.logEvent("",ft.E,{EX:t||""})},n.prototype._getViewModel=function(){return this._viewModel||(this._viewModel=new ee(this,this._controlTemplateFactory)),this._viewModel},n.hiddenTested=!1,n.hidden=!1,n}(),ri;(function(n){n[n.TST=1]="TST";n[n.LI=2]="LI";n[n.PD=4]="PD";n[n.HO=5]="HO";n[n.PL=6]="PL";n[n.CT=8]="CT";n[n.DR=9]="DR";n[n.LS=10]="LS";n[n.DE=11]="DE";n[n.OD=12]="OD"})(ri||(ri={})),function(n){n[n.Q=1]="Q";n[n.R=2]="R";n[n.N=3]="N";n[n.C=4]="C";n[n.E=5]="E"}(ft||(ft={}));ht=function(){function n(){}return n.logEvent=function(t,i,r){r.SC=t;var e={logData:{feature:n.featureName,action:ft[i],data:r}};f.invokeHandler(u.instrumentationDataHandlerKey,e)},n.featureName="ADS",n}();vr=function(){function n(){this.resources=i}return n.prototype.getRootElement=function(){var n,t,r,u,i,f;if(!this._root&&(n=this.data,n)){for(this._root=a._createElement("div").add_class("saRating"),t=document.createElement("a"),t.href=n.ratingLink,t.target="_blank",t.setAttribute("data-log","R,"+this.rank+"|"+n.ratingLinkPingSuffix),t.textContent=a._formatString(this.resources.L_AdReviewCount,n.numberOfRatings),r=n.rating/2,u=document.createElement("span"),u.title=a._formatString(this.resources.L_AdRatingTooltip,r),i=0;i<5;++i)f="sw_sth",r<=i?f="sw_ste":r>=i+1&&(f="sw_st"),u.appendChild(document.createElement("span")).className=f;this._formatDomString(this._root,this.resources.L_AdRating,n.domain,u,null,t)}return this._root},n.prototype._formatDomString=function(n,t){for(var f,e,o,r,c,s=[],u=2;u<arguments.length;u++)s[u-2]=arguments[u];if(t&&s){var l=/\d+/g,i=0,h=t.match(/{\d+}/g);if(h)for(f=0;f<h.length;f++)e=h[f],o=t.indexOf(e,i),o>i&&n.appendText(t.substring(i,o)),r=s[Number(e.match(l)[0])],r!==null&&(c=typeof r,c!=="undefined"&&(c==="string"?n.appendText(r):n.append(r))),i=o+e.length;i<t.length&&n.appendText(t.substring(i))}},n}();b.registerControl("AdRating",vr);var e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),se=function(n){function t(t,i){var r=n.call(this,i)||this;return r.setDropdown(t),r.taskBarListDropDownTemplate=lu,r}return e(t,n),t.prototype.boolTodisplay=function(n){return n?"inline-block":"none"},t.prototype.onEntryClicked=function(t){if(t>=0&&t<this.dropdownList.length){var i=this.dropdownList[t];i.cssClass==="feedbackMenuLink"?i.mouseoverhandler.call(this,null,t):n.prototype.onEntryClicked.call(this,t)}},t.prototype.onEntryMouseover=function(n){var r=this,i;n>=0&&n<this.dropdownList.length&&(i=this.dropdownList[n],i.cssClass==="feedbackMenuLink"&&(window.clearTimeout(t._mouseOverDelayHandle),t._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i.mouseoverhandler.call(r,null,n)},t._mouseTimeout)))},t.prototype.onEntryMouseout=function(n){if(n>=0&&n<this.dropdownList.length){var i=this.dropdownList[n];i.mouseouthandler&&(window.clearTimeout(t._mouseOverDelayHandle),i.mouseouthandler.call(this,null,n))}},t._mouseTimeout=250,t}(st),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),he=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("itemList"),i.defineProperty("displayDropdown"),i.defineProperty("buttonName"),i.defineProperty("buttonIcon"),i.defineProperty("dropdownTitle"),t.setTemplate(new b(ce,{boolToDisplay:function(n){return t._boolToDisplay(n)},onDropdownButtonClick:function(n){t._onDropdownButtonClick(n)},itemCheckedClass:function(n){return t._itemCheckedClass(n)},dropdownOpenClass:function(n){return t._dropdownOpenClass(n)},mouseoverDropdown:function(n){t._mouseoverDropdownHandler(n)},mouseexitDropdown:function(n){t._mouseexitDropdownHandler(n)}})),t}return e(t,n),t.prototype._boolToDisplay=function(n){return n?"":"none"},t.prototype._onDropdownButtonClick=function(n){this.setDisplayDropdown(!0);n&&n.preventDefault&&n.preventDefault()},t.prototype._itemCheckedClass=function(n){return"multiselectCheckbox"+(n?" checked":"")},t.prototype._dropdownOpenClass=function(n){return"dropdownButton"+(n?" open":"")},t.prototype._mouseoverDropdownHandler=function(n){var t=this;window.clearTimeout(this._mouseoverDelay);this._mouseoverDelay=Microsoft.Maps.setTimeout(function(){t.setDisplayDropdown(!0)},50);this._tempButtonIcon||(this._tempButtonIcon=this.getButtonIcon());this.setButtonIcon(this._tempButtonIcon+" hover");n&&n.preventDefault&&n.preventDefault()},t.prototype._mouseexitDropdownHandler=function(n){var t=this;window.clearTimeout(this._mouseoverDelay);this._mouseoverDelay=Microsoft.Maps.setTimeout(function(){t.setDisplayDropdown(!1)},200);this.setButtonIcon(this._tempButtonIcon);n&&n.preventDefault&&n.preventDefault()},t}(yt);b.registerControl("MultiselectDropdown",he);var ce='<div class="bm_dropdownContainer">    <a class="{TemplateBinding DisplayDropdown Converter=dropdownOpenClass}" data-tag="dropdownButton" event:click="onDropdownButtonClick" event:mouseleave="mouseexitDropdown" event:mouseenter="mouseoverDropdown" href="#">        <span class="{TemplateBinding ButtonIcon}"><\/span>        <span>            <TextBlock Text="{TemplateBinding ButtonName}" />        <\/span>        <span class="chevron"><\/span>    <\/a>    <div class="dropdownParent">        <div class="multiselectDropdown popOutTop" style:display="{TemplateBinding DisplayDropdown Converter=boolToDisplay}" event:mouseleave="mouseexitDropdown" event:mouseenter="mouseoverDropdown">            <div class="dropdownTitle" style:display="{TemplateBinding DropdownTitle Converter=boolToDisplay}">                <TextBlock Text="{TemplateBinding DropdownTitle}" />            <\/div>            <ItemsControl ItemsSource="{TemplateBinding ItemList}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div>                            <a class="multiselectItem" data-tag="multiselectItem" data-entityid="{Binding Name}" event:click="onItemClick" href="#">                                <span class="{Binding Checked Converter=itemCheckedClass}"><\/span>                                <span class="{Binding Icon}"><\/span>                                <span class="itemName">                                    <TextBlock Text="{Binding Name}" />                                <\/span>                            <\/a>                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>',e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),le=function(n){function t(t,i){var r=this;return i=i||{},r=n.call(this,i)||this,i.defineProperty("name"),i.defineProperty("checked",function(n,t){r._onChanged(n,t)}),i.defineProperty("icon"),r.setName(t),r.onCheckedChanged=new v,r}return e(t,n),t.prototype.onItemClick=function(n){this.setChecked(!this.getChecked());n.preventDefault()},t.prototype._onChanged=function(n,t){t?this.onCheckedChanged.invoke(!0):n&&this.onCheckedChanged.invoke(!1)},t}(ot),e=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ae=function(n){function t(t,i){return n.call(this,t,i)||this}return e(t,n),t.prototype.setMap=function(t){var i=this;n.prototype.setMap.call(this,t);this.mouseenter.add(function(){i.preventAutoClose=!0});this.mouseleave.add(function(){i.preventAutoClose=!1;i.setOptions({visible:!1})})},t.prototype.setOptions=function(t){t.htmlContent&&(t.htmlContent=this._updateHtmlContent(t.htmlContent));n.prototype.setOptions.call(this,t)},t.prototype._updateHtmlContent=function(n){return'<div class="MapsInfoboxContainer">'+n+"<\/div>"},t.prototype.dispose=function(){n.prototype.dispose.call(this)},t}(br);o.AdsScenario=ri;t.CategoriesBar=ku;t.CategoriesBarItemData=gu;t.CalendarSyncTemplate=nr;t.CalendarSync=wr;t.CalendarSyncViewModel=ci;t.FiltersBarModuleViewModel=vf;t.FiltersBarViewModel=tr;t.FiltersStatusBarViewModel=ir;t.FiltersBar=cf;t.FiltersBarItem=lf;t.FiltersBarItemData=af;t.SignInState=hi;t.CollectionsTaskResponseProcessor=rr;t.ButtonGroupViewModel=pf;t.TabControlRequester=pu;t.TransientLensViewModel=gt;t.PoiTransientLensViewModel=li;t.DetailsPoiTransientLensViewModel=wf;t.CollectionsPoiTransientLensViewModel=bf;t.TransientLens=kf;t.MapsInfobox=ae;o.TransientLensActions=n;t.CommonControls=t.CommonControls||{};t.CommonControls.SyndicatedAds=oe;t.CommonControls.AutosuggestViewModel=ue;t.CommonControls.AutosuggestV2=ar;t.CommonControls.MobileAutosuggestV2=re;t.CommonControls.ListDropdownViewModel=st;t.CommonControls.SuggestionViewModelV2=yi;t.CommonControls.CollectionsListDropdownViewModel=or;t.CommonControls.DirectionsAutosuggestDataModel=ni;t.CommonControls.DirectionsListDropdownViewModel=fr;t.CommonControls.SelectionListDropdownViewModel=sr;t.CommonControls.ItineraryListDropdownViewModel=er;t.CommonControls.ModalDialogViewModel=bi;t.CommonControls.PopOutButtonViewModel=ai;t.CommonControls.PopOutMessageViewModel=cr;t.CommonControls.SearchBoxAutosuggestDataModel=ne;t.CommonControls.CollectionsAutosuggestDataModel=te;t.CommonControls.CollectionPopOutMessageViewModel=vi;t.CommonControls.SearchHistoryLocalStorageHelper=lr;t.CommonControls.TaskBarDropdownViewModel=se;t.CommonControls.SendToMobileDialogViewModel=vu;t.CommonControls.DropdownItem=le}catch(yr){if(t.logger)t.logger.logCriticalError(yr);else throw yr;}}).call(window)